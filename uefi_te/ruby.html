<!DOCTYPE html>
<html dir="ltr" lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>TE (Terse Executable) file.: Ruby parsing library</title>
  <meta name="keywords" content="kaitai,struct,binary,format,parsing,decoding,java,javascript,python,ruby,library,metadata">
  <meta name="description" content="Kaitai Struct is a formal language for binary format specification that can be compiled into parser code">

  <link rel="stylesheet" href="//kaitai.io/styles/bootstrap.min.css">
  <link rel="stylesheet" href="//kaitai.io/styles/bootstrap-theme.min.css">
  <link href='https://fonts.googleapis.com/css?family=Exo:400,700' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Share+Tech+Mono' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

  <link rel="stylesheet" href="//kaitai.io/styles/main.css" type="text/css">

  <link rel="stylesheet" href="//kaitai.io/styles/highlight/default.css">
  <style>
.diagram-img {
    display: block;
    max-width: 100%;
    height: auto;
    margin: 0 auto;
}

section.format {
    padding: 30px 0;
}

section#format-meta, section#format-index-header {
    background: #e3eef7;
}

section#format-diagram, section#format-index-footer {
    background: #e9f8dd;
}

section#format-ksy, section#format-lang {
    background: #d1eadd;
}

section#format-index .row {
    padding-bottom: 10px;
}

  </style>
  <script src="//kaitai.io/js/highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
</head>
<body data-spy="scroll" data-target="#main-navbar" data-offset="100">

    <nav class="navbar navbar-inverse navbar-fixed-top" id="main-navbar">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#main-navbar-collapse" aria-expanded="false">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <span class="navbar-brand">Kaitai Struct</span>
            </div>
            <div class="collapse navbar-collapse" id="main-navbar-collapse">
                <ul class="nav navbar-nav">
                    <li><a href="http://kaitai.io/#what-is-it">What is it?</a></li>
                    <li><a href="http://kaitai.io/#quick-start">Quick Start</a></li>
                    <li><a href="http://kaitai.io/#download">Download</a></li>
                    <li class="active"><a href="http://formats.kaitai.io/">Format Gallery</a></li>
                </ul>
                <ul class="nav navbar-nav navbar-right">
                    <li><a href="http://kaitai.io/repl/index.html">Try it</a></li>
                    <li><a href="https://ide.kaitai.io/">Web IDE</a></li>
                    <li><a href="http://doc.kaitai.io/">Documentation</a></li>
                </ul>
            </div>
        </div>
    </nav>
<nav>
    <div class="container">
    <ol class="breadcrumb">
        <li><a href="../index.html">Format Gallery</a></li>
        <li>Executables and Byte-code</li>
        <li class="active">TE (Terse Executable) file.</li>
    </ol>
    </div>
</nav>

<section id="format-meta" class="format">
    <div class="container">
        <h1>TE (Terse Executable) file.:
            
            Ruby parsing library
            
        </h1>

        <div class="row">
            <div class="col-md-8">
                <p><p>This type of executables could be found inside the UEFI firmware. The UEFI
firmware is stored in SPI flash memory, which is a chip soldered on a
systemâ€™s motherboard. UEFI firmware is very modular: it usually contains
dozens, if not hundreds, of executables. To store all these separates files,
the firmware is laid out in volumes using the Firmware File System (FFS), a
file system specifically designed to store firmware images. The volumes
contain files that are identified by GUIDs and each of these files contain
one or more sections holding the data. One of these sections contains the
actual executable image. Most of the executable images follow the PE format.
However, some of them follow the TE format.</p>
<p>The Terse Executable (TE) image format was created as a mechanism to reduce
the overhead of the PE/COFF headers in PE32/PE32+ images, resulting in a
corresponding reduction of image sizes for executables running in the PI
(Platform Initialization) Architecture environment. Reducing image size
provides an opportunity for use of a smaller system flash part.</p>
<p>So the TE format is basically a stripped version of PE.</p>
</p>
            </div>
            <div class="col-md-4">
                <div class="panel panel-info">
                    
                    <div class="panel-heading">
                        <h3 class="panel-title">Application</h3>
                    </div>
                    <div class="panel-body">
                        UEFI
                    </div>
                    
                    
                    <div class="panel-heading">
                        <h3 class="panel-title">File extension</h3>
                    </div>
                    <div class="panel-body">
                        ["efi", "te"]
                    </div>
                    
                    
                    <div class="panel-heading">
                        <h3 class="panel-title">KS implementation details</h3>
                    </div>
                    
                    <div class="panel-body">
                        License: <a href="https://spdx.org/licenses/CC0-1.0.html">CC0-1.0</a>
                    </div>
                    
                    
                    <div class="panel-body">
                        Minimal Kaitai Struct required: 0.7
                    </div>
                    
                    
                    
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
            <p>
            This page hosts a formal specification of TE (Terse Executable) file.
            using <a href="http://kaitai.io">Kaitai Struct</a>. This
            specification can be automatically translated into a
            variety of programming languages to get a parsing library.
            </p>

            <ul class="nav nav-pills">
                
                
                <li>
                
                <a href="index.html" title="TE (Terse Executable) file. parsing Overview library">Overview</a></li>
                
                
                <li>
                
                <a href="cpp_stl.html" title="TE (Terse Executable) file. parsing C++/STL library">C++/STL</a></li>
                
                
                <li>
                
                <a href="csharp.html" title="TE (Terse Executable) file. parsing C# library">C#</a></li>
                
                
                <li>
                
                <a href="java.html" title="TE (Terse Executable) file. parsing Java library">Java</a></li>
                
                
                <li>
                
                <a href="javascript.html" title="TE (Terse Executable) file. parsing JavaScript library">JavaScript</a></li>
                
                
                <li>
                
                <a href="lua.html" title="TE (Terse Executable) file. parsing Lua library">Lua</a></li>
                
                
                <li>
                
                <a href="perl.html" title="TE (Terse Executable) file. parsing Perl library">Perl</a></li>
                
                
                <li>
                
                <a href="php.html" title="TE (Terse Executable) file. parsing PHP library">PHP</a></li>
                
                
                <li>
                
                <a href="python.html" title="TE (Terse Executable) file. parsing Python library">Python</a></li>
                
                
                <li class="active">
                
                <a href="ruby.html" title="TE (Terse Executable) file. parsing Ruby library">Ruby</a></li>
                
            </ul>
            </div>
        </div>
    </div>
</section>

<section id="format-usage" class="format">
    <div class="container">
        <h2>Usage</h2>

        <p>Parse a local file and get structure in memory:</p>



<pre><code class="ruby">data = UefiTe.from_file("path/to/local/file.["efi", "te"]")</code></pre>

<p>Or parse structure from a string of bytes:</p>

<pre><code class="ruby">bytes = "\x00\x01\x02..."
data = UefiTe.new(Kaitai::Struct::Stream.new(bytes))</code></pre>

<p>After that, one can get various attributes from the structure by invoking getter methods like:</p>

<pre><code class="ruby">data.te_hdr # => get te hdr</code></pre>

    </div>
</section>


<section id="format-lang" class="format">
    <div class="container">
        <h2>
            
            Ruby source code to parse TE (Terse Executable) file.
            
        </h2>

        

        <h3>uefi_te.rb</h3>

        <div class="row">
            <div class="pull-right">
                <p>
                    <a href="src/ruby/uefi_te.rb" class="btn btn-success">Download <i class="fa fa-download"></i></a>
                </p>
            </div>
        </div>

        <div class="row">
            <pre><code class="ruby"># This is a generated file! Please edit source .ksy file and use kaitai-struct-compiler to rebuild

require &#39;kaitai/struct/struct&#39;

unless Gem::Version.new(Kaitai::Struct::VERSION) &gt;= Gem::Version.new(&#39;0.7&#39;)
  raise &quot;Incompatible Kaitai Struct Ruby API: 0.7 or later is required, but you have #{Kaitai::Struct::VERSION}&quot;
end


##
# This type of executables could be found inside the UEFI firmware. The UEFI 
# firmware is stored in SPI flash memory, which is a chip soldered on a 
# systemâ€™s motherboard. UEFI firmware is very modular: it usually contains 
# dozens, if not hundreds, of executables. To store all these separates files, 
# the firmware is laid out in volumes using the Firmware File System (FFS), a 
# file system specifically designed to store firmware images. The volumes 
# contain files that are identified by GUIDs and each of these files contain 
# one or more sections holding the data. One of these sections contains the 
# actual executable image. Most of the executable images follow the PE format. 
# However, some of them follow the TE format.
# 
# The Terse Executable (TE) image format was created as a mechanism to reduce
# the overhead of the PE/COFF headers in PE32/PE32+ images, resulting in a 
# corresponding reduction of image sizes for executables running in the PI 
# (Platform Initialization) Architecture environment. Reducing image size 
# provides an opportunity for use of a smaller system flash part.
# 
# So the TE format is basically a stripped version of PE.
# @see https://uefi.org/sites/default/files/resources/PI_Spec_1_6.pdf Source
class UefiTe &lt; Kaitai::Struct::Struct
  def initialize(_io, _parent = nil, _root = self)
    super(_io, _parent, _root)
    _read
  end

  def _read
    @_raw_te_hdr = @_io.read_bytes(40)
    io = Kaitai::Struct::Stream.new(@_raw_te_hdr)
    @te_hdr = TeHeader.new(io, self, @_root)
    @sections = Array.new(te_hdr.num_sections)
    (te_hdr.num_sections).times { |i|
      @sections[i] = Section.new(@_io, self, @_root)
    }
    self
  end
  class TeHeader &lt; Kaitai::Struct::Struct

    MACHINE_TYPE = {
      0 =&gt; :machine_type_unknown,
      332 =&gt; :machine_type_i386,
      358 =&gt; :machine_type_r4000,
      361 =&gt; :machine_type_wcemipsv2,
      388 =&gt; :machine_type_alpha,
      418 =&gt; :machine_type_sh3,
      419 =&gt; :machine_type_sh3dsp,
      422 =&gt; :machine_type_sh4,
      424 =&gt; :machine_type_sh5,
      448 =&gt; :machine_type_arm,
      450 =&gt; :machine_type_thumb,
      452 =&gt; :machine_type_armnt,
      467 =&gt; :machine_type_am33,
      496 =&gt; :machine_type_powerpc,
      497 =&gt; :machine_type_powerpcfp,
      512 =&gt; :machine_type_ia64,
      614 =&gt; :machine_type_mips16,
      870 =&gt; :machine_type_mipsfpu,
      1126 =&gt; :machine_type_mipsfpu16,
      3772 =&gt; :machine_type_ebc,
      20530 =&gt; :machine_type_riscv32,
      20580 =&gt; :machine_type_riscv64,
      20776 =&gt; :machine_type_riscv128,
      34404 =&gt; :machine_type_amd64,
      36929 =&gt; :machine_type_m32r,
      43620 =&gt; :machine_type_arm64,
    }
    I__MACHINE_TYPE = MACHINE_TYPE.invert

    SUBSYSTEM_ENUM = {
      0 =&gt; :subsystem_enum_unknown,
      1 =&gt; :subsystem_enum_native,
      2 =&gt; :subsystem_enum_windows_gui,
      3 =&gt; :subsystem_enum_windows_cui,
      7 =&gt; :subsystem_enum_posix_cui,
      9 =&gt; :subsystem_enum_windows_ce_gui,
      10 =&gt; :subsystem_enum_efi_application,
      11 =&gt; :subsystem_enum_efi_boot_service_driver,
      12 =&gt; :subsystem_enum_efi_runtime_driver,
      13 =&gt; :subsystem_enum_efi_rom,
      14 =&gt; :subsystem_enum_xbox,
      16 =&gt; :subsystem_enum_windows_boot_application,
    }
    I__SUBSYSTEM_ENUM = SUBSYSTEM_ENUM.invert
    def initialize(_io, _parent = nil, _root = self)
      super(_io, _parent, _root)
      _read
    end

    def _read
      @magic = @_io.ensure_fixed_contents([86, 90].pack(&#39;C*&#39;))
      @machine = Kaitai::Struct::Stream::resolve_enum(MACHINE_TYPE, @_io.read_u2le)
      @num_sections = @_io.read_u1
      @subsystem = Kaitai::Struct::Stream::resolve_enum(SUBSYSTEM_ENUM, @_io.read_u1)
      @stripped_size = @_io.read_u2le
      @entry_point_addr = @_io.read_u4le
      @base_of_code = @_io.read_u4le
      @image_base = @_io.read_u8le
      @data_dirs = HeaderDataDirs.new(@_io, self, @_root)
      self
    end
    attr_reader :magic
    attr_reader :machine
    attr_reader :num_sections
    attr_reader :subsystem
    attr_reader :stripped_size
    attr_reader :entry_point_addr
    attr_reader :base_of_code
    attr_reader :image_base
    attr_reader :data_dirs
  end
  class HeaderDataDirs &lt; Kaitai::Struct::Struct
    def initialize(_io, _parent = nil, _root = self)
      super(_io, _parent, _root)
      _read
    end

    def _read
      @base_relocation_table = DataDir.new(@_io, self, @_root)
      @debug = DataDir.new(@_io, self, @_root)
      self
    end
    attr_reader :base_relocation_table
    attr_reader :debug
  end
  class DataDir &lt; Kaitai::Struct::Struct
    def initialize(_io, _parent = nil, _root = self)
      super(_io, _parent, _root)
      _read
    end

    def _read
      @virtual_address = @_io.read_u4le
      @size = @_io.read_u4le
      self
    end
    attr_reader :virtual_address
    attr_reader :size
  end
  class Section &lt; Kaitai::Struct::Struct
    def initialize(_io, _parent = nil, _root = self)
      super(_io, _parent, _root)
      _read
    end

    def _read
      @name = (Kaitai::Struct::Stream::bytes_strip_right(@_io.read_bytes(8), 0)).force_encoding(&quot;UTF-8&quot;)
      @virtual_size = @_io.read_u4le
      @virtual_address = @_io.read_u4le
      @size_of_raw_data = @_io.read_u4le
      @pointer_to_raw_data = @_io.read_u4le
      @pointer_to_relocations = @_io.read_u4le
      @pointer_to_linenumbers = @_io.read_u4le
      @num_relocations = @_io.read_u2le
      @num_linenumbers = @_io.read_u2le
      @characteristics = @_io.read_u4le
      self
    end
    def body
      return @body unless @body.nil?
      _pos = @_io.pos
      @_io.seek(((pointer_to_raw_data - _root.te_hdr.stripped_size) + _root.te_hdr._io.size))
      @body = @_io.read_bytes(size_of_raw_data)
      @_io.seek(_pos)
      @body
    end
    attr_reader :name
    attr_reader :virtual_size
    attr_reader :virtual_address
    attr_reader :size_of_raw_data
    attr_reader :pointer_to_raw_data
    attr_reader :pointer_to_relocations
    attr_reader :pointer_to_linenumbers
    attr_reader :num_relocations
    attr_reader :num_linenumbers
    attr_reader :characteristics
  end
  attr_reader :te_hdr
  attr_reader :sections
  attr_reader :_raw_te_hdr
end
</code></pre>
            
        </div>
        
    </div>
</section>

    <footer id="main-footer">
        <div class="container">
            &copy; 2015-2019 Kaitai Project and <a href="https://github.com/kaitai-io/kaitai_struct_formats/graphs/contributors">formats repo contributors</a>

            <h3>Contacts</h3>

            <div class="row">
                <div class="col-sm-4">
                    <i class="fa fa-fw fa-2x fa-github"></i> <a href="https://github.com/kaitai-io/kaitai_struct">GitHub</a>
                </div>
                <div class="col-sm-4">
                    <i class="fa fa-fw fa-2x fa-twitter"></i> <a href="https://twitter.com/kaitai_io">@kaitai_io</a>
                </div>
                <div class="col-sm-4">
                    Gitter: <a href="https://gitter.im/kaitai_struct/Lobby">kaitai_struct</a>
                </div>
            </div>
        </div>
    </footer>

  <script src="//kaitai.io/js/jquery-1.12.3.min.js"></script>
  <script src="//kaitai.io/js/bootstrap.min.js"></script>

  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-76299550-1', 'auto');
      ga('send', 'pageview');
  </script>
</body>
</html>
