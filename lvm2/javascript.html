<!DOCTYPE html>
<html dir="ltr" lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Logical Volume Manager version 2: JavaScript parsing library</title>
  <meta name="keywords" content="kaitai,struct,binary,format,parsing,decoding,java,javascript,python,ruby,library,metadata">
  <meta name="description" content="Kaitai Struct is a formal language for binary format specification that can be compiled into parser code">

  <link rel="stylesheet" href="//kaitai.io/styles/bootstrap.min.css">
  <link rel="stylesheet" href="//kaitai.io/styles/bootstrap-theme.min.css">
  <link href='https://fonts.googleapis.com/css?family=Exo:400,700' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Share+Tech+Mono' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

  <link rel="stylesheet" href="//kaitai.io/styles/main.css" type="text/css">

  <link rel="stylesheet" href="//kaitai.io/styles/highlight/default.css">
  <style>
.diagram-img {
    display: block;
    max-width: 100%;
    height: auto;
    margin: 0 auto;
}

section.format {
    padding: 30px 0;
}

section#format-meta, section#format-index-header {
    background: #e3eef7;
}

section#format-diagram, section#format-index-footer {
    background: #e9f8dd;
}

section#format-ksy, section#format-lang {
    background: #d1eadd;
}

section#format-index .row {
    padding-bottom: 10px;
}

  </style>
  <script src="//kaitai.io/js/highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
</head>
<body data-spy="scroll" data-target="#main-navbar" data-offset="100">

    <nav class="navbar navbar-inverse navbar-fixed-top" id="main-navbar">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#main-navbar-collapse" aria-expanded="false">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <span class="navbar-brand">Kaitai Struct</span>
            </div>
            <div class="collapse navbar-collapse" id="main-navbar-collapse">
                <ul class="nav navbar-nav">
                    <li><a href="http://kaitai.io/#what-is-it">What is it?</a></li>
                    <li><a href="http://kaitai.io/#quick-start">Quick Start</a></li>
                    <li><a href="http://kaitai.io/#download">Download</a></li>
                    <li class="active"><a href="http://formats.kaitai.io/">Format Gallery</a></li>
                </ul>
                <ul class="nav navbar-nav navbar-right">
                    <li><a href="http://kaitai.io/repl/index.html">Try it</a></li>
                    <li><a href="https://ide.kaitai.io/">Web IDE</a></li>
                    <li><a href="http://doc.kaitai.io/">Documentation</a></li>
                </ul>
            </div>
        </div>
    </nav>
<nav>
    <div class="container">
    <ol class="breadcrumb">
        <li><a href="../index.html">Format Gallery</a></li>
        <li>Filesystems</li>
        <li class="active">Logical Volume Manager version 2</li>
    </ol>
    </div>
</nav>

<section id="format-meta" class="format">
    <div class="container">
        <h1>Logical Volume Manager version 2:
            
            JavaScript parsing library
            
        </h1>

        <div class="row">
            <div class="col-md-8">
                <p><h3>Building a test file</h3>
<pre><code>dd if=/dev/zero of=image.img bs=512 count=$(( 4 * 1024 * 2 ))
sudo losetup /dev/loop1 image.img
sudo pvcreate /dev/loop1
sudo vgcreate vg_test /dev/loop1
sudo lvcreate --name lv_test1 vg_test
sudo losetup -d /dev/loop1
</code></pre>
</p>
            </div>
            <div class="col-md-4">
                <div class="panel panel-info">
                    
                    <div class="panel-heading">
                        <h3 class="panel-title">Application</h3>
                    </div>
                    <div class="panel-body">
                        ["linux", "grub2", "lvm tools", "libvslvm"]
                    </div>
                    
                    
                    
                    <div class="panel-heading">
                        <h3 class="panel-title">KS implementation details</h3>
                    </div>
                    
                    <div class="panel-body">
                        License: <a href="https://spdx.org/licenses/GFDL-1.3+.html">GFDL-1.3+</a>
                    </div>
                    
                    
                    
                    
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
            <p>
            This page hosts a formal specification of Logical Volume Manager version 2
            using <a href="http://kaitai.io">Kaitai Struct</a>. This
            specification can be automatically translated into a
            variety of programming languages to get a parsing library.
            </p>

            <ul class="nav nav-pills">
                
                
                <li>
                
                <a href="index.html" title="Logical Volume Manager version 2 parsing Overview library">Overview</a></li>
                
                
                <li>
                
                <a href="cpp_stl.html" title="Logical Volume Manager version 2 parsing C++/STL library">C++/STL</a></li>
                
                
                <li>
                
                <a href="csharp.html" title="Logical Volume Manager version 2 parsing C# library">C#</a></li>
                
                
                <li>
                
                <a href="graphviz.html" title="Logical Volume Manager version 2 parsing GraphViz library">GraphViz</a></li>
                
                
                <li>
                
                <a href="java.html" title="Logical Volume Manager version 2 parsing Java library">Java</a></li>
                
                
                <li class="active">
                
                <a href="javascript.html" title="Logical Volume Manager version 2 parsing JavaScript library">JavaScript</a></li>
                
                
                <li>
                
                <a href="lua.html" title="Logical Volume Manager version 2 parsing Lua library">Lua</a></li>
                
                
                <li>
                
                <a href="perl.html" title="Logical Volume Manager version 2 parsing Perl library">Perl</a></li>
                
                
                <li>
                
                <a href="php.html" title="Logical Volume Manager version 2 parsing PHP library">PHP</a></li>
                
                
                <li>
                
                <a href="python.html" title="Logical Volume Manager version 2 parsing Python library">Python</a></li>
                
                
                <li>
                
                <a href="ruby.html" title="Logical Volume Manager version 2 parsing Ruby library">Ruby</a></li>
                
            </ul>
            </div>
        </div>
    </div>
</section>

<section id="format-usage" class="format">
    <div class="container">
        <h2>Usage</h2>

        
<p>See the usage examples in the <a href="http://doc.kaitai.io/lang_javascript.html" target="_blank">JavaScript notes</a>.</p>

<p>Parse structure from an ArrayBuffer:</p>

<pre><code class="javascript">var arrayBuffer = ...;
var data = new Lvm2(new KaitaiStream(arrayBuffer));</code></pre>

<p>After that, one can get various attributes from the structure by accessing fields or properties like:</p>

<pre><code class="javascript">data.pv // => Physical volume</code></pre>

    </div>
</section>


<section id="format-lang" class="format">
    <div class="container">
        <h2>
            
            JavaScript source code to parse Logical Volume Manager version 2
            
        </h2>

        

        <h3>Lvm2.js</h3>

        <div class="row">
            <div class="pull-right">
                <p>
                    <a href="src/javascript/Lvm2.js" class="btn btn-success">Download <i class="fa fa-download"></i></a>
                </p>
            </div>
        </div>

        <div class="row">
            <pre><code class="javascript">// This is a generated file! Please edit source .ksy file and use kaitai-struct-compiler to rebuild

(function (root, factory) {
  if (typeof define === &#39;function&#39; &amp;&amp; define.amd) {
    define([&#39;kaitai-struct/KaitaiStream&#39;], factory);
  } else if (typeof module === &#39;object&#39; &amp;&amp; module.exports) {
    module.exports = factory(require(&#39;kaitai-struct/KaitaiStream&#39;));
  } else {
    root.Lvm2 = factory(root.KaitaiStream);
  }
}(this, function (KaitaiStream) {
/**
 * ### Building a test file
 * 
 * ```
 * dd if=/dev/zero of=image.img bs=512 count=$(( 4 * 1024 * 2 ))
 * sudo losetup /dev/loop1 image.img
 * sudo pvcreate /dev/loop1
 * sudo vgcreate vg_test /dev/loop1
 * sudo lvcreate --name lv_test1 vg_test
 * sudo losetup -d /dev/loop1
 * ```
 * @see {@link https://github.com/libyal/libvslvm/blob/master/documentation/Logical%20Volume%20Manager%20(LVM)%20format.asciidoc|Source}
 */

var Lvm2 = (function() {
  function Lvm2(_io, _parent, _root) {
    this._io = _io;
    this._parent = _parent;
    this._root = _root || this;

    this._read();
  }
  Lvm2.prototype._read = function() {
    this.pv = new PhysicalVolume(this._io, this, this._root);
  }

  var PhysicalVolume = Lvm2.PhysicalVolume = (function() {
    function PhysicalVolume(_io, _parent, _root) {
      this._io = _io;
      this._parent = _parent;
      this._root = _root || this;

      this._read();
    }
    PhysicalVolume.prototype._read = function() {
      this.emptySector = this._io.readBytes(this._root.sectorSize);
      this.label = new Label(this._io, this, this._root);
    }

    var Label = PhysicalVolume.Label = (function() {
      function Label(_io, _parent, _root) {
        this._io = _io;
        this._parent = _parent;
        this._root = _root || this;

        this._read();
      }
      Label.prototype._read = function() {
        this.labelHeader = new LabelHeader(this._io, this, this._root);
        this.volumeHeader = new VolumeHeader(this._io, this, this._root);
      }

      var LabelHeader = Label.LabelHeader = (function() {
        function LabelHeader(_io, _parent, _root) {
          this._io = _io;
          this._parent = _parent;
          this._root = _root || this;

          this._read();
        }
        LabelHeader.prototype._read = function() {
          this.signature = this._io.ensureFixedContents([76, 65, 66, 69, 76, 79, 78, 69]);
          this.sectorNumber = this._io.readU8le();
          this.checksum = this._io.readU4le();
          this.labelHeader = new LabelHeader(this._io, this, this._root);
        }

        var LabelHeader = LabelHeader.LabelHeader = (function() {
          function LabelHeader(_io, _parent, _root) {
            this._io = _io;
            this._parent = _parent;
            this._root = _root || this;

            this._read();
          }
          LabelHeader.prototype._read = function() {
            this.dataOffset = this._io.readU4le();
            this.typeIndicator = this._io.ensureFixedContents([76, 86, 77, 50, 32, 48, 48, 49]);
          }

          /**
           * The offset, in bytes, relative from the start of the physical volume label header where data is stored
           */

          return LabelHeader;
        })();

        /**
         * The sector number of the physical volume label header
         */

        /**
         * CRC-32 for offset 20 to end of the physical volume label sector
         */

        return LabelHeader;
      })();

      var VolumeHeader = Label.VolumeHeader = (function() {
        function VolumeHeader(_io, _parent, _root) {
          this._io = _io;
          this._parent = _parent;
          this._root = _root || this;

          this._read();
        }
        VolumeHeader.prototype._read = function() {
          this.id = KaitaiStream.bytesToStr(this._io.readBytes(32), &quot;ascii&quot;);
          this.size = this._io.readU8le();
          this.dataAreaDescriptors = []
          var i = 0;
          do {
            var _ = new DataAreaDescriptor(this._io, this, this._root);
            this.dataAreaDescriptors.push(_);
            i++;
          } while (!( ((_.size != 0) &amp;&amp; (_.offset != 0)) ));
          this.metadataAreaDescriptors = []
          var i = 0;
          do {
            var _ = new MetadataAreaDescriptor(this._io, this, this._root);
            this.metadataAreaDescriptors.push(_);
            i++;
          } while (!( ((_.size != 0) &amp;&amp; (_.offset != 0)) ));
        }

        var DataAreaDescriptor = VolumeHeader.DataAreaDescriptor = (function() {
          function DataAreaDescriptor(_io, _parent, _root) {
            this._io = _io;
            this._parent = _parent;
            this._root = _root || this;

            this._read();
          }
          DataAreaDescriptor.prototype._read = function() {
            this.offset = this._io.readU8le();
            this.size = this._io.readU8le();
          }
          Object.defineProperty(DataAreaDescriptor.prototype, &#39;data&#39;, {
            get: function() {
              if (this._m_data !== undefined)
                return this._m_data;
              if (this.size != 0) {
                var _pos = this._io.pos;
                this._io.seek(this.offset);
                this._m_data = KaitaiStream.bytesToStr(this._io.readBytes(this.size), &quot;ascii&quot;);
                this._io.seek(_pos);
              }
              return this._m_data;
            }
          });

          /**
           * The offset, in bytes, relative from the start of the physical volume
           */

          /**
           * Value in bytes. Can be 0. [yellow-background]*Does this represent all remaining available space?*
           */

          return DataAreaDescriptor;
        })();

        var MetadataAreaDescriptor = VolumeHeader.MetadataAreaDescriptor = (function() {
          function MetadataAreaDescriptor(_io, _parent, _root) {
            this._io = _io;
            this._parent = _parent;
            this._root = _root || this;

            this._read();
          }
          MetadataAreaDescriptor.prototype._read = function() {
            this.offset = this._io.readU8le();
            this.size = this._io.readU8le();
          }
          Object.defineProperty(MetadataAreaDescriptor.prototype, &#39;data&#39;, {
            get: function() {
              if (this._m_data !== undefined)
                return this._m_data;
              if (this.size != 0) {
                var _pos = this._io.pos;
                this._io.seek(this.offset);
                this._raw__m_data = this._io.readBytes(this.size);
                var _io__raw__m_data = new KaitaiStream(this._raw__m_data);
                this._m_data = new MetadataArea(_io__raw__m_data, this, this._root);
                this._io.seek(_pos);
              }
              return this._m_data;
            }
          });

          /**
           * The offset, in bytes, relative from the start of the physical volume
           */

          /**
           * Value in bytes
           */

          return MetadataAreaDescriptor;
        })();

        /**
         * According to `[REDHAT]` the metadata area is a circular buffer. New metadata is appended to the old metadata and then the pointer to the start of it is updated. The metadata area, therefore, can contain copies of older versions of the metadata.
         */

        var MetadataArea = VolumeHeader.MetadataArea = (function() {
          function MetadataArea(_io, _parent, _root) {
            this._io = _io;
            this._parent = _parent;
            this._root = _root || this;

            this._read();
          }
          MetadataArea.prototype._read = function() {
            this.header = new MetadataAreaHeader(this._io, this, this._root);
          }

          var MetadataAreaHeader = MetadataArea.MetadataAreaHeader = (function() {
            function MetadataAreaHeader(_io, _parent, _root) {
              this._io = _io;
              this._parent = _parent;
              this._root = _root || this;

              this._read();
            }
            MetadataAreaHeader.prototype._read = function() {
              this.checksum = new MetadataAreaHeader(this._io, this, this._root);
              this.signature = this._io.ensureFixedContents([32, 76, 86, 77, 50, 32, 120, 91, 53, 65, 37, 114, 48, 78, 42, 62]);
              this.version = this._io.readU4le();
              this.metadataAreaOffset = this._io.readU8le();
              this.metadataAreaSize = this._io.readU8le();
              this.rawLocationDescriptors = []
              var i = 0;
              do {
                var _ = new RawLocationDescriptor(this._io, this, this._root);
                this.rawLocationDescriptors.push(_);
                i++;
              } while (!( ((_.offset != 0) &amp;&amp; (_.size != 0) &amp;&amp; (_.checksum != 0)) ));
            }

            /**
             * The data area size can be 0. It is assumed it represents the remaining  available data.
             */

            var RawLocationDescriptor = MetadataAreaHeader.RawLocationDescriptor = (function() {
              RawLocationDescriptor.RawLocationDescriptorFlags = Object.freeze({
                RAW_LOCATION_IGNORED: 1,

                1: &quot;RAW_LOCATION_IGNORED&quot;,
              });

              function RawLocationDescriptor(_io, _parent, _root) {
                this._io = _io;
                this._parent = _parent;
                this._root = _root || this;

                this._read();
              }
              RawLocationDescriptor.prototype._read = function() {
                this.offset = this._io.readU8le();
                this.size = this._io.readU8le();
                this.checksum = this._io.readU4le();
                this.flags = this._io.readU4le();
              }

              /**
               * The data area offset, in bytes, relative from the start of the metadata area
               */

              /**
               * data area size in bytes
               */

              /**
               * CRC-32 of *TODO (metadata?)*
               */

              return RawLocationDescriptor;
            })();
            Object.defineProperty(MetadataAreaHeader.prototype, &#39;metadata&#39;, {
              get: function() {
                if (this._m_metadata !== undefined)
                  return this._m_metadata;
                var _pos = this._io.pos;
                this._io.seek(this.metadataAreaOffset);
                this._m_metadata = this._io.readBytes(this.metadataAreaSize);
                this._io.seek(_pos);
                return this._m_metadata;
              }
            });

            /**
             * CRC-32 for offset 4 to end of the metadata area header
             */

            /**
             * The offset, in bytes, of the metadata area relative from the start of the physical volume
             */

            /**
             * The last descriptor in the list is terminator and consists of 0-byte values.
             */

            return MetadataAreaHeader;
          })();

          return MetadataArea;
        })();

        /**
         * Contains a UUID stored as an ASCII string. The physical volume identifier can be used to uniquely identify a physical volume. The physical volume identifier is stored as: 9LBcEB7PQTGIlLI0KxrtzrynjuSL983W but is equivalent to its formatted variant: 9LBcEB-7PQT-GIlL-I0Kx-rtzr-ynju-SL983W, which is used in the metadata.
         */

        /**
         * Physical Volume size. Value in bytes
         */

        /**
         * The last descriptor in the list is terminator and consists of 0-byte values.
         */

        return VolumeHeader;
      })();

      return Label;
    })();

    return PhysicalVolume;
  })();
  Object.defineProperty(Lvm2.prototype, &#39;sectorSize&#39;, {
    get: function() {
      if (this._m_sectorSize !== undefined)
        return this._m_sectorSize;
      this._m_sectorSize = 512;
      return this._m_sectorSize;
    }
  });

  /**
   * Physical volume
   */

  return Lvm2;
})();
return Lvm2;
}));
</code></pre>
            
        </div>
        
    </div>
</section>

    <footer id="main-footer">
        <div class="container">
            &copy; 2015-2018 Kaitai Project and <a href="https://github.com/kaitai-io/kaitai_struct_formats/graphs/contributors">formats repo contributors</a>

            <h3>Contacts</h3>

            <div class="row">
                <div class="col-sm-4">
                    <i class="fa fa-fw fa-2x fa-github"></i> <a href="https://github.com/kaitai-io/kaitai_struct">GitHub</a>
                </div>
                <div class="col-sm-4">
                    <i class="fa fa-fw fa-2x fa-twitter"></i> <a href="https://twitter.com/kaitai_io">@kaitai_io</a>
                </div>
                <div class="col-sm-4">
                    Gitter: <a href="https://gitter.im/kaitai_struct/Lobby">kaitai_struct</a>
                </div>
            </div>
        </div>
    </footer>

  <script src="//kaitai.io/js/jquery-1.12.3.min.js"></script>
  <script src="//kaitai.io/js/bootstrap.min.js"></script>

  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-76299550-1', 'auto');
      ga('send', 'pageview');
  </script>
</body>
</html>
