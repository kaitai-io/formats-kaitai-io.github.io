<!DOCTYPE html>
<html dir="ltr" lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Windows shell link file format spec for Kaitai Struct</title>
  <meta name="keywords" content="kaitai,struct,binary,format,parsing,decoding,java,javascript,python,ruby,library,metadata">
  <meta name="description" content="Kaitai Struct is a formal language for binary format specification that can be compiled into parser code">

  <link rel="stylesheet" href="http://kaitai.io/styles/bootstrap.min.css">
  <link rel="stylesheet" href="http://kaitai.io/styles/bootstrap-theme.min.css">
  <link href='https://fonts.googleapis.com/css?family=Exo:400,700' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Share+Tech+Mono' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

  <link rel="stylesheet" href="http://kaitai.io/styles/main.css" type="text/css">

  <link rel="stylesheet" href="http://kaitai.io/styles/highlight/default.css">
  <style>
.diagram-img {
    display: block;
    max-width: 100%;
    height: auto;
    margin: 0 auto;
}

section.format {
    padding: 30px 0;
}

section#format-meta, section#format-index-header {
    background: #e3eef7;
}

section#format-diagram, section#format-index-footer {
    background: #e9f8dd;
}

section#format-ksy, section#format-lang {
    background: #d1eadd;
}

section#format-index .row {
    padding-bottom: 10px;
}

  </style>
  <script src="http://kaitai.io/js/highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
</head>
<body data-spy="scroll" data-target="#main-navbar" data-offset="100">

    <nav class="navbar navbar-inverse navbar-fixed-top" id="main-navbar">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#main-navbar-collapse" aria-expanded="false">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <span class="navbar-brand">Kaitai Struct</span>
            </div>
            <div class="collapse navbar-collapse" id="main-navbar-collapse">
                <ul class="nav navbar-nav">
                    <li><a href="http://kaitai.io/#what-is-it">What is it?</a></li>
                    <li><a href="http://kaitai.io/#quick-start">Quick Start</a></li>
                    <li><a href="http://kaitai.io/#download">Download</a></li>
                    <li class="active"><a href="http://formats.kaitai.io/">Format Gallery</a></li>
                </ul>
                <ul class="nav navbar-nav navbar-right">
                    <li><a href="http://kaitai.io/repl/index.html">Try it</a></li>
                    <li><a href="https://ide.kaitai.io/">Web IDE</a></li>
                    <li><a href="http://doc.kaitai.io/">Documentation</a></li>
                </ul>
            </div>
        </div>
    </nav>
<nav>
    <div class="container">
    <ol class="breadcrumb">
        <li><a href="../index.html">Format Gallery</a></li>
        <li>Windows-specific</li>
        <li class="active">Windows shell link file</li>
    </ol>
    </div>
</nav>

<section id="format-meta" class="format">
    <div class="container">
        <h1>Windows shell link file:
            
            format specification
            
        </h1>

        <div class="row">
            <div class="col-md-8">
                <p><p>Windows .lnk files (AKA &quot;shell link&quot; file) are most frequently used
in Windows shell to create &quot;shortcuts&quot; to another files, usually for
purposes of running a program from some other directory, sometimes
with certain preconfigured arguments and some other options.</p>
</p>
            </div>
            <div class="col-md-4">
                <div class="panel panel-info">
                    
                    
                    <div class="panel-heading">
                        <h3 class="panel-title">File extension</h3>
                    </div>
                    <div class="panel-body">
                        lnk
                    </div>
                    
                    
                    <div class="panel-heading">
                        <h3 class="panel-title">KS implementation details</h3>
                    </div>
                    
                    <div class="panel-body">
                        License: <a href="https://spdx.org/licenses/CC0-1.0.html">CC0-1.0</a>
                    </div>
                    
                    
                    
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
            <p>
            This page hosts a formal specification of Windows shell link file
            using <a href="http://kaitai.io">Kaitai Struct</a>. This
            specification can be automatically translated into a
            variety of programming languages to get a parsing library.
            </p>

            <ul class="nav nav-pills">
                
                
                <li class="active">
                
                <a href="index.html" title="Windows shell link file parsing Overview library">Overview</a></li>
                
                
                <li>
                
                <a href="cpp_stl.html" title="Windows shell link file parsing C++/STL library">C++/STL</a></li>
                
                
                <li>
                
                <a href="csharp.html" title="Windows shell link file parsing C# library">C#</a></li>
                
                
                <li>
                
                <a href="graphviz.html" title="Windows shell link file parsing GraphViz library">GraphViz</a></li>
                
                
                <li>
                
                <a href="java.html" title="Windows shell link file parsing Java library">Java</a></li>
                
                
                <li>
                
                <a href="javascript.html" title="Windows shell link file parsing JavaScript library">JavaScript</a></li>
                
                
                <li>
                
                <a href="lua.html" title="Windows shell link file parsing Lua library">Lua</a></li>
                
                
                <li>
                
                <a href="perl.html" title="Windows shell link file parsing Perl library">Perl</a></li>
                
                
                <li>
                
                <a href="php.html" title="Windows shell link file parsing PHP library">PHP</a></li>
                
                
                <li>
                
                <a href="python.html" title="Windows shell link file parsing Python library">Python</a></li>
                
                
                <li>
                
                <a href="ruby.html" title="Windows shell link file parsing Ruby library">Ruby</a></li>
                
            </ul>
            </div>
        </div>
    </div>
</section>
<section id="format-diagram" class="format">
    <div class="container">
        <h2>Block diagram</h2>
        <a href="windows_lnk_file.svg">
            <img class="diagram-img" src="windows_lnk_file.svg" />
        </a>
    </div>
</section>

<section id="format-ksy" class="format">
    <div class="container">
        <h2>Format specification in Kaitai Struct YAML</h2>
        
        <pre><code class="yaml">meta:
  id: windows_lnk_file
  title: Windows shell link file
  file-extension: lnk
  license: CC0-1.0
  endian: le
  encoding: cp437
  imports:
    - windows_shell_items
doc: |
  Windows .lnk files (AKA "shell link" file) are most frequently used
  in Windows shell to create "shortcuts" to another files, usually for
  purposes of running a program from some other directory, sometimes
  with certain preconfigured arguments and some other options.
doc-ref: 'https://winprotocoldoc.blob.core.windows.net/productionwindowsarchives/MS-SHLLINK/[MS-SHLLINK].pdf'
seq:
  - id: header
    type: file_header
  - id: target_id_list
    type: link_target_id_list
    if: header.flags.has_link_target_id_list
  - id: info
    type: link_info
    if: header.flags.has_link_info
  - id: name
    -orig-id: NAME_STRING
    type: string_data
    if: header.flags.has_name
  - id: rel_path
    -orig-id: RELATIVE_PATH
    type: string_data
    if: header.flags.has_rel_path
  - id: work_dir
    -orig-id: WORKING_DIR
    type: string_data
    if: header.flags.has_work_dir
  - id: arguments
    -orig-id: COMMAND_LINE_ARGUMENTS
    type: string_data
    if: header.flags.has_arguments
  - id: icon_location
    -orig-id: ICON_LOCATION
    type: string_data
    if: header.flags.has_icon_location
types:
  file_header:
    doc-ref: 'https://winprotocoldoc.blob.core.windows.net/productionwindowsarchives/MS-SHLLINK/[MS-SHLLINK].pdf Section 2.1'
    -orig-id: ShellLinkHeader
    seq:
      - id: len_header
        -orig-id: HeaderSize
        contents: [0x4c, 0, 0, 0]
        doc: |
          Technically, a size of the header, but in reality, it's
          fixed by standard.
      - id: link_clsid
        contents: [0x01, 0x14, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x46]
        doc: |
          16-byte class identified (CLSID), reserved for Windows shell
          link files.
      - id: flags
        -orig-id: LinkFlags
        type: link_flags
        size: 4
      - id: file_attrs
        type: u4
      - id: time_creation
        -orig-id: CreationTime
        type: u8
      - id: time_access
        -orig-id: AccessTime
        type: u8
      - id: time_write
        -orig-id: WriteTime
        type: u8
      - id: target_file_size
        -orig-id: FileSize
        type: u4
        doc: Lower 32 bits of the size of the file that this link targets
      - id: icon_index
        -orig-id: IconIndex
        type: s4
        doc: Index of an icon to use from target file
      - id: show_command
        -orig-id: ShowCommand
        type: u4
        enum: window_state
        doc: Window state to set after the launch of target executable
      - id: hotkey
        type: u2
      - id: reserved
        contents: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
  link_flags:
    doc-ref: 'https://winprotocoldoc.blob.core.windows.net/productionwindowsarchives/MS-SHLLINK/[MS-SHLLINK].pdf Section 2.1.1'
    seq:
      # Byte #0
      - id: is_unicode
        -orig-id: IsUnicode (H)
        type: b1
      - id: has_icon_location
        -orig-id: HasIconLocation (G)
        type: b1
      - id: has_arguments
        -orig-id: HasArguments (F)
        type: b1
      - id: has_work_dir
        -orig-id: HasWorkingDir (E)
        type: b1
      - id: has_rel_path
        -orig-id: HasRelativePath (D)
        type: b1
      - id: has_name
        -orig-id: HasName (C)
        type: b1
      - id: has_link_info
        -orig-id: HasLinkInfo (B)
        type: b1
      - id: has_link_target_id_list
        -orig-id: HasLinkTargetIDList (A)
        type: b1
      # Byte #1, 2
      - type: b16
      # Byte #3
      - id: reserved
        type: b5
      - id: keep_local_id_list_for_unc_target
        -orig-id: KeepLocalIDListForUNCTarget (AA)
        type: b1
      - type: b2
  link_target_id_list:
    -orig-id: LinkTargetIDList
    doc-ref: 'https://winprotocoldoc.blob.core.windows.net/productionwindowsarchives/MS-SHLLINK/[MS-SHLLINK].pdf Section 2.2'
    seq:
      - id: len_id_list
        -orig-id: IDListSize          
        type: u2
      - id: id_list
        -orig-id: IDList
        size: len_id_list
        type: windows_shell_items
  link_info:
    -orig-id: LinkInfo
    doc-ref: 'https://winprotocoldoc.blob.core.windows.net/productionwindowsarchives/MS-SHLLINK/[MS-SHLLINK].pdf Section 2.3'
    seq:
      - id: len_all
        -orig-id: LinkInfoSize
        type: u4
      - id: all
        size: len_all - 4
        type: all
    types:
      all:
        doc-ref: 'https://winprotocoldoc.blob.core.windows.net/productionwindowsarchives/MS-SHLLINK/[MS-SHLLINK].pdf Section 2.3'
        seq:
          - id: len_header
            -orig-id: LinkInfoHeaderSize
            type: u4
          - id: header
            size: len_header - 8 # LinkInfoSize and LinkInfoHeaderSize
            type: header
        instances:
          volume_id:
            -orig-id: VolumeID
            pos: header.ofs_volume_id - 4
            type: volume_id_spec
            if: header.flags.has_volume_id_and_local_base_path
          local_base_path:
            -orig-id: LocalBasePath
            pos: header.ofs_local_base_path - 4
            terminator: 0
            if: header.flags.has_volume_id_and_local_base_path
      header:
        doc-ref: 'https://winprotocoldoc.blob.core.windows.net/productionwindowsarchives/MS-SHLLINK/[MS-SHLLINK].pdf Section 2.3'
        seq:
          - id: flags
            -orig-id: LinkInfoFlags
            type: link_info_flags
          - id: ofs_volume_id
            -orig-id: VolumeIDOffset
            type: u4
          - id: ofs_local_base_path
            -orig-id: LocalBasePathOffset
            type: u4
          - id: ofs_common_net_rel_link
            -orig-id: CommonNetworkRelativeLinkOffset
            type: u4
          - id: ofs_common_path_suffix
            -orig-id: CommonPathSuffixOffset
            type: u4
          - id: ofs_local_base_path_unicode
            -orig-id: LocalBasePathOffsetUnicode
            type: u4
            if: not _io.eof
          - id: ofs_common_path_suffix_unicode
            -orig-id: CommonPathSuffixOffsetUnicode
            type: u4
            if: not _io.eof
      link_info_flags:
        -orig-id: LinkInfoFlags
        doc-ref: 'https://winprotocoldoc.blob.core.windows.net/productionwindowsarchives/MS-SHLLINK/[MS-SHLLINK].pdf Section 2.3'
        seq:
          - id: reserved1
            type: b6
          - id: has_common_net_rel_link
            -orig-id: CommonNetworkRelativeLinkAndPathSuffix (B)
            type: b1
          - id: has_volume_id_and_local_base_path
            -orig-id: VolumeIDAndLocalBasePath (A)
            type: b1
          - id: reserved2
            type: b24
      volume_id_spec:
        -orig-id: VolumeID
        doc-ref: 'https://winprotocoldoc.blob.core.windows.net/productionwindowsarchives/MS-SHLLINK/[MS-SHLLINK].pdf Section 2.3.1'
        seq:
          - id: len_all
            -orig-id: VolumeIDSize
            type: u4
          - id: body
            size: len_all - 4
            type: volume_id_body
      volume_id_body:
        -orig-id: VolumeID
        doc-ref: 'https://winprotocoldoc.blob.core.windows.net/productionwindowsarchives/MS-SHLLINK/[MS-SHLLINK].pdf Section 2.3.1'
        seq:
          - id: drive_type
            -orig-id: DriveType
            type: u4
            enum: drive_types
          - id: drive_serial_number
            -orig-id: DriveSerialNumber
            type: u4
          - id: ofs_volume_label
            -orig-id: VolumeLabelOffset
            type: u4
          - id: ofs_volume_label_unicode
            -orig-id: VolumeLabelOffsetUnicode
            type: u4
            if: is_unicode
        instances:
          is_unicode:
            value: ofs_volume_label == 0x14
          volume_label_ansi:
            pos: ofs_volume_label - 4
            type: strz
            if: not is_unicode
  string_data:
    seq:
      - id: chars_str
        -orig-id: CountCharacters
        type: u2
      - id: str
        size: chars_str * 2
        type: str
        encoding: UTF-16LE
enums:
  window_state:
    1: normal
    3: maximized
    7: min_no_active
  drive_types:
    0: unknown
    1: no_root_dir
    2: removable
    3: fixed
    4: remote
    5: cdrom
    6: ramdisk
</code></pre>
    </div>
</section>

    <footer id="main-footer">
        <div class="container">
            &copy; 2015-2018 Kaitai Project and <a href="https://github.com/kaitai-io/kaitai_struct_formats/graphs/contributors">formats repo contributors</a>

            <h3>Contacts</h3>

            <div class="row">
                <div class="col-sm-4">
                    <i class="fa fa-fw fa-2x fa-github"></i> <a href="https://github.com/kaitai-io/kaitai_struct">GitHub</a>
                </div>
                <div class="col-sm-4">
                    <i class="fa fa-fw fa-2x fa-twitter"></i> <a href="https://twitter.com/kaitai_io">@kaitai_io</a>
                </div>
                <div class="col-sm-4">
                    Gitter: <a href="https://gitter.im/kaitai_struct/Lobby">kaitai_struct</a>
                </div>
            </div>
        </div>
    </footer>

  <script src="http://kaitai.io/js/jquery-1.12.3.min.js"></script>
  <script src="http://kaitai.io/js/bootstrap.min.js"></script>

  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-76299550-1', 'auto');
      ga('send', 'pageview');
  </script>
</body>
</html>
