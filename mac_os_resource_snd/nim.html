<!DOCTYPE html>
<html dir="ltr" lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Classic MacOS Sound Resource: Nim parsing library</title>
  <meta name="keywords" content="kaitai,struct,binary,format,parsing,decoding,java,javascript,python,ruby,library,metadata">
  <meta name="description" content="Kaitai Struct is a formal language for binary format specification that can be compiled into parser code">

  <link rel="stylesheet" href="//kaitai.io/styles/bootstrap.min.css">
  <link rel="stylesheet" href="//kaitai.io/styles/bootstrap-theme.min.css">
  <link href='https://fonts.googleapis.com/css?family=Exo:400,700' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Share+Tech+Mono' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

  <link rel="stylesheet" href="//kaitai.io/styles/main.css" type="text/css">
  <link rel="stylesheet" href="/pygments-default.css" type="text/css">
  <style>
.diagram-img {
    display: block;
    max-width: 100%;
    height: auto;
    margin: 0 auto;
}

section.format {
    padding: 30px 0;
}

section#format-meta, section#format-index-header {
    background: #e3eef7;
}

section#format-diagram, section#format-index-footer {
    background: #e9f8dd;
}

section#format-ksy, section#format-lang {
    background: #d1eadd;
}

section#format-index .row {
    padding-bottom: 10px;
}

  </style>
</head>
<body data-spy="scroll" data-target="#main-navbar" data-offset="100">

    <nav class="navbar navbar-inverse navbar-fixed-top" id="main-navbar">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#main-navbar-collapse" aria-expanded="false">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <span class="navbar-brand">Kaitai Struct</span>
            </div>
            <div class="collapse navbar-collapse" id="main-navbar-collapse">
                <ul class="nav navbar-nav">
                    <li><a href="//kaitai.io/#what-is-it">What is it?</a></li>
                    <li><a href="//kaitai.io/#quick-start">Quick Start</a></li>
                    <li><a href="//kaitai.io/#download">Download</a></li>
                    <li><a href="//kaitai.io/news/">News</a></li>
                    <li class="active"><a href="//formats.kaitai.io/">Format Gallery</a></li>
                </ul>
                <ul class="nav navbar-nav navbar-right">
                    <li><a href="https://ide.kaitai.io/">Try it &mdash; Web IDE</a></li>
                    <li><a href="//doc.kaitai.io/">Documentation</a></li>
                </ul>
            </div>
        </div>
    </nav>
<nav>
    <div class="container">
    <ol class="breadcrumb">
        <li><a href="../">Format Gallery</a></li>
        <li>macOS-specific</li>
        <li class="active">Classic MacOS Sound Resource</li>
    </ol>
    </div>
</nav>

<section id="format-meta" class="format">
    <div class="container">
        <h1>Classic MacOS Sound Resource:
            
            Nim parsing library
            
        </h1>

        <div class="row">
            <div class="col-md-8">
                <p><p>Sound resources were introduced in Classic MacOS with the Sound Manager program.
They can contain sound commands to generate sounds with given frequencies as well as sampled sound data.
They are mostly found in resource forks, but can occasionally appear standalone or embedded in other files.</p>
</p>
            </div>
            <div class="col-md-4">
                <div class="panel panel-info">
                    
                    <div class="panel-heading">
                        <h3 class="panel-title">Application</h3>
                    </div>
                    <div class="panel-body">
                        Sound Manager
                    </div>
                    
                    
                    
                    <div class="panel-heading">
                        <h3 class="panel-title">KS implementation details</h3>
                    </div>
                    
                    <div class="panel-body">
                        License: <a href="https://spdx.org/licenses/MIT.html">MIT</a>
                    </div>
                    
                    
                    
                    
                    
                    <div class="panel-heading">
                        <h3 class="panel-title">References</h3>
                    </div>
                    <div class="panel-body">
                        <ul>
                            
                            
                            
                            
                            
                            
                            
                            
                            
                            <li><a href="https://www.wikidata.org/wiki/Q7564684">Wikidata Q7564684</a></li>
                            
                            
                            
                            
                            
                        </ul>
                    </div>
                    
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
            <p>
            This page hosts a formal specification of Classic MacOS Sound Resource
            using <a href="//kaitai.io">Kaitai Struct</a>. This
            specification can be automatically translated into a
            variety of programming languages to get a parsing library.
            </p>

            <ul class="nav nav-pills">
                
                
                <li>
                
                <a href="index.html" title="Classic MacOS Sound Resource parsing Overview library">Overview</a></li>
                
                
                <li>
                
                <a href="cpp_stl_11.html" title="Classic MacOS Sound Resource parsing C++11/STL library">C++11/STL</a></li>
                
                
                <li>
                
                <a href="csharp.html" title="Classic MacOS Sound Resource parsing C# library">C#</a></li>
                
                
                <li>
                
                <a href="go.html" title="Classic MacOS Sound Resource parsing Go library">Go</a></li>
                
                
                <li>
                
                <a href="graphviz.html" title="Classic MacOS Sound Resource parsing GraphViz library">GraphViz</a></li>
                
                
                <li>
                
                <a href="java.html" title="Classic MacOS Sound Resource parsing Java library">Java</a></li>
                
                
                <li>
                
                <a href="javascript.html" title="Classic MacOS Sound Resource parsing JavaScript library">JavaScript</a></li>
                
                
                <li>
                
                <a href="lua.html" title="Classic MacOS Sound Resource parsing Lua library">Lua</a></li>
                
                
                <li class="active">
                
                <a href="nim.html" title="Classic MacOS Sound Resource parsing Nim library">Nim</a></li>
                
                
                <li>
                
                <a href="perl.html" title="Classic MacOS Sound Resource parsing Perl library">Perl</a></li>
                
                
                <li>
                
                <a href="php.html" title="Classic MacOS Sound Resource parsing PHP library">PHP</a></li>
                
                
                <li>
                
                <a href="python.html" title="Classic MacOS Sound Resource parsing Python library">Python</a></li>
                
                
                <li>
                
                <a href="ruby.html" title="Classic MacOS Sound Resource parsing Ruby library">Ruby</a></li>
                
            </ul>
            </div>
        </div>
    </div>
</section>


<section id="format-lang" class="format">
    <div class="container">
        <h2>
            
            Nim source code to parse Classic MacOS Sound Resource
            
        </h2>

        

        <h3>mac_os_resource_snd.nim</h3>

        <div class="row">
            <div class="pull-right">
                <p>
                    <a href="src/nim/mac_os_resource_snd.nim" download="mac_os_resource_snd.nim" class="btn btn-success">Download <i class="fa fa-download"></i></a>
                </p>
            </div>
        </div>

        <div class="row">
            <div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="n">kaitai_struct_nim_runtime</span>
<span class="kn">import</span><span class="w"> </span><span class="n">options</span>

<span class="k">type</span>
<span class="w">  </span><span class="n">MacOsResourceSnd</span><span class="o">*</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">ref</span><span class="w"> </span><span class="k">object</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">KaitaiStruct</span>
<span class="w">    </span><span class="p">`</span><span class="n">format</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">uint16</span>
<span class="w">    </span><span class="p">`</span><span class="n">numDataFormats</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">uint16</span>
<span class="w">    </span><span class="p">`</span><span class="n">dataFormats</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="nb">seq</span><span class="o">[</span><span class="n">MacOsResourceSnd_DataFormat</span><span class="o">]</span>
<span class="w">    </span><span class="p">`</span><span class="n">referenceCount</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">uint16</span>
<span class="w">    </span><span class="p">`</span><span class="n">numSoundCommands</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">uint16</span>
<span class="w">    </span><span class="p">`</span><span class="n">soundCommands</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="nb">seq</span><span class="o">[</span><span class="n">MacOsResourceSnd_SoundCommand</span><span class="o">]</span>
<span class="w">    </span><span class="p">`</span><span class="n">parent</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">KaitaiStruct</span>
<span class="w">    </span><span class="p">`</span><span class="n">midiNoteToFrequencyInst</span><span class="p">`:</span><span class="w"> </span><span class="nb">seq</span><span class="o">[</span><span class="nb">float64</span><span class="o">]</span>
<span class="w">    </span><span class="p">`</span><span class="n">midiNoteToFrequencyInstFlag</span><span class="p">`:</span><span class="w"> </span><span class="nb">bool</span>
<span class="w">  </span><span class="n">MacOsResourceSnd_CmdType</span><span class="o">*</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">enum</span>
<span class="w">    </span><span class="n">null_cmd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">quiet_cmd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span>
<span class="w">    </span><span class="n">flush_cmd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span>
<span class="w">    </span><span class="n">re_init_cmd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span>
<span class="w">    </span><span class="n">wait_cmd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span>
<span class="w">    </span><span class="n">pause_cmd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">11</span>
<span class="w">    </span><span class="n">resume_cmd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">12</span>
<span class="w">    </span><span class="n">call_back_cmd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">13</span>
<span class="w">    </span><span class="n">sync_cmd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">14</span>
<span class="w">    </span><span class="n">empty_cmd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">15</span>
<span class="w">    </span><span class="n">available_cmd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">24</span>
<span class="w">    </span><span class="n">version_cmd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">25</span>
<span class="w">    </span><span class="n">total_load_cmd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">26</span>
<span class="w">    </span><span class="n">load_cmd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">27</span>
<span class="w">    </span><span class="n">freq_duration_cmd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">40</span>
<span class="w">    </span><span class="n">rest_cmd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">41</span>
<span class="w">    </span><span class="n">freq_cmd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">42</span>
<span class="w">    </span><span class="n">amp_cmd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">43</span>
<span class="w">    </span><span class="n">timbre_cmd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">44</span>
<span class="w">    </span><span class="n">get_amp_cmd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">45</span>
<span class="w">    </span><span class="n">volume_cmd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">46</span>
<span class="w">    </span><span class="n">get_volume_cmd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">47</span>
<span class="w">    </span><span class="n">wave_table_cmd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">60</span>
<span class="w">    </span><span class="n">phase_cmd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">61</span>
<span class="w">    </span><span class="n">sound_cmd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">80</span>
<span class="w">    </span><span class="n">buffer_cmd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">81</span>
<span class="w">    </span><span class="n">rate_cmd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">82</span>
<span class="w">    </span><span class="n">get_rate_cmd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">85</span>
<span class="w">  </span><span class="n">MacOsResourceSnd_SoundHeaderType</span><span class="o">*</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">enum</span>
<span class="w">    </span><span class="n">standard</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">compressed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">254</span>
<span class="w">    </span><span class="n">extended</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">255</span>
<span class="w">  </span><span class="n">MacOsResourceSnd_DataType</span><span class="o">*</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">enum</span>
<span class="w">    </span><span class="n">square_wave_synth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="n">wave_table_synth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span>
<span class="w">    </span><span class="n">sampled_synth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span>
<span class="w">  </span><span class="n">MacOsResourceSnd_WaveInitOption</span><span class="o">*</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">enum</span>
<span class="w">    </span><span class="n">channel0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span>
<span class="w">    </span><span class="n">channel1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span>
<span class="w">    </span><span class="n">channel2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span>
<span class="w">    </span><span class="n">channel3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">7</span>
<span class="w">  </span><span class="n">MacOsResourceSnd_InitOption</span><span class="o">*</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">enum</span>
<span class="w">    </span><span class="n">chan_left</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span>
<span class="w">    </span><span class="n">chan_right</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span>
<span class="w">    </span><span class="n">no_interp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span>
<span class="w">    </span><span class="n">no_drop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8</span>
<span class="w">    </span><span class="n">mono</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">128</span>
<span class="w">    </span><span class="n">stereo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">192</span>
<span class="w">    </span><span class="n">mace3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">768</span>
<span class="w">    </span><span class="n">mace6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1024</span>
<span class="w">  </span><span class="n">MacOsResourceSnd_CompressionTypeEnum</span><span class="o">*</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">enum</span>
<span class="w">    </span><span class="n">variable_compression</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">2</span>
<span class="w">    </span><span class="n">fixed_compression</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span>
<span class="w">    </span><span class="n">not_compressed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">two_to_one</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="n">eight_to_three</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span>
<span class="w">    </span><span class="n">three_to_one</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span>
<span class="w">    </span><span class="n">six_to_one</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span>
<span class="w">  </span><span class="n">MacOsResourceSnd_Extended</span><span class="o">*</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">ref</span><span class="w"> </span><span class="k">object</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">KaitaiStruct</span>
<span class="w">    </span><span class="p">`</span><span class="n">instrumentChunkPtr</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">uint32</span>
<span class="w">    </span><span class="p">`</span><span class="n">aesRecordingPtr</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">uint32</span>
<span class="w">    </span><span class="p">`</span><span class="n">parent</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">MacOsResourceSnd_ExtendedOrCompressed</span>
<span class="w">  </span><span class="n">MacOsResourceSnd_SoundHeader</span><span class="o">*</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">ref</span><span class="w"> </span><span class="k">object</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">KaitaiStruct</span>
<span class="w">    </span><span class="p">`</span><span class="n">unnamed0</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="nb">seq</span><span class="o">[</span><span class="n">byte</span><span class="o">]</span>
<span class="w">    </span><span class="p">`</span><span class="n">samplePtr</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">uint32</span>
<span class="w">    </span><span class="p">`</span><span class="n">numSamples</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">uint32</span>
<span class="w">    </span><span class="p">`</span><span class="n">numChannels</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">uint32</span>
<span class="w">    </span><span class="p">`</span><span class="n">sampleRate</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">MacOsResourceSnd_UnsignedFixedPoint</span>
<span class="w">    </span><span class="p">`</span><span class="n">loopStart</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">uint32</span>
<span class="w">    </span><span class="p">`</span><span class="n">loopEnd</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">uint32</span>
<span class="w">    </span><span class="p">`</span><span class="n">encode</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">MacOsResourceSnd_SoundHeaderType</span>
<span class="w">    </span><span class="p">`</span><span class="n">midiNote</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">uint8</span>
<span class="w">    </span><span class="p">`</span><span class="n">extendedOrCompressed</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">MacOsResourceSnd_ExtendedOrCompressed</span>
<span class="w">    </span><span class="p">`</span><span class="n">sampleArea</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="nb">seq</span><span class="o">[</span><span class="n">byte</span><span class="o">]</span>
<span class="w">    </span><span class="p">`</span><span class="n">parent</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">MacOsResourceSnd_SoundCommand</span>
<span class="w">    </span><span class="p">`</span><span class="n">startOfsInst</span><span class="p">`:</span><span class="w"> </span><span class="nb">int</span>
<span class="w">    </span><span class="p">`</span><span class="n">startOfsInstFlag</span><span class="p">`:</span><span class="w"> </span><span class="nb">bool</span>
<span class="w">    </span><span class="p">`</span><span class="n">baseFreqeuncyInst</span><span class="p">`:</span><span class="w"> </span><span class="nb">float64</span>
<span class="w">    </span><span class="p">`</span><span class="n">baseFreqeuncyInstFlag</span><span class="p">`:</span><span class="w"> </span><span class="nb">bool</span>
<span class="w">    </span><span class="p">`</span><span class="n">soundHeaderTypeInst</span><span class="p">`:</span><span class="w"> </span><span class="n">MacOsResourceSnd_SoundHeaderType</span>
<span class="w">    </span><span class="p">`</span><span class="n">soundHeaderTypeInstFlag</span><span class="p">`:</span><span class="w"> </span><span class="nb">bool</span>
<span class="w">  </span><span class="n">MacOsResourceSnd_UnsignedFixedPoint</span><span class="o">*</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">ref</span><span class="w"> </span><span class="k">object</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">KaitaiStruct</span>
<span class="w">    </span><span class="p">`</span><span class="n">integerPart</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">uint16</span>
<span class="w">    </span><span class="p">`</span><span class="n">fractionPart</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">uint16</span>
<span class="w">    </span><span class="p">`</span><span class="n">parent</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">MacOsResourceSnd_SoundHeader</span>
<span class="w">    </span><span class="p">`</span><span class="n">valueInst</span><span class="p">`:</span><span class="w"> </span><span class="nb">float64</span>
<span class="w">    </span><span class="p">`</span><span class="n">valueInstFlag</span><span class="p">`:</span><span class="w"> </span><span class="nb">bool</span>
<span class="w">  </span><span class="n">MacOsResourceSnd_SoundCommand</span><span class="o">*</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">ref</span><span class="w"> </span><span class="k">object</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">KaitaiStruct</span>
<span class="w">    </span><span class="p">`</span><span class="n">isDataOffset</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="nb">bool</span>
<span class="w">    </span><span class="p">`</span><span class="n">cmd</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">MacOsResourceSnd_CmdType</span>
<span class="w">    </span><span class="p">`</span><span class="n">param1</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">uint16</span>
<span class="w">    </span><span class="p">`</span><span class="n">param2</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">uint32</span>
<span class="w">    </span><span class="p">`</span><span class="n">parent</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">MacOsResourceSnd</span>
<span class="w">    </span><span class="p">`</span><span class="n">soundHeaderInst</span><span class="p">`:</span><span class="w"> </span><span class="n">MacOsResourceSnd_SoundHeader</span>
<span class="w">    </span><span class="p">`</span><span class="n">soundHeaderInstFlag</span><span class="p">`:</span><span class="w"> </span><span class="nb">bool</span>
<span class="w">  </span><span class="n">MacOsResourceSnd_Compressed</span><span class="o">*</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">ref</span><span class="w"> </span><span class="k">object</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">KaitaiStruct</span>
<span class="w">    </span><span class="p">`</span><span class="n">format</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="nb">string</span>
<span class="w">    </span><span class="p">`</span><span class="n">reserved</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="nb">seq</span><span class="o">[</span><span class="n">byte</span><span class="o">]</span>
<span class="w">    </span><span class="p">`</span><span class="n">stateVarsPtr</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">uint32</span>
<span class="w">    </span><span class="p">`</span><span class="n">leftOverSamplesPtr</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">uint32</span>
<span class="w">    </span><span class="p">`</span><span class="n">compressionId</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="nb">int16</span>
<span class="w">    </span><span class="p">`</span><span class="n">packetSize</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">uint16</span>
<span class="w">    </span><span class="p">`</span><span class="n">synthesizerId</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">uint16</span>
<span class="w">    </span><span class="p">`</span><span class="n">parent</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">MacOsResourceSnd_ExtendedOrCompressed</span>
<span class="w">    </span><span class="p">`</span><span class="n">compressionTypeInst</span><span class="p">`:</span><span class="w"> </span><span class="n">MacOsResourceSnd_CompressionTypeEnum</span>
<span class="w">    </span><span class="p">`</span><span class="n">compressionTypeInstFlag</span><span class="p">`:</span><span class="w"> </span><span class="nb">bool</span>
<span class="w">  </span><span class="n">MacOsResourceSnd_ExtendedOrCompressed</span><span class="o">*</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">ref</span><span class="w"> </span><span class="k">object</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">KaitaiStruct</span>
<span class="w">    </span><span class="p">`</span><span class="n">numFrames</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">uint32</span>
<span class="w">    </span><span class="p">`</span><span class="n">aiffSampleRate</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="nb">seq</span><span class="o">[</span><span class="n">byte</span><span class="o">]</span>
<span class="w">    </span><span class="p">`</span><span class="n">markerChunk</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">uint32</span>
<span class="w">    </span><span class="p">`</span><span class="n">extended</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">MacOsResourceSnd_Extended</span>
<span class="w">    </span><span class="p">`</span><span class="n">compressed</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">MacOsResourceSnd_Compressed</span>
<span class="w">    </span><span class="p">`</span><span class="n">bitsPerSample</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">uint16</span>
<span class="w">    </span><span class="p">`</span><span class="n">reserved</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="nb">seq</span><span class="o">[</span><span class="n">byte</span><span class="o">]</span>
<span class="w">    </span><span class="p">`</span><span class="n">parent</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">MacOsResourceSnd_SoundHeader</span>
<span class="w">  </span><span class="n">MacOsResourceSnd_DataFormat</span><span class="o">*</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">ref</span><span class="w"> </span><span class="k">object</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">KaitaiStruct</span>
<span class="w">    </span><span class="p">`</span><span class="n">id</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">MacOsResourceSnd_DataType</span>
<span class="w">    </span><span class="p">`</span><span class="n">options</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">uint32</span>
<span class="w">    </span><span class="p">`</span><span class="n">parent</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">MacOsResourceSnd</span>
<span class="w">    </span><span class="p">`</span><span class="n">initPanMaskInst</span><span class="p">`:</span><span class="w"> </span><span class="nb">int8</span>
<span class="w">    </span><span class="p">`</span><span class="n">initPanMaskInstFlag</span><span class="p">`:</span><span class="w"> </span><span class="nb">bool</span>
<span class="w">    </span><span class="p">`</span><span class="n">waveInitChannelMaskInst</span><span class="p">`:</span><span class="w"> </span><span class="nb">int8</span>
<span class="w">    </span><span class="p">`</span><span class="n">waveInitChannelMaskInstFlag</span><span class="p">`:</span><span class="w"> </span><span class="nb">bool</span>
<span class="w">    </span><span class="p">`</span><span class="n">initStereoMaskInst</span><span class="p">`:</span><span class="w"> </span><span class="n">uint8</span>
<span class="w">    </span><span class="p">`</span><span class="n">initStereoMaskInstFlag</span><span class="p">`:</span><span class="w"> </span><span class="nb">bool</span>
<span class="w">    </span><span class="p">`</span><span class="n">waveInitInst</span><span class="p">`:</span><span class="w"> </span><span class="n">MacOsResourceSnd_WaveInitOption</span>
<span class="w">    </span><span class="p">`</span><span class="n">waveInitInstFlag</span><span class="p">`:</span><span class="w"> </span><span class="nb">bool</span>
<span class="w">    </span><span class="p">`</span><span class="n">panInitInst</span><span class="p">`:</span><span class="w"> </span><span class="n">MacOsResourceSnd_InitOption</span>
<span class="w">    </span><span class="p">`</span><span class="n">panInitInstFlag</span><span class="p">`:</span><span class="w"> </span><span class="nb">bool</span>
<span class="w">    </span><span class="p">`</span><span class="n">initCompMaskInst</span><span class="p">`:</span><span class="w"> </span><span class="nb">int</span>
<span class="w">    </span><span class="p">`</span><span class="n">initCompMaskInstFlag</span><span class="p">`:</span><span class="w"> </span><span class="nb">bool</span>
<span class="w">    </span><span class="p">`</span><span class="n">stereoInitInst</span><span class="p">`:</span><span class="w"> </span><span class="n">MacOsResourceSnd_InitOption</span>
<span class="w">    </span><span class="p">`</span><span class="n">stereoInitInstFlag</span><span class="p">`:</span><span class="w"> </span><span class="nb">bool</span>
<span class="w">    </span><span class="p">`</span><span class="n">compInitInst</span><span class="p">`:</span><span class="w"> </span><span class="n">MacOsResourceSnd_InitOption</span>
<span class="w">    </span><span class="p">`</span><span class="n">compInitInstFlag</span><span class="p">`:</span><span class="w"> </span><span class="nb">bool</span>

<span class="k">proc</span><span class="w"> </span><span class="nf">read</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[MacOsResourceSnd], io: KaitaiStream, root: KaitaiStruct, parent: KaitaiStruct): MacOsResourceSnd</span>
<span class="k">proc</span><span class="w"> </span><span class="nf">read</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[MacOsResourceSnd_Extended], io: KaitaiStream, root: KaitaiStruct, parent: MacOsResourceSnd_ExtendedOrCompressed): MacOsResourceSnd_Extended</span>
<span class="k">proc</span><span class="w"> </span><span class="nf">read</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[MacOsResourceSnd_SoundHeader], io: KaitaiStream, root: KaitaiStruct, parent: MacOsResourceSnd_SoundCommand): MacOsResourceSnd_SoundHeader</span>
<span class="k">proc</span><span class="w"> </span><span class="nf">read</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[MacOsResourceSnd_UnsignedFixedPoint], io: KaitaiStream, root: KaitaiStruct, parent: MacOsResourceSnd_SoundHeader): MacOsResourceSnd_UnsignedFixedPoint</span>
<span class="k">proc</span><span class="w"> </span><span class="nf">read</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[MacOsResourceSnd_SoundCommand], io: KaitaiStream, root: KaitaiStruct, parent: MacOsResourceSnd): MacOsResourceSnd_SoundCommand</span>
<span class="k">proc</span><span class="w"> </span><span class="nf">read</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[MacOsResourceSnd_Compressed], io: KaitaiStream, root: KaitaiStruct, parent: MacOsResourceSnd_ExtendedOrCompressed): MacOsResourceSnd_Compressed</span>
<span class="k">proc</span><span class="w"> </span><span class="nf">read</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[MacOsResourceSnd_ExtendedOrCompressed], io: KaitaiStream, root: KaitaiStruct, parent: MacOsResourceSnd_SoundHeader): MacOsResourceSnd_ExtendedOrCompressed</span>
<span class="k">proc</span><span class="w"> </span><span class="nf">read</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[MacOsResourceSnd_DataFormat], io: KaitaiStream, root: KaitaiStruct, parent: MacOsResourceSnd): MacOsResourceSnd_DataFormat</span>

<span class="k">proc</span><span class="w"> </span><span class="nf">midiNoteToFrequency</span><span class="o">*</span><span class="p">(</span><span class="n">this</span><span class="p">:</span><span class="w"> </span><span class="n">MacOsResourceSnd</span><span class="p">):</span><span class="w"> </span><span class="nb">seq</span><span class="o">[</span><span class="nb">float64</span><span class="o">]</span>
<span class="k">proc</span><span class="w"> </span><span class="nf">startOfs</span><span class="o">*</span><span class="p">(</span><span class="n">this</span><span class="p">:</span><span class="w"> </span><span class="n">MacOsResourceSnd_SoundHeader</span><span class="p">):</span><span class="w"> </span><span class="nb">int</span>
<span class="k">proc</span><span class="w"> </span><span class="nf">baseFreqeuncy</span><span class="o">*</span><span class="p">(</span><span class="n">this</span><span class="p">:</span><span class="w"> </span><span class="n">MacOsResourceSnd_SoundHeader</span><span class="p">):</span><span class="w"> </span><span class="nb">float64</span>
<span class="k">proc</span><span class="w"> </span><span class="nf">soundHeaderType</span><span class="o">*</span><span class="p">(</span><span class="n">this</span><span class="p">:</span><span class="w"> </span><span class="n">MacOsResourceSnd_SoundHeader</span><span class="p">):</span><span class="w"> </span><span class="n">MacOsResourceSnd_SoundHeaderType</span>
<span class="k">proc</span><span class="w"> </span><span class="nf">value</span><span class="o">*</span><span class="p">(</span><span class="n">this</span><span class="p">:</span><span class="w"> </span><span class="n">MacOsResourceSnd_UnsignedFixedPoint</span><span class="p">):</span><span class="w"> </span><span class="nb">float64</span>
<span class="k">proc</span><span class="w"> </span><span class="nf">soundHeader</span><span class="o">*</span><span class="p">(</span><span class="n">this</span><span class="p">:</span><span class="w"> </span><span class="n">MacOsResourceSnd_SoundCommand</span><span class="p">):</span><span class="w"> </span><span class="n">MacOsResourceSnd_SoundHeader</span>
<span class="k">proc</span><span class="w"> </span><span class="nf">compressionType</span><span class="o">*</span><span class="p">(</span><span class="n">this</span><span class="p">:</span><span class="w"> </span><span class="n">MacOsResourceSnd_Compressed</span><span class="p">):</span><span class="w"> </span><span class="n">MacOsResourceSnd_CompressionTypeEnum</span>
<span class="k">proc</span><span class="w"> </span><span class="nf">initPanMask</span><span class="o">*</span><span class="p">(</span><span class="n">this</span><span class="p">:</span><span class="w"> </span><span class="n">MacOsResourceSnd_DataFormat</span><span class="p">):</span><span class="w"> </span><span class="nb">int8</span>
<span class="k">proc</span><span class="w"> </span><span class="nf">waveInitChannelMask</span><span class="o">*</span><span class="p">(</span><span class="n">this</span><span class="p">:</span><span class="w"> </span><span class="n">MacOsResourceSnd_DataFormat</span><span class="p">):</span><span class="w"> </span><span class="nb">int8</span>
<span class="k">proc</span><span class="w"> </span><span class="nf">initStereoMask</span><span class="o">*</span><span class="p">(</span><span class="n">this</span><span class="p">:</span><span class="w"> </span><span class="n">MacOsResourceSnd_DataFormat</span><span class="p">):</span><span class="w"> </span><span class="n">uint8</span>
<span class="k">proc</span><span class="w"> </span><span class="nf">waveInit</span><span class="o">*</span><span class="p">(</span><span class="n">this</span><span class="p">:</span><span class="w"> </span><span class="n">MacOsResourceSnd_DataFormat</span><span class="p">):</span><span class="w"> </span><span class="n">MacOsResourceSnd_WaveInitOption</span>
<span class="k">proc</span><span class="w"> </span><span class="nf">panInit</span><span class="o">*</span><span class="p">(</span><span class="n">this</span><span class="p">:</span><span class="w"> </span><span class="n">MacOsResourceSnd_DataFormat</span><span class="p">):</span><span class="w"> </span><span class="n">MacOsResourceSnd_InitOption</span>
<span class="k">proc</span><span class="w"> </span><span class="nf">initCompMask</span><span class="o">*</span><span class="p">(</span><span class="n">this</span><span class="p">:</span><span class="w"> </span><span class="n">MacOsResourceSnd_DataFormat</span><span class="p">):</span><span class="w"> </span><span class="nb">int</span>
<span class="k">proc</span><span class="w"> </span><span class="nf">stereoInit</span><span class="o">*</span><span class="p">(</span><span class="n">this</span><span class="p">:</span><span class="w"> </span><span class="n">MacOsResourceSnd_DataFormat</span><span class="p">):</span><span class="w"> </span><span class="n">MacOsResourceSnd_InitOption</span>
<span class="k">proc</span><span class="w"> </span><span class="nf">compInit</span><span class="o">*</span><span class="p">(</span><span class="n">this</span><span class="p">:</span><span class="w"> </span><span class="n">MacOsResourceSnd_DataFormat</span><span class="p">):</span><span class="w"> </span><span class="n">MacOsResourceSnd_InitOption</span>


<span class="sd">##[</span>
<span class="sd">Sound resources were introduced in Classic MacOS with the Sound Manager program.</span>
<span class="sd">They can contain sound commands to generate sounds with given frequencies as well as sampled sound data.</span>
<span class="sd">They are mostly found in resource forks, but can occasionally appear standalone or embedded in other files.</span>

<span class="sd">@see &lt;a href=&quot;https://developer.apple.com/library/archive/documentation/mac/pdf/Sound/Sound_Manager.pdf&quot;&gt;Source&lt;/a&gt;</span>
<span class="sd">]##</span>
<span class="k">proc</span><span class="w"> </span><span class="nf">read</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[MacOsResourceSnd], io: KaitaiStream, root: KaitaiStruct, parent: KaitaiStruct): MacOsResourceSnd =</span>
<span class="w">  </span><span class="k">template</span><span class="w"> </span><span class="nf">this</span><span class="p">:</span><span class="w"> </span><span class="n">untyped</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span>
<span class="w">  </span><span class="n">this</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="p">(</span><span class="n">MacOsResourceSnd</span><span class="p">)</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kp">nil</span><span class="p">:</span><span class="w"> </span><span class="k">cast</span><span class="o">[</span><span class="n">MacOsResourceSnd</span><span class="o">]</span><span class="p">(</span><span class="n">this</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="p">:</span><span class="w"> </span><span class="k">cast</span><span class="o">[</span><span class="n">MacOsResourceSnd</span><span class="o">]</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">io</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">root</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parent</span>

<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">formatExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readU2be</span><span class="p">()</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">format</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">formatExpr</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">format</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span>
<span class="w">    </span><span class="k">let</span><span class="w"> </span><span class="n">numDataFormatsExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readU2be</span><span class="p">()</span>
<span class="w">    </span><span class="n">this</span><span class="p">.</span><span class="n">numDataFormats</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">numDataFormatsExpr</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">format</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">..</span><span class="o">&lt;</span><span class="w"> </span><span class="nb">int</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">numDataFormats</span><span class="p">):</span>
<span class="w">      </span><span class="k">let</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MacOsResourceSnd_DataFormat</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">root</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="p">)</span>
<span class="w">      </span><span class="n">this</span><span class="p">.</span><span class="n">dataFormats</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">it</span><span class="p">)</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">format</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="p">:</span>
<span class="w">    </span><span class="k">let</span><span class="w"> </span><span class="n">referenceCountExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readU2be</span><span class="p">()</span>
<span class="w">    </span><span class="n">this</span><span class="p">.</span><span class="n">referenceCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">referenceCountExpr</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">numSoundCommandsExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readU2be</span><span class="p">()</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">numSoundCommands</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">numSoundCommandsExpr</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">..</span><span class="o">&lt;</span><span class="w"> </span><span class="nb">int</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">numSoundCommands</span><span class="p">):</span>
<span class="w">    </span><span class="k">let</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MacOsResourceSnd_SoundCommand</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">root</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="p">)</span>
<span class="w">    </span><span class="n">this</span><span class="p">.</span><span class="n">soundCommands</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">it</span><span class="p">)</span>

<span class="k">proc</span><span class="w"> </span><span class="nf">midiNoteToFrequency</span><span class="p">(</span><span class="n">this</span><span class="p">:</span><span class="w"> </span><span class="n">MacOsResourceSnd</span><span class="p">):</span><span class="w"> </span><span class="nb">seq</span><span class="o">[</span><span class="nb">float64</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  Lookup table to convert a MIDI note into a frequency in Hz</span>
<span class="sd">The lookup table represents the formula (2 ** ((midi_note - 69) / 12)) * 440</span>

<span class="sd">  @see &lt;a href=&quot;https://en.wikipedia.org/wiki/MIDI_tuning_standard&quot;&gt;Source&lt;/a&gt;</span>
<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">midiNoteToFrequencyInstFlag</span><span class="p">:</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">midiNoteToFrequencyInst</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">midiNoteToFrequencyInstExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">seq</span><span class="o">[</span><span class="nb">float64</span><span class="o">]</span><span class="p">(</span><span class="o">@[</span><span class="nb">float64</span><span class="p">(</span><span class="mf">8.18</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">8.66</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">9.18</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">9.72</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">10.30</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">10.91</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">11.56</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">12.25</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">12.98</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">13.75</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">14.57</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">15.43</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">16.35</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">17.32</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">18.35</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">19.45</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">20.60</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">21.83</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">23.12</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">24.50</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">25.96</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">27.50</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">29.14</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">30.87</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">32.70</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">34.65</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">36.71</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">38.89</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">41.20</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">43.65</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">46.25</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">49.00</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">51.91</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">55.00</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">58.27</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">61.74</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">65.41</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">69.30</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">73.42</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">77.78</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">82.41</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">87.31</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">92.50</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">98.00</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">103.83</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">110.00</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">116.54</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">123.47</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">130.81</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">138.59</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">146.83</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">155.56</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">164.81</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">174.61</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">185.00</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">196.00</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">207.65</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">220.00</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">233.08</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">246.94</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">261.63</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">277.18</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">293.66</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">311.13</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">329.63</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">349.23</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">369.99</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">392.00</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">415.30</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">440.00</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">466.16</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">493.88</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">523.25</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">554.37</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">587.33</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">622.25</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">659.26</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">698.46</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">739.99</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">783.99</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">830.61</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">880.00</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">932.33</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">987.77</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">1046.50</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">1108.73</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">1174.66</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">1244.51</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">1318.51</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">1396.91</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">1479.98</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">1567.98</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">1661.22</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">1760.00</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">1864.66</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">1975.53</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">2093.00</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">2217.46</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">2349.32</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">2489.02</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">2637.02</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">2793.83</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">2959.96</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">3135.96</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">3322.44</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">3520.00</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">3729.31</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">3951.07</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">4186.01</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">4434.92</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">4698.64</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">4978.03</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">5274.04</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">5587.65</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">5919.91</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">6271.93</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">6644.88</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">7040.00</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">7458.62</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">7902.13</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">8372.02</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">8869.84</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">9397.27</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">9956.06</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">10548.08</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">11175.30</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">11839.82</span><span class="p">),</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mf">12543.85</span><span class="p">)</span><span class="o">]</span><span class="p">)</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">midiNoteToFrequencyInst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">midiNoteToFrequencyInstExpr</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">midiNoteToFrequencyInstFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kp">true</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">midiNoteToFrequencyInst</span>

<span class="k">proc</span><span class="w"> </span><span class="nf">fromFile</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[MacOsResourceSnd], filename: string): MacOsResourceSnd =</span>
<span class="w">  </span><span class="n">MacOsResourceSnd</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">newKaitaiFileStream</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span><span class="w"> </span><span class="kp">nil</span><span class="p">,</span><span class="w"> </span><span class="kp">nil</span><span class="p">)</span>

<span class="k">proc</span><span class="w"> </span><span class="nf">read</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[MacOsResourceSnd_Extended], io: KaitaiStream, root: KaitaiStruct, parent: MacOsResourceSnd_ExtendedOrCompressed): MacOsResourceSnd_Extended =</span>
<span class="w">  </span><span class="k">template</span><span class="w"> </span><span class="nf">this</span><span class="p">:</span><span class="w"> </span><span class="n">untyped</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span>
<span class="w">  </span><span class="n">this</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="p">(</span><span class="n">MacOsResourceSnd_Extended</span><span class="p">)</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kp">nil</span><span class="p">:</span><span class="w"> </span><span class="k">cast</span><span class="o">[</span><span class="n">MacOsResourceSnd</span><span class="o">]</span><span class="p">(</span><span class="n">this</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="p">:</span><span class="w"> </span><span class="k">cast</span><span class="o">[</span><span class="n">MacOsResourceSnd</span><span class="o">]</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">io</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">root</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parent</span>


<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  pointer to instrument info</span>
<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">instrumentChunkPtrExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readU4be</span><span class="p">()</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">instrumentChunkPtr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">instrumentChunkPtrExpr</span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  pointer to audio info</span>
<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">aesRecordingPtrExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readU4be</span><span class="p">()</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">aesRecordingPtr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aesRecordingPtrExpr</span>

<span class="k">proc</span><span class="w"> </span><span class="nf">fromFile</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[MacOsResourceSnd_Extended], filename: string): MacOsResourceSnd_Extended =</span>
<span class="w">  </span><span class="n">MacOsResourceSnd_Extended</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">newKaitaiFileStream</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span><span class="w"> </span><span class="kp">nil</span><span class="p">,</span><span class="w"> </span><span class="kp">nil</span><span class="p">)</span>

<span class="k">proc</span><span class="w"> </span><span class="nf">read</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[MacOsResourceSnd_SoundHeader], io: KaitaiStream, root: KaitaiStruct, parent: MacOsResourceSnd_SoundCommand): MacOsResourceSnd_SoundHeader =</span>
<span class="w">  </span><span class="k">template</span><span class="w"> </span><span class="nf">this</span><span class="p">:</span><span class="w"> </span><span class="n">untyped</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span>
<span class="w">  </span><span class="n">this</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="p">(</span><span class="n">MacOsResourceSnd_SoundHeader</span><span class="p">)</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kp">nil</span><span class="p">:</span><span class="w"> </span><span class="k">cast</span><span class="o">[</span><span class="n">MacOsResourceSnd</span><span class="o">]</span><span class="p">(</span><span class="n">this</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="p">:</span><span class="w"> </span><span class="k">cast</span><span class="o">[</span><span class="n">MacOsResourceSnd</span><span class="o">]</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">io</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">root</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parent</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">startOfs</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">:</span>
<span class="w">    </span><span class="k">let</span><span class="w"> </span><span class="n">unnamed0Expr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readBytes</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
<span class="w">    </span><span class="n">this</span><span class="p">.</span><span class="n">unnamed0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">unnamed0Expr</span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  pointer to samples (or 0 if samples follow data structure)</span>
<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">samplePtrExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readU4be</span><span class="p">()</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">samplePtr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">samplePtrExpr</span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  number of samples</span>
<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">soundHeaderType</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">mac_os_resource_snd</span><span class="p">.</span><span class="n">standard</span><span class="p">:</span>
<span class="w">    </span><span class="k">let</span><span class="w"> </span><span class="n">numSamplesExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readU4be</span><span class="p">()</span>
<span class="w">    </span><span class="n">this</span><span class="p">.</span><span class="n">numSamples</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">numSamplesExpr</span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  number of channels in sample</span>
<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">if</span><span class="w">  </span><span class="p">((</span><span class="n">this</span><span class="p">.</span><span class="n">soundHeaderType</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">mac_os_resource_snd</span><span class="p">.</span><span class="n">extended</span><span class="p">)</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">soundHeaderType</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">mac_os_resource_snd</span><span class="p">.</span><span class="n">compressed</span><span class="p">))</span><span class="w"> </span><span class="p">:</span>
<span class="w">    </span><span class="k">let</span><span class="w"> </span><span class="n">numChannelsExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readU4be</span><span class="p">()</span>
<span class="w">    </span><span class="n">this</span><span class="p">.</span><span class="n">numChannels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">numChannelsExpr</span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  The rate at which the sample was originally recorded.</span>
<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">sampleRateExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MacOsResourceSnd_UnsignedFixedPoint</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">root</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="p">)</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">sampleRate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sampleRateExpr</span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  loop point beginning</span>
<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">loopStartExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readU4be</span><span class="p">()</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">loopStart</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">loopStartExpr</span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  loop point ending</span>
<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">loopEndExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readU4be</span><span class="p">()</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">loopEnd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">loopEndExpr</span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  sample&#39;s encoding option</span>
<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">encodeExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MacOsResourceSnd_SoundHeaderType</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readU1</span><span class="p">())</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">encode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">encodeExpr</span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  base frequency of sample, expressed as MIDI note values, 60 is middle C</span>
<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">midiNoteExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readU1</span><span class="p">()</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">midiNote</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">midiNoteExpr</span>
<span class="w">  </span><span class="k">if</span><span class="w">  </span><span class="p">((</span><span class="n">this</span><span class="p">.</span><span class="n">soundHeaderType</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">mac_os_resource_snd</span><span class="p">.</span><span class="n">extended</span><span class="p">)</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">soundHeaderType</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">mac_os_resource_snd</span><span class="p">.</span><span class="n">compressed</span><span class="p">))</span><span class="w"> </span><span class="p">:</span>
<span class="w">    </span><span class="k">let</span><span class="w"> </span><span class="n">extendedOrCompressedExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MacOsResourceSnd_ExtendedOrCompressed</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">root</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="p">)</span>
<span class="w">    </span><span class="n">this</span><span class="p">.</span><span class="n">extendedOrCompressed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">extendedOrCompressedExpr</span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  sampled-sound data</span>
<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">samplePtr</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">:</span>
<span class="w">    </span><span class="k">let</span><span class="w"> </span><span class="n">sampleAreaExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readBytes</span><span class="p">(</span><span class="nb">int</span><span class="p">((</span><span class="k">if</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">soundHeaderType</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">mac_os_resource_snd</span><span class="p">.</span><span class="n">standard</span><span class="p">:</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">numSamples</span><span class="w"> </span><span class="k">else</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">soundHeaderType</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">mac_os_resource_snd</span><span class="p">.</span><span class="n">extended</span><span class="p">:</span><span class="w"> </span><span class="p">(((</span><span class="n">this</span><span class="p">.</span><span class="n">extendedOrCompressed</span><span class="p">.</span><span class="n">numFrames</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">numChannels</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">extendedOrCompressed</span><span class="p">.</span><span class="n">bitsPerSample</span><span class="p">)</span><span class="w"> </span><span class="ow">div</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">size</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">pos</span><span class="p">)))))</span>
<span class="w">    </span><span class="n">this</span><span class="p">.</span><span class="n">sampleArea</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sampleAreaExpr</span>

<span class="k">proc</span><span class="w"> </span><span class="nf">startOfs</span><span class="p">(</span><span class="n">this</span><span class="p">:</span><span class="w"> </span><span class="n">MacOsResourceSnd_SoundHeader</span><span class="p">):</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">startOfsInstFlag</span><span class="p">:</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">startOfsInst</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">startOfsInstExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">int</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">pos</span><span class="p">)</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">startOfsInst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">startOfsInstExpr</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">startOfsInstFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kp">true</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">startOfsInst</span>

<span class="k">proc</span><span class="w"> </span><span class="nf">baseFreqeuncy</span><span class="p">(</span><span class="n">this</span><span class="p">:</span><span class="w"> </span><span class="n">MacOsResourceSnd_SoundHeader</span><span class="p">):</span><span class="w"> </span><span class="nb">float64</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  base frequency of sample in Hz</span>
<span class="sd">Calculated with the formula (2 ** ((midi_note - 69) / 12)) * 440</span>

<span class="sd">  @see &lt;a href=&quot;https://en.wikipedia.org/wiki/MIDI_tuning_standard&quot;&gt;Source&lt;/a&gt;</span>
<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">baseFreqeuncyInstFlag</span><span class="p">:</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">baseFreqeuncyInst</span>
<span class="w">  </span><span class="k">if</span><span class="w">  </span><span class="p">((</span><span class="n">this</span><span class="p">.</span><span class="n">midiNote</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">midiNote</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">128</span><span class="p">))</span><span class="w"> </span><span class="p">:</span>
<span class="w">    </span><span class="k">let</span><span class="w"> </span><span class="n">baseFreqeuncyInstExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="n">MacOsResourceSnd</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">root</span><span class="p">).</span><span class="n">midiNoteToFrequency</span><span class="o">[</span><span class="n">this</span><span class="p">.</span><span class="n">midiNote</span><span class="o">]</span><span class="p">)</span>
<span class="w">    </span><span class="n">this</span><span class="p">.</span><span class="n">baseFreqeuncyInst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">baseFreqeuncyInstExpr</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">baseFreqeuncyInstFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kp">true</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">baseFreqeuncyInst</span>

<span class="k">proc</span><span class="w"> </span><span class="nf">soundHeaderType</span><span class="p">(</span><span class="n">this</span><span class="p">:</span><span class="w"> </span><span class="n">MacOsResourceSnd_SoundHeader</span><span class="p">):</span><span class="w"> </span><span class="n">MacOsResourceSnd_SoundHeaderType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">soundHeaderTypeInstFlag</span><span class="p">:</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">soundHeaderTypeInst</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">pos</span><span class="p">()</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">seek</span><span class="p">(</span><span class="nb">int</span><span class="p">((</span><span class="n">this</span><span class="p">.</span><span class="n">startOfs</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">20</span><span class="p">)))</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">soundHeaderTypeInstExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MacOsResourceSnd_SoundHeaderType</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readU1</span><span class="p">())</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">soundHeaderTypeInst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">soundHeaderTypeInstExpr</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">seek</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">soundHeaderTypeInstFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kp">true</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">soundHeaderTypeInst</span>

<span class="k">proc</span><span class="w"> </span><span class="nf">fromFile</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[MacOsResourceSnd_SoundHeader], filename: string): MacOsResourceSnd_SoundHeader =</span>
<span class="w">  </span><span class="n">MacOsResourceSnd_SoundHeader</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">newKaitaiFileStream</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span><span class="w"> </span><span class="kp">nil</span><span class="p">,</span><span class="w"> </span><span class="kp">nil</span><span class="p">)</span>

<span class="k">proc</span><span class="w"> </span><span class="nf">read</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[MacOsResourceSnd_UnsignedFixedPoint], io: KaitaiStream, root: KaitaiStruct, parent: MacOsResourceSnd_SoundHeader): MacOsResourceSnd_UnsignedFixedPoint =</span>
<span class="w">  </span><span class="k">template</span><span class="w"> </span><span class="nf">this</span><span class="p">:</span><span class="w"> </span><span class="n">untyped</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span>
<span class="w">  </span><span class="n">this</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="p">(</span><span class="n">MacOsResourceSnd_UnsignedFixedPoint</span><span class="p">)</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kp">nil</span><span class="p">:</span><span class="w"> </span><span class="k">cast</span><span class="o">[</span><span class="n">MacOsResourceSnd</span><span class="o">]</span><span class="p">(</span><span class="n">this</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="p">:</span><span class="w"> </span><span class="k">cast</span><span class="o">[</span><span class="n">MacOsResourceSnd</span><span class="o">]</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">io</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">root</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parent</span>

<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">integerPartExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readU2be</span><span class="p">()</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">integerPart</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">integerPartExpr</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">fractionPartExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readU2be</span><span class="p">()</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">fractionPart</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fractionPartExpr</span>

<span class="k">proc</span><span class="w"> </span><span class="nf">value</span><span class="p">(</span><span class="n">this</span><span class="p">:</span><span class="w"> </span><span class="n">MacOsResourceSnd_UnsignedFixedPoint</span><span class="p">):</span><span class="w"> </span><span class="nb">float64</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">valueInstFlag</span><span class="p">:</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">valueInst</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">valueInstExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">float64</span><span class="p">((</span><span class="n">this</span><span class="p">.</span><span class="n">integerPart</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">fractionPart</span><span class="w"> </span><span class="ow">div</span><span class="w"> </span><span class="mf">65535.0</span><span class="p">)))</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">valueInst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">valueInstExpr</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">valueInstFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kp">true</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">valueInst</span>

<span class="k">proc</span><span class="w"> </span><span class="nf">fromFile</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[MacOsResourceSnd_UnsignedFixedPoint], filename: string): MacOsResourceSnd_UnsignedFixedPoint =</span>
<span class="w">  </span><span class="n">MacOsResourceSnd_UnsignedFixedPoint</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">newKaitaiFileStream</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span><span class="w"> </span><span class="kp">nil</span><span class="p">,</span><span class="w"> </span><span class="kp">nil</span><span class="p">)</span>

<span class="k">proc</span><span class="w"> </span><span class="nf">read</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[MacOsResourceSnd_SoundCommand], io: KaitaiStream, root: KaitaiStruct, parent: MacOsResourceSnd): MacOsResourceSnd_SoundCommand =</span>
<span class="w">  </span><span class="k">template</span><span class="w"> </span><span class="nf">this</span><span class="p">:</span><span class="w"> </span><span class="n">untyped</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span>
<span class="w">  </span><span class="n">this</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="p">(</span><span class="n">MacOsResourceSnd_SoundCommand</span><span class="p">)</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kp">nil</span><span class="p">:</span><span class="w"> </span><span class="k">cast</span><span class="o">[</span><span class="n">MacOsResourceSnd</span><span class="o">]</span><span class="p">(</span><span class="n">this</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="p">:</span><span class="w"> </span><span class="k">cast</span><span class="o">[</span><span class="n">MacOsResourceSnd</span><span class="o">]</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">io</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">root</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parent</span>

<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">isDataOffsetExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readBitsIntBe</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">isDataOffset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">isDataOffsetExpr</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">cmdExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MacOsResourceSnd_CmdType</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readBitsIntBe</span><span class="p">(</span><span class="mi">15</span><span class="p">))</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">cmd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cmdExpr</span>
<span class="w">  </span><span class="n">alignToByte</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">)</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">param1Expr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readU2be</span><span class="p">()</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">param1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">param1Expr</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">param2Expr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readU4be</span><span class="p">()</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">param2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">param2Expr</span>

<span class="k">proc</span><span class="w"> </span><span class="nf">soundHeader</span><span class="p">(</span><span class="n">this</span><span class="p">:</span><span class="w"> </span><span class="n">MacOsResourceSnd_SoundCommand</span><span class="p">):</span><span class="w"> </span><span class="n">MacOsResourceSnd_SoundHeader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">soundHeaderInstFlag</span><span class="p">:</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">soundHeaderInst</span>
<span class="w">  </span><span class="k">if</span><span class="w">  </span><span class="p">((</span><span class="n">this</span><span class="p">.</span><span class="n">isDataOffset</span><span class="p">)</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">cmd</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">mac_os_resource_snd</span><span class="p">.</span><span class="n">buffer_cmd</span><span class="p">))</span><span class="w"> </span><span class="p">:</span>
<span class="w">    </span><span class="k">let</span><span class="w"> </span><span class="n">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">pos</span><span class="p">()</span>
<span class="w">    </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">seek</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">param2</span><span class="p">))</span>
<span class="w">    </span><span class="k">let</span><span class="w"> </span><span class="n">soundHeaderInstExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MacOsResourceSnd_SoundHeader</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">root</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="p">)</span>
<span class="w">    </span><span class="n">this</span><span class="p">.</span><span class="n">soundHeaderInst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">soundHeaderInstExpr</span>
<span class="w">    </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">seek</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">soundHeaderInstFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kp">true</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">soundHeaderInst</span>

<span class="k">proc</span><span class="w"> </span><span class="nf">fromFile</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[MacOsResourceSnd_SoundCommand], filename: string): MacOsResourceSnd_SoundCommand =</span>
<span class="w">  </span><span class="n">MacOsResourceSnd_SoundCommand</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">newKaitaiFileStream</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span><span class="w"> </span><span class="kp">nil</span><span class="p">,</span><span class="w"> </span><span class="kp">nil</span><span class="p">)</span>

<span class="k">proc</span><span class="w"> </span><span class="nf">read</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[MacOsResourceSnd_Compressed], io: KaitaiStream, root: KaitaiStruct, parent: MacOsResourceSnd_ExtendedOrCompressed): MacOsResourceSnd_Compressed =</span>
<span class="w">  </span><span class="k">template</span><span class="w"> </span><span class="nf">this</span><span class="p">:</span><span class="w"> </span><span class="n">untyped</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span>
<span class="w">  </span><span class="n">this</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="p">(</span><span class="n">MacOsResourceSnd_Compressed</span><span class="p">)</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kp">nil</span><span class="p">:</span><span class="w"> </span><span class="k">cast</span><span class="o">[</span><span class="n">MacOsResourceSnd</span><span class="o">]</span><span class="p">(</span><span class="n">this</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="p">:</span><span class="w"> </span><span class="k">cast</span><span class="o">[</span><span class="n">MacOsResourceSnd</span><span class="o">]</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">io</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">root</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parent</span>


<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  data format type</span>
<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">formatExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">encode</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readBytes</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">4</span><span class="p">)),</span><span class="w"> </span><span class="s">&quot;ASCII&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">format</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">formatExpr</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">reservedExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readBytes</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">reserved</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reservedExpr</span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  pointer to StateBlock</span>
<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">stateVarsPtrExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readU4be</span><span class="p">()</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">stateVarsPtr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stateVarsPtrExpr</span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  pointer to LeftOverBlock</span>
<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">leftOverSamplesPtrExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readU4be</span><span class="p">()</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">leftOverSamplesPtr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">leftOverSamplesPtrExpr</span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  ID of compression algorithm</span>
<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">compressionIdExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readS2be</span><span class="p">()</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">compressionId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">compressionIdExpr</span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  number of bits per packet</span>
<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">packetSizeExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readU2be</span><span class="p">()</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">packetSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">packetSizeExpr</span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  Latest Sound Manager documentation specifies this field as:</span>
<span class="sd">This field is unused. You should set it to 0.</span>
<span class="sd">Inside Macintosh (Volume VI, 1991) specifies it as:</span>
<span class="sd">Indicates the resource ID number of the &#39;snth&#39; resource that was used to compress the packets contained in the compressed sound header.</span>

<span class="sd">  @see &lt;a href=&quot;https://vintageapple.org/inside_o/pdf/Inside_Macintosh_Volume_VI_1991.pdf&quot;&gt;Page 22-49, absolute page number 1169 in the PDF&lt;/a&gt;</span>
<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">synthesizerIdExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readU2be</span><span class="p">()</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">synthesizerId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">synthesizerIdExpr</span>

<span class="k">proc</span><span class="w"> </span><span class="nf">compressionType</span><span class="p">(</span><span class="n">this</span><span class="p">:</span><span class="w"> </span><span class="n">MacOsResourceSnd_Compressed</span><span class="p">):</span><span class="w"> </span><span class="n">MacOsResourceSnd_CompressionTypeEnum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">compressionTypeInstFlag</span><span class="p">:</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">compressionTypeInst</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">compressionTypeInstExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MacOsResourceSnd_CompressionTypeEnum</span><span class="p">(</span><span class="n">MacOsResourceSnd_CompressionTypeEnum</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">compressionId</span><span class="p">))</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">compressionTypeInst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">compressionTypeInstExpr</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">compressionTypeInstFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kp">true</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">compressionTypeInst</span>

<span class="k">proc</span><span class="w"> </span><span class="nf">fromFile</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[MacOsResourceSnd_Compressed], filename: string): MacOsResourceSnd_Compressed =</span>
<span class="w">  </span><span class="n">MacOsResourceSnd_Compressed</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">newKaitaiFileStream</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span><span class="w"> </span><span class="kp">nil</span><span class="p">,</span><span class="w"> </span><span class="kp">nil</span><span class="p">)</span>

<span class="k">proc</span><span class="w"> </span><span class="nf">read</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[MacOsResourceSnd_ExtendedOrCompressed], io: KaitaiStream, root: KaitaiStruct, parent: MacOsResourceSnd_SoundHeader): MacOsResourceSnd_ExtendedOrCompressed =</span>
<span class="w">  </span><span class="k">template</span><span class="w"> </span><span class="nf">this</span><span class="p">:</span><span class="w"> </span><span class="n">untyped</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span>
<span class="w">  </span><span class="n">this</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="p">(</span><span class="n">MacOsResourceSnd_ExtendedOrCompressed</span><span class="p">)</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kp">nil</span><span class="p">:</span><span class="w"> </span><span class="k">cast</span><span class="o">[</span><span class="n">MacOsResourceSnd</span><span class="o">]</span><span class="p">(</span><span class="n">this</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="p">:</span><span class="w"> </span><span class="k">cast</span><span class="o">[</span><span class="n">MacOsResourceSnd</span><span class="o">]</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">io</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">root</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parent</span>

<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">numFramesExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readU4be</span><span class="p">()</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">numFrames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">numFramesExpr</span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  rate of original sample (Extended80)</span>
<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">aiffSampleRateExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readBytes</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">aiffSampleRate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aiffSampleRateExpr</span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  reserved</span>
<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">markerChunkExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readU4be</span><span class="p">()</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">markerChunk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">markerChunkExpr</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">parent</span><span class="p">.</span><span class="n">soundHeaderType</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">mac_os_resource_snd</span><span class="p">.</span><span class="n">extended</span><span class="p">:</span>
<span class="w">    </span><span class="k">let</span><span class="w"> </span><span class="n">extendedExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MacOsResourceSnd_Extended</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">root</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="p">)</span>
<span class="w">    </span><span class="n">this</span><span class="p">.</span><span class="n">extended</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">extendedExpr</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">parent</span><span class="p">.</span><span class="n">soundHeaderType</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">mac_os_resource_snd</span><span class="p">.</span><span class="n">compressed</span><span class="p">:</span>
<span class="w">    </span><span class="k">let</span><span class="w"> </span><span class="n">compressedExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MacOsResourceSnd_Compressed</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">root</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="p">)</span>
<span class="w">    </span><span class="n">this</span><span class="p">.</span><span class="n">compressed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">compressedExpr</span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  number of bits per sample</span>
<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">bitsPerSampleExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readU2be</span><span class="p">()</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">bitsPerSample</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bitsPerSampleExpr</span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  reserved</span>
<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">parent</span><span class="p">.</span><span class="n">soundHeaderType</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">mac_os_resource_snd</span><span class="p">.</span><span class="n">extended</span><span class="p">:</span>
<span class="w">    </span><span class="k">let</span><span class="w"> </span><span class="n">reservedExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readBytes</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">14</span><span class="p">))</span>
<span class="w">    </span><span class="n">this</span><span class="p">.</span><span class="n">reserved</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reservedExpr</span>

<span class="k">proc</span><span class="w"> </span><span class="nf">fromFile</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[MacOsResourceSnd_ExtendedOrCompressed], filename: string): MacOsResourceSnd_ExtendedOrCompressed =</span>
<span class="w">  </span><span class="n">MacOsResourceSnd_ExtendedOrCompressed</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">newKaitaiFileStream</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span><span class="w"> </span><span class="kp">nil</span><span class="p">,</span><span class="w"> </span><span class="kp">nil</span><span class="p">)</span>

<span class="k">proc</span><span class="w"> </span><span class="nf">read</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[MacOsResourceSnd_DataFormat], io: KaitaiStream, root: KaitaiStruct, parent: MacOsResourceSnd): MacOsResourceSnd_DataFormat =</span>
<span class="w">  </span><span class="k">template</span><span class="w"> </span><span class="nf">this</span><span class="p">:</span><span class="w"> </span><span class="n">untyped</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span>
<span class="w">  </span><span class="n">this</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="p">(</span><span class="n">MacOsResourceSnd_DataFormat</span><span class="p">)</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kp">nil</span><span class="p">:</span><span class="w"> </span><span class="k">cast</span><span class="o">[</span><span class="n">MacOsResourceSnd</span><span class="o">]</span><span class="p">(</span><span class="n">this</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="p">:</span><span class="w"> </span><span class="k">cast</span><span class="o">[</span><span class="n">MacOsResourceSnd</span><span class="o">]</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">io</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">root</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parent</span>

<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">idExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MacOsResourceSnd_DataType</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readU2be</span><span class="p">())</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">idExpr</span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  contains initialisation options for the SndNewChannel function</span>
<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">optionsExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readU4be</span><span class="p">()</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">optionsExpr</span>

<span class="k">proc</span><span class="w"> </span><span class="nf">initPanMask</span><span class="p">(</span><span class="n">this</span><span class="p">:</span><span class="w"> </span><span class="n">MacOsResourceSnd_DataFormat</span><span class="p">):</span><span class="w"> </span><span class="nb">int8</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  mask for right/left pan values</span>
<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">initPanMaskInstFlag</span><span class="p">:</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">initPanMaskInst</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">initPanMaskInstExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">int8</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">initPanMaskInst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">initPanMaskInstExpr</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">initPanMaskInstFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kp">true</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">initPanMaskInst</span>

<span class="k">proc</span><span class="w"> </span><span class="nf">waveInitChannelMask</span><span class="p">(</span><span class="n">this</span><span class="p">:</span><span class="w"> </span><span class="n">MacOsResourceSnd_DataFormat</span><span class="p">):</span><span class="w"> </span><span class="nb">int8</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  wave table only, Sound Manager 2.0 and earlier</span>
<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">waveInitChannelMaskInstFlag</span><span class="p">:</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">waveInitChannelMaskInst</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">waveInitChannelMaskInstExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">int8</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">waveInitChannelMaskInst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">waveInitChannelMaskInstExpr</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">waveInitChannelMaskInstFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kp">true</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">waveInitChannelMaskInst</span>

<span class="k">proc</span><span class="w"> </span><span class="nf">initStereoMask</span><span class="p">(</span><span class="n">this</span><span class="p">:</span><span class="w"> </span><span class="n">MacOsResourceSnd_DataFormat</span><span class="p">):</span><span class="w"> </span><span class="n">uint8</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  mask for mono/stereo values</span>
<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">initStereoMaskInstFlag</span><span class="p">:</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">initStereoMaskInst</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">initStereoMaskInstExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uint8</span><span class="p">(</span><span class="mi">192</span><span class="p">)</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">initStereoMaskInst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">initStereoMaskInstExpr</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">initStereoMaskInstFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kp">true</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">initStereoMaskInst</span>

<span class="k">proc</span><span class="w"> </span><span class="nf">waveInit</span><span class="p">(</span><span class="n">this</span><span class="p">:</span><span class="w"> </span><span class="n">MacOsResourceSnd_DataFormat</span><span class="p">):</span><span class="w"> </span><span class="n">MacOsResourceSnd_WaveInitOption</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">waveInitInstFlag</span><span class="p">:</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">waveInitInst</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">mac_os_resource_snd</span><span class="p">.</span><span class="n">wave_table_synth</span><span class="p">:</span>
<span class="w">    </span><span class="k">let</span><span class="w"> </span><span class="n">waveInitInstExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MacOsResourceSnd_WaveInitOption</span><span class="p">(</span><span class="n">MacOsResourceSnd_WaveInitOption</span><span class="p">((</span><span class="n">this</span><span class="p">.</span><span class="n">options</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">waveInitChannelMask</span><span class="p">)))</span>
<span class="w">    </span><span class="n">this</span><span class="p">.</span><span class="n">waveInitInst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">waveInitInstExpr</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">waveInitInstFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kp">true</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">waveInitInst</span>

<span class="k">proc</span><span class="w"> </span><span class="nf">panInit</span><span class="p">(</span><span class="n">this</span><span class="p">:</span><span class="w"> </span><span class="n">MacOsResourceSnd_DataFormat</span><span class="p">):</span><span class="w"> </span><span class="n">MacOsResourceSnd_InitOption</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">panInitInstFlag</span><span class="p">:</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">panInitInst</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">panInitInstExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MacOsResourceSnd_InitOption</span><span class="p">(</span><span class="n">MacOsResourceSnd_InitOption</span><span class="p">((</span><span class="n">this</span><span class="p">.</span><span class="n">options</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">initPanMask</span><span class="p">)))</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">panInitInst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">panInitInstExpr</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">panInitInstFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kp">true</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">panInitInst</span>

<span class="k">proc</span><span class="w"> </span><span class="nf">initCompMask</span><span class="p">(</span><span class="n">this</span><span class="p">:</span><span class="w"> </span><span class="n">MacOsResourceSnd_DataFormat</span><span class="p">):</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  mask for compression IDs</span>
<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">initCompMaskInstFlag</span><span class="p">:</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">initCompMaskInst</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">initCompMaskInstExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">int</span><span class="p">(</span><span class="mi">65280</span><span class="p">)</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">initCompMaskInst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">initCompMaskInstExpr</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">initCompMaskInstFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kp">true</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">initCompMaskInst</span>

<span class="k">proc</span><span class="w"> </span><span class="nf">stereoInit</span><span class="p">(</span><span class="n">this</span><span class="p">:</span><span class="w"> </span><span class="n">MacOsResourceSnd_DataFormat</span><span class="p">):</span><span class="w"> </span><span class="n">MacOsResourceSnd_InitOption</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">stereoInitInstFlag</span><span class="p">:</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">stereoInitInst</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">stereoInitInstExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MacOsResourceSnd_InitOption</span><span class="p">(</span><span class="n">MacOsResourceSnd_InitOption</span><span class="p">((</span><span class="n">this</span><span class="p">.</span><span class="n">options</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">initStereoMask</span><span class="p">)))</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">stereoInitInst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stereoInitInstExpr</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">stereoInitInstFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kp">true</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">stereoInitInst</span>

<span class="k">proc</span><span class="w"> </span><span class="nf">compInit</span><span class="p">(</span><span class="n">this</span><span class="p">:</span><span class="w"> </span><span class="n">MacOsResourceSnd_DataFormat</span><span class="p">):</span><span class="w"> </span><span class="n">MacOsResourceSnd_InitOption</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">compInitInstFlag</span><span class="p">:</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">compInitInst</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">compInitInstExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MacOsResourceSnd_InitOption</span><span class="p">(</span><span class="n">MacOsResourceSnd_InitOption</span><span class="p">((</span><span class="n">this</span><span class="p">.</span><span class="n">options</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">initCompMask</span><span class="p">)))</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">compInitInst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">compInitInstExpr</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">compInitInstFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kp">true</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">compInitInst</span>

<span class="k">proc</span><span class="w"> </span><span class="nf">fromFile</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[MacOsResourceSnd_DataFormat], filename: string): MacOsResourceSnd_DataFormat =</span>
<span class="w">  </span><span class="n">MacOsResourceSnd_DataFormat</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">newKaitaiFileStream</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span><span class="w"> </span><span class="kp">nil</span><span class="p">,</span><span class="w"> </span><span class="kp">nil</span><span class="p">)</span>
</pre></div>

        </div>
        
    </div>
</section>

    <footer id="main-footer">
        <div class="container">
            &copy; 2015&ndash;2025 Kaitai Project and <a href="https://github.com/kaitai-io/kaitai_struct_formats/graphs/contributors">format repo contributors</a>

            <h3>Contacts</h3>

            <div class="row">
                <div class="col-sm-4">
                    <i class="fa fa-fw fa-2x fa-github"></i> <a href="https://github.com/kaitai-io/kaitai_struct">GitHub</a>
                </div>
                <div class="col-sm-4">
                    <i class="fa fa-fw fa-2x fa-twitter"></i> <a href="https://twitter.com/kaitai_io">@kaitai_io</a>
                </div>
                <div class="col-sm-4">
                    Gitter: <a href="https://gitter.im/kaitai_struct/Lobby">kaitai_struct</a>
                </div>
            </div>
        </div>
    </footer>

  <script src="//kaitai.io/js/jquery-1.12.3.min.js"></script>
  <script src="//kaitai.io/js/bootstrap.min.js"></script>
</body>
</html>
