<!DOCTYPE html>
<html dir="ltr" lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Compressed Macintosh resource data, Apple `'dcmp' (0)` format: Ruby parsing library</title>
  <meta name="keywords" content="kaitai,struct,binary,format,parsing,decoding,java,javascript,python,ruby,library,metadata">
  <meta name="description" content="Kaitai Struct is a formal language for binary format specification that can be compiled into parser code">

  <link rel="stylesheet" href="https://kaitai.io/styles/bootstrap.min.css">
  <link rel="stylesheet" href="https://kaitai.io/styles/bootstrap-theme.min.css">
  <link href='https://fonts.googleapis.com/css?family=Exo:400,700' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Share+Tech+Mono' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

  <link rel="stylesheet" href="https://kaitai.io/styles/main.css" type="text/css">
  <link rel="stylesheet" href="../pygments-default.css" type="text/css">
  <style>
.diagram-img {
    display: block;
    max-width: 100%;
    height: auto;
    margin: 0 auto;
}

section.format {
    padding: 30px 0;
}

section#format-meta, section#format-index-header {
    background: #e3eef7;
}

section#format-diagram, section#format-index-footer {
    background: #e9f8dd;
}

section#format-ksy, section#format-lang {
    background: #d1eadd;
}

section#format-index .row {
    padding-bottom: 10px;
}

  </style>
</head>
<body data-spy="scroll" data-target="#main-navbar" data-offset="100">

    <nav class="navbar navbar-inverse navbar-fixed-top" id="main-navbar">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#main-navbar-collapse" aria-expanded="false">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <span class="navbar-brand">Kaitai Struct</span>
            </div>
            <div class="collapse navbar-collapse" id="main-navbar-collapse">
                <ul class="nav navbar-nav">
                    <li><a href="http://kaitai.io/#what-is-it">What is it?</a></li>
                    <li><a href="http://kaitai.io/#quick-start">Quick Start</a></li>
                    <li><a href="http://kaitai.io/#download">Download</a></li>
                    <li class="active"><a href="http://formats.kaitai.io/">Format Gallery</a></li>
                </ul>
                <ul class="nav navbar-nav navbar-right">
                    <li><a href="https://ide.kaitai.io/">Try it &mdash; Web IDE</a></li>
                    <li><a href="http://doc.kaitai.io/">Documentation</a></li>
                </ul>
            </div>
        </div>
    </nav>
<nav>
    <div class="container">
    <ol class="breadcrumb">
        <li><a href="../index.html">Format Gallery</a></li>
        <li>macOS-specific</li>
        <li class="active">Compressed Macintosh resource data, Apple `'dcmp' (0)` format</li>
    </ol>
    </div>
</nav>

<section id="format-meta" class="format">
    <div class="container">
        <h1>Compressed Macintosh resource data, Apple `'dcmp' (0)` format:
            
            Ruby parsing library
            
        </h1>

        <div class="row">
            <div class="col-md-8">
                <p><p>Compressed resource data in <code>'dcmp' (0)</code> format,
as stored in compressed resources with header type <code>8</code> and decompressor ID <code>0</code>.</p>
<p>The <code>'dcmp' (0)</code> decompressor resource is included in the System file of System 7.0 and later.
This compression format is used for most compressed resources in System 7.0's files.
This decompressor is also included with and used by some other Apple applications,
such as ResEdit.</p>
<p>This compression format supports some basic general-purpose compression schemes,
including backreferences to previous data,
run-length encoding,
and delta encoding.
It also includes some types of compression tailored specifically to Mac OS resources,
including a set of single-byte codes that correspond to entries in a hard-coded lookup table,
and a specialized kind of delta encoding for segment loader jump tables.</p>
<p>Almost all parts of this compression format operate on units of 2 or 4 bytes.
As a result,
it is nearly impossible to store data with an odd length in this format.
To work around this limitation,
odd-length resources are padded with an extra byte before compressing them with this format.
This extra byte is ignored after decompression,
as the real (odd) length of the resource is stored in the compressed resource header.</p>
<p>The <code>'dcmp' (1)</code> compression format (see dcmp_1.ksy) is very similar to this format,
with the main difference that it operates mostly on single bytes rather than two-byte units.</p>
</p>
            </div>
            <div class="col-md-4">
                <div class="panel panel-info">
                    
                    <div class="panel-heading">
                        <h3 class="panel-title">Application</h3>
                    </div>
                    <div class="panel-body">
                        Mac OS
                    </div>
                    
                    
                    
                    <div class="panel-heading">
                        <h3 class="panel-title">KS implementation details</h3>
                    </div>
                    
                    <div class="panel-body">
                        License: <a href="https://spdx.org/licenses/MIT.html">MIT</a>
                    </div>
                    
                    
                    <div class="panel-body">
                        Minimal Kaitai Struct required: 0.8
                    </div>
                    
                    
                    
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
            <p>
            This page hosts a formal specification of Compressed Macintosh resource data, Apple `'dcmp' (0)` format
            using <a href="http://kaitai.io">Kaitai Struct</a>. This
            specification can be automatically translated into a
            variety of programming languages to get a parsing library.
            </p>

            <ul class="nav nav-pills">
                
                
                <li>
                
                <a href="index.html" title="Compressed Macintosh resource data, Apple `'dcmp' (0)` format parsing Overview library">Overview</a></li>
                
                
                <li>
                
                <a href="csharp.html" title="Compressed Macintosh resource data, Apple `'dcmp' (0)` format parsing C# library">C#</a></li>
                
                
                <li>
                
                <a href="graphviz.html" title="Compressed Macintosh resource data, Apple `'dcmp' (0)` format parsing GraphViz library">GraphViz</a></li>
                
                
                <li>
                
                <a href="java.html" title="Compressed Macintosh resource data, Apple `'dcmp' (0)` format parsing Java library">Java</a></li>
                
                
                <li>
                
                <a href="javascript.html" title="Compressed Macintosh resource data, Apple `'dcmp' (0)` format parsing JavaScript library">JavaScript</a></li>
                
                
                <li>
                
                <a href="lua.html" title="Compressed Macintosh resource data, Apple `'dcmp' (0)` format parsing Lua library">Lua</a></li>
                
                
                <li>
                
                <a href="perl.html" title="Compressed Macintosh resource data, Apple `'dcmp' (0)` format parsing Perl library">Perl</a></li>
                
                
                <li>
                
                <a href="php.html" title="Compressed Macintosh resource data, Apple `'dcmp' (0)` format parsing PHP library">PHP</a></li>
                
                
                <li>
                
                <a href="python.html" title="Compressed Macintosh resource data, Apple `'dcmp' (0)` format parsing Python library">Python</a></li>
                
                
                <li class="active">
                
                <a href="ruby.html" title="Compressed Macintosh resource data, Apple `'dcmp' (0)` format parsing Ruby library">Ruby</a></li>
                
            </ul>
            </div>
        </div>
    </div>
</section>

<section id="format-usage" class="format">
    <div class="container">
        <h2>Usage</h2>

        <p>Parse a local file and get structure in memory:</p>



<div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="no">Dcmp0</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="s2">&quot;path/to/local/file.Compressed Macintosh resource data, Apple `&#39;dcmp&#39; (0)` format&quot;</span><span class="p">)</span>
</pre></div>

<p>Or parse structure from a string of bytes:</p>

<div class="highlight"><pre><span></span><span class="n">bytes</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\x00\x01\x02</span><span class="s2">...&quot;</span>
<span class="n">data</span> <span class="o">=</span> <span class="no">Dcmp0</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="no">Kaitai</span><span class="o">::</span><span class="no">Struct</span><span class="o">::</span><span class="no">Stream</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">bytes</span><span class="p">))</span>
</pre></div>

<p>After that, one can get various attributes from the structure by invoking getter methods like:</p>


<div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">chunks</span> <span class="c1"># =&gt; The sequence of chunks that make up the compressed data.</span>
</pre></div>

    </div>
</section>


<section id="format-lang" class="format">
    <div class="container">
        <h2>
            
            Ruby source code to parse Compressed Macintosh resource data, Apple `'dcmp' (0)` format
            
        </h2>

        

        <h3>dcmp_0.rb</h3>

        <div class="row">
            <div class="pull-right">
                <p>
                    <a href="src/ruby/dcmp_0.rb" class="btn btn-success">Download <i class="fa fa-download"></i></a>
                </p>
            </div>
        </div>

        <div class="row">
            <div class="highlight"><pre><span></span><span class="c1"># This is a generated file! Please edit source .ksy file and use kaitai-struct-compiler to rebuild</span>

<span class="nb">require</span> <span class="s1">&#39;kaitai/struct/struct&#39;</span>

<span class="k">unless</span> <span class="no">Gem</span><span class="o">::</span><span class="no">Version</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="no">Kaitai</span><span class="o">::</span><span class="no">Struct</span><span class="o">::</span><span class="no">VERSION</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="no">Gem</span><span class="o">::</span><span class="no">Version</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;0.7&#39;</span><span class="p">)</span>
  <span class="k">raise</span> <span class="s2">&quot;Incompatible Kaitai Struct Ruby API: 0.7 or later is required, but you have </span><span class="si">#{</span><span class="no">Kaitai</span><span class="o">::</span><span class="no">Struct</span><span class="o">::</span><span class="no">VERSION</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="k">end</span>


<span class="c1">##</span>
<span class="c1"># Compressed resource data in `&#39;dcmp&#39; (0)` format,</span>
<span class="c1"># as stored in compressed resources with header type `8` and decompressor ID `0`.</span>
<span class="c1"># </span>
<span class="c1"># The `&#39;dcmp&#39; (0)` decompressor resource is included in the System file of System 7.0 and later.</span>
<span class="c1"># This compression format is used for most compressed resources in System 7.0&#39;s files.</span>
<span class="c1"># This decompressor is also included with and used by some other Apple applications,</span>
<span class="c1"># such as ResEdit.</span>
<span class="c1"># </span>
<span class="c1"># This compression format supports some basic general-purpose compression schemes,</span>
<span class="c1"># including backreferences to previous data,</span>
<span class="c1"># run-length encoding,</span>
<span class="c1"># and delta encoding.</span>
<span class="c1"># It also includes some types of compression tailored specifically to Mac OS resources,</span>
<span class="c1"># including a set of single-byte codes that correspond to entries in a hard-coded lookup table,</span>
<span class="c1"># and a specialized kind of delta encoding for segment loader jump tables.</span>
<span class="c1"># </span>
<span class="c1"># Almost all parts of this compression format operate on units of 2 or 4 bytes.</span>
<span class="c1"># As a result,</span>
<span class="c1"># it is nearly impossible to store data with an odd length in this format.</span>
<span class="c1"># To work around this limitation,</span>
<span class="c1"># odd-length resources are padded with an extra byte before compressing them with this format.</span>
<span class="c1"># This extra byte is ignored after decompression,</span>
<span class="c1"># as the real (odd) length of the resource is stored in the compressed resource header.</span>
<span class="c1"># </span>
<span class="c1"># The `&#39;dcmp&#39; (1)` compression format (see dcmp_1.ksy) is very similar to this format,</span>
<span class="c1"># with the main difference that it operates mostly on single bytes rather than two-byte units.</span>
<span class="c1"># @see https://github.com/dgelessus/python-rsrcfork/tree/master/rsrcfork/compress/dcmp0.py Source</span>
<span class="k">class</span> <span class="nc">Dcmp0</span> <span class="o">&lt;</span> <span class="no">Kaitai</span><span class="o">::</span><span class="no">Struct</span><span class="o">::</span><span class="no">Struct</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">_io</span><span class="p">,</span> <span class="n">_parent</span> <span class="o">=</span> <span class="kp">nil</span><span class="p">,</span> <span class="n">_root</span> <span class="o">=</span> <span class="nb">self</span><span class="p">)</span>
    <span class="k">super</span><span class="p">(</span><span class="n">_io</span><span class="p">,</span> <span class="n">_parent</span><span class="p">,</span> <span class="n">_root</span><span class="p">)</span>
    <span class="n">_read</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">_read</span>
    <span class="vi">@chunks</span> <span class="o">=</span> <span class="o">[]</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">begin</span>
      <span class="n">_</span> <span class="o">=</span> <span class="no">Chunk</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="vi">@_io</span><span class="p">,</span> <span class="nb">self</span><span class="p">,</span> <span class="vi">@_root</span><span class="p">)</span>
      <span class="vi">@chunks</span> <span class="o">&lt;&lt;</span> <span class="n">_</span>
      <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">end</span> <span class="k">until</span> <span class="n">_</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="mi">255</span>
    <span class="nb">self</span>
  <span class="k">end</span>

  <span class="c1">##</span>
  <span class="c1"># A single chunk of compressed data.</span>
  <span class="c1"># Each chunk in the compressed data expands to a sequence of bytes in the uncompressed data,</span>
  <span class="c1"># except when `tag == 0xff`,</span>
  <span class="c1"># which marks the end of the data and does not correspond to any bytes in the uncompressed data.</span>
  <span class="c1"># </span>
  <span class="c1"># Most chunks are stateless and always expand to the same data,</span>
  <span class="c1"># regardless of where the chunk appears in the sequence.</span>
  <span class="c1"># However,</span>
  <span class="c1"># some chunks affect the behavior of future chunks,</span>
  <span class="c1"># or expand to different data depending on which chunks came before them.</span>
  <span class="k">class</span> <span class="nc">Chunk</span> <span class="o">&lt;</span> <span class="no">Kaitai</span><span class="o">::</span><span class="no">Struct</span><span class="o">::</span><span class="no">Struct</span>

    <span class="no">TAG_KIND</span> <span class="o">=</span> <span class="p">{</span>
      <span class="o">-</span><span class="mi">1</span> <span class="o">=&gt;</span> <span class="ss">:tag_kind_invalid</span><span class="p">,</span>
      <span class="mi">0</span> <span class="o">=&gt;</span> <span class="ss">:tag_kind_literal</span><span class="p">,</span>
      <span class="mi">1</span> <span class="o">=&gt;</span> <span class="ss">:tag_kind_backreference</span><span class="p">,</span>
      <span class="mi">2</span> <span class="o">=&gt;</span> <span class="ss">:tag_kind_table_lookup</span><span class="p">,</span>
      <span class="mi">3</span> <span class="o">=&gt;</span> <span class="ss">:tag_kind_extended</span><span class="p">,</span>
      <span class="mi">4</span> <span class="o">=&gt;</span> <span class="ss">:tag_kind_end</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="no">I__TAG_KIND</span> <span class="o">=</span> <span class="no">TAG_KIND</span><span class="o">.</span><span class="n">invert</span>
    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">_io</span><span class="p">,</span> <span class="n">_parent</span> <span class="o">=</span> <span class="kp">nil</span><span class="p">,</span> <span class="n">_root</span> <span class="o">=</span> <span class="nb">self</span><span class="p">)</span>
      <span class="k">super</span><span class="p">(</span><span class="n">_io</span><span class="p">,</span> <span class="n">_parent</span><span class="p">,</span> <span class="n">_root</span><span class="p">)</span>
      <span class="n">_read</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">_read</span>
      <span class="vi">@tag</span> <span class="o">=</span> <span class="vi">@_io</span><span class="o">.</span><span class="n">read_u1</span>
      <span class="k">case</span> <span class="p">(</span> <span class="p">((</span><span class="n">tag</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">tag</span> <span class="o">&lt;=</span> <span class="mi">31</span><span class="p">))</span>  <span class="p">?</span> <span class="ss">:tag_kind_literal</span> <span class="p">:</span> <span class="p">(</span> <span class="p">((</span><span class="n">tag</span> <span class="o">&gt;=</span> <span class="mi">32</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">tag</span> <span class="o">&lt;=</span> <span class="mi">74</span><span class="p">))</span>  <span class="p">?</span> <span class="ss">:tag_kind_backreference</span> <span class="p">:</span> <span class="p">(</span> <span class="p">((</span><span class="n">tag</span> <span class="o">&gt;=</span> <span class="mi">75</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">tag</span> <span class="o">&lt;=</span> <span class="mi">253</span><span class="p">))</span>  <span class="p">?</span> <span class="ss">:tag_kind_table_lookup</span> <span class="p">:</span> <span class="p">(</span><span class="n">tag</span> <span class="o">==</span> <span class="mi">254</span> <span class="o">?</span> <span class="ss">:tag_kind_extended</span> <span class="p">:</span> <span class="p">(</span><span class="n">tag</span> <span class="o">==</span> <span class="mi">255</span> <span class="o">?</span> <span class="ss">:tag_kind_end</span> <span class="p">:</span> <span class="ss">:tag_kind_invalid</span><span class="p">)))))</span>
      <span class="k">when</span> <span class="ss">:tag_kind_end</span>
        <span class="vi">@body</span> <span class="o">=</span> <span class="no">EndBody</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="vi">@_io</span><span class="p">,</span> <span class="nb">self</span><span class="p">,</span> <span class="vi">@_root</span><span class="p">)</span>
      <span class="k">when</span> <span class="ss">:tag_kind_literal</span>
        <span class="vi">@body</span> <span class="o">=</span> <span class="no">LiteralBody</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="vi">@_io</span><span class="p">,</span> <span class="nb">self</span><span class="p">,</span> <span class="vi">@_root</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
      <span class="k">when</span> <span class="ss">:tag_kind_backreference</span>
        <span class="vi">@body</span> <span class="o">=</span> <span class="no">BackreferenceBody</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="vi">@_io</span><span class="p">,</span> <span class="nb">self</span><span class="p">,</span> <span class="vi">@_root</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
      <span class="k">when</span> <span class="ss">:tag_kind_table_lookup</span>
        <span class="vi">@body</span> <span class="o">=</span> <span class="no">TableLookupBody</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="vi">@_io</span><span class="p">,</span> <span class="nb">self</span><span class="p">,</span> <span class="vi">@_root</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
      <span class="k">when</span> <span class="ss">:tag_kind_extended</span>
        <span class="vi">@body</span> <span class="o">=</span> <span class="no">ExtendedBody</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="vi">@_io</span><span class="p">,</span> <span class="nb">self</span><span class="p">,</span> <span class="vi">@_root</span><span class="p">)</span>
      <span class="k">end</span>
      <span class="nb">self</span>
    <span class="k">end</span>

    <span class="c1">##</span>
    <span class="c1"># The body of a literal data chunk.</span>
    <span class="c1"># </span>
    <span class="c1"># The data that this chunk expands to is stored literally in the body (`literal`).</span>
    <span class="c1"># Optionally,</span>
    <span class="c1"># the literal data may also be stored for use by future backreference chunks (`do_store`).</span>
    <span class="c1"># </span>
    <span class="c1"># The length of the literal data is stored as a number of two-byte units.</span>
    <span class="c1"># This means that the literal data always has an even length in bytes.</span>
    <span class="k">class</span> <span class="nc">LiteralBody</span> <span class="o">&lt;</span> <span class="no">Kaitai</span><span class="o">::</span><span class="no">Struct</span><span class="o">::</span><span class="no">Struct</span>
      <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">_io</span><span class="p">,</span> <span class="n">_parent</span> <span class="o">=</span> <span class="kp">nil</span><span class="p">,</span> <span class="n">_root</span> <span class="o">=</span> <span class="nb">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
        <span class="k">super</span><span class="p">(</span><span class="n">_io</span><span class="p">,</span> <span class="n">_parent</span><span class="p">,</span> <span class="n">_root</span><span class="p">)</span>
        <span class="vi">@tag</span> <span class="o">=</span> <span class="n">tag</span>
        <span class="n">_read</span>
      <span class="k">end</span>

      <span class="k">def</span> <span class="nf">_read</span>
        <span class="k">if</span> <span class="n">is_len_literal_div2_separate</span>
          <span class="vi">@len_literal_div2_separate</span> <span class="o">=</span> <span class="vi">@_io</span><span class="o">.</span><span class="n">read_u1</span>
        <span class="k">end</span>
        <span class="vi">@literal</span> <span class="o">=</span> <span class="vi">@_io</span><span class="o">.</span><span class="n">read_bytes</span><span class="p">(</span><span class="n">len_literal</span><span class="p">)</span>
        <span class="nb">self</span>
      <span class="k">end</span>

      <span class="c1">##</span>
      <span class="c1"># Whether this literal should be stored for use by future backreference chunks.</span>
      <span class="c1"># </span>
      <span class="c1"># See the documentation of the `backreference_body` type for details about backreference chunks.</span>
      <span class="k">def</span> <span class="nf">do_store</span>
        <span class="k">return</span> <span class="vi">@do_store</span> <span class="k">unless</span> <span class="vi">@do_store</span><span class="o">.</span><span class="n">nil?</span>
        <span class="vi">@do_store</span> <span class="o">=</span> <span class="p">(</span><span class="n">tag</span> <span class="o">&amp;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span>
        <span class="vi">@do_store</span>
      <span class="k">end</span>

      <span class="c1">##</span>
      <span class="c1"># The length of the literal data,</span>
      <span class="c1"># in two-byte units.</span>
      <span class="c1"># </span>
      <span class="c1"># In practice,</span>
      <span class="c1"># this value is always greater than zero,</span>
      <span class="c1"># as there is no use in storing a zero-length literal.</span>
      <span class="k">def</span> <span class="nf">len_literal_div2</span>
        <span class="k">return</span> <span class="vi">@len_literal_div2</span> <span class="k">unless</span> <span class="vi">@len_literal_div2</span><span class="o">.</span><span class="n">nil?</span>
        <span class="vi">@len_literal_div2</span> <span class="o">=</span> <span class="p">(</span><span class="n">is_len_literal_div2_separate</span> <span class="p">?</span> <span class="n">len_literal_div2_separate</span> <span class="p">:</span> <span class="n">len_literal_div2_in_tag</span><span class="p">)</span>
        <span class="vi">@len_literal_div2</span>
      <span class="k">end</span>

      <span class="c1">##</span>
      <span class="c1"># The length of the literal data,</span>
      <span class="c1"># in bytes.</span>
      <span class="k">def</span> <span class="nf">len_literal</span>
        <span class="k">return</span> <span class="vi">@len_literal</span> <span class="k">unless</span> <span class="vi">@len_literal</span><span class="o">.</span><span class="n">nil?</span>
        <span class="vi">@len_literal</span> <span class="o">=</span> <span class="p">(</span><span class="n">len_literal_div2</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
        <span class="vi">@len_literal</span>
      <span class="k">end</span>

      <span class="c1">##</span>
      <span class="c1"># The part of the tag byte that indicates the length of the literal data,</span>
      <span class="c1"># in two-byte units.</span>
      <span class="c1"># If this value is 0,</span>
      <span class="c1"># the length is stored in a separate byte after the tag byte and before the literal data.</span>
      <span class="k">def</span> <span class="nf">len_literal_div2_in_tag</span>
        <span class="k">return</span> <span class="vi">@len_literal_div2_in_tag</span> <span class="k">unless</span> <span class="vi">@len_literal_div2_in_tag</span><span class="o">.</span><span class="n">nil?</span>
        <span class="vi">@len_literal_div2_in_tag</span> <span class="o">=</span> <span class="p">(</span><span class="n">tag</span> <span class="o">&amp;</span> <span class="mi">15</span><span class="p">)</span>
        <span class="vi">@len_literal_div2_in_tag</span>
      <span class="k">end</span>

      <span class="c1">##</span>
      <span class="c1"># Whether the length of the literal is stored separately from the tag.</span>
      <span class="k">def</span> <span class="nf">is_len_literal_div2_separate</span>
        <span class="k">return</span> <span class="vi">@is_len_literal_div2_separate</span> <span class="k">unless</span> <span class="vi">@is_len_literal_div2_separate</span><span class="o">.</span><span class="n">nil?</span>
        <span class="vi">@is_len_literal_div2_separate</span> <span class="o">=</span> <span class="n">len_literal_div2_in_tag</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="vi">@is_len_literal_div2_separate</span>
      <span class="k">end</span>

      <span class="c1">##</span>
      <span class="c1"># The length of the literal data,</span>
      <span class="c1"># in two-byte units.</span>
      <span class="c1"># </span>
      <span class="c1"># This field is only present if the tag byte&#39;s low nibble is zero.</span>
      <span class="c1"># In practice,</span>
      <span class="c1"># this only happens if the length is 0x10 or greater,</span>
      <span class="c1"># because smaller lengths can be encoded into the tag byte.</span>
      <span class="kp">attr_reader</span> <span class="ss">:len_literal_div2_separate</span>

      <span class="c1">##</span>
      <span class="c1"># The literal data.</span>
      <span class="kp">attr_reader</span> <span class="ss">:literal</span>

      <span class="c1">##</span>
      <span class="c1"># The tag byte preceding this chunk body.</span>
      <span class="kp">attr_reader</span> <span class="ss">:tag</span>
    <span class="k">end</span>

    <span class="c1">##</span>
    <span class="c1"># The body of a backreference chunk.</span>
    <span class="c1"># </span>
    <span class="c1"># This chunk expands to the data stored in a preceding literal chunk,</span>
    <span class="c1"># indicated by an index number (`index`).</span>
    <span class="k">class</span> <span class="nc">BackreferenceBody</span> <span class="o">&lt;</span> <span class="no">Kaitai</span><span class="o">::</span><span class="no">Struct</span><span class="o">::</span><span class="no">Struct</span>
      <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">_io</span><span class="p">,</span> <span class="n">_parent</span> <span class="o">=</span> <span class="kp">nil</span><span class="p">,</span> <span class="n">_root</span> <span class="o">=</span> <span class="nb">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
        <span class="k">super</span><span class="p">(</span><span class="n">_io</span><span class="p">,</span> <span class="n">_parent</span><span class="p">,</span> <span class="n">_root</span><span class="p">)</span>
        <span class="vi">@tag</span> <span class="o">=</span> <span class="n">tag</span>
        <span class="n">_read</span>
      <span class="k">end</span>

      <span class="k">def</span> <span class="nf">_read</span>
        <span class="k">if</span> <span class="n">is_index_separate</span>
          <span class="k">case</span> <span class="n">tag</span>
          <span class="k">when</span> <span class="mi">32</span>
            <span class="vi">@index_separate_minus</span> <span class="o">=</span> <span class="vi">@_io</span><span class="o">.</span><span class="n">read_u1</span>
          <span class="k">when</span> <span class="mi">33</span>
            <span class="vi">@index_separate_minus</span> <span class="o">=</span> <span class="vi">@_io</span><span class="o">.</span><span class="n">read_u1</span>
          <span class="k">when</span> <span class="mi">34</span>
            <span class="vi">@index_separate_minus</span> <span class="o">=</span> <span class="vi">@_io</span><span class="o">.</span><span class="n">read_u2be</span>
          <span class="k">end</span>
        <span class="k">end</span>
        <span class="nb">self</span>
      <span class="k">end</span>

      <span class="c1">##</span>
      <span class="c1"># Whether the index is stored separately from the tag.</span>
      <span class="k">def</span> <span class="nf">is_index_separate</span>
        <span class="k">return</span> <span class="vi">@is_index_separate</span> <span class="k">unless</span> <span class="vi">@is_index_separate</span><span class="o">.</span><span class="n">nil?</span>
        <span class="vi">@is_index_separate</span> <span class="o">=</span>  <span class="p">((</span><span class="n">tag</span> <span class="o">&gt;=</span> <span class="mi">32</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">tag</span> <span class="o">&lt;=</span> <span class="mi">34</span><span class="p">))</span> 
        <span class="vi">@is_index_separate</span>
      <span class="k">end</span>

      <span class="c1">##</span>
      <span class="c1"># The index of the referenced literal chunk,</span>
      <span class="c1"># as stored in the tag byte.</span>
      <span class="k">def</span> <span class="nf">index_in_tag</span>
        <span class="k">return</span> <span class="vi">@index_in_tag</span> <span class="k">unless</span> <span class="vi">@index_in_tag</span><span class="o">.</span><span class="n">nil?</span>
        <span class="vi">@index_in_tag</span> <span class="o">=</span> <span class="p">(</span><span class="n">tag</span> <span class="o">-</span> <span class="mi">35</span><span class="p">)</span>
        <span class="vi">@index_in_tag</span>
      <span class="k">end</span>

      <span class="c1">##</span>
      <span class="c1"># The index of the referenced literal chunk,</span>
      <span class="c1"># as stored separately from the tag byte,</span>
      <span class="c1"># with the implicit offset corrected for.</span>
      <span class="k">def</span> <span class="nf">index_separate</span>
        <span class="k">return</span> <span class="vi">@index_separate</span> <span class="k">unless</span> <span class="vi">@index_separate</span><span class="o">.</span><span class="n">nil?</span>
        <span class="k">if</span> <span class="n">is_index_separate</span>
          <span class="vi">@index_separate</span> <span class="o">=</span> <span class="p">((</span><span class="n">index_separate_minus</span> <span class="o">+</span> <span class="mi">40</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">tag</span> <span class="o">==</span> <span class="mi">33</span> <span class="o">?</span> <span class="mi">256</span> <span class="p">:</span> <span class="mi">0</span><span class="p">))</span>
        <span class="k">end</span>
        <span class="vi">@index_separate</span>
      <span class="k">end</span>

      <span class="c1">##</span>
      <span class="c1"># The index of the referenced literal chunk.</span>
      <span class="c1"># </span>
      <span class="c1"># Stored literals are assigned index numbers in the order in which they appear in the compressed data,</span>
      <span class="c1"># starting at 0.</span>
      <span class="c1"># Non-stored literals are not counted in the numbering and cannot be referenced using backreferences.</span>
      <span class="c1"># Once an index is assigned to a stored literal,</span>
      <span class="c1"># it is never changed or unassigned for the entire length of the compressed data.</span>
      <span class="c1"># </span>
      <span class="c1"># As the name indicates,</span>
      <span class="c1"># a backreference can only reference stored literal chunks found *before* the backreference,</span>
      <span class="c1"># not ones that come after it.</span>
      <span class="k">def</span> <span class="nf">index</span>
        <span class="k">return</span> <span class="vi">@index</span> <span class="k">unless</span> <span class="vi">@index</span><span class="o">.</span><span class="n">nil?</span>
        <span class="vi">@index</span> <span class="o">=</span> <span class="p">(</span><span class="n">is_index_separate</span> <span class="p">?</span> <span class="n">index_separate</span> <span class="p">:</span> <span class="n">index_in_tag</span><span class="p">)</span>
        <span class="vi">@index</span>
      <span class="k">end</span>

      <span class="c1">##</span>
      <span class="c1"># The index of the referenced literal chunk,</span>
      <span class="c1"># stored separately from the tag.</span>
      <span class="c1"># The value in this field is stored minus 0x28.</span>
      <span class="c1"># If the tag byte is 0x21,</span>
      <span class="c1"># the value is also stored minus 0x100,</span>
      <span class="c1"># *on top of* the regular offset</span>
      <span class="c1"># (i. e. minus 0x128 in total).</span>
      <span class="c1"># </span>
      <span class="c1"># In other words,</span>
      <span class="c1"># for tag bytes 0x20 and 0x21,</span>
      <span class="c1"># the index is actually 9 bits large,</span>
      <span class="c1"># with the low 8 bits stored separately and the highest bit stored in the lowest bit of the tag byte.</span>
      <span class="c1"># </span>
      <span class="c1"># This field is only present if the tag byte is 0x20 through 0x22.</span>
      <span class="c1"># For higher tag bytes,</span>
      <span class="c1"># the index is encoded in the tag byte.</span>
      <span class="c1"># Values smaller than 0x28 cannot be stored in this field,</span>
      <span class="c1"># they must always be encoded in the tag byte.</span>
      <span class="kp">attr_reader</span> <span class="ss">:index_separate_minus</span>

      <span class="c1">##</span>
      <span class="c1"># The tag byte preceding this chunk body.</span>
      <span class="kp">attr_reader</span> <span class="ss">:tag</span>
    <span class="k">end</span>

    <span class="c1">##</span>
    <span class="c1"># The body of a table lookup chunk.</span>
    <span class="c1"># This body is always empty.</span>
    <span class="c1"># </span>
    <span class="c1"># This chunk always expands to two bytes (`value`),</span>
    <span class="c1"># determined from the tag byte using a fixed lookup table (`lookup_table`).</span>
    <span class="c1"># This lookup table is hardcoded in the decompressor and always the same for all compressed data.</span>
    <span class="k">class</span> <span class="nc">TableLookupBody</span> <span class="o">&lt;</span> <span class="no">Kaitai</span><span class="o">::</span><span class="no">Struct</span><span class="o">::</span><span class="no">Struct</span>
      <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">_io</span><span class="p">,</span> <span class="n">_parent</span> <span class="o">=</span> <span class="kp">nil</span><span class="p">,</span> <span class="n">_root</span> <span class="o">=</span> <span class="nb">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
        <span class="k">super</span><span class="p">(</span><span class="n">_io</span><span class="p">,</span> <span class="n">_parent</span><span class="p">,</span> <span class="n">_root</span><span class="p">)</span>
        <span class="vi">@tag</span> <span class="o">=</span> <span class="n">tag</span>
        <span class="n">_read</span>
      <span class="k">end</span>

      <span class="k">def</span> <span class="nf">_read</span>
        <span class="nb">self</span>
      <span class="k">end</span>

      <span class="c1">##</span>
      <span class="c1"># Fixed lookup table that maps tag byte numbers to two bytes each.</span>
      <span class="c1"># </span>
      <span class="c1"># The entries in the lookup table are offset -</span>
      <span class="c1"># index 0 stands for tag 0x4b, 1 for 0x4c, etc.</span>
      <span class="k">def</span> <span class="nf">lookup_table</span>
        <span class="k">return</span> <span class="vi">@lookup_table</span> <span class="k">unless</span> <span class="vi">@lookup_table</span><span class="o">.</span><span class="n">nil?</span>
        <span class="vi">@lookup_table</span> <span class="o">=</span> <span class="o">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">78</span><span class="p">,</span> <span class="mi">186</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">78</span><span class="p">,</span> <span class="mi">117</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">12</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">78</span><span class="p">,</span> <span class="mi">173</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">32</span><span class="p">,</span> <span class="mi">83</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">47</span><span class="p">,</span> <span class="mi">11</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">97</span><span class="p">,</span> <span class="mi">0</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">16</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">112</span><span class="p">,</span> <span class="mi">0</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">47</span><span class="p">,</span> <span class="mi">0</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">72</span><span class="p">,</span> <span class="mi">110</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">32</span><span class="p">,</span> <span class="mi">80</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">32</span><span class="p">,</span> <span class="mi">110</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">47</span><span class="p">,</span> <span class="mi">46</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">252</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">72</span><span class="p">,</span> <span class="mi">231</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">63</span><span class="p">,</span> <span class="mi">60</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">248</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">47</span><span class="p">,</span> <span class="mi">12</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">32</span><span class="p">,</span> <span class="mi">6</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">78</span><span class="p">,</span> <span class="mi">237</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">78</span><span class="p">,</span> <span class="mi">86</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">32</span><span class="p">,</span> <span class="mi">104</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">78</span><span class="p">,</span> <span class="mi">94</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">88</span><span class="p">,</span> <span class="mi">143</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">79</span><span class="p">,</span> <span class="mi">239</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">96</span><span class="p">,</span> <span class="mi">0</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">80</span><span class="p">,</span> <span class="mi">143</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">78</span><span class="p">,</span> <span class="mi">144</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">38</span><span class="p">,</span> <span class="mi">110</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">244</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">76</span><span class="p">,</span> <span class="mi">238</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">14</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">65</span><span class="p">,</span> <span class="mi">238</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">76</span><span class="p">,</span> <span class="mi">223</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">72</span><span class="p">,</span> <span class="mi">192</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">240</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">45</span><span class="p">,</span> <span class="mi">64</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">18</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">48</span><span class="p">,</span> <span class="mi">46</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">112</span><span class="p">,</span> <span class="mi">1</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">47</span><span class="p">,</span> <span class="mi">40</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">32</span><span class="p">,</span> <span class="mi">84</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">103</span><span class="p">,</span> <span class="mi">0</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">32</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">28</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">32</span><span class="p">,</span> <span class="mi">95</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">24</span><span class="p">,</span> <span class="mi">0</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">38</span><span class="p">,</span> <span class="mi">111</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">72</span><span class="p">,</span> <span class="mi">120</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">22</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">65</span><span class="p">,</span> <span class="mi">250</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">48</span><span class="p">,</span> <span class="mi">60</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">40</span><span class="p">,</span> <span class="mi">64</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">114</span><span class="p">,</span> <span class="mi">0</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">40</span><span class="p">,</span> <span class="mi">110</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">32</span><span class="p">,</span> <span class="mi">12</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">102</span><span class="p">,</span> <span class="mi">0</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">32</span><span class="p">,</span> <span class="mi">107</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">47</span><span class="p">,</span> <span class="mi">7</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">85</span><span class="p">,</span> <span class="mi">143</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">40</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">254</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">236</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">34</span><span class="p">,</span> <span class="mi">216</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">32</span><span class="p">,</span> <span class="mi">11</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">15</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">89</span><span class="p">,</span> <span class="mi">143</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">47</span><span class="p">,</span> <span class="mi">60</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">24</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">129</span><span class="p">,</span> <span class="mi">225</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">74</span><span class="p">,</span> <span class="mi">0</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">78</span><span class="p">,</span> <span class="mi">176</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">232</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">72</span><span class="p">,</span> <span class="mi">199</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">34</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">26</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">103</span><span class="p">,</span> <span class="mi">6</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">103</span><span class="p">,</span> <span class="mi">8</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">78</span><span class="p">,</span> <span class="mi">249</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">36</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">32</span><span class="p">,</span> <span class="mi">120</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">102</span><span class="p">,</span> <span class="mi">4</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">42</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">78</span><span class="p">,</span> <span class="mi">208</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">48</span><span class="p">,</span> <span class="mi">40</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">38</span><span class="p">,</span> <span class="mi">95</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">103</span><span class="p">,</span> <span class="mi">4</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">48</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">67</span><span class="p">,</span> <span class="mi">238</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">63</span><span class="p">,</span> <span class="mi">0</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">32</span><span class="p">,</span> <span class="mi">31</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">246</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">32</span><span class="p">,</span> <span class="mi">46</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">66</span><span class="p">,</span> <span class="mi">167</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">32</span><span class="p">,</span> <span class="mi">7</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">250</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">96</span><span class="p">,</span> <span class="mi">2</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">61</span><span class="p">,</span> <span class="mi">64</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">64</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">102</span><span class="p">,</span> <span class="mi">6</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">38</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">45</span><span class="p">,</span> <span class="mi">72</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">47</span><span class="p">,</span> <span class="mi">1</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">112</span><span class="p">,</span> <span class="mi">255</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">96</span><span class="p">,</span> <span class="mi">4</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">24</span><span class="p">,</span> <span class="mi">128</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">74</span><span class="p">,</span> <span class="mi">64</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">64</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">44</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">47</span><span class="p">,</span> <span class="mi">8</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">17</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">228</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">33</span><span class="p">,</span> <span class="mi">64</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">38</span><span class="p">,</span> <span class="mi">64</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">242</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">66</span><span class="p">,</span> <span class="mi">110</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">78</span><span class="p">,</span> <span class="mi">185</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">61</span><span class="p">,</span> <span class="mi">124</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">56</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">13</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">96</span><span class="p">,</span> <span class="mi">6</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">66</span><span class="p">,</span> <span class="mi">46</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">32</span><span class="p">,</span> <span class="mi">60</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">103</span><span class="p">,</span> <span class="mi">12</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">45</span><span class="p">,</span> <span class="mi">104</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">102</span><span class="p">,</span> <span class="mi">8</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">74</span><span class="p">,</span> <span class="mi">46</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">74</span><span class="p">,</span> <span class="mi">174</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">46</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">72</span><span class="p">,</span> <span class="mi">64</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">34</span><span class="p">,</span> <span class="mi">95</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">34</span><span class="p">,</span> <span class="mi">0</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">103</span><span class="p">,</span> <span class="mi">10</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">48</span><span class="p">,</span> <span class="mi">7</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">66</span><span class="p">,</span> <span class="mi">103</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">32</span><span class="p">,</span> <span class="mi">40</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">72</span><span class="p">,</span> <span class="mi">122</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">47</span><span class="p">,</span> <span class="mi">43</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">34</span><span class="p">,</span> <span class="mi">110</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">102</span><span class="p">,</span> <span class="mi">2</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">229</span><span class="p">,</span> <span class="mi">128</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">103</span><span class="p">,</span> <span class="mi">14</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">102</span><span class="p">,</span> <span class="mi">10</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">80</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">62</span><span class="p">,</span> <span class="mi">0</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">102</span><span class="p">,</span> <span class="mi">12</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">46</span><span class="p">,</span> <span class="mi">0</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">238</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">32</span><span class="p">,</span> <span class="mi">109</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">32</span><span class="p">,</span> <span class="mi">64</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">224</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">83</span><span class="p">,</span> <span class="mi">64</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">96</span><span class="p">,</span> <span class="mi">8</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">128</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">104</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">11</span><span class="p">,</span> <span class="mi">124</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">68</span><span class="p">,</span> <span class="mi">0</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">65</span><span class="p">,</span> <span class="mi">232</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">),</span> <span class="o">[</span><span class="mi">72</span><span class="p">,</span> <span class="mi">65</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;C*&#39;</span><span class="p">)</span><span class="o">]</span>
        <span class="vi">@lookup_table</span>
      <span class="k">end</span>

      <span class="c1">##</span>
      <span class="c1"># The two bytes that the tag byte expands to,</span>
      <span class="c1"># based on the fixed lookup table.</span>
      <span class="k">def</span> <span class="nf">value</span>
        <span class="k">return</span> <span class="vi">@value</span> <span class="k">unless</span> <span class="vi">@value</span><span class="o">.</span><span class="n">nil?</span>
        <span class="vi">@value</span> <span class="o">=</span> <span class="n">lookup_table</span><span class="o">[</span><span class="p">(</span><span class="n">tag</span> <span class="o">-</span> <span class="mi">75</span><span class="p">)</span><span class="o">]</span>
        <span class="vi">@value</span>
      <span class="k">end</span>

      <span class="c1">##</span>
      <span class="c1"># The tag byte preceding this chunk body.</span>
      <span class="kp">attr_reader</span> <span class="ss">:tag</span>
    <span class="k">end</span>

    <span class="c1">##</span>
    <span class="c1"># The body of an end chunk.</span>
    <span class="c1"># This body is always empty.</span>
    <span class="c1"># </span>
    <span class="c1"># The last chunk in the compressed data must always be an end chunk.</span>
    <span class="c1"># An end chunk cannot appear elsewhere in the compressed data.</span>
    <span class="k">class</span> <span class="nc">EndBody</span> <span class="o">&lt;</span> <span class="no">Kaitai</span><span class="o">::</span><span class="no">Struct</span><span class="o">::</span><span class="no">Struct</span>
      <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">_io</span><span class="p">,</span> <span class="n">_parent</span> <span class="o">=</span> <span class="kp">nil</span><span class="p">,</span> <span class="n">_root</span> <span class="o">=</span> <span class="nb">self</span><span class="p">)</span>
        <span class="k">super</span><span class="p">(</span><span class="n">_io</span><span class="p">,</span> <span class="n">_parent</span><span class="p">,</span> <span class="n">_root</span><span class="p">)</span>
        <span class="n">_read</span>
      <span class="k">end</span>

      <span class="k">def</span> <span class="nf">_read</span>
        <span class="nb">self</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="c1">##</span>
    <span class="c1"># The body of an extended chunk.</span>
    <span class="c1"># The meaning of this chunk depends on the extended tag byte stored in the chunk data.</span>
    <span class="k">class</span> <span class="nc">ExtendedBody</span> <span class="o">&lt;</span> <span class="no">Kaitai</span><span class="o">::</span><span class="no">Struct</span><span class="o">::</span><span class="no">Struct</span>
      <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">_io</span><span class="p">,</span> <span class="n">_parent</span> <span class="o">=</span> <span class="kp">nil</span><span class="p">,</span> <span class="n">_root</span> <span class="o">=</span> <span class="nb">self</span><span class="p">)</span>
        <span class="k">super</span><span class="p">(</span><span class="n">_io</span><span class="p">,</span> <span class="n">_parent</span><span class="p">,</span> <span class="n">_root</span><span class="p">)</span>
        <span class="n">_read</span>
      <span class="k">end</span>

      <span class="k">def</span> <span class="nf">_read</span>
        <span class="vi">@tag</span> <span class="o">=</span> <span class="vi">@_io</span><span class="o">.</span><span class="n">read_u1</span>
        <span class="k">case</span> <span class="n">tag</span>
        <span class="k">when</span> <span class="mi">0</span>
          <span class="vi">@body</span> <span class="o">=</span> <span class="no">JumpTableBody</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="vi">@_io</span><span class="p">,</span> <span class="nb">self</span><span class="p">,</span> <span class="vi">@_root</span><span class="p">)</span>
        <span class="k">when</span> <span class="mi">4</span>
          <span class="vi">@body</span> <span class="o">=</span> <span class="no">DeltaEncoding16BitBody</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="vi">@_io</span><span class="p">,</span> <span class="nb">self</span><span class="p">,</span> <span class="vi">@_root</span><span class="p">)</span>
        <span class="k">when</span> <span class="mi">6</span>
          <span class="vi">@body</span> <span class="o">=</span> <span class="no">DeltaEncoding32BitBody</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="vi">@_io</span><span class="p">,</span> <span class="nb">self</span><span class="p">,</span> <span class="vi">@_root</span><span class="p">)</span>
        <span class="k">when</span> <span class="mi">3</span>
          <span class="vi">@body</span> <span class="o">=</span> <span class="no">RepeatBody</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="vi">@_io</span><span class="p">,</span> <span class="nb">self</span><span class="p">,</span> <span class="vi">@_root</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
        <span class="k">when</span> <span class="mi">2</span>
          <span class="vi">@body</span> <span class="o">=</span> <span class="no">RepeatBody</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="vi">@_io</span><span class="p">,</span> <span class="nb">self</span><span class="p">,</span> <span class="vi">@_root</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
        <span class="k">end</span>
        <span class="nb">self</span>
      <span class="k">end</span>

      <span class="c1">##</span>
      <span class="c1"># The body of a jump table chunk.</span>
      <span class="c1"># </span>
      <span class="c1"># This chunk generates parts of a segment loader jump table,</span>
      <span class="c1"># in the format found in `&#39;CODE&#39; (0)` resources.</span>
      <span class="c1"># It expands to the following data,</span>
      <span class="c1"># with all non-constant numbers encoded as unsigned 16-bit big-endian integers:</span>
      <span class="c1"># </span>
      <span class="c1"># * `0x3f 0x3c` (push following segment number onto stack)</span>
      <span class="c1"># * The segment number</span>
      <span class="c1"># * `0xa9 0xf0` (`_LoadSeg` trap)</span>
      <span class="c1"># * For each address:</span>
      <span class="c1">#   * The address</span>
      <span class="c1">#   * `0x3f 0x3c` (push following segment number onto stack)</span>
      <span class="c1">#   * The segment number</span>
      <span class="c1">#   * `0xa9 0xf0` (`_LoadSeg` trap)</span>
      <span class="c1"># </span>
      <span class="c1"># Note that this generates one jump table entry without an address before it,</span>
      <span class="c1"># meaning that this address needs to be generated by the preceding chunk.</span>
      <span class="c1"># All following jump table entries are generated with the addresses encoded in this chunk.</span>
      <span class="k">class</span> <span class="nc">JumpTableBody</span> <span class="o">&lt;</span> <span class="no">Kaitai</span><span class="o">::</span><span class="no">Struct</span><span class="o">::</span><span class="no">Struct</span>
        <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">_io</span><span class="p">,</span> <span class="n">_parent</span> <span class="o">=</span> <span class="kp">nil</span><span class="p">,</span> <span class="n">_root</span> <span class="o">=</span> <span class="nb">self</span><span class="p">)</span>
          <span class="k">super</span><span class="p">(</span><span class="n">_io</span><span class="p">,</span> <span class="n">_parent</span><span class="p">,</span> <span class="n">_root</span><span class="p">)</span>
          <span class="n">_read</span>
        <span class="k">end</span>

        <span class="k">def</span> <span class="nf">_read</span>
          <span class="vi">@segment_number_raw</span> <span class="o">=</span> <span class="no">DcmpVariableLengthInteger</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="vi">@_io</span><span class="p">)</span>
          <span class="vi">@num_addresses_raw</span> <span class="o">=</span> <span class="no">DcmpVariableLengthInteger</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="vi">@_io</span><span class="p">)</span>
          <span class="vi">@addresses_raw</span> <span class="o">=</span> <span class="nb">Array</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">num_addresses</span><span class="p">)</span>
          <span class="p">(</span><span class="n">num_addresses</span><span class="p">)</span><span class="o">.</span><span class="n">times</span> <span class="p">{</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
            <span class="vi">@addresses_raw</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="no">DcmpVariableLengthInteger</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="vi">@_io</span><span class="p">)</span>
          <span class="p">}</span>
          <span class="nb">self</span>
        <span class="k">end</span>

        <span class="c1">##</span>
        <span class="c1"># The segment number for all of the generated jump table entries.</span>
        <span class="c1"># </span>
        <span class="c1"># Although it is stored as a variable-length integer,</span>
        <span class="c1"># the segment number must be in the range `0x0 &lt;= x &lt;= 0xffff`,</span>
        <span class="c1"># i. e. an unsigned 16-bit integer.</span>
        <span class="k">def</span> <span class="nf">segment_number</span>
          <span class="k">return</span> <span class="vi">@segment_number</span> <span class="k">unless</span> <span class="vi">@segment_number</span><span class="o">.</span><span class="n">nil?</span>
          <span class="vi">@segment_number</span> <span class="o">=</span> <span class="n">segment_number_raw</span><span class="o">.</span><span class="n">value</span>
          <span class="vi">@segment_number</span>
        <span class="k">end</span>

        <span class="c1">##</span>
        <span class="c1"># The number of addresses stored in this chunk.</span>
        <span class="c1"># </span>
        <span class="c1"># This number must be greater than 0.</span>
        <span class="k">def</span> <span class="nf">num_addresses</span>
          <span class="k">return</span> <span class="vi">@num_addresses</span> <span class="k">unless</span> <span class="vi">@num_addresses</span><span class="o">.</span><span class="n">nil?</span>
          <span class="vi">@num_addresses</span> <span class="o">=</span> <span class="n">num_addresses_raw</span><span class="o">.</span><span class="n">value</span>
          <span class="vi">@num_addresses</span>
        <span class="k">end</span>

        <span class="c1">##</span>
        <span class="c1"># Raw variable-length integer representation of `segment_number`.</span>
        <span class="kp">attr_reader</span> <span class="ss">:segment_number_raw</span>

        <span class="c1">##</span>
        <span class="c1"># Raw variable-length integer representation of `num_addresses`.</span>
        <span class="kp">attr_reader</span> <span class="ss">:num_addresses_raw</span>

        <span class="c1">##</span>
        <span class="c1"># The addresses for each generated jump table entry,</span>
        <span class="c1"># stored as variable-length integers.</span>
        <span class="c1"># </span>
        <span class="c1"># The first address is stored literally and must be in the range `0x0 &lt;= x &lt;= 0xffff`,</span>
        <span class="c1"># i. e. an unsigned 16-bit integer.</span>
        <span class="c1"># </span>
        <span class="c1"># All following addresses are stored as deltas relative to the previous address.</span>
        <span class="c1"># Each of these deltas is stored plus 6;</span>
        <span class="c1"># this value needs to be subtracted before (or after) adding it to the previous address.</span>
        <span class="c1"># </span>
        <span class="c1"># Each delta (after subtracting 6) should be positive,</span>
        <span class="c1"># and adding it to the previous address should not result in a value larger than `0xffff`,</span>
        <span class="c1"># i. e. there should be no 16-bit unsigned integer wraparound.</span>
        <span class="c1"># These conditions are always met in all known jump table chunks,</span>
        <span class="c1"># so it is not known how the original decompressor behaves otherwise.</span>
        <span class="kp">attr_reader</span> <span class="ss">:addresses_raw</span>
      <span class="k">end</span>

      <span class="c1">##</span>
      <span class="c1"># The body of a repeat chunk.</span>
      <span class="c1"># </span>
      <span class="c1"># This chunk expands to a 1-byte or 2-byte value repeated a number of times,</span>
      <span class="c1"># i. e. it implements a form of run-length encoding.</span>
      <span class="k">class</span> <span class="nc">RepeatBody</span> <span class="o">&lt;</span> <span class="no">Kaitai</span><span class="o">::</span><span class="no">Struct</span><span class="o">::</span><span class="no">Struct</span>
        <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">_io</span><span class="p">,</span> <span class="n">_parent</span> <span class="o">=</span> <span class="kp">nil</span><span class="p">,</span> <span class="n">_root</span> <span class="o">=</span> <span class="nb">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
          <span class="k">super</span><span class="p">(</span><span class="n">_io</span><span class="p">,</span> <span class="n">_parent</span><span class="p">,</span> <span class="n">_root</span><span class="p">)</span>
          <span class="vi">@tag</span> <span class="o">=</span> <span class="n">tag</span>
          <span class="n">_read</span>
        <span class="k">end</span>

        <span class="k">def</span> <span class="nf">_read</span>
          <span class="vi">@to_repeat_raw</span> <span class="o">=</span> <span class="no">DcmpVariableLengthInteger</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="vi">@_io</span><span class="p">)</span>
          <span class="vi">@repeat_count_m1_raw</span> <span class="o">=</span> <span class="no">DcmpVariableLengthInteger</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="vi">@_io</span><span class="p">)</span>
          <span class="nb">self</span>
        <span class="k">end</span>

        <span class="c1">##</span>
        <span class="c1"># The length in bytes of the value to be repeated.</span>
        <span class="c1"># Regardless of the byte count,</span>
        <span class="c1"># the value to be repeated is stored as a variable-length integer.</span>
        <span class="k">def</span> <span class="nf">byte_count</span>
          <span class="k">return</span> <span class="vi">@byte_count</span> <span class="k">unless</span> <span class="vi">@byte_count</span><span class="o">.</span><span class="n">nil?</span>
          <span class="vi">@byte_count</span> <span class="o">=</span> <span class="p">(</span><span class="n">tag</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">?</span> <span class="mi">1</span> <span class="p">:</span> <span class="p">(</span><span class="n">tag</span> <span class="o">==</span> <span class="mi">3</span> <span class="o">?</span> <span class="mi">2</span> <span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
          <span class="vi">@byte_count</span>
        <span class="k">end</span>

        <span class="c1">##</span>
        <span class="c1"># The value to repeat.</span>
        <span class="c1"># </span>
        <span class="c1"># Although it is stored as a variable-length integer,</span>
        <span class="c1"># this value must fit into an unsigned big-endian integer that is as long as `byte_count`,</span>
        <span class="c1"># i. e. either 8 or 16 bits.</span>
        <span class="k">def</span> <span class="nf">to_repeat</span>
          <span class="k">return</span> <span class="vi">@to_repeat</span> <span class="k">unless</span> <span class="vi">@to_repeat</span><span class="o">.</span><span class="n">nil?</span>
          <span class="vi">@to_repeat</span> <span class="o">=</span> <span class="n">to_repeat_raw</span><span class="o">.</span><span class="n">value</span>
          <span class="vi">@to_repeat</span>
        <span class="k">end</span>

        <span class="c1">##</span>
        <span class="c1"># The number of times to repeat the value,</span>
        <span class="c1"># minus one.</span>
        <span class="c1"># </span>
        <span class="c1"># This value must not be negative.</span>
        <span class="k">def</span> <span class="nf">repeat_count_m1</span>
          <span class="k">return</span> <span class="vi">@repeat_count_m1</span> <span class="k">unless</span> <span class="vi">@repeat_count_m1</span><span class="o">.</span><span class="n">nil?</span>
          <span class="vi">@repeat_count_m1</span> <span class="o">=</span> <span class="n">repeat_count_m1_raw</span><span class="o">.</span><span class="n">value</span>
          <span class="vi">@repeat_count_m1</span>
        <span class="k">end</span>

        <span class="c1">##</span>
        <span class="c1"># The number of times to repeat the value.</span>
        <span class="c1"># </span>
        <span class="c1"># This value must be positive.</span>
        <span class="k">def</span> <span class="nf">repeat_count</span>
          <span class="k">return</span> <span class="vi">@repeat_count</span> <span class="k">unless</span> <span class="vi">@repeat_count</span><span class="o">.</span><span class="n">nil?</span>
          <span class="vi">@repeat_count</span> <span class="o">=</span> <span class="p">(</span><span class="n">repeat_count_m1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
          <span class="vi">@repeat_count</span>
        <span class="k">end</span>

        <span class="c1">##</span>
        <span class="c1"># Raw variable-length integer representation of `to_repeat`.</span>
        <span class="kp">attr_reader</span> <span class="ss">:to_repeat_raw</span>

        <span class="c1">##</span>
        <span class="c1"># Raw variable-length integer representation of `repeat_count_m1`.</span>
        <span class="kp">attr_reader</span> <span class="ss">:repeat_count_m1_raw</span>

        <span class="c1">##</span>
        <span class="c1"># The extended tag byte preceding this chunk body.</span>
        <span class="kp">attr_reader</span> <span class="ss">:tag</span>
      <span class="k">end</span>

      <span class="c1">##</span>
      <span class="c1"># The body of a 16-bit delta encoding chunk.</span>
      <span class="c1"># </span>
      <span class="c1"># This chunk expands to a sequence of 16-bit big-endian integer values.</span>
      <span class="c1"># The first value is stored literally.</span>
      <span class="c1"># All following values are stored as deltas relative to the previous value.</span>
      <span class="k">class</span> <span class="nc">DeltaEncoding16BitBody</span> <span class="o">&lt;</span> <span class="no">Kaitai</span><span class="o">::</span><span class="no">Struct</span><span class="o">::</span><span class="no">Struct</span>
        <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">_io</span><span class="p">,</span> <span class="n">_parent</span> <span class="o">=</span> <span class="kp">nil</span><span class="p">,</span> <span class="n">_root</span> <span class="o">=</span> <span class="nb">self</span><span class="p">)</span>
          <span class="k">super</span><span class="p">(</span><span class="n">_io</span><span class="p">,</span> <span class="n">_parent</span><span class="p">,</span> <span class="n">_root</span><span class="p">)</span>
          <span class="n">_read</span>
        <span class="k">end</span>

        <span class="k">def</span> <span class="nf">_read</span>
          <span class="vi">@first_value_raw</span> <span class="o">=</span> <span class="no">DcmpVariableLengthInteger</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="vi">@_io</span><span class="p">)</span>
          <span class="vi">@num_deltas_raw</span> <span class="o">=</span> <span class="no">DcmpVariableLengthInteger</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="vi">@_io</span><span class="p">)</span>
          <span class="vi">@deltas</span> <span class="o">=</span> <span class="nb">Array</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">num_deltas</span><span class="p">)</span>
          <span class="p">(</span><span class="n">num_deltas</span><span class="p">)</span><span class="o">.</span><span class="n">times</span> <span class="p">{</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
            <span class="vi">@deltas</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="vi">@_io</span><span class="o">.</span><span class="n">read_s1</span>
          <span class="p">}</span>
          <span class="nb">self</span>
        <span class="k">end</span>

        <span class="c1">##</span>
        <span class="c1"># The first value in the sequence.</span>
        <span class="c1"># </span>
        <span class="c1"># Although it is stored as a variable-length integer,</span>
        <span class="c1"># this value must be in the range `-0x8000 &lt;= x &lt;= 0x7fff`,</span>
        <span class="c1"># i. e. a signed 16-bit integer.</span>
        <span class="k">def</span> <span class="nf">first_value</span>
          <span class="k">return</span> <span class="vi">@first_value</span> <span class="k">unless</span> <span class="vi">@first_value</span><span class="o">.</span><span class="n">nil?</span>
          <span class="vi">@first_value</span> <span class="o">=</span> <span class="n">first_value_raw</span><span class="o">.</span><span class="n">value</span>
          <span class="vi">@first_value</span>
        <span class="k">end</span>

        <span class="c1">##</span>
        <span class="c1"># The number of deltas stored in this chunk.</span>
        <span class="c1"># </span>
        <span class="c1"># This number must not be negative.</span>
        <span class="k">def</span> <span class="nf">num_deltas</span>
          <span class="k">return</span> <span class="vi">@num_deltas</span> <span class="k">unless</span> <span class="vi">@num_deltas</span><span class="o">.</span><span class="n">nil?</span>
          <span class="vi">@num_deltas</span> <span class="o">=</span> <span class="n">num_deltas_raw</span><span class="o">.</span><span class="n">value</span>
          <span class="vi">@num_deltas</span>
        <span class="k">end</span>

        <span class="c1">##</span>
        <span class="c1"># Raw variable-length integer representation of `first_value`.</span>
        <span class="kp">attr_reader</span> <span class="ss">:first_value_raw</span>

        <span class="c1">##</span>
        <span class="c1"># Raw variable-length integer representation of `num_deltas`.</span>
        <span class="kp">attr_reader</span> <span class="ss">:num_deltas_raw</span>

        <span class="c1">##</span>
        <span class="c1"># The deltas for each value relative to the previous value.</span>
        <span class="c1"># </span>
        <span class="c1"># Each of these deltas is a signed 8-bit value.</span>
        <span class="c1"># When adding the delta to the previous value,</span>
        <span class="c1"># 16-bit integer wraparound is performed if necessary,</span>
        <span class="c1"># so that the resulting value always fits into a 16-bit signed integer.</span>
        <span class="kp">attr_reader</span> <span class="ss">:deltas</span>
      <span class="k">end</span>

      <span class="c1">##</span>
      <span class="c1"># The body of a 32-bit delta encoding chunk.</span>
      <span class="c1"># </span>
      <span class="c1"># This chunk expands to a sequence of 32-bit big-endian integer values.</span>
      <span class="c1"># The first value is stored literally.</span>
      <span class="c1"># All following values are stored as deltas relative to the previous value.</span>
      <span class="k">class</span> <span class="nc">DeltaEncoding32BitBody</span> <span class="o">&lt;</span> <span class="no">Kaitai</span><span class="o">::</span><span class="no">Struct</span><span class="o">::</span><span class="no">Struct</span>
        <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">_io</span><span class="p">,</span> <span class="n">_parent</span> <span class="o">=</span> <span class="kp">nil</span><span class="p">,</span> <span class="n">_root</span> <span class="o">=</span> <span class="nb">self</span><span class="p">)</span>
          <span class="k">super</span><span class="p">(</span><span class="n">_io</span><span class="p">,</span> <span class="n">_parent</span><span class="p">,</span> <span class="n">_root</span><span class="p">)</span>
          <span class="n">_read</span>
        <span class="k">end</span>

        <span class="k">def</span> <span class="nf">_read</span>
          <span class="vi">@first_value_raw</span> <span class="o">=</span> <span class="no">DcmpVariableLengthInteger</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="vi">@_io</span><span class="p">)</span>
          <span class="vi">@num_deltas_raw</span> <span class="o">=</span> <span class="no">DcmpVariableLengthInteger</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="vi">@_io</span><span class="p">)</span>
          <span class="vi">@deltas_raw</span> <span class="o">=</span> <span class="nb">Array</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">num_deltas</span><span class="p">)</span>
          <span class="p">(</span><span class="n">num_deltas</span><span class="p">)</span><span class="o">.</span><span class="n">times</span> <span class="p">{</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
            <span class="vi">@deltas_raw</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="no">DcmpVariableLengthInteger</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="vi">@_io</span><span class="p">)</span>
          <span class="p">}</span>
          <span class="nb">self</span>
        <span class="k">end</span>

        <span class="c1">##</span>
        <span class="c1"># The first value in the sequence.</span>
        <span class="k">def</span> <span class="nf">first_value</span>
          <span class="k">return</span> <span class="vi">@first_value</span> <span class="k">unless</span> <span class="vi">@first_value</span><span class="o">.</span><span class="n">nil?</span>
          <span class="vi">@first_value</span> <span class="o">=</span> <span class="n">first_value_raw</span><span class="o">.</span><span class="n">value</span>
          <span class="vi">@first_value</span>
        <span class="k">end</span>

        <span class="c1">##</span>
        <span class="c1"># The number of deltas stored in this chunk.</span>
        <span class="c1"># </span>
        <span class="c1"># This number must not be negative.</span>
        <span class="k">def</span> <span class="nf">num_deltas</span>
          <span class="k">return</span> <span class="vi">@num_deltas</span> <span class="k">unless</span> <span class="vi">@num_deltas</span><span class="o">.</span><span class="n">nil?</span>
          <span class="vi">@num_deltas</span> <span class="o">=</span> <span class="n">num_deltas_raw</span><span class="o">.</span><span class="n">value</span>
          <span class="vi">@num_deltas</span>
        <span class="k">end</span>

        <span class="c1">##</span>
        <span class="c1"># Raw variable-length integer representation of `first_value`.</span>
        <span class="kp">attr_reader</span> <span class="ss">:first_value_raw</span>

        <span class="c1">##</span>
        <span class="c1"># Raw variable-length integer representation of `num_deltas`.</span>
        <span class="kp">attr_reader</span> <span class="ss">:num_deltas_raw</span>

        <span class="c1">##</span>
        <span class="c1"># The deltas for each value relative to the previous value,</span>
        <span class="c1"># stored as variable-length integers.</span>
        <span class="c1"># </span>
        <span class="c1"># Each of these deltas is a signed value.</span>
        <span class="c1"># When adding the delta to the previous value,</span>
        <span class="c1"># 32-bit integer wraparound is performed if necessary,</span>
        <span class="c1"># so that the resulting value always fits into a 32-bit signed integer.</span>
        <span class="kp">attr_reader</span> <span class="ss">:deltas_raw</span>
      <span class="k">end</span>

      <span class="c1">##</span>
      <span class="c1"># The chunk&#39;s extended tag byte.</span>
      <span class="c1"># This controls the structure of the body and the meaning of the chunk.</span>
      <span class="kp">attr_reader</span> <span class="ss">:tag</span>

      <span class="c1">##</span>
      <span class="c1"># The chunk&#39;s body.</span>
      <span class="kp">attr_reader</span> <span class="ss">:body</span>
    <span class="k">end</span>

    <span class="c1">##</span>
    <span class="c1"># The chunk&#39;s tag byte.</span>
    <span class="c1"># This controls the structure of the body and the meaning of the chunk.</span>
    <span class="kp">attr_reader</span> <span class="ss">:tag</span>

    <span class="c1">##</span>
    <span class="c1"># The chunk&#39;s body.</span>
    <span class="c1"># </span>
    <span class="c1"># Certain chunks do not have any data following the tag byte.</span>
    <span class="c1"># In this case,</span>
    <span class="c1"># the body is a zero-length structure.</span>
    <span class="kp">attr_reader</span> <span class="ss">:body</span>
  <span class="k">end</span>

  <span class="c1">##</span>
  <span class="c1"># The sequence of chunks that make up the compressed data.</span>
  <span class="kp">attr_reader</span> <span class="ss">:chunks</span>
<span class="k">end</span>
</pre></div>

        </div>
        
    </div>
</section>

    <footer id="main-footer">
        <div class="container">
            &copy; 2015-2020 Kaitai Project and <a href="https://github.com/kaitai-io/kaitai_struct_formats/graphs/contributors">formats repo contributors</a>

            <h3>Contacts</h3>

            <div class="row">
                <div class="col-sm-4">
                    <i class="fa fa-fw fa-2x fa-github"></i> <a href="https://github.com/kaitai-io/kaitai_struct">GitHub</a>
                </div>
                <div class="col-sm-4">
                    <i class="fa fa-fw fa-2x fa-twitter"></i> <a href="https://twitter.com/kaitai_io">@kaitai_io</a>
                </div>
                <div class="col-sm-4">
                    Gitter: <a href="https://gitter.im/kaitai_struct/Lobby">kaitai_struct</a>
                </div>
            </div>
        </div>
    </footer>

  <script src="https://kaitai.io/js/jquery-1.12.3.min.js"></script>
  <script src="https://kaitai.io/js/bootstrap.min.js"></script>

  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-76299550-1', 'auto');
      ga('send', 'pageview');
  </script>
</body>
</html>
