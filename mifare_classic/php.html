<!DOCTYPE html>
<html dir="ltr" lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Mifare Classic RFID tag dump: PHP parsing library</title>
  <meta name="keywords" content="kaitai,struct,binary,format,parsing,decoding,java,javascript,python,ruby,library,metadata">
  <meta name="description" content="Kaitai Struct is a formal language for binary format specification that can be compiled into parser code">

  <link rel="stylesheet" href="//kaitai.io/styles/bootstrap.min.css">
  <link rel="stylesheet" href="//kaitai.io/styles/bootstrap-theme.min.css">
  <link href='https://fonts.googleapis.com/css?family=Exo:400,700' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Share+Tech+Mono' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

  <link rel="stylesheet" href="//kaitai.io/styles/main.css" type="text/css">

  <link rel="stylesheet" href="//kaitai.io/styles/highlight/default.css">
  <style>
.diagram-img {
    display: block;
    max-width: 100%;
    height: auto;
    margin: 0 auto;
}

section.format {
    padding: 30px 0;
}

section#format-meta, section#format-index-header {
    background: #e3eef7;
}

section#format-diagram, section#format-index-footer {
    background: #e9f8dd;
}

section#format-ksy, section#format-lang {
    background: #d1eadd;
}

section#format-index .row {
    padding-bottom: 10px;
}

  </style>
  <script src="//kaitai.io/js/highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
</head>
<body data-spy="scroll" data-target="#main-navbar" data-offset="100">

    <nav class="navbar navbar-inverse navbar-fixed-top" id="main-navbar">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#main-navbar-collapse" aria-expanded="false">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <span class="navbar-brand">Kaitai Struct</span>
            </div>
            <div class="collapse navbar-collapse" id="main-navbar-collapse">
                <ul class="nav navbar-nav">
                    <li><a href="http://kaitai.io/#what-is-it">What is it?</a></li>
                    <li><a href="http://kaitai.io/#quick-start">Quick Start</a></li>
                    <li><a href="http://kaitai.io/#download">Download</a></li>
                    <li class="active"><a href="http://formats.kaitai.io/">Format Gallery</a></li>
                </ul>
                <ul class="nav navbar-nav navbar-right">
                    <li><a href="http://kaitai.io/repl/index.html">Try it</a></li>
                    <li><a href="https://ide.kaitai.io/">Web IDE</a></li>
                    <li><a href="http://doc.kaitai.io/">Documentation</a></li>
                </ul>
            </div>
        </div>
    </nav>
<nav>
    <div class="container">
    <ol class="breadcrumb">
        <li><a href="../index.html">Format Gallery</a></li>
        <li>Hardware Protocols</li>
        <li class="active">Mifare Classic RFID tag dump</li>
    </ol>
    </div>
</nav>

<section id="format-meta" class="format">
    <div class="container">
        <h1>Mifare Classic RFID tag dump:
            
            PHP parsing library
            
        </h1>

        <div class="row">
            <div class="col-md-8">
                <p><p>You can get a dump for testing by the link: https://github.com/zhovner/mfdread/raw/master/dump.mfd</p>
</p>
            </div>
            <div class="col-md-4">
                <div class="panel panel-info">
                    
                    
                    <div class="panel-heading">
                        <h3 class="panel-title">File extension</h3>
                    </div>
                    <div class="panel-body">
                        mfd
                    </div>
                    
                    
                    <div class="panel-heading">
                        <h3 class="panel-title">KS implementation details</h3>
                    </div>
                    
                    <div class="panel-body">
                        License: <a href="https://spdx.org/licenses/BSD-2-Clause.html">BSD-2-Clause</a>
                    </div>
                    
                    
                    <div class="panel-body">
                        Minimal Kaitai Struct required: 0.9
                    </div>
                    
                    
                    
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
            <p>
            This page hosts a formal specification of Mifare Classic RFID tag dump
            using <a href="http://kaitai.io">Kaitai Struct</a>. This
            specification can be automatically translated into a
            variety of programming languages to get a parsing library.
            </p>

            <ul class="nav nav-pills">
                
                
                <li>
                
                <a href="index.html" title="Mifare Classic RFID tag dump parsing Overview library">Overview</a></li>
                
                
                <li>
                
                <a href="csharp.html" title="Mifare Classic RFID tag dump parsing C# library">C#</a></li>
                
                
                <li>
                
                <a href="graphviz.html" title="Mifare Classic RFID tag dump parsing GraphViz library">GraphViz</a></li>
                
                
                <li>
                
                <a href="java.html" title="Mifare Classic RFID tag dump parsing Java library">Java</a></li>
                
                
                <li>
                
                <a href="javascript.html" title="Mifare Classic RFID tag dump parsing JavaScript library">JavaScript</a></li>
                
                
                <li>
                
                <a href="lua.html" title="Mifare Classic RFID tag dump parsing Lua library">Lua</a></li>
                
                
                <li>
                
                <a href="perl.html" title="Mifare Classic RFID tag dump parsing Perl library">Perl</a></li>
                
                
                <li class="active">
                
                <a href="php.html" title="Mifare Classic RFID tag dump parsing PHP library">PHP</a></li>
                
                
                <li>
                
                <a href="python.html" title="Mifare Classic RFID tag dump parsing Python library">Python</a></li>
                
                
                <li>
                
                <a href="ruby.html" title="Mifare Classic RFID tag dump parsing Ruby library">Ruby</a></li>
                
            </ul>
            </div>
        </div>
    </div>
</section>


<section id="format-lang" class="format">
    <div class="container">
        <h2>
            
            PHP source code to parse Mifare Classic RFID tag dump
            
        </h2>

        

        <h3>MifareClassic.php</h3>

        <div class="row">
            <div class="pull-right">
                <p>
                    <a href="src/php/MifareClassic.php" class="btn btn-success">Download <i class="fa fa-download"></i></a>
                </p>
            </div>
        </div>

        <div class="row">
            <pre><code class="php">&lt;?php
// This is a generated file! Please edit source .ksy file and use kaitai-struct-compiler to rebuild

/**
 * You can get a dump for testing by the link: https://github.com/zhovner/mfdread/raw/master/dump.mfd
 */

class MifareClassic extends \Kaitai\Struct\Struct {
    public function __construct(\Kaitai\Struct\Stream $_io, \Kaitai\Struct\Struct $_parent = null, \MifareClassic $_root = null) {
        parent::__construct($_io, $_parent, $_root);
        $this-&gt;_read();
    }

    private function _read() {
        $this-&gt;_m__raw_sectors = [];
        $this-&gt;_m_sectors = [];
        $i = 0;
        while (!$this-&gt;_io-&gt;isEof()) {
            $this-&gt;_m__raw_sectors[] = $this-&gt;_io-&gt;readBytes(((($i &gt;= 32 ? 4 : 1) * 4) * 16));
            $_io__raw_sectors = new \Kaitai\Struct\Stream(end($this-&gt;_m__raw_sectors));
            $this-&gt;_m_sectors[] = new \MifareClassic\Sector($i == 0, $_io__raw_sectors, $this, $this-&gt;_root);
            $i++;
        }
    }
    protected $_m_sectors;
    protected $_m__raw_sectors;
    public function sectors() { return $this-&gt;_m_sectors; }
    public function _raw_sectors() { return $this-&gt;_m__raw_sectors; }
}

namespace \MifareClassic;

class Key extends \Kaitai\Struct\Struct {
    public function __construct(\Kaitai\Struct\Stream $_io, \MifareClassic\Trailer $_parent = null, \MifareClassic $_root = null) {
        parent::__construct($_io, $_parent, $_root);
        $this-&gt;_read();
    }

    private function _read() {
        $this-&gt;_m_key = $this-&gt;_io-&gt;readBytes(6);
    }
    protected $_m_key;
    public function key() { return $this-&gt;_m_key; }
}

namespace \MifareClassic;

class Sector extends \Kaitai\Struct\Struct {
    public function __construct(bool $hasManufacturer, \Kaitai\Struct\Stream $_io, \MifareClassic $_parent = null, \MifareClassic $_root = null) {
        parent::__construct($_io, $_parent, $_root);
        $this-&gt;_m_hasManufacturer = $hasManufacturer;
        $this-&gt;_read();
    }

    private function _read() {
        if ($this-&gt;hasManufacturer()) {
            $this-&gt;_m_manufacturer = new \MifareClassic\Manufacturer($this-&gt;_io, $this, $this-&gt;_root);
        }
        $this-&gt;_m__raw_dataFiller = $this-&gt;_io-&gt;readBytes((($this-&gt;_io()-&gt;size() - $this-&gt;_io()-&gt;pos()) - 16));
        $_io__raw_dataFiller = new \Kaitai\Struct\Stream($this-&gt;_m__raw_dataFiller);
        $this-&gt;_m_dataFiller = new \MifareClassic\Sector\Filler($_io__raw_dataFiller, $this, $this-&gt;_root);
        $this-&gt;_m_trailer = new \MifareClassic\Trailer($this-&gt;_io, $this, $this-&gt;_root);
    }
    protected $_m_blockSize;
    public function blockSize() {
        if ($this-&gt;_m_blockSize !== null)
            return $this-&gt;_m_blockSize;
        $this-&gt;_m_blockSize = 16;
        return $this-&gt;_m_blockSize;
    }
    protected $_m_data;
    public function data() {
        if ($this-&gt;_m_data !== null)
            return $this-&gt;_m_data;
        $this-&gt;_m_data = $this-&gt;dataFiller()-&gt;data();
        return $this-&gt;_m_data;
    }
    protected $_m_blocks;
    public function blocks() {
        if ($this-&gt;_m_blocks !== null)
            return $this-&gt;_m_blocks;
        $io = $this-&gt;dataFiller()-&gt;_io();
        $_pos = $io-&gt;pos();
        $io-&gt;seek(0);
        $this-&gt;_m_blocks = [];
        $i = 0;
        while (!$io-&gt;isEof()) {
            $this-&gt;_m_blocks[] = $io-&gt;readBytes($this-&gt;blockSize());
            $i++;
        }
        $io-&gt;seek($_pos);
        return $this-&gt;_m_blocks;
    }
    protected $_m_values;
    public function values() {
        if ($this-&gt;_m_values !== null)
            return $this-&gt;_m_values;
        $io = $this-&gt;dataFiller()-&gt;_io();
        $_pos = $io-&gt;pos();
        $io-&gt;seek(0);
        $this-&gt;_m_values = new \MifareClassic\Sector\Values($io, $this, $this-&gt;_root);
        $io-&gt;seek($_pos);
        return $this-&gt;_m_values;
    }
    protected $_m_manufacturer;
    protected $_m_dataFiller;
    protected $_m_trailer;
    protected $_m_hasManufacturer;
    protected $_m__raw_dataFiller;
    public function manufacturer() { return $this-&gt;_m_manufacturer; }
    public function dataFiller() { return $this-&gt;_m_dataFiller; }
    public function trailer() { return $this-&gt;_m_trailer; }
    public function hasManufacturer() { return $this-&gt;_m_hasManufacturer; }
    public function _raw_dataFiller() { return $this-&gt;_m__raw_dataFiller; }
}

namespace \MifareClassic\Sector;

class Values extends \Kaitai\Struct\Struct {
    public function __construct(\Kaitai\Struct\Stream $_io, \MifareClassic\Sector $_parent = null, \MifareClassic $_root = null) {
        parent::__construct($_io, $_parent, $_root);
        $this-&gt;_read();
    }

    private function _read() {
        $this-&gt;_m_values = [];
        $i = 0;
        while (!$this-&gt;_io-&gt;isEof()) {
            $this-&gt;_m_values[] = new \MifareClassic\Sector\Values\ValueBlock($this-&gt;_io, $this, $this-&gt;_root);
            $i++;
        }
    }
    protected $_m_values;
    public function values() { return $this-&gt;_m_values; }
}

namespace \MifareClassic\Sector\Values;

class ValueBlock extends \Kaitai\Struct\Struct {
    public function __construct(\Kaitai\Struct\Stream $_io, \MifareClassic\Sector\Values $_parent = null, \MifareClassic $_root = null) {
        parent::__construct($_io, $_parent, $_root);
        $this-&gt;_read();
    }

    private function _read() {
        $this-&gt;_m_valuez = [];
        $n = 3;
        for ($i = 0; $i &lt; $n; $i++) {
            $this-&gt;_m_valuez[] = $this-&gt;_io-&gt;readU4le();
        }
        $this-&gt;_m_addrz = [];
        $n = 4;
        for ($i = 0; $i &lt; $n; $i++) {
            $this-&gt;_m_addrz[] = $this-&gt;_io-&gt;readU1();
        }
    }
    protected $_m_addr;
    public function addr() {
        if ($this-&gt;_m_addr !== null)
            return $this-&gt;_m_addr;
        if ($this-&gt;valid()) {
            $this-&gt;_m_addr = $this-&gt;addrz()[0];
        }
        return $this-&gt;_m_addr;
    }
    protected $_m_addrValid;
    public function addrValid() {
        if ($this-&gt;_m_addrValid !== null)
            return $this-&gt;_m_addrValid;
        $this-&gt;_m_addrValid =  (($this-&gt;addrz()[0] == ~($this-&gt;addrz()[1])) &amp;&amp; ($this-&gt;addrz()[0] == $this-&gt;addrz()[2]) &amp;&amp; ($this-&gt;addrz()[1] == $this-&gt;addrz()[3])) ;
        return $this-&gt;_m_addrValid;
    }
    protected $_m_valid;
    public function valid() {
        if ($this-&gt;_m_valid !== null)
            return $this-&gt;_m_valid;
        $this-&gt;_m_valid =  (($this-&gt;valueValid()) &amp;&amp; ($this-&gt;addrValid())) ;
        return $this-&gt;_m_valid;
    }
    protected $_m_valueValid;
    public function valueValid() {
        if ($this-&gt;_m_valueValid !== null)
            return $this-&gt;_m_valueValid;
        $this-&gt;_m_valueValid =  (($this-&gt;valuez()[0] == ~($this-&gt;valuez()[1])) &amp;&amp; ($this-&gt;valuez()[0] == $this-&gt;valuez()[2])) ;
        return $this-&gt;_m_valueValid;
    }
    protected $_m_value;
    public function value() {
        if ($this-&gt;_m_value !== null)
            return $this-&gt;_m_value;
        if ($this-&gt;valid()) {
            $this-&gt;_m_value = $this-&gt;valuez()[0];
        }
        return $this-&gt;_m_value;
    }
    protected $_m_valuez;
    protected $_m_addrz;
    public function valuez() { return $this-&gt;_m_valuez; }
    public function addrz() { return $this-&gt;_m_addrz; }
}

/**
 * only to create _io
 */

namespace \MifareClassic\Sector;

class Filler extends \Kaitai\Struct\Struct {
    public function __construct(\Kaitai\Struct\Stream $_io, \MifareClassic\Sector $_parent = null, \MifareClassic $_root = null) {
        parent::__construct($_io, $_parent, $_root);
        $this-&gt;_read();
    }

    private function _read() {
        $this-&gt;_m_data = $this-&gt;_io-&gt;readBytes($this-&gt;_io()-&gt;size());
    }
    protected $_m_data;
    public function data() { return $this-&gt;_m_data; }
}

namespace \MifareClassic;

class Manufacturer extends \Kaitai\Struct\Struct {
    public function __construct(\Kaitai\Struct\Stream $_io, \MifareClassic\Sector $_parent = null, \MifareClassic $_root = null) {
        parent::__construct($_io, $_parent, $_root);
        $this-&gt;_read();
    }

    private function _read() {
        $this-&gt;_m_nuid = $this-&gt;_io-&gt;readU4le();
        $this-&gt;_m_bcc = $this-&gt;_io-&gt;readU1();
        $this-&gt;_m_sak = $this-&gt;_io-&gt;readU1();
        $this-&gt;_m_atqa = $this-&gt;_io-&gt;readU2le();
        $this-&gt;_m_manufacturer = $this-&gt;_io-&gt;readBytes(8);
    }
    protected $_m_nuid;
    protected $_m_bcc;
    protected $_m_sak;
    protected $_m_atqa;
    protected $_m_manufacturer;

    /**
     * beware for 7bytes UID it goes over next fields
     */
    public function nuid() { return $this-&gt;_m_nuid; }
    public function bcc() { return $this-&gt;_m_bcc; }
    public function sak() { return $this-&gt;_m_sak; }
    public function atqa() { return $this-&gt;_m_atqa; }

    /**
     * may contain manufacture date as BCD
     */
    public function manufacturer() { return $this-&gt;_m_manufacturer; }
}

namespace \MifareClassic;

class Trailer extends \Kaitai\Struct\Struct {
    public function __construct(\Kaitai\Struct\Stream $_io, \MifareClassic\Sector $_parent = null, \MifareClassic $_root = null) {
        parent::__construct($_io, $_parent, $_root);
        $this-&gt;_read();
    }

    private function _read() {
        $this-&gt;_m_keyA = new \MifareClassic\Key($this-&gt;_io, $this, $this-&gt;_root);
        $this-&gt;_m__raw_accessBits = $this-&gt;_io-&gt;readBytes(3);
        $_io__raw_accessBits = new \Kaitai\Struct\Stream($this-&gt;_m__raw_accessBits);
        $this-&gt;_m_accessBits = new \MifareClassic\Trailer\AccessConditions($_io__raw_accessBits, $this, $this-&gt;_root);
        $this-&gt;_m_userByte = $this-&gt;_io-&gt;readU1();
        $this-&gt;_m_keyB = new \MifareClassic\Key($this-&gt;_io, $this, $this-&gt;_root);
    }
    protected $_m_acBits;
    public function acBits() {
        if ($this-&gt;_m_acBits !== null)
            return $this-&gt;_m_acBits;
        $this-&gt;_m_acBits = 3;
        return $this-&gt;_m_acBits;
    }
    protected $_m_acsInSector;
    public function acsInSector() {
        if ($this-&gt;_m_acsInSector !== null)
            return $this-&gt;_m_acsInSector;
        $this-&gt;_m_acsInSector = 4;
        return $this-&gt;_m_acsInSector;
    }
    protected $_m_acCountOfChunks;
    public function acCountOfChunks() {
        if ($this-&gt;_m_acCountOfChunks !== null)
            return $this-&gt;_m_acCountOfChunks;
        $this-&gt;_m_acCountOfChunks = ($this-&gt;acBits() * 2);
        return $this-&gt;_m_acCountOfChunks;
    }
    protected $_m_keyA;
    protected $_m_accessBits;
    protected $_m_userByte;
    protected $_m_keyB;
    protected $_m__raw_accessBits;
    public function keyA() { return $this-&gt;_m_keyA; }
    public function accessBits() { return $this-&gt;_m_accessBits; }
    public function userByte() { return $this-&gt;_m_userByte; }
    public function keyB() { return $this-&gt;_m_keyB; }
    public function _raw_accessBits() { return $this-&gt;_m__raw_accessBits; }
}

namespace \MifareClassic\Trailer;

class AccessConditions extends \Kaitai\Struct\Struct {
    public function __construct(\Kaitai\Struct\Stream $_io, \MifareClassic\Trailer $_parent = null, \MifareClassic $_root = null) {
        parent::__construct($_io, $_parent, $_root);
        $this-&gt;_read();
    }

    private function _read() {
        $this-&gt;_m_rawChunks = [];
        $n = $this-&gt;_parent()-&gt;acCountOfChunks();
        for ($i = 0; $i &lt; $n; $i++) {
            $this-&gt;_m_rawChunks[] = $this-&gt;_io-&gt;readBitsInt(4);
        }
    }
    protected $_m_dataAcs;
    public function dataAcs() {
        if ($this-&gt;_m_dataAcs !== null)
            return $this-&gt;_m_dataAcs;
        $_pos = $this-&gt;_io-&gt;pos();
        $this-&gt;_io-&gt;seek(0);
        $this-&gt;_m_dataAcs = [];
        $n = ($this-&gt;_parent()-&gt;acsInSector() - 1);
        for ($i = 0; $i &lt; $n; $i++) {
            $this-&gt;_m_dataAcs[] = new \MifareClassic\Trailer\AccessConditions\DataAc($this-&gt;acsRaw()[$i], $this-&gt;_io, $this, $this-&gt;_root);
        }
        $this-&gt;_io-&gt;seek($_pos);
        return $this-&gt;_m_dataAcs;
    }
    protected $_m_remaps;
    public function remaps() {
        if ($this-&gt;_m_remaps !== null)
            return $this-&gt;_m_remaps;
        $_pos = $this-&gt;_io-&gt;pos();
        $this-&gt;_io-&gt;seek(0);
        $this-&gt;_m_remaps = [];
        $n = $this-&gt;_parent()-&gt;acBits();
        for ($i = 0; $i &lt; $n; $i++) {
            $this-&gt;_m_remaps[] = new \MifareClassic\Trailer\AccessConditions\ChunkBitRemap($i, $this-&gt;_io, $this, $this-&gt;_root);
        }
        $this-&gt;_io-&gt;seek($_pos);
        return $this-&gt;_m_remaps;
    }
    protected $_m_acsRaw;
    public function acsRaw() {
        if ($this-&gt;_m_acsRaw !== null)
            return $this-&gt;_m_acsRaw;
        $_pos = $this-&gt;_io-&gt;pos();
        $this-&gt;_io-&gt;seek(0);
        $this-&gt;_m_acsRaw = [];
        $n = $this-&gt;_parent()-&gt;acsInSector();
        for ($i = 0; $i &lt; $n; $i++) {
            $this-&gt;_m_acsRaw[] = new \MifareClassic\Trailer\AccessConditions\Ac($i, $this-&gt;_io, $this, $this-&gt;_root);
        }
        $this-&gt;_io-&gt;seek($_pos);
        return $this-&gt;_m_acsRaw;
    }
    protected $_m_trailerAc;
    public function trailerAc() {
        if ($this-&gt;_m_trailerAc !== null)
            return $this-&gt;_m_trailerAc;
        $_pos = $this-&gt;_io-&gt;pos();
        $this-&gt;_io-&gt;seek(0);
        $this-&gt;_m_trailerAc = new \MifareClassic\Trailer\AccessConditions\TrailerAc($this-&gt;acsRaw()[($this-&gt;_parent()-&gt;acsInSector() - 1)], $this-&gt;_io, $this, $this-&gt;_root);
        $this-&gt;_io-&gt;seek($_pos);
        return $this-&gt;_m_trailerAc;
    }
    protected $_m_chunks;
    public function chunks() {
        if ($this-&gt;_m_chunks !== null)
            return $this-&gt;_m_chunks;
        $_pos = $this-&gt;_io-&gt;pos();
        $this-&gt;_io-&gt;seek(0);
        $this-&gt;_m_chunks = [];
        $n = $this-&gt;_parent()-&gt;acBits();
        for ($i = 0; $i &lt; $n; $i++) {
            $this-&gt;_m_chunks[] = new \MifareClassic\Trailer\AccessConditions\ValidChunk($this-&gt;rawChunks()[$this-&gt;remaps()[$i]-&gt;invChunkNo()], $this-&gt;rawChunks()[$this-&gt;remaps()[$i]-&gt;chunkNo()], $this-&gt;_io, $this, $this-&gt;_root);
        }
        $this-&gt;_io-&gt;seek($_pos);
        return $this-&gt;_m_chunks;
    }
    protected $_m_rawChunks;
    public function rawChunks() { return $this-&gt;_m_rawChunks; }
}

namespace \MifareClassic\Trailer\AccessConditions;

class TrailerAc extends \Kaitai\Struct\Struct {
    public function __construct(\MifareClassic\Trailer\AccessConditions\Ac $ac, \Kaitai\Struct\Stream $_io, \MifareClassic\Trailer\AccessConditions $_parent = null, \MifareClassic $_root = null) {
        parent::__construct($_io, $_parent, $_root);
        $this-&gt;_m_ac = $ac;
        $this-&gt;_read();
    }

    private function _read() {
    }
    protected $_m_canReadKeyB;

    /**
     * key A is required
     */
    public function canReadKeyB() {
        if ($this-&gt;_m_canReadKeyB !== null)
            return $this-&gt;_m_canReadKeyB;
        $this-&gt;_m_canReadKeyB = $this-&gt;ac()-&gt;invShiftVal() &lt;= 2;
        return $this-&gt;_m_canReadKeyB;
    }
    protected $_m_canWriteKeys;
    public function canWriteKeys() {
        if ($this-&gt;_m_canWriteKeys !== null)
            return $this-&gt;_m_canWriteKeys;
        $this-&gt;_m_canWriteKeys =  ((\Kaitai\Struct\Stream::mod(($this-&gt;ac()-&gt;invShiftVal() + 1), 3) != 0) &amp;&amp; ($this-&gt;ac()-&gt;invShiftVal() &lt; 6)) ;
        return $this-&gt;_m_canWriteKeys;
    }
    protected $_m_canWriteAccessBits;
    public function canWriteAccessBits() {
        if ($this-&gt;_m_canWriteAccessBits !== null)
            return $this-&gt;_m_canWriteAccessBits;
        $this-&gt;_m_canWriteAccessBits = $this-&gt;ac()-&gt;bits()[2]-&gt;b();
        return $this-&gt;_m_canWriteAccessBits;
    }
    protected $_m_keyBControlsWrite;
    public function keyBControlsWrite() {
        if ($this-&gt;_m_keyBControlsWrite !== null)
            return $this-&gt;_m_keyBControlsWrite;
        $this-&gt;_m_keyBControlsWrite = !($this-&gt;canReadKeyB());
        return $this-&gt;_m_keyBControlsWrite;
    }
    protected $_m_ac;
    public function ac() { return $this-&gt;_m_ac; }
}

namespace \MifareClassic\Trailer\AccessConditions;

class ChunkBitRemap extends \Kaitai\Struct\Struct {
    public function __construct(int $bitNo, \Kaitai\Struct\Stream $_io, \MifareClassic\Trailer\AccessConditions $_parent = null, \MifareClassic $_root = null) {
        parent::__construct($_io, $_parent, $_root);
        $this-&gt;_m_bitNo = $bitNo;
        $this-&gt;_read();
    }

    private function _read() {
    }
    protected $_m_shiftValue;
    public function shiftValue() {
        if ($this-&gt;_m_shiftValue !== null)
            return $this-&gt;_m_shiftValue;
        $this-&gt;_m_shiftValue = ($this-&gt;bitNo() == 1 ? -1 : 1);
        return $this-&gt;_m_shiftValue;
    }
    protected $_m_chunkNo;
    public function chunkNo() {
        if ($this-&gt;_m_chunkNo !== null)
            return $this-&gt;_m_chunkNo;
        $this-&gt;_m_chunkNo = \Kaitai\Struct\Stream::mod((($this-&gt;invChunkNo() + $this-&gt;shiftValue()) + $this-&gt;_parent()-&gt;_parent()-&gt;acCountOfChunks()), $this-&gt;_parent()-&gt;_parent()-&gt;acCountOfChunks());
        return $this-&gt;_m_chunkNo;
    }
    protected $_m_invChunkNo;
    public function invChunkNo() {
        if ($this-&gt;_m_invChunkNo !== null)
            return $this-&gt;_m_invChunkNo;
        $this-&gt;_m_invChunkNo = ($this-&gt;bitNo() + $this-&gt;shiftValue());
        return $this-&gt;_m_invChunkNo;
    }
    protected $_m_bitNo;
    public function bitNo() { return $this-&gt;_m_bitNo; }
}

namespace \MifareClassic\Trailer\AccessConditions;

class DataAc extends \Kaitai\Struct\Struct {
    public function __construct(\MifareClassic\Trailer\AccessConditions\Ac $ac, \Kaitai\Struct\Stream $_io, \MifareClassic\Trailer\AccessConditions $_parent = null, \MifareClassic $_root = null) {
        parent::__construct($_io, $_parent, $_root);
        $this-&gt;_m_ac = $ac;
        $this-&gt;_read();
    }

    private function _read() {
    }
    protected $_m_readKeyARequired;
    public function readKeyARequired() {
        if ($this-&gt;_m_readKeyARequired !== null)
            return $this-&gt;_m_readKeyARequired;
        $this-&gt;_m_readKeyARequired = $this-&gt;ac()-&gt;val() &lt;= 4;
        return $this-&gt;_m_readKeyARequired;
    }
    protected $_m_writeKeyBRequired;
    public function writeKeyBRequired() {
        if ($this-&gt;_m_writeKeyBRequired !== null)
            return $this-&gt;_m_writeKeyBRequired;
        $this-&gt;_m_writeKeyBRequired =  (( ((!($this-&gt;readKeyARequired())) || ($this-&gt;readKeyBRequired())) ) &amp;&amp; (!($this-&gt;ac()-&gt;bits()[0]-&gt;b()))) ;
        return $this-&gt;_m_writeKeyBRequired;
    }
    protected $_m_writeKeyARequired;
    public function writeKeyARequired() {
        if ($this-&gt;_m_writeKeyARequired !== null)
            return $this-&gt;_m_writeKeyARequired;
        $this-&gt;_m_writeKeyARequired = $this-&gt;ac()-&gt;val() == 0;
        return $this-&gt;_m_writeKeyARequired;
    }
    protected $_m_readKeyBRequired;
    public function readKeyBRequired() {
        if ($this-&gt;_m_readKeyBRequired !== null)
            return $this-&gt;_m_readKeyBRequired;
        $this-&gt;_m_readKeyBRequired = $this-&gt;ac()-&gt;val() &lt;= 6;
        return $this-&gt;_m_readKeyBRequired;
    }
    protected $_m_decrementAvailable;
    public function decrementAvailable() {
        if ($this-&gt;_m_decrementAvailable !== null)
            return $this-&gt;_m_decrementAvailable;
        $this-&gt;_m_decrementAvailable =  (( (($this-&gt;ac()-&gt;bits()[1]-&gt;b()) || (!($this-&gt;ac()-&gt;bits()[0]-&gt;b()))) ) &amp;&amp; (!($this-&gt;ac()-&gt;bits()[2]-&gt;b()))) ;
        return $this-&gt;_m_decrementAvailable;
    }
    protected $_m_incrementAvailable;
    public function incrementAvailable() {
        if ($this-&gt;_m_incrementAvailable !== null)
            return $this-&gt;_m_incrementAvailable;
        $this-&gt;_m_incrementAvailable =  (( ((!($this-&gt;ac()-&gt;bits()[0]-&gt;b())) &amp;&amp; (!($this-&gt;readKeyARequired())) &amp;&amp; (!($this-&gt;readKeyBRequired()))) ) || ( ((!($this-&gt;ac()-&gt;bits()[0]-&gt;b())) &amp;&amp; ($this-&gt;readKeyARequired()) &amp;&amp; ($this-&gt;readKeyBRequired())) )) ;
        return $this-&gt;_m_incrementAvailable;
    }
    protected $_m_ac;
    public function ac() { return $this-&gt;_m_ac; }
}

namespace \MifareClassic\Trailer\AccessConditions;

class Ac extends \Kaitai\Struct\Struct {
    public function __construct(int $index, \Kaitai\Struct\Stream $_io, \MifareClassic\Trailer\AccessConditions $_parent = null, \MifareClassic $_root = null) {
        parent::__construct($_io, $_parent, $_root);
        $this-&gt;_m_index = $index;
        $this-&gt;_read();
    }

    private function _read() {
    }
    protected $_m_bits;
    public function bits() {
        if ($this-&gt;_m_bits !== null)
            return $this-&gt;_m_bits;
        $_pos = $this-&gt;_io-&gt;pos();
        $this-&gt;_io-&gt;seek(0);
        $this-&gt;_m_bits = [];
        $n = $this-&gt;_parent()-&gt;_parent()-&gt;acBits();
        for ($i = 0; $i &lt; $n; $i++) {
            $this-&gt;_m_bits[] = new \MifareClassic\Trailer\AccessConditions\Ac\AcBit($this-&gt;index(), $this-&gt;_parent()-&gt;chunks()[$i]-&gt;chunk(), $this-&gt;_io, $this, $this-&gt;_root);
        }
        $this-&gt;_io-&gt;seek($_pos);
        return $this-&gt;_m_bits;
    }
    protected $_m_val;

    /**
     * c3 c2 c1
     */
    public function val() {
        if ($this-&gt;_m_val !== null)
            return $this-&gt;_m_val;
        $this-&gt;_m_val = ((($this-&gt;bits()[2]-&gt;n() &lt;&lt; 2) | ($this-&gt;bits()[1]-&gt;n() &lt;&lt; 1)) | $this-&gt;bits()[0]-&gt;n());
        return $this-&gt;_m_val;
    }
    protected $_m_invShiftVal;
    public function invShiftVal() {
        if ($this-&gt;_m_invShiftVal !== null)
            return $this-&gt;_m_invShiftVal;
        $this-&gt;_m_invShiftVal = ((($this-&gt;bits()[0]-&gt;n() &lt;&lt; 2) | ($this-&gt;bits()[1]-&gt;n() &lt;&lt; 1)) | $this-&gt;bits()[2]-&gt;n());
        return $this-&gt;_m_invShiftVal;
    }
    protected $_m_index;
    public function index() { return $this-&gt;_m_index; }
}

namespace \MifareClassic\Trailer\AccessConditions\Ac;

class AcBit extends \Kaitai\Struct\Struct {
    public function __construct(int $i, int $chunk, \Kaitai\Struct\Stream $_io, \MifareClassic\Trailer\AccessConditions\Ac $_parent = null, \MifareClassic $_root = null) {
        parent::__construct($_io, $_parent, $_root);
        $this-&gt;_m_i = $i;
        $this-&gt;_m_chunk = $chunk;
        $this-&gt;_read();
    }

    private function _read() {
    }
    protected $_m_n;
    public function n() {
        if ($this-&gt;_m_n !== null)
            return $this-&gt;_m_n;
        $this-&gt;_m_n = (($this-&gt;chunk() &gt;&gt; $this-&gt;i()) &amp; 1);
        return $this-&gt;_m_n;
    }
    protected $_m_b;
    public function b() {
        if ($this-&gt;_m_b !== null)
            return $this-&gt;_m_b;
        $this-&gt;_m_b = $this-&gt;n() == 1;
        return $this-&gt;_m_b;
    }
    protected $_m_i;
    protected $_m_chunk;
    public function i() { return $this-&gt;_m_i; }
    public function chunk() { return $this-&gt;_m_chunk; }
}

namespace \MifareClassic\Trailer\AccessConditions;

class ValidChunk extends \Kaitai\Struct\Struct {
    public function __construct(int $invChunk, int $chunk, \Kaitai\Struct\Stream $_io, \MifareClassic\Trailer\AccessConditions $_parent = null, \MifareClassic $_root = null) {
        parent::__construct($_io, $_parent, $_root);
        $this-&gt;_m_invChunk = $invChunk;
        $this-&gt;_m_chunk = $chunk;
        $this-&gt;_read();
    }

    private function _read() {
    }
    protected $_m_valid;
    public function valid() {
        if ($this-&gt;_m_valid !== null)
            return $this-&gt;_m_valid;
        $this-&gt;_m_valid = ($this-&gt;invChunk() ^ $this-&gt;chunk()) == 15;
        return $this-&gt;_m_valid;
    }
    protected $_m_invChunk;
    protected $_m_chunk;
    public function invChunk() { return $this-&gt;_m_invChunk; }

    /**
     * c3 c2 c1 c0
     */
    public function chunk() { return $this-&gt;_m_chunk; }
}
</code></pre>
            
        </div>
        
    </div>
</section>

    <footer id="main-footer">
        <div class="container">
            &copy; 2015-2019 Kaitai Project and <a href="https://github.com/kaitai-io/kaitai_struct_formats/graphs/contributors">formats repo contributors</a>

            <h3>Contacts</h3>

            <div class="row">
                <div class="col-sm-4">
                    <i class="fa fa-fw fa-2x fa-github"></i> <a href="https://github.com/kaitai-io/kaitai_struct">GitHub</a>
                </div>
                <div class="col-sm-4">
                    <i class="fa fa-fw fa-2x fa-twitter"></i> <a href="https://twitter.com/kaitai_io">@kaitai_io</a>
                </div>
                <div class="col-sm-4">
                    Gitter: <a href="https://gitter.im/kaitai_struct/Lobby">kaitai_struct</a>
                </div>
            </div>
        </div>
    </footer>

  <script src="//kaitai.io/js/jquery-1.12.3.min.js"></script>
  <script src="//kaitai.io/js/bootstrap.min.js"></script>

  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-76299550-1', 'auto');
      ga('send', 'pageview');
  </script>
</body>
</html>
