<!DOCTYPE html>
<html dir="ltr" lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Extended Module: PHP parsing library</title>
  <meta name="keywords" content="kaitai,struct,binary,format,parsing,decoding,java,javascript,python,ruby,library,metadata">
  <meta name="description" content="Kaitai Struct is a formal language for binary format specification that can be compiled into parser code">

  <link rel="stylesheet" href="//kaitai.io/styles/bootstrap.min.css">
  <link rel="stylesheet" href="//kaitai.io/styles/bootstrap-theme.min.css">
  <link href='https://fonts.googleapis.com/css?family=Exo:400,700' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Share+Tech+Mono' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

  <link rel="stylesheet" href="//kaitai.io/styles/main.css" type="text/css">

  <link rel="stylesheet" href="//kaitai.io/styles/highlight/default.css">
  <style>
.diagram-img {
    display: block;
    max-width: 100%;
    height: auto;
    margin: 0 auto;
}

section.format {
    padding: 30px 0;
}

section#format-meta, section#format-index-header {
    background: #e3eef7;
}

section#format-diagram, section#format-index-footer {
    background: #e9f8dd;
}

section#format-ksy, section#format-lang {
    background: #d1eadd;
}

section#format-index .row {
    padding-bottom: 10px;
}

  </style>
  <script src="//kaitai.io/js/highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
</head>
<body data-spy="scroll" data-target="#main-navbar" data-offset="100">

    <nav class="navbar navbar-inverse navbar-fixed-top" id="main-navbar">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#main-navbar-collapse" aria-expanded="false">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <span class="navbar-brand">Kaitai Struct</span>
            </div>
            <div class="collapse navbar-collapse" id="main-navbar-collapse">
                <ul class="nav navbar-nav">
                    <li><a href="http://kaitai.io/#what-is-it">What is it?</a></li>
                    <li><a href="http://kaitai.io/#quick-start">Quick Start</a></li>
                    <li><a href="http://kaitai.io/#download">Download</a></li>
                    <li class="active"><a href="http://formats.kaitai.io/">Format Gallery</a></li>
                </ul>
                <ul class="nav navbar-nav navbar-right">
                    <li><a href="http://kaitai.io/repl/index.html">Try it</a></li>
                    <li><a href="https://ide.kaitai.io/">Web IDE</a></li>
                    <li><a href="http://doc.kaitai.io/">Documentation</a></li>
                </ul>
            </div>
        </div>
    </nav>
<nav>
    <div class="container">
    <ol class="breadcrumb">
        <li><a href="../index.html">Format Gallery</a></li>
        <li>Multimedia Files</li>
        <li class="active">Extended Module</li>
    </ol>
    </div>
</nav>

<section id="format-meta" class="format">
    <div class="container">
        <h1>Extended Module:
            
            PHP parsing library
            
        </h1>

        <div class="row">
            <div class="col-md-8">
                <p></p>
            </div>
            <div class="col-md-4">
                <div class="panel panel-info">
                    
                    <div class="panel-heading">
                        <h3 class="panel-title">Application</h3>
                    </div>
                    <div class="panel-body">
                        ["FastTracker 2", "Protracker", "MilkyTracker", "libmodplug", "Mikmod"]
                    </div>
                    
                    
                    <div class="panel-heading">
                        <h3 class="panel-title">File extension</h3>
                    </div>
                    <div class="panel-body">
                        xm
                    </div>
                    
                    
                    <div class="panel-heading">
                        <h3 class="panel-title">KS implementation details</h3>
                    </div>
                    
                    <div class="panel-body">
                        License: <a href="https://spdx.org/licenses/Unlicense.html">Unlicense</a>
                    </div>
                    
                    
                    
                    
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
            <p>
            This page hosts a formal specification of Extended Module
            using <a href="http://kaitai.io">Kaitai Struct</a>. This
            specification can be automatically translated into a
            variety of programming languages to get a parsing library.
            </p>

            <ul class="nav nav-pills">
                
                
                <li>
                
                <a href="index.html" title="Extended Module parsing Overview library">Overview</a></li>
                
                
                <li>
                
                <a href="cpp_stl.html" title="Extended Module parsing C++/STL library">C++/STL</a></li>
                
                
                <li>
                
                <a href="csharp.html" title="Extended Module parsing C# library">C#</a></li>
                
                
                <li>
                
                <a href="graphviz.html" title="Extended Module parsing GraphViz library">GraphViz</a></li>
                
                
                <li>
                
                <a href="java.html" title="Extended Module parsing Java library">Java</a></li>
                
                
                <li>
                
                <a href="javascript.html" title="Extended Module parsing JavaScript library">JavaScript</a></li>
                
                
                <li>
                
                <a href="lua.html" title="Extended Module parsing Lua library">Lua</a></li>
                
                
                <li>
                
                <a href="perl.html" title="Extended Module parsing Perl library">Perl</a></li>
                
                
                <li class="active">
                
                <a href="php.html" title="Extended Module parsing PHP library">PHP</a></li>
                
                
                <li>
                
                <a href="python.html" title="Extended Module parsing Python library">Python</a></li>
                
                
                <li>
                
                <a href="ruby.html" title="Extended Module parsing Ruby library">Ruby</a></li>
                
            </ul>
            </div>
        </div>
    </div>
</section>


<section id="format-lang" class="format">
    <div class="container">
        <h2>
            
            PHP source code to parse Extended Module
            
        </h2>

        

        <h3>Xm.php</h3>

        <div class="row">
            <div class="pull-right">
                <p>
                    <a href="src/php/Xm.php" class="btn btn-success">Download <i class="fa fa-download"></i></a>
                </p>
            </div>
        </div>

        <div class="row">
            <pre><code class="php">&lt;?php
// This is a generated file! Please edit source .ksy file and use kaitai-struct-compiler to rebuild

class Xm extends \Kaitai\Struct\Struct {
    public function __construct(\Kaitai\Struct\Stream $_io, \Kaitai\Struct\Struct $_parent = null, \Xm $_root = null) {
        parent::__construct($_io, $_parent, $_root);
        $this-&gt;_read();
    }

    private function _read() {
        $this-&gt;_m_preheader = new \Xm\Preheader($this-&gt;_io, $this, $this-&gt;_root);
        $this-&gt;_m__raw_header = $this-&gt;_io-&gt;readBytes(($this-&gt;preheader()-&gt;headerSize() - 4));
        $io = new \Kaitai\Struct\Stream($this-&gt;_m__raw_header);
        $this-&gt;_m_header = new \Xm\Header($io, $this, $this-&gt;_root);
        $this-&gt;_m_patterns = [];
        $n = $this-&gt;header()-&gt;numberOfPatterns();
        for ($i = 0; $i &lt; $n; $i++) {
            $this-&gt;_m_patterns[] = new \Xm\Pattern($this-&gt;_io, $this, $this-&gt;_root);
        }
        $this-&gt;_m_instruments = [];
        $n = $this-&gt;header()-&gt;numberOfInstruments();
        for ($i = 0; $i &lt; $n; $i++) {
            $this-&gt;_m_instruments[] = new \Xm\Instrument($this-&gt;_io, $this, $this-&gt;_root);
        }
    }
    protected $_m_preheader;
    protected $_m_header;
    protected $_m_patterns;
    protected $_m_instruments;
    protected $_m__raw_header;
    public function preheader() { return $this-&gt;_m_preheader; }
    public function header() { return $this-&gt;_m_header; }
    public function patterns() { return $this-&gt;_m_patterns; }
    public function instruments() { return $this-&gt;_m_instruments; }
    public function _raw_header() { return $this-&gt;_m__raw_header; }
}

namespace \Xm;

class Preheader extends \Kaitai\Struct\Struct {
    public function __construct(\Kaitai\Struct\Stream $_io, \Xm $_parent = null, \Xm $_root = null) {
        parent::__construct($_io, $_parent, $_root);
        $this-&gt;_read();
    }

    private function _read() {
        $this-&gt;_m_signature0 = $this-&gt;_io-&gt;ensureFixedContents(&quot;\x45\x78\x74\x65\x6E\x64\x65\x64\x20\x4D\x6F\x64\x75\x6C\x65\x3A\x20&quot;);
        $this-&gt;_m_moduleName = \Kaitai\Struct\Stream::bytesToStr(\Kaitai\Struct\Stream::bytesTerminate($this-&gt;_io-&gt;readBytes(20), 0, false), &quot;utf-8&quot;);
        $this-&gt;_m_signature1 = $this-&gt;_io-&gt;ensureFixedContents(&quot;\x1A&quot;);
        $this-&gt;_m_trackerName = \Kaitai\Struct\Stream::bytesToStr(\Kaitai\Struct\Stream::bytesTerminate($this-&gt;_io-&gt;readBytes(20), 0, false), &quot;utf-8&quot;);
        $this-&gt;_m_versionNumber = new \Xm\Preheader\Version($this-&gt;_io, $this, $this-&gt;_root);
        $this-&gt;_m_headerSize = $this-&gt;_io-&gt;readU4le();
    }
    protected $_m_signature0;
    protected $_m_moduleName;
    protected $_m_signature1;
    protected $_m_trackerName;
    protected $_m_versionNumber;
    protected $_m_headerSize;
    public function signature0() { return $this-&gt;_m_signature0; }

    /**
     * Module name, padded with zeroes
     */
    public function moduleName() { return $this-&gt;_m_moduleName; }
    public function signature1() { return $this-&gt;_m_signature1; }

    /**
     * Tracker name
     */
    public function trackerName() { return $this-&gt;_m_trackerName; }

    /**
     * Format versions below [0x01, 0x04] have a LOT of differences. Check this field!
     */
    public function versionNumber() { return $this-&gt;_m_versionNumber; }

    /**
     * Header size &lt;&lt; Calculated FROM THIS OFFSET, not from the beginning of the file! &gt;&gt;
     */
    public function headerSize() { return $this-&gt;_m_headerSize; }
}

namespace \Xm\Preheader;

class Version extends \Kaitai\Struct\Struct {
    public function __construct(\Kaitai\Struct\Stream $_io, \Xm\Preheader $_parent = null, \Xm $_root = null) {
        parent::__construct($_io, $_parent, $_root);
        $this-&gt;_read();
    }

    private function _read() {
        $this-&gt;_m_minor = $this-&gt;_io-&gt;readU1();
        $this-&gt;_m_major = $this-&gt;_io-&gt;readU1();
    }
    protected $_m_value;
    public function value() {
        if ($this-&gt;_m_value !== null)
            return $this-&gt;_m_value;
        $this-&gt;_m_value = (($this-&gt;major() &lt;&lt; 8) | $this-&gt;minor());
        return $this-&gt;_m_value;
    }
    protected $_m_minor;
    protected $_m_major;

    /**
     * currently 0x04
     */
    public function minor() { return $this-&gt;_m_minor; }

    /**
     * currently 0x01
     */
    public function major() { return $this-&gt;_m_major; }
}

namespace \Xm;

class Pattern extends \Kaitai\Struct\Struct {
    public function __construct(\Kaitai\Struct\Stream $_io, \Xm $_parent = null, \Xm $_root = null) {
        parent::__construct($_io, $_parent, $_root);
        $this-&gt;_read();
    }

    private function _read() {
        $this-&gt;_m_header = new \Xm\Pattern\Header($this-&gt;_io, $this, $this-&gt;_root);
        $this-&gt;_m_packedData = $this-&gt;_io-&gt;readBytes($this-&gt;header()-&gt;main()-&gt;packedPatternDataSize());
    }
    protected $_m_header;
    protected $_m_packedData;
    public function header() { return $this-&gt;_m_header; }
    public function packedData() { return $this-&gt;_m_packedData; }
}

namespace \Xm\Pattern;

class Header extends \Kaitai\Struct\Struct {
    public function __construct(\Kaitai\Struct\Stream $_io, \Xm\Pattern $_parent = null, \Xm $_root = null) {
        parent::__construct($_io, $_parent, $_root);
        $this-&gt;_read();
    }

    private function _read() {
        $this-&gt;_m_headerLength = $this-&gt;_io-&gt;readU4le();
        $this-&gt;_m__raw_main = $this-&gt;_io-&gt;readBytes(($this-&gt;headerLength() - 4));
        $io = new \Kaitai\Struct\Stream($this-&gt;_m__raw_main);
        $this-&gt;_m_main = new \Xm\Pattern\Header\HeaderMain($io, $this, $this-&gt;_root);
    }
    protected $_m_headerLength;
    protected $_m_main;
    protected $_m__raw_main;

    /**
     * Pattern header length
     */
    public function headerLength() { return $this-&gt;_m_headerLength; }
    public function main() { return $this-&gt;_m_main; }
    public function _raw_main() { return $this-&gt;_m__raw_main; }
}

namespace \Xm\Pattern\Header;

class HeaderMain extends \Kaitai\Struct\Struct {
    public function __construct(\Kaitai\Struct\Stream $_io, \Xm\Pattern\Header $_parent = null, \Xm $_root = null) {
        parent::__construct($_io, $_parent, $_root);
        $this-&gt;_read();
    }

    private function _read() {
        $this-&gt;_m_packingType = $this-&gt;_io-&gt;readU1();
        switch ($this-&gt;_root()-&gt;preheader()-&gt;versionNumber()-&gt;value()) {
            case 258:
                $this-&gt;_m_numberOfRowsRaw = $this-&gt;_io-&gt;readU1();
                break;
            default:
                $this-&gt;_m_numberOfRowsRaw = $this-&gt;_io-&gt;readU2le();
                break;
        }
        $this-&gt;_m_packedPatternDataSize = $this-&gt;_io-&gt;readU2le();
    }
    protected $_m_numberOfRows;
    public function numberOfRows() {
        if ($this-&gt;_m_numberOfRows !== null)
            return $this-&gt;_m_numberOfRows;
        $this-&gt;_m_numberOfRows = ($this-&gt;numberOfRowsRaw() + ($this-&gt;_root()-&gt;preheader()-&gt;versionNumber()-&gt;value() == 258 ? 1 : 0));
        return $this-&gt;_m_numberOfRows;
    }
    protected $_m_packingType;
    protected $_m_numberOfRowsRaw;
    protected $_m_packedPatternDataSize;

    /**
     * Packing type (always 0)
     */
    public function packingType() { return $this-&gt;_m_packingType; }

    /**
     * Number of rows in pattern (1..256)
     */
    public function numberOfRowsRaw() { return $this-&gt;_m_numberOfRowsRaw; }

    /**
     * Packed pattern data size
     */
    public function packedPatternDataSize() { return $this-&gt;_m_packedPatternDataSize; }
}

namespace \Xm;

class Flags extends \Kaitai\Struct\Struct {
    public function __construct(\Kaitai\Struct\Stream $_io, \Xm\Header $_parent = null, \Xm $_root = null) {
        parent::__construct($_io, $_parent, $_root);
        $this-&gt;_read();
    }

    private function _read() {
        $this-&gt;_m_reserved = $this-&gt;_io-&gt;readBitsInt(15);
        $this-&gt;_m_freqTableType = $this-&gt;_io-&gt;readBitsInt(1) != 0;
    }
    protected $_m_reserved;
    protected $_m_freqTableType;
    public function reserved() { return $this-&gt;_m_reserved; }

    /**
     * 0 = Amiga frequency table (see below); 1 = Linear frequency table
     */
    public function freqTableType() { return $this-&gt;_m_freqTableType; }
}

namespace \Xm;

class Header extends \Kaitai\Struct\Struct {
    public function __construct(\Kaitai\Struct\Stream $_io, \Xm $_parent = null, \Xm $_root = null) {
        parent::__construct($_io, $_parent, $_root);
        $this-&gt;_read();
    }

    private function _read() {
        $this-&gt;_m_songLength = $this-&gt;_io-&gt;readU2le();
        $this-&gt;_m_restartPosition = $this-&gt;_io-&gt;readU2le();
        $this-&gt;_m_numberOfChannels = $this-&gt;_io-&gt;readU2le();
        $this-&gt;_m_numberOfPatterns = $this-&gt;_io-&gt;readU2le();
        $this-&gt;_m_numberOfInstruments = $this-&gt;_io-&gt;readU2le();
        $this-&gt;_m_flags = new \Xm\Flags($this-&gt;_io, $this, $this-&gt;_root);
        $this-&gt;_m_defaultTempo = $this-&gt;_io-&gt;readU2le();
        $this-&gt;_m_defaultBpm = $this-&gt;_io-&gt;readU2le();
        $this-&gt;_m_patternOrderTable = [];
        $n = 256;
        for ($i = 0; $i &lt; $n; $i++) {
            $this-&gt;_m_patternOrderTable[] = $this-&gt;_io-&gt;readU1();
        }
    }
    protected $_m_songLength;
    protected $_m_restartPosition;
    protected $_m_numberOfChannels;
    protected $_m_numberOfPatterns;
    protected $_m_numberOfInstruments;
    protected $_m_flags;
    protected $_m_defaultTempo;
    protected $_m_defaultBpm;
    protected $_m_patternOrderTable;

    /**
     * Song length (in pattern order table)
     */
    public function songLength() { return $this-&gt;_m_songLength; }
    public function restartPosition() { return $this-&gt;_m_restartPosition; }

    /**
     * (2,4,6,8,10,...,32)
     */
    public function numberOfChannels() { return $this-&gt;_m_numberOfChannels; }

    /**
     * (max 256)
     */
    public function numberOfPatterns() { return $this-&gt;_m_numberOfPatterns; }

    /**
     * (max 128)
     */
    public function numberOfInstruments() { return $this-&gt;_m_numberOfInstruments; }
    public function flags() { return $this-&gt;_m_flags; }
    public function defaultTempo() { return $this-&gt;_m_defaultTempo; }
    public function defaultBpm() { return $this-&gt;_m_defaultBpm; }

    /**
     * max 256
     */
    public function patternOrderTable() { return $this-&gt;_m_patternOrderTable; }
}

namespace \Xm;

class Instrument extends \Kaitai\Struct\Struct {
    public function __construct(\Kaitai\Struct\Stream $_io, \Xm $_parent = null, \Xm $_root = null) {
        parent::__construct($_io, $_parent, $_root);
        $this-&gt;_read();
    }

    private function _read() {
        $this-&gt;_m_headerSize = $this-&gt;_io-&gt;readU4le();
        $this-&gt;_m__raw_header = $this-&gt;_io-&gt;readBytes(($this-&gt;headerSize() - 4));
        $io = new \Kaitai\Struct\Stream($this-&gt;_m__raw_header);
        $this-&gt;_m_header = new \Xm\Instrument\Header($io, $this, $this-&gt;_root);
        $this-&gt;_m_samplesHeaders = [];
        $n = $this-&gt;header()-&gt;numberOfSamples();
        for ($i = 0; $i &lt; $n; $i++) {
            $this-&gt;_m_samplesHeaders[] = new \Xm\Instrument\SampleHeader($this-&gt;_io, $this, $this-&gt;_root);
        }
        $this-&gt;_m_samples = [];
        $n = $this-&gt;header()-&gt;numberOfSamples();
        for ($i = 0; $i &lt; $n; $i++) {
            $this-&gt;_m_samples[] = new \Xm\Instrument\SamplesData($i, $this-&gt;_io, $this, $this-&gt;_root);
        }
    }
    protected $_m_headerSize;
    protected $_m_header;
    protected $_m_samplesHeaders;
    protected $_m_samples;
    protected $_m__raw_header;

    /**
     * Instrument size &lt;&lt; header that is &gt;&gt;
     * &lt;&lt; &quot;Instrument Size&quot; field tends to be more than the actual size of the structure documented here (it includes also the extended instrument sample header above). So remember to check it and skip the additional bytes before the first sample header &gt;&gt;
     */
    public function headerSize() { return $this-&gt;_m_headerSize; }
    public function header() { return $this-&gt;_m_header; }
    public function samplesHeaders() { return $this-&gt;_m_samplesHeaders; }
    public function samples() { return $this-&gt;_m_samples; }
    public function _raw_header() { return $this-&gt;_m__raw_header; }
}

namespace \Xm\Instrument;

class Header extends \Kaitai\Struct\Struct {
    public function __construct(\Kaitai\Struct\Stream $_io, \Xm\Instrument $_parent = null, \Xm $_root = null) {
        parent::__construct($_io, $_parent, $_root);
        $this-&gt;_read();
    }

    private function _read() {
        $this-&gt;_m_name = \Kaitai\Struct\Stream::bytesToStr(\Kaitai\Struct\Stream::bytesTerminate($this-&gt;_io-&gt;readBytes(22), 0, false), &quot;utf-8&quot;);
        $this-&gt;_m_type = $this-&gt;_io-&gt;readU1();
        $this-&gt;_m_numberOfSamples = $this-&gt;_io-&gt;readU2le();
        if ($this-&gt;numberOfSamples() &gt; 0) {
            $this-&gt;_m_extraHeader = new \Xm\Instrument\ExtraHeader($this-&gt;_io, $this, $this-&gt;_root);
        }
    }
    protected $_m_name;
    protected $_m_type;
    protected $_m_numberOfSamples;
    protected $_m_extraHeader;
    public function name() { return $this-&gt;_m_name; }

    /**
     * Usually zero, but this seems pretty random, don&#39;t assume it&#39;s zero
     */
    public function type() { return $this-&gt;_m_type; }
    public function numberOfSamples() { return $this-&gt;_m_numberOfSamples; }
    public function extraHeader() { return $this-&gt;_m_extraHeader; }
}

namespace \Xm\Instrument;

class ExtraHeader extends \Kaitai\Struct\Struct {
    public function __construct(\Kaitai\Struct\Stream $_io, \Xm\Instrument\Header $_parent = null, \Xm $_root = null) {
        parent::__construct($_io, $_parent, $_root);
        $this-&gt;_read();
    }

    private function _read() {
        $this-&gt;_m_sampleHeaderSize = $this-&gt;_io-&gt;readU4le();
        $this-&gt;_m_sampleNumberForAllNotes = [];
        $n = 96;
        for ($i = 0; $i &lt; $n; $i++) {
            $this-&gt;_m_sampleNumberForAllNotes[] = $this-&gt;_io-&gt;readU1();
        }
        $this-&gt;_m_pointsForVolumeEnvelope = [];
        $n = 12;
        for ($i = 0; $i &lt; $n; $i++) {
            $this-&gt;_m_pointsForVolumeEnvelope[] = new \Xm\Instrument\ExtraHeader\EnvelopePoint($this-&gt;_io, $this, $this-&gt;_root);
        }
        $this-&gt;_m_pointsForPanningEnvelope = [];
        $n = 12;
        for ($i = 0; $i &lt; $n; $i++) {
            $this-&gt;_m_pointsForPanningEnvelope[] = new \Xm\Instrument\ExtraHeader\EnvelopePoint($this-&gt;_io, $this, $this-&gt;_root);
        }
        $this-&gt;_m_numberOfVolumePoints = $this-&gt;_io-&gt;readU1();
        $this-&gt;_m_numberOfPanningPoints = $this-&gt;_io-&gt;readU1();
        $this-&gt;_m_volumeSustainPoint = $this-&gt;_io-&gt;readU1();
        $this-&gt;_m_volumeLoopStartPoint = $this-&gt;_io-&gt;readU1();
        $this-&gt;_m_volumeLoopEndPoint = $this-&gt;_io-&gt;readU1();
        $this-&gt;_m_panningSustainPoint = $this-&gt;_io-&gt;readU1();
        $this-&gt;_m_panningLoopStartPoint = $this-&gt;_io-&gt;readU1();
        $this-&gt;_m_panningLoopEndPoint = $this-&gt;_io-&gt;readU1();
        $this-&gt;_m_volumeType = $this-&gt;_io-&gt;readU1();
        $this-&gt;_m_panningType = $this-&gt;_io-&gt;readU1();
        $this-&gt;_m_vibratoType = $this-&gt;_io-&gt;readU1();
        $this-&gt;_m_vibratoSweep = $this-&gt;_io-&gt;readU1();
        $this-&gt;_m_vibratoDepth = $this-&gt;_io-&gt;readU1();
        $this-&gt;_m_vibratoRate = $this-&gt;_io-&gt;readU1();
        $this-&gt;_m_volumeFadeout = $this-&gt;_io-&gt;readU2le();
        $this-&gt;_m_reserved = $this-&gt;_io-&gt;readU2le();
    }
    protected $_m_sampleHeaderSize;
    protected $_m_sampleNumberForAllNotes;
    protected $_m_pointsForVolumeEnvelope;
    protected $_m_pointsForPanningEnvelope;
    protected $_m_numberOfVolumePoints;
    protected $_m_numberOfPanningPoints;
    protected $_m_volumeSustainPoint;
    protected $_m_volumeLoopStartPoint;
    protected $_m_volumeLoopEndPoint;
    protected $_m_panningSustainPoint;
    protected $_m_panningLoopStartPoint;
    protected $_m_panningLoopEndPoint;
    protected $_m_volumeType;
    protected $_m_panningType;
    protected $_m_vibratoType;
    protected $_m_vibratoSweep;
    protected $_m_vibratoDepth;
    protected $_m_vibratoRate;
    protected $_m_volumeFadeout;
    protected $_m_reserved;
    public function sampleHeaderSize() { return $this-&gt;_m_sampleHeaderSize; }
    public function sampleNumberForAllNotes() { return $this-&gt;_m_sampleNumberForAllNotes; }
    public function pointsForVolumeEnvelope() { return $this-&gt;_m_pointsForVolumeEnvelope; }
    public function pointsForPanningEnvelope() { return $this-&gt;_m_pointsForPanningEnvelope; }
    public function numberOfVolumePoints() { return $this-&gt;_m_numberOfVolumePoints; }
    public function numberOfPanningPoints() { return $this-&gt;_m_numberOfPanningPoints; }
    public function volumeSustainPoint() { return $this-&gt;_m_volumeSustainPoint; }
    public function volumeLoopStartPoint() { return $this-&gt;_m_volumeLoopStartPoint; }
    public function volumeLoopEndPoint() { return $this-&gt;_m_volumeLoopEndPoint; }
    public function panningSustainPoint() { return $this-&gt;_m_panningSustainPoint; }
    public function panningLoopStartPoint() { return $this-&gt;_m_panningLoopStartPoint; }
    public function panningLoopEndPoint() { return $this-&gt;_m_panningLoopEndPoint; }
    public function volumeType() { return $this-&gt;_m_volumeType; }
    public function panningType() { return $this-&gt;_m_panningType; }
    public function vibratoType() { return $this-&gt;_m_vibratoType; }
    public function vibratoSweep() { return $this-&gt;_m_vibratoSweep; }
    public function vibratoDepth() { return $this-&gt;_m_vibratoDepth; }
    public function vibratoRate() { return $this-&gt;_m_vibratoRate; }
    public function volumeFadeout() { return $this-&gt;_m_volumeFadeout; }
    public function reserved() { return $this-&gt;_m_reserved; }
}

/**
 * Envelope frame-counters work in range 0..FFFFh (0..65535 dec).
 * BUT! FT2 only itself supports only range 0..FFh (0..255 dec).
 * Some other trackers (like SoundTracker for Unix), however, can use the full range 0..FFFF, so it should be supported.
 * !!TIP: This is also a good way to detect if the module has been made with FT2 or not. (In case the tracker name is brain- deadly left unchanged!)
 * Of course it does not help if all instruments have the values inside FT2 supported range.
 * The value-field of the envelope point is ranged between 00..3Fh (0..64 dec).
 */

namespace \Xm\Instrument\ExtraHeader;

class EnvelopePoint extends \Kaitai\Struct\Struct {
    public function __construct(\Kaitai\Struct\Stream $_io, \Xm\Instrument\ExtraHeader $_parent = null, \Xm $_root = null) {
        parent::__construct($_io, $_parent, $_root);
        $this-&gt;_read();
    }

    private function _read() {
        $this-&gt;_m_x = $this-&gt;_io-&gt;readU2le();
        $this-&gt;_m_y = $this-&gt;_io-&gt;readU2le();
    }
    protected $_m_x;
    protected $_m_y;

    /**
     * Frame number of the point
     */
    public function x() { return $this-&gt;_m_x; }

    /**
     * Value of the point
     */
    public function y() { return $this-&gt;_m_y; }
}

namespace \Xm\Instrument\ExtraHeader;

class Type {
    const TRUE = 0;
    const SUSTAIN = 1;
    const LOOP = 2;
}

/**
 * The saved data uses simple delta-encoding to achieve better compression ratios (when compressed with pkzip, etc.)
 * Pseudocode for converting the delta-coded data to normal data,
 * old = 0;
 * for i in range(data_len):
 *   new = sample[i] + old;
 *   sample[i] = new;
 *   old = new;
 */

namespace \Xm\Instrument;

class SamplesData extends \Kaitai\Struct\Struct {
    public function __construct(int $index, \Kaitai\Struct\Stream $_io, \Xm\Instrument $_parent = null, \Xm $_root = null) {
        parent::__construct($_io, $_parent, $_root);
        $this-&gt;_m_index = $index;
        $this-&gt;_read();
    }

    private function _read() {
        $this-&gt;_m_samplesData = [];
        $n = $this-&gt;_parent()-&gt;samplesHeaders()[$this-&gt;index()]-&gt;sampleLength();
        for ($i = 0; $i &lt; $n; $i++) {
            switch ($this-&gt;_parent()-&gt;samplesHeaders()[$this-&gt;index()]-&gt;type()-&gt;isSampleData16Bit()) {
                case true:
                    $this-&gt;_m_samplesData[] = $this-&gt;_io-&gt;readU2le();
                    break;
                case false:
                    $this-&gt;_m_samplesData[] = $this-&gt;_io-&gt;readU1();
                    break;
            }
        }
    }
    protected $_m_samplesData;
    protected $_m_index;
    public function samplesData() { return $this-&gt;_m_samplesData; }
    public function index() { return $this-&gt;_m_index; }
}

namespace \Xm\Instrument;

class SampleHeader extends \Kaitai\Struct\Struct {
    public function __construct(\Kaitai\Struct\Stream $_io, \Xm\Instrument $_parent = null, \Xm $_root = null) {
        parent::__construct($_io, $_parent, $_root);
        $this-&gt;_read();
    }

    private function _read() {
        $this-&gt;_m_sampleLength = $this-&gt;_io-&gt;readU4le();
        $this-&gt;_m_sampleLoopStart = $this-&gt;_io-&gt;readU4le();
        $this-&gt;_m_sampleLoopLength = $this-&gt;_io-&gt;readU4le();
        $this-&gt;_m_volume = $this-&gt;_io-&gt;readU1();
        $this-&gt;_m_fineTune = $this-&gt;_io-&gt;readS1();
        $this-&gt;_m_type = new \Xm\Instrument\SampleHeader\LoopType($this-&gt;_io, $this, $this-&gt;_root);
        $this-&gt;_m_panning = $this-&gt;_io-&gt;readU1();
        $this-&gt;_m_relativeNoteNumber = $this-&gt;_io-&gt;readS1();
        $this-&gt;_m_reserved = $this-&gt;_io-&gt;readU1();
        $this-&gt;_m_name = \Kaitai\Struct\Stream::bytesToStr(\Kaitai\Struct\Stream::bytesTerminate($this-&gt;_io-&gt;readBytes(22), 0, false), &quot;utf-8&quot;);
    }
    protected $_m_sampleLength;
    protected $_m_sampleLoopStart;
    protected $_m_sampleLoopLength;
    protected $_m_volume;
    protected $_m_fineTune;
    protected $_m_type;
    protected $_m_panning;
    protected $_m_relativeNoteNumber;
    protected $_m_reserved;
    protected $_m_name;
    public function sampleLength() { return $this-&gt;_m_sampleLength; }
    public function sampleLoopStart() { return $this-&gt;_m_sampleLoopStart; }
    public function sampleLoopLength() { return $this-&gt;_m_sampleLoopLength; }
    public function volume() { return $this-&gt;_m_volume; }

    /**
     * -16..+15
     */
    public function fineTune() { return $this-&gt;_m_fineTune; }
    public function type() { return $this-&gt;_m_type; }

    /**
     * (0-255)
     */
    public function panning() { return $this-&gt;_m_panning; }
    public function relativeNoteNumber() { return $this-&gt;_m_relativeNoteNumber; }
    public function reserved() { return $this-&gt;_m_reserved; }
    public function name() { return $this-&gt;_m_name; }
}

namespace \Xm\Instrument\SampleHeader;

class LoopType extends \Kaitai\Struct\Struct {
    public function __construct(\Kaitai\Struct\Stream $_io, \Xm\Instrument\SampleHeader $_parent = null, \Xm $_root = null) {
        parent::__construct($_io, $_parent, $_root);
        $this-&gt;_read();
    }

    private function _read() {
        $this-&gt;_m_reserved0 = $this-&gt;_io-&gt;readBitsInt(3);
        $this-&gt;_m_isSampleData16Bit = $this-&gt;_io-&gt;readBitsInt(1) != 0;
        $this-&gt;_m_reserved1 = $this-&gt;_io-&gt;readBitsInt(2);
        $this-&gt;_m_loopType = $this-&gt;_io-&gt;readBitsInt(2);
    }
    protected $_m_reserved0;
    protected $_m_isSampleData16Bit;
    protected $_m_reserved1;
    protected $_m_loopType;
    public function reserved0() { return $this-&gt;_m_reserved0; }
    public function isSampleData16Bit() { return $this-&gt;_m_isSampleData16Bit; }
    public function reserved1() { return $this-&gt;_m_reserved1; }
    public function loopType() { return $this-&gt;_m_loopType; }
}

namespace \Xm\Instrument\SampleHeader\LoopType;

class LoopType {
    const NONE = 0;
    const FORWARD = 1;
    const PING_PONG = 2;
}
</code></pre>
            
        </div>
        
    </div>
</section>

    <footer id="main-footer">
        <div class="container">
            &copy; 2015-2018 Kaitai Project and <a href="https://github.com/kaitai-io/kaitai_struct_formats/graphs/contributors">formats repo contributors</a>

            <h3>Contacts</h3>

            <div class="row">
                <div class="col-sm-4">
                    <i class="fa fa-fw fa-2x fa-github"></i> <a href="https://github.com/kaitai-io/kaitai_struct">GitHub</a>
                </div>
                <div class="col-sm-4">
                    <i class="fa fa-fw fa-2x fa-twitter"></i> <a href="https://twitter.com/kaitai_io">@kaitai_io</a>
                </div>
                <div class="col-sm-4">
                    Gitter: <a href="https://gitter.im/kaitai_struct/Lobby">kaitai_struct</a>
                </div>
            </div>
        </div>
    </footer>

  <script src="//kaitai.io/js/jquery-1.12.3.min.js"></script>
  <script src="//kaitai.io/js/bootstrap.min.js"></script>

  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-76299550-1', 'auto');
      ga('send', 'pageview');
  </script>
</body>
</html>
