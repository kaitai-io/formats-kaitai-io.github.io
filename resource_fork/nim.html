<!DOCTYPE html>
<html dir="ltr" lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Macintosh resource fork data: Nim parsing library</title>
  <meta name="keywords" content="kaitai,struct,binary,format,parsing,decoding,java,javascript,python,ruby,library,metadata">
  <meta name="description" content="Kaitai Struct is a formal language for binary format specification that can be compiled into parser code">

  <link rel="stylesheet" href="//kaitai.io/styles/bootstrap.min.css">
  <link rel="stylesheet" href="//kaitai.io/styles/bootstrap-theme.min.css">
  <link href='https://fonts.googleapis.com/css?family=Exo:400,700' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Share+Tech+Mono' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

  <link rel="stylesheet" href="//kaitai.io/styles/main.css" type="text/css">
  <link rel="stylesheet" href="/pygments-default.css" type="text/css">
  <style>
.diagram-img {
    display: block;
    max-width: 100%;
    height: auto;
    margin: 0 auto;
}

section.format {
    padding: 30px 0;
}

section#format-meta, section#format-index-header {
    background: #e3eef7;
}

section#format-diagram, section#format-index-footer {
    background: #e9f8dd;
}

section#format-ksy, section#format-lang {
    background: #d1eadd;
}

section#format-index .row {
    padding-bottom: 10px;
}

  </style>

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-MFSBBRGREL"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-MFSBBRGREL');
  </script>
</head>
<body data-spy="scroll" data-target="#main-navbar" data-offset="100">

    <nav class="navbar navbar-inverse navbar-fixed-top" id="main-navbar">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#main-navbar-collapse" aria-expanded="false">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <span class="navbar-brand">Kaitai Struct</span>
            </div>
            <div class="collapse navbar-collapse" id="main-navbar-collapse">
                <ul class="nav navbar-nav">
                    <li><a href="//kaitai.io/#what-is-it">What is it?</a></li>
                    <li><a href="//kaitai.io/#quick-start">Quick Start</a></li>
                    <li><a href="//kaitai.io/#download">Download</a></li>
                    <li class="active"><a href="//formats.kaitai.io/">Format Gallery</a></li>
                </ul>
                <ul class="nav navbar-nav navbar-right">
                    <li><a href="https://ide.kaitai.io/">Try it &mdash; Web IDE</a></li>
                    <li><a href="//doc.kaitai.io/">Documentation</a></li>
                </ul>
            </div>
        </div>
    </nav>
<nav>
    <div class="container">
    <ol class="breadcrumb">
        <li><a href="../">Format Gallery</a></li>
        <li>macOS-specific</li>
        <li class="active">Macintosh resource fork data</li>
    </ol>
    </div>
</nav>

<section id="format-meta" class="format">
    <div class="container">
        <h1>Macintosh resource fork data:
            
            Nim parsing library
            
        </h1>

        <div class="row">
            <div class="col-md-8">
                <p><p>The data format of Macintosh resource forks,
used on Classic Mac OS and Mac OS X/macOS to store additional structured data along with a file's main data (the data fork).
The kinds of data stored in resource forks include:</p>
<ul>
<li>Document resources:
images, sounds, etc. used by a document</li>
<li>Application resources:
graphics, GUI layouts, localizable strings,
and even code used by an application, a library, or system files</li>
<li>Common metadata:
custom icons and version metadata that could be displayed by the Finder</li>
<li>Application-specific metadata:
because resource forks follow a common format,
other applications can store new metadata in them,
even if the original application does not recognize or understand it</li>
</ul>
<p>Macintosh file systems (MFS, HFS, HFS+, APFS) support resource forks natively,
which allows storing resources along with any file.
Non-Macintosh file systems and protocols have little or no support for resource forks,
so the resource fork data must be stored in some other way when using such file systems or protocols.
Various file formats and tools exist for this purpose,
such as BinHex, MacBinary, AppleSingle, AppleDouble, or QuickTime RezWack.
In some cases,
resource forks are stored as plain data in separate files with a .rsrc extension,
even on Mac systems that natively support resource forks.</p>
<p>On modern Mac OS X/macOS systems,
resource forks are used far less commonly than on classic Mac OS systems,
because of compatibility issues with other systems and historical limitations in the format.
Modern macOS APIs and libraries do not use resource forks,
and the legacy Carbon API that still used them has been deprecated since OS X 10.8.
Despite this,
even current macOS systems still use resource forks for certain purposes,
such as custom file icons.</p>
</p>
            </div>
            <div class="col-md-4">
                <div class="panel panel-info">
                    
                    <div class="panel-heading">
                        <h3 class="panel-title">Application</h3>
                    </div>
                    <div class="panel-body">
                        Mac OS
                    </div>
                    
                    
                    <div class="panel-heading">
                        <h3 class="panel-title">File extension</h3>
                    </div>
                    <div class="panel-body">
                        ["rsrc", "dfont"]
                    </div>
                    
                    
                    <div class="panel-heading">
                        <h3 class="panel-title">KS implementation details</h3>
                    </div>
                    
                    <div class="panel-body">
                        License: <a href="https://spdx.org/licenses/MIT.html">MIT</a>
                    </div>
                    
                    
                    <div class="panel-body">
                        Minimal Kaitai Struct required: 0.9
                    </div>
                    
                    
                    
                    
                    <div class="panel-heading">
                        <h3 class="panel-title">References</h3>
                    </div>
                    <div class="panel-body">
                        <ul>
                            
                            
                            
                            
                            
                            
                            
                            
                            
                            <li><a href="https://www.wikidata.org/wiki/Q3933446">Wikidata Q3933446</a></li>
                            
                            
                            
                            <li><a href="http://fileformats.archiveteam.org/wiki/Resource_Fork">Resource Fork in Just Solve the File Format Problem</a></li>
                            
                        </ul>
                    </div>
                    
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
            <p>
            This page hosts a formal specification of Macintosh resource fork data
            using <a href="//kaitai.io">Kaitai Struct</a>. This
            specification can be automatically translated into a
            variety of programming languages to get a parsing library.
            </p>

            <ul class="nav nav-pills">
                
                
                <li>
                
                <a href="index.html" title="Macintosh resource fork data parsing Overview library">Overview</a></li>
                
                
                <li>
                
                <a href="cpp_stl_11.html" title="Macintosh resource fork data parsing C++11/STL library">C++11/STL</a></li>
                
                
                <li>
                
                <a href="cpp_stl_98.html" title="Macintosh resource fork data parsing C++98/STL library">C++98/STL</a></li>
                
                
                <li>
                
                <a href="csharp.html" title="Macintosh resource fork data parsing C# library">C#</a></li>
                
                
                <li>
                
                <a href="go.html" title="Macintosh resource fork data parsing Go library">Go</a></li>
                
                
                <li>
                
                <a href="graphviz.html" title="Macintosh resource fork data parsing GraphViz library">GraphViz</a></li>
                
                
                <li>
                
                <a href="java.html" title="Macintosh resource fork data parsing Java library">Java</a></li>
                
                
                <li>
                
                <a href="javascript.html" title="Macintosh resource fork data parsing JavaScript library">JavaScript</a></li>
                
                
                <li>
                
                <a href="lua.html" title="Macintosh resource fork data parsing Lua library">Lua</a></li>
                
                
                <li class="active">
                
                <a href="nim.html" title="Macintosh resource fork data parsing Nim library">Nim</a></li>
                
                
                <li>
                
                <a href="perl.html" title="Macintosh resource fork data parsing Perl library">Perl</a></li>
                
                
                <li>
                
                <a href="php.html" title="Macintosh resource fork data parsing PHP library">PHP</a></li>
                
                
                <li>
                
                <a href="python.html" title="Macintosh resource fork data parsing Python library">Python</a></li>
                
                
                <li>
                
                <a href="ruby.html" title="Macintosh resource fork data parsing Ruby library">Ruby</a></li>
                
            </ul>
            </div>
        </div>
    </div>
</section>


<section id="format-lang" class="format">
    <div class="container">
        <h2>
            
            Nim source code to parse Macintosh resource fork data
            
        </h2>

        

        <h3>resource_fork.nim</h3>

        <div class="row">
            <div class="pull-right">
                <p>
                    <a href="src/nim/resource_fork.nim" download="resource_fork.nim" class="btn btn-success">Download <i class="fa fa-download"></i></a>
                </p>
            </div>
        </div>

        <div class="row">
            <div class="highlight"><pre><span></span><span class="kn">import</span> <span class="n">kaitai_struct_nim_runtime</span>
<span class="kn">import</span> <span class="n">options</span>
<span class="kn">import</span> <span class="o">/</span><span class="n">common</span><span class="o">/</span><span class="n">bytes_with_io</span>

<span class="kn">import</span> <span class="s">&quot;bytes_with_io&quot;</span>
<span class="k">type</span>
  <span class="n">ResourceFork</span><span class="o">*</span> <span class="o">=</span> <span class="k">ref</span> <span class="k">object</span> <span class="k">of</span> <span class="n">KaitaiStruct</span>
    <span class="p">`</span><span class="n">header</span><span class="p">`</span><span class="o">*</span><span class="p">:</span> <span class="n">ResourceFork_FileHeader</span>
    <span class="p">`</span><span class="n">systemData</span><span class="p">`</span><span class="o">*</span><span class="p">:</span> <span class="kt">seq</span><span class="o">[</span><span class="n">byte</span><span class="o">]</span>
    <span class="p">`</span><span class="n">applicationData</span><span class="p">`</span><span class="o">*</span><span class="p">:</span> <span class="kt">seq</span><span class="o">[</span><span class="n">byte</span><span class="o">]</span>
    <span class="p">`</span><span class="n">parent</span><span class="p">`</span><span class="o">*</span><span class="p">:</span> <span class="n">KaitaiStruct</span>
    <span class="p">`</span><span class="n">rawDataBlocksWithIoInst</span><span class="p">`</span><span class="o">*</span><span class="p">:</span> <span class="kt">seq</span><span class="o">[</span><span class="n">byte</span><span class="o">]</span>
    <span class="p">`</span><span class="n">rawResourceMapInst</span><span class="p">`</span><span class="o">*</span><span class="p">:</span> <span class="kt">seq</span><span class="o">[</span><span class="n">byte</span><span class="o">]</span>
    <span class="p">`</span><span class="n">dataBlocksWithIoInst</span><span class="p">`:</span> <span class="n">BytesWithIo</span>
    <span class="p">`</span><span class="n">dataBlocksWithIoInstFlag</span><span class="p">`:</span> <span class="kt">bool</span>
    <span class="p">`</span><span class="n">dataBlocksInst</span><span class="p">`:</span> <span class="kt">seq</span><span class="o">[</span><span class="n">byte</span><span class="o">]</span>
    <span class="p">`</span><span class="n">dataBlocksInstFlag</span><span class="p">`:</span> <span class="kt">bool</span>
    <span class="p">`</span><span class="n">resourceMapInst</span><span class="p">`:</span> <span class="n">ResourceFork_ResourceMap</span>
    <span class="p">`</span><span class="n">resourceMapInstFlag</span><span class="p">`:</span> <span class="kt">bool</span>
  <span class="n">ResourceFork_FileHeader</span><span class="o">*</span> <span class="o">=</span> <span class="k">ref</span> <span class="k">object</span> <span class="k">of</span> <span class="n">KaitaiStruct</span>
    <span class="p">`</span><span class="n">ofsDataBlocks</span><span class="p">`</span><span class="o">*</span><span class="p">:</span> <span class="n">uint32</span>
    <span class="p">`</span><span class="n">ofsResourceMap</span><span class="p">`</span><span class="o">*</span><span class="p">:</span> <span class="n">uint32</span>
    <span class="p">`</span><span class="n">lenDataBlocks</span><span class="p">`</span><span class="o">*</span><span class="p">:</span> <span class="n">uint32</span>
    <span class="p">`</span><span class="n">lenResourceMap</span><span class="p">`</span><span class="o">*</span><span class="p">:</span> <span class="n">uint32</span>
    <span class="p">`</span><span class="n">parent</span><span class="p">`</span><span class="o">*</span><span class="p">:</span> <span class="n">KaitaiStruct</span>
  <span class="n">ResourceFork_DataBlock</span><span class="o">*</span> <span class="o">=</span> <span class="k">ref</span> <span class="k">object</span> <span class="k">of</span> <span class="n">KaitaiStruct</span>
    <span class="p">`</span><span class="n">lenData</span><span class="p">`</span><span class="o">*</span><span class="p">:</span> <span class="n">uint32</span>
    <span class="p">`</span><span class="n">data</span><span class="p">`</span><span class="o">*</span><span class="p">:</span> <span class="kt">seq</span><span class="o">[</span><span class="n">byte</span><span class="o">]</span>
    <span class="p">`</span><span class="n">parent</span><span class="p">`</span><span class="o">*</span><span class="p">:</span> <span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference</span>
  <span class="n">ResourceFork_ResourceMap</span><span class="o">*</span> <span class="o">=</span> <span class="k">ref</span> <span class="k">object</span> <span class="k">of</span> <span class="n">KaitaiStruct</span>
    <span class="p">`</span><span class="n">reservedFileHeaderCopy</span><span class="p">`</span><span class="o">*</span><span class="p">:</span> <span class="n">ResourceFork_FileHeader</span>
    <span class="p">`</span><span class="n">reservedNextResourceMapHandle</span><span class="p">`</span><span class="o">*</span><span class="p">:</span> <span class="n">uint32</span>
    <span class="p">`</span><span class="n">reservedFileReferenceNumber</span><span class="p">`</span><span class="o">*</span><span class="p">:</span> <span class="n">uint16</span>
    <span class="p">`</span><span class="n">fileAttributes</span><span class="p">`</span><span class="o">*</span><span class="p">:</span> <span class="n">ResourceFork_ResourceMap_FileAttributes</span>
    <span class="p">`</span><span class="n">ofsTypeList</span><span class="p">`</span><span class="o">*</span><span class="p">:</span> <span class="n">uint16</span>
    <span class="p">`</span><span class="n">ofsNames</span><span class="p">`</span><span class="o">*</span><span class="p">:</span> <span class="n">uint16</span>
    <span class="p">`</span><span class="n">parent</span><span class="p">`</span><span class="o">*</span><span class="p">:</span> <span class="n">ResourceFork</span>
    <span class="p">`</span><span class="n">rawFileAttributes</span><span class="p">`</span><span class="o">*</span><span class="p">:</span> <span class="kt">seq</span><span class="o">[</span><span class="n">byte</span><span class="o">]</span>
    <span class="p">`</span><span class="n">rawTypeListAndReferenceListsInst</span><span class="p">`</span><span class="o">*</span><span class="p">:</span> <span class="kt">seq</span><span class="o">[</span><span class="n">byte</span><span class="o">]</span>
    <span class="p">`</span><span class="n">rawNamesWithIoInst</span><span class="p">`</span><span class="o">*</span><span class="p">:</span> <span class="kt">seq</span><span class="o">[</span><span class="n">byte</span><span class="o">]</span>
    <span class="p">`</span><span class="n">typeListAndReferenceListsInst</span><span class="p">`:</span> <span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists</span>
    <span class="p">`</span><span class="n">typeListAndReferenceListsInstFlag</span><span class="p">`:</span> <span class="kt">bool</span>
    <span class="p">`</span><span class="n">namesWithIoInst</span><span class="p">`:</span> <span class="n">BytesWithIo</span>
    <span class="p">`</span><span class="n">namesWithIoInstFlag</span><span class="p">`:</span> <span class="kt">bool</span>
    <span class="p">`</span><span class="n">namesInst</span><span class="p">`:</span> <span class="kt">seq</span><span class="o">[</span><span class="n">byte</span><span class="o">]</span>
    <span class="p">`</span><span class="n">namesInstFlag</span><span class="p">`:</span> <span class="kt">bool</span>
  <span class="n">ResourceFork_ResourceMap_FileAttributes</span><span class="o">*</span> <span class="o">=</span> <span class="k">ref</span> <span class="k">object</span> <span class="k">of</span> <span class="n">KaitaiStruct</span>
    <span class="p">`</span><span class="n">resourcesLocked</span><span class="p">`</span><span class="o">*</span><span class="p">:</span> <span class="kt">bool</span>
    <span class="p">`</span><span class="n">reserved0</span><span class="p">`</span><span class="o">*</span><span class="p">:</span> <span class="n">uint64</span>
    <span class="p">`</span><span class="n">printerDriverMultifinderCompatible</span><span class="p">`</span><span class="o">*</span><span class="p">:</span> <span class="kt">bool</span>
    <span class="p">`</span><span class="n">noWriteChanges</span><span class="p">`</span><span class="o">*</span><span class="p">:</span> <span class="kt">bool</span>
    <span class="p">`</span><span class="n">needsCompact</span><span class="p">`</span><span class="o">*</span><span class="p">:</span> <span class="kt">bool</span>
    <span class="p">`</span><span class="n">mapNeedsWrite</span><span class="p">`</span><span class="o">*</span><span class="p">:</span> <span class="kt">bool</span>
    <span class="p">`</span><span class="n">reserved1</span><span class="p">`</span><span class="o">*</span><span class="p">:</span> <span class="n">uint64</span>
    <span class="p">`</span><span class="n">parent</span><span class="p">`</span><span class="o">*</span><span class="p">:</span> <span class="n">ResourceFork_ResourceMap</span>
    <span class="p">`</span><span class="n">asIntInst</span><span class="p">`:</span> <span class="n">uint16</span>
    <span class="p">`</span><span class="n">asIntInstFlag</span><span class="p">`:</span> <span class="kt">bool</span>
  <span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists</span><span class="o">*</span> <span class="o">=</span> <span class="k">ref</span> <span class="k">object</span> <span class="k">of</span> <span class="n">KaitaiStruct</span>
    <span class="p">`</span><span class="n">typeList</span><span class="p">`</span><span class="o">*</span><span class="p">:</span> <span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_TypeList</span>
    <span class="p">`</span><span class="n">referenceLists</span><span class="p">`</span><span class="o">*</span><span class="p">:</span> <span class="kt">seq</span><span class="o">[</span><span class="n">byte</span><span class="o">]</span>
    <span class="p">`</span><span class="n">parent</span><span class="p">`</span><span class="o">*</span><span class="p">:</span> <span class="n">ResourceFork_ResourceMap</span>
  <span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_TypeList</span><span class="o">*</span> <span class="o">=</span> <span class="k">ref</span> <span class="k">object</span> <span class="k">of</span> <span class="n">KaitaiStruct</span>
    <span class="p">`</span><span class="n">numTypesM1</span><span class="p">`</span><span class="o">*</span><span class="p">:</span> <span class="n">uint16</span>
    <span class="p">`</span><span class="n">entries</span><span class="p">`</span><span class="o">*</span><span class="p">:</span> <span class="kt">seq</span><span class="o">[</span><span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_TypeList_TypeListEntry</span><span class="o">]</span>
    <span class="p">`</span><span class="n">parent</span><span class="p">`</span><span class="o">*</span><span class="p">:</span> <span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists</span>
    <span class="p">`</span><span class="n">numTypesInst</span><span class="p">`:</span> <span class="kt">int</span>
    <span class="p">`</span><span class="n">numTypesInstFlag</span><span class="p">`:</span> <span class="kt">bool</span>
  <span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_TypeList_TypeListEntry</span><span class="o">*</span> <span class="o">=</span> <span class="k">ref</span> <span class="k">object</span> <span class="k">of</span> <span class="n">KaitaiStruct</span>
    <span class="p">`</span><span class="k">type</span><span class="p">`</span><span class="o">*</span><span class="p">:</span> <span class="kt">seq</span><span class="o">[</span><span class="n">byte</span><span class="o">]</span>
    <span class="p">`</span><span class="n">numReferencesM1</span><span class="p">`</span><span class="o">*</span><span class="p">:</span> <span class="n">uint16</span>
    <span class="p">`</span><span class="n">ofsReferenceList</span><span class="p">`</span><span class="o">*</span><span class="p">:</span> <span class="n">uint16</span>
    <span class="p">`</span><span class="n">parent</span><span class="p">`</span><span class="o">*</span><span class="p">:</span> <span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_TypeList</span>
    <span class="p">`</span><span class="n">numReferencesInst</span><span class="p">`:</span> <span class="kt">int</span>
    <span class="p">`</span><span class="n">numReferencesInstFlag</span><span class="p">`:</span> <span class="kt">bool</span>
    <span class="p">`</span><span class="n">referenceListInst</span><span class="p">`:</span> <span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList</span>
    <span class="p">`</span><span class="n">referenceListInstFlag</span><span class="p">`:</span> <span class="kt">bool</span>
  <span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList</span><span class="o">*</span> <span class="o">=</span> <span class="k">ref</span> <span class="k">object</span> <span class="k">of</span> <span class="n">KaitaiStruct</span>
    <span class="p">`</span><span class="n">references</span><span class="p">`</span><span class="o">*</span><span class="p">:</span> <span class="kt">seq</span><span class="o">[</span><span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference</span><span class="o">]</span>
    <span class="p">`</span><span class="n">numReferences</span><span class="p">`</span><span class="o">*</span><span class="p">:</span> <span class="n">uint16</span>
    <span class="p">`</span><span class="n">parent</span><span class="p">`</span><span class="o">*</span><span class="p">:</span> <span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_TypeList_TypeListEntry</span>
  <span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference</span><span class="o">*</span> <span class="o">=</span> <span class="k">ref</span> <span class="k">object</span> <span class="k">of</span> <span class="n">KaitaiStruct</span>
    <span class="p">`</span><span class="n">id</span><span class="p">`</span><span class="o">*</span><span class="p">:</span> <span class="kt">int16</span>
    <span class="p">`</span><span class="n">ofsName</span><span class="p">`</span><span class="o">*</span><span class="p">:</span> <span class="n">uint16</span>
    <span class="p">`</span><span class="n">attributes</span><span class="p">`</span><span class="o">*</span><span class="p">:</span> <span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference_Attributes</span>
    <span class="p">`</span><span class="n">ofsDataBlock</span><span class="p">`</span><span class="o">*</span><span class="p">:</span> <span class="n">uint64</span>
    <span class="p">`</span><span class="n">reservedHandle</span><span class="p">`</span><span class="o">*</span><span class="p">:</span> <span class="n">uint32</span>
    <span class="p">`</span><span class="n">parent</span><span class="p">`</span><span class="o">*</span><span class="p">:</span> <span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList</span>
    <span class="p">`</span><span class="n">rawAttributes</span><span class="p">`</span><span class="o">*</span><span class="p">:</span> <span class="kt">seq</span><span class="o">[</span><span class="n">byte</span><span class="o">]</span>
    <span class="p">`</span><span class="n">nameInst</span><span class="p">`:</span> <span class="n">ResourceFork_ResourceMap_Name</span>
    <span class="p">`</span><span class="n">nameInstFlag</span><span class="p">`:</span> <span class="kt">bool</span>
    <span class="p">`</span><span class="n">dataBlockInst</span><span class="p">`:</span> <span class="n">ResourceFork_DataBlock</span>
    <span class="p">`</span><span class="n">dataBlockInstFlag</span><span class="p">`:</span> <span class="kt">bool</span>
  <span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference_Attributes</span><span class="o">*</span> <span class="o">=</span> <span class="k">ref</span> <span class="k">object</span> <span class="k">of</span> <span class="n">KaitaiStruct</span>
    <span class="p">`</span><span class="n">systemReference</span><span class="p">`</span><span class="o">*</span><span class="p">:</span> <span class="kt">bool</span>
    <span class="p">`</span><span class="n">loadIntoSystemHeap</span><span class="p">`</span><span class="o">*</span><span class="p">:</span> <span class="kt">bool</span>
    <span class="p">`</span><span class="n">purgeable</span><span class="p">`</span><span class="o">*</span><span class="p">:</span> <span class="kt">bool</span>
    <span class="p">`</span><span class="n">locked</span><span class="p">`</span><span class="o">*</span><span class="p">:</span> <span class="kt">bool</span>
    <span class="p">`</span><span class="n">protected</span><span class="p">`</span><span class="o">*</span><span class="p">:</span> <span class="kt">bool</span>
    <span class="p">`</span><span class="n">preload</span><span class="p">`</span><span class="o">*</span><span class="p">:</span> <span class="kt">bool</span>
    <span class="p">`</span><span class="n">needsWrite</span><span class="p">`</span><span class="o">*</span><span class="p">:</span> <span class="kt">bool</span>
    <span class="p">`</span><span class="n">compressed</span><span class="p">`</span><span class="o">*</span><span class="p">:</span> <span class="kt">bool</span>
    <span class="p">`</span><span class="n">parent</span><span class="p">`</span><span class="o">*</span><span class="p">:</span> <span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference</span>
    <span class="p">`</span><span class="n">asIntInst</span><span class="p">`:</span> <span class="n">uint8</span>
    <span class="p">`</span><span class="n">asIntInstFlag</span><span class="p">`:</span> <span class="kt">bool</span>
  <span class="n">ResourceFork_ResourceMap_Name</span><span class="o">*</span> <span class="o">=</span> <span class="k">ref</span> <span class="k">object</span> <span class="k">of</span> <span class="n">KaitaiStruct</span>
    <span class="p">`</span><span class="n">lenValue</span><span class="p">`</span><span class="o">*</span><span class="p">:</span> <span class="n">uint8</span>
    <span class="p">`</span><span class="n">value</span><span class="p">`</span><span class="o">*</span><span class="p">:</span> <span class="kt">seq</span><span class="o">[</span><span class="n">byte</span><span class="o">]</span>
    <span class="p">`</span><span class="n">parent</span><span class="p">`</span><span class="o">*</span><span class="p">:</span> <span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference</span>

<span class="k">proc </span><span class="nf">read</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork], io: KaitaiStream, root: KaitaiStruct, parent: KaitaiStruct): ResourceFork</span>
<span class="k">proc </span><span class="nf">read</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork_FileHeader], io: KaitaiStream, root: KaitaiStruct, parent: KaitaiStruct): ResourceFork_FileHeader</span>
<span class="k">proc </span><span class="nf">read</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork_DataBlock], io: KaitaiStream, root: KaitaiStruct, parent: ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference): ResourceFork_DataBlock</span>
<span class="k">proc </span><span class="nf">read</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork_ResourceMap], io: KaitaiStream, root: KaitaiStruct, parent: ResourceFork): ResourceFork_ResourceMap</span>
<span class="k">proc </span><span class="nf">read</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork_ResourceMap_FileAttributes], io: KaitaiStream, root: KaitaiStruct, parent: ResourceFork_ResourceMap): ResourceFork_ResourceMap_FileAttributes</span>
<span class="k">proc </span><span class="nf">read</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork_ResourceMap_TypeListAndReferenceLists], io: KaitaiStream, root: KaitaiStruct, parent: ResourceFork_ResourceMap): ResourceFork_ResourceMap_TypeListAndReferenceLists</span>
<span class="k">proc </span><span class="nf">read</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork_ResourceMap_TypeListAndReferenceLists_TypeList], io: KaitaiStream, root: KaitaiStruct, parent: ResourceFork_ResourceMap_TypeListAndReferenceLists): ResourceFork_ResourceMap_TypeListAndReferenceLists_TypeList</span>
<span class="k">proc </span><span class="nf">read</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork_ResourceMap_TypeListAndReferenceLists_TypeList_TypeListEntry], io: KaitaiStream, root: KaitaiStruct, parent: ResourceFork_ResourceMap_TypeListAndReferenceLists_TypeList): ResourceFork_ResourceMap_TypeListAndReferenceLists_TypeList_TypeListEntry</span>
<span class="k">proc </span><span class="nf">read</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList], io: KaitaiStream, root: KaitaiStruct, parent: ResourceFork_ResourceMap_TypeListAndReferenceLists_TypeList_TypeListEntry, numReferences: any): ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList</span>
<span class="k">proc </span><span class="nf">read</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference], io: KaitaiStream, root: KaitaiStruct, parent: ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList): ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference</span>
<span class="k">proc </span><span class="nf">read</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference_Attributes], io: KaitaiStream, root: KaitaiStruct, parent: ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference): ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference_Attributes</span>
<span class="k">proc </span><span class="nf">read</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork_ResourceMap_Name], io: KaitaiStream, root: KaitaiStruct, parent: ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference): ResourceFork_ResourceMap_Name</span>

<span class="k">proc </span><span class="nf">dataBlocksWithIo</span><span class="o">*</span><span class="p">(</span><span class="n">this</span><span class="p">:</span> <span class="n">ResourceFork</span><span class="p">):</span> <span class="n">BytesWithIo</span>
<span class="k">proc </span><span class="nf">dataBlocks</span><span class="o">*</span><span class="p">(</span><span class="n">this</span><span class="p">:</span> <span class="n">ResourceFork</span><span class="p">):</span> <span class="kt">seq</span><span class="o">[</span><span class="n">byte</span><span class="o">]</span>
<span class="k">proc </span><span class="nf">resourceMap</span><span class="o">*</span><span class="p">(</span><span class="n">this</span><span class="p">:</span> <span class="n">ResourceFork</span><span class="p">):</span> <span class="n">ResourceFork_ResourceMap</span>
<span class="k">proc </span><span class="nf">typeListAndReferenceLists</span><span class="o">*</span><span class="p">(</span><span class="n">this</span><span class="p">:</span> <span class="n">ResourceFork_ResourceMap</span><span class="p">):</span> <span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists</span>
<span class="k">proc </span><span class="nf">namesWithIo</span><span class="o">*</span><span class="p">(</span><span class="n">this</span><span class="p">:</span> <span class="n">ResourceFork_ResourceMap</span><span class="p">):</span> <span class="n">BytesWithIo</span>
<span class="k">proc </span><span class="nf">names</span><span class="o">*</span><span class="p">(</span><span class="n">this</span><span class="p">:</span> <span class="n">ResourceFork_ResourceMap</span><span class="p">):</span> <span class="kt">seq</span><span class="o">[</span><span class="n">byte</span><span class="o">]</span>
<span class="k">proc </span><span class="nf">asInt</span><span class="o">*</span><span class="p">(</span><span class="n">this</span><span class="p">:</span> <span class="n">ResourceFork_ResourceMap_FileAttributes</span><span class="p">):</span> <span class="n">uint16</span>
<span class="k">proc </span><span class="nf">numTypes</span><span class="o">*</span><span class="p">(</span><span class="n">this</span><span class="p">:</span> <span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_TypeList</span><span class="p">):</span> <span class="kt">int</span>
<span class="k">proc </span><span class="nf">numReferences</span><span class="o">*</span><span class="p">(</span><span class="n">this</span><span class="p">:</span> <span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_TypeList_TypeListEntry</span><span class="p">):</span> <span class="kt">int</span>
<span class="k">proc </span><span class="nf">referenceList</span><span class="o">*</span><span class="p">(</span><span class="n">this</span><span class="p">:</span> <span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_TypeList_TypeListEntry</span><span class="p">):</span> <span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList</span>
<span class="k">proc </span><span class="nf">name</span><span class="o">*</span><span class="p">(</span><span class="n">this</span><span class="p">:</span> <span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference</span><span class="p">):</span> <span class="n">ResourceFork_ResourceMap_Name</span>
<span class="k">proc </span><span class="nf">dataBlock</span><span class="o">*</span><span class="p">(</span><span class="n">this</span><span class="p">:</span> <span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference</span><span class="p">):</span> <span class="n">ResourceFork_DataBlock</span>
<span class="k">proc </span><span class="nf">asInt</span><span class="o">*</span><span class="p">(</span><span class="n">this</span><span class="p">:</span> <span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference_Attributes</span><span class="p">):</span> <span class="n">uint8</span>


<span class="sd">##[</span>
<span class="n">The</span> <span class="n">data</span> <span class="n">format</span> <span class="k">of</span> <span class="n">Macintosh</span> <span class="n">resource</span> <span class="n">forks</span><span class="p">,</span>
<span class="n">used</span> <span class="n">on</span> <span class="n">Classic</span> <span class="n">Mac</span> <span class="n">OS</span> <span class="ow">and</span> <span class="n">Mac</span> <span class="n">OS</span> <span class="n">X</span><span class="o">/</span><span class="n">macOS</span> <span class="n">to</span> <span class="n">store</span> <span class="n">additional</span> <span class="n">structured</span> <span class="n">data</span> <span class="n">along</span> <span class="n">with</span> <span class="n">a</span> <span class="n">file</span><span class="sc">&#39;s main data (the data fork).</span>
<span class="n">The</span> <span class="n">kinds</span> <span class="k">of</span> <span class="n">data</span> <span class="n">stored</span> <span class="ow">in</span> <span class="n">resource</span> <span class="n">forks</span> <span class="kn">include</span><span class="p">:</span>

<span class="o">*</span> <span class="n">Document</span> <span class="n">resources</span><span class="p">:</span>
  <span class="n">images</span><span class="p">,</span> <span class="n">sounds</span><span class="p">,</span> <span class="n">etc</span><span class="p">.</span> <span class="n">used</span> <span class="n">by</span> <span class="n">a</span> <span class="n">document</span>
<span class="o">*</span> <span class="n">Application</span> <span class="n">resources</span><span class="p">:</span>
  <span class="n">graphics</span><span class="p">,</span> <span class="n">GUI</span> <span class="n">layouts</span><span class="p">,</span> <span class="n">localizable</span> <span class="n">strings</span><span class="p">,</span>
  <span class="ow">and</span> <span class="n">even</span> <span class="n">code</span> <span class="n">used</span> <span class="n">by</span> <span class="n">an</span> <span class="n">application</span><span class="p">,</span> <span class="n">a</span> <span class="n">library</span><span class="p">,</span> <span class="ow">or</span> <span class="n">system</span> <span class="n">files</span>
<span class="o">*</span> <span class="n">Common</span> <span class="n">metadata</span><span class="p">:</span>
  <span class="n">custom</span> <span class="n">icons</span> <span class="ow">and</span> <span class="n">version</span> <span class="n">metadata</span> <span class="n">that</span> <span class="n">could</span> <span class="n">be</span> <span class="n">displayed</span> <span class="n">by</span> <span class="n">the</span> <span class="n">Finder</span>
<span class="o">*</span> <span class="n">Application</span><span class="o">-</span><span class="n">specific</span> <span class="n">metadata</span><span class="p">:</span>
  <span class="n">because</span> <span class="n">resource</span> <span class="n">forks</span> <span class="n">follow</span> <span class="n">a</span> <span class="n">common</span> <span class="n">format</span><span class="p">,</span>
  <span class="n">other</span> <span class="n">applications</span> <span class="n">can</span> <span class="n">store</span> <span class="n">new</span> <span class="n">metadata</span> <span class="ow">in</span> <span class="n">them</span><span class="p">,</span>
  <span class="n">even</span> <span class="k">if</span> <span class="n">the</span> <span class="n">original</span> <span class="n">application</span> <span class="n">does</span> <span class="ow">not</span> <span class="n">recognize</span> <span class="ow">or</span> <span class="n">understand</span> <span class="n">it</span>

<span class="n">Macintosh</span> <span class="n">file</span> <span class="n">systems</span> <span class="p">(</span><span class="n">MFS</span><span class="p">,</span> <span class="n">HFS</span><span class="p">,</span> <span class="n">HFS</span><span class="o">+</span><span class="p">,</span> <span class="n">APFS</span><span class="p">)</span> <span class="n">support</span> <span class="n">resource</span> <span class="n">forks</span> <span class="n">natively</span><span class="p">,</span>
<span class="n">which</span> <span class="n">allows</span> <span class="n">storing</span> <span class="n">resources</span> <span class="n">along</span> <span class="n">with</span> <span class="n">any</span> <span class="n">file</span><span class="p">.</span>
<span class="n">Non</span><span class="o">-</span><span class="n">Macintosh</span> <span class="n">file</span> <span class="n">systems</span> <span class="ow">and</span> <span class="n">protocols</span> <span class="n">have</span> <span class="n">little</span> <span class="ow">or</span> <span class="n">no</span> <span class="n">support</span> <span class="k">for</span> <span class="n">resource</span> <span class="n">forks</span><span class="p">,</span>
<span class="n">so</span> <span class="n">the</span> <span class="n">resource</span> <span class="n">fork</span> <span class="n">data</span> <span class="n">must</span> <span class="n">be</span> <span class="n">stored</span> <span class="ow">in</span> <span class="n">some</span> <span class="n">other</span> <span class="n">way</span> <span class="k">when</span> <span class="k">using</span> <span class="n">such</span> <span class="n">file</span> <span class="n">systems</span> <span class="ow">or</span> <span class="n">protocols</span><span class="p">.</span>
<span class="n">Various</span> <span class="n">file</span> <span class="n">formats</span> <span class="ow">and</span> <span class="n">tools</span> <span class="n">exist</span> <span class="k">for</span> <span class="n">this</span> <span class="n">purpose</span><span class="p">,</span>
<span class="n">such</span> <span class="k">as</span> <span class="n">BinHex</span><span class="p">,</span> <span class="n">MacBinary</span><span class="p">,</span> <span class="n">AppleSingle</span><span class="p">,</span> <span class="n">AppleDouble</span><span class="p">,</span> <span class="ow">or</span> <span class="n">QuickTime</span> <span class="n">RezWack</span><span class="p">.</span>
<span class="ow">In</span> <span class="n">some</span> <span class="n">cases</span><span class="p">,</span>
<span class="n">resource</span> <span class="n">forks</span> <span class="n">are</span> <span class="n">stored</span> <span class="k">as</span> <span class="n">plain</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">separate</span> <span class="n">files</span> <span class="n">with</span> <span class="n">a</span> <span class="p">.</span><span class="n">rsrc</span> <span class="n">extension</span><span class="p">,</span>
<span class="n">even</span> <span class="n">on</span> <span class="n">Mac</span> <span class="n">systems</span> <span class="n">that</span> <span class="n">natively</span> <span class="n">support</span> <span class="n">resource</span> <span class="n">forks</span><span class="p">.</span>

<span class="n">On</span> <span class="n">modern</span> <span class="n">Mac</span> <span class="n">OS</span> <span class="n">X</span><span class="o">/</span><span class="n">macOS</span> <span class="n">systems</span><span class="p">,</span>
<span class="n">resource</span> <span class="n">forks</span> <span class="n">are</span> <span class="n">used</span> <span class="n">far</span> <span class="n">less</span> <span class="n">commonly</span> <span class="n">than</span> <span class="n">on</span> <span class="n">classic</span> <span class="n">Mac</span> <span class="n">OS</span> <span class="n">systems</span><span class="p">,</span>
<span class="n">because</span> <span class="k">of</span> <span class="n">compatibility</span> <span class="n">issues</span> <span class="n">with</span> <span class="n">other</span> <span class="n">systems</span> <span class="ow">and</span> <span class="n">historical</span> <span class="n">limitations</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">format</span><span class="p">.</span>
<span class="n">Modern</span> <span class="n">macOS</span> <span class="n">APIs</span> <span class="ow">and</span> <span class="n">libraries</span> <span class="k">do</span> <span class="ow">not</span> <span class="n">use</span> <span class="n">resource</span> <span class="n">forks</span><span class="p">,</span>
<span class="ow">and</span> <span class="n">the</span> <span class="n">legacy</span> <span class="n">Carbon</span> <span class="n">API</span> <span class="n">that</span> <span class="n">still</span> <span class="n">used</span> <span class="n">them</span> <span class="n">has</span> <span class="n">been</span> <span class="n">deprecated</span> <span class="n">since</span> <span class="n">OS</span> <span class="n">X</span> <span class="mf">10.8.</span>
<span class="n">Despite</span> <span class="n">this</span><span class="p">,</span>
<span class="n">even</span> <span class="n">current</span> <span class="n">macOS</span> <span class="n">systems</span> <span class="n">still</span> <span class="n">use</span> <span class="n">resource</span> <span class="n">forks</span> <span class="k">for</span> <span class="n">certain</span> <span class="n">purposes</span><span class="p">,</span>
<span class="n">such</span> <span class="k">as</span> <span class="n">custom</span> <span class="n">file</span> <span class="n">icons</span><span class="p">.</span>

<span class="o">@</span><span class="n">see</span> <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s">&quot;https://developer.apple.com/library/archive/documentation/mac/pdf/MoreMacintoshToolbox.pdf#page=151&quot;</span><span class="o">&gt;</span><span class="n">Inside</span> <span class="n">Macintosh</span><span class="p">,</span> <span class="n">More</span> <span class="n">Macintosh</span> <span class="n">Toolbox</span><span class="p">,</span> <span class="n">Resource</span> <span class="n">Manager</span><span class="p">,</span> <span class="n">Resource</span> <span class="n">Manager</span> <span class="n">Reference</span><span class="p">,</span> <span class="n">Resource</span> <span class="n">File</span> <span class="n">Format</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
<span class="o">@</span><span class="n">see</span> <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s">&quot;https://www.pagetable.com/?p=50&quot;</span><span class="o">&gt;</span><span class="n">Inside</span> <span class="n">Macintosh</span><span class="p">,</span> <span class="n">Volume</span> <span class="n">I</span><span class="p">,</span> <span class="n">The</span> <span class="n">Resource</span> <span class="n">Manager</span><span class="p">,</span> <span class="n">Format</span> <span class="k">of</span> <span class="n">a</span> <span class="n">Resource</span> <span class="n">File</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
<span class="o">@</span><span class="n">see</span> <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s">&quot;https://github.com/kreativekorp/ksfl/wiki/Macintosh-Resource-File-Format&quot;</span><span class="o">&gt;</span><span class="n">Source</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
<span class="o">@</span><span class="n">see</span> <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s">&quot;https://github.com/dgelessus/mac_file_format_docs/blob/master/README.md#resource-forks&quot;</span><span class="o">&gt;</span><span class="n">Source</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
<span class="o">]</span><span class="sd">##</span>
<span class="k">proc </span><span class="nf">read</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork], io: KaitaiStream, root: KaitaiStruct, parent: KaitaiStruct): ResourceFork =</span>
  <span class="k">template</span> <span class="n">this</span><span class="p">:</span> <span class="n">untyped</span> <span class="o">=</span> <span class="n">result</span>
  <span class="n">this</span> <span class="o">=</span> <span class="n">new</span><span class="p">(</span><span class="n">ResourceFork</span><span class="p">)</span>
  <span class="k">let</span> <span class="n">root</span> <span class="o">=</span> <span class="k">if</span> <span class="n">root</span> <span class="o">==</span> <span class="kp">nil</span><span class="p">:</span> <span class="k">cast</span><span class="o">[</span><span class="n">ResourceFork</span><span class="o">]</span><span class="p">(</span><span class="n">this</span><span class="p">)</span> <span class="k">else</span><span class="p">:</span> <span class="k">cast</span><span class="o">[</span><span class="n">ResourceFork</span><span class="o">]</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
  <span class="n">this</span><span class="p">.</span><span class="n">io</span> <span class="o">=</span> <span class="n">io</span>
  <span class="n">this</span><span class="p">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">root</span>
  <span class="n">this</span><span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>


  <span class="sd">##[</span>
  <span class="n">The</span> <span class="n">resource</span> <span class="n">file</span><span class="sc">&#39;s header information.</span>
  <span class="o">]</span><span class="sd">##</span>
  <span class="k">let</span> <span class="n">headerExpr</span> <span class="o">=</span> <span class="n">ResourceFork_FileHeader</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">,</span> <span class="n">this</span><span class="p">.</span><span class="n">root</span><span class="p">,</span> <span class="n">this</span><span class="p">)</span>
  <span class="n">this</span><span class="p">.</span><span class="n">header</span> <span class="o">=</span> <span class="n">headerExpr</span>

  <span class="sd">##[</span>
  <span class="n">System</span><span class="o">-</span><span class="n">reserved</span> <span class="n">data</span> <span class="n">area</span><span class="p">.</span>
<span class="n">This</span> <span class="n">field</span> <span class="n">can</span> <span class="n">generally</span> <span class="n">be</span> <span class="n">ignored</span> <span class="k">when</span> <span class="n">reading</span> <span class="ow">and</span> <span class="n">writing</span><span class="p">.</span>

<span class="n">This</span> <span class="n">field</span> <span class="ow">is</span> <span class="n">used</span> <span class="n">by</span> <span class="n">the</span> <span class="n">Classic</span> <span class="n">Mac</span> <span class="n">OS</span> <span class="n">Finder</span> <span class="k">as</span> <span class="n">temporary</span> <span class="n">storage</span> <span class="n">space</span><span class="p">.</span>
<span class="n">It</span> <span class="n">usually</span> <span class="n">contains</span> <span class="n">parts</span> <span class="k">of</span> <span class="n">the</span> <span class="n">file</span> <span class="n">metadata</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="k">type</span><span class="o">/</span><span class="n">creator</span> <span class="n">code</span><span class="p">,</span> <span class="n">etc</span><span class="p">.).</span>
<span class="n">Any</span> <span class="n">existing</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">this</span> <span class="n">field</span> <span class="ow">is</span> <span class="n">ignored</span> <span class="ow">and</span> <span class="n">overwritten</span><span class="p">.</span>

<span class="ow">In</span> <span class="n">resource</span> <span class="n">files</span> <span class="n">written</span> <span class="n">by</span> <span class="n">Mac</span> <span class="n">OS</span> <span class="n">X</span><span class="p">,</span>
<span class="n">this</span> <span class="n">field</span> <span class="ow">is</span> <span class="kt">set</span> <span class="n">to</span> <span class="n">all</span> <span class="n">zero</span> <span class="n">bytes</span><span class="p">.</span>

  <span class="o">]</span><span class="sd">##</span>
  <span class="k">let</span> <span class="n">systemDataExpr</span> <span class="o">=</span> <span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readBytes</span><span class="p">(</span><span class="kt">int</span><span class="p">(</span><span class="mi">112</span><span class="p">))</span>
  <span class="n">this</span><span class="p">.</span><span class="n">systemData</span> <span class="o">=</span> <span class="n">systemDataExpr</span>

  <span class="sd">##[</span>
  <span class="n">Application</span><span class="o">-</span><span class="n">specific</span> <span class="n">data</span> <span class="n">area</span><span class="p">.</span>
<span class="n">This</span> <span class="n">field</span> <span class="n">can</span> <span class="n">generally</span> <span class="n">be</span> <span class="n">ignored</span> <span class="k">when</span> <span class="n">reading</span> <span class="ow">and</span> <span class="n">writing</span><span class="p">.</span>

<span class="n">According</span> <span class="n">to</span> <span class="n">early</span> <span class="n">revisions</span> <span class="k">of</span> <span class="n">Inside</span> <span class="n">Macintosh</span><span class="p">,</span>
<span class="n">this</span> <span class="n">field</span> <span class="ow">is</span> <span class="s">&quot;available for application data&quot;</span><span class="p">.</span>
<span class="ow">In</span> <span class="n">practice</span><span class="p">,</span> <span class="n">it</span> <span class="ow">is</span> <span class="n">almost</span> <span class="n">never</span> <span class="n">used</span> <span class="k">for</span> <span class="n">this</span> <span class="n">purpose</span><span class="p">,</span>
<span class="ow">and</span> <span class="n">usually</span> <span class="n">contains</span> <span class="n">only</span> <span class="n">junk</span> <span class="n">data</span><span class="p">.</span>

<span class="ow">In</span> <span class="n">resource</span> <span class="n">files</span> <span class="n">written</span> <span class="n">by</span> <span class="n">Mac</span> <span class="n">OS</span> <span class="n">X</span><span class="p">,</span>
<span class="n">this</span> <span class="n">field</span> <span class="ow">is</span> <span class="kt">set</span> <span class="n">to</span> <span class="n">all</span> <span class="n">zero</span> <span class="n">bytes</span><span class="p">.</span>

  <span class="o">]</span><span class="sd">##</span>
  <span class="k">let</span> <span class="n">applicationDataExpr</span> <span class="o">=</span> <span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readBytes</span><span class="p">(</span><span class="kt">int</span><span class="p">(</span><span class="mi">128</span><span class="p">))</span>
  <span class="n">this</span><span class="p">.</span><span class="n">applicationData</span> <span class="o">=</span> <span class="n">applicationDataExpr</span>

<span class="k">proc </span><span class="nf">dataBlocksWithIo</span><span class="p">(</span><span class="n">this</span><span class="p">:</span> <span class="n">ResourceFork</span><span class="p">):</span> <span class="n">BytesWithIo</span> <span class="o">=</span> 

  <span class="sd">##[</span>
  <span class="n">Use</span> <span class="p">`</span><span class="n">data_blocks</span><span class="p">`</span> <span class="n">instead</span><span class="p">,</span>
<span class="n">unless</span> <span class="n">you</span> <span class="n">need</span> <span class="n">access</span> <span class="n">to</span> <span class="n">this</span> <span class="n">instance</span><span class="sc">&#39;s `_io`.</span>

  <span class="o">]</span><span class="sd">##</span>
  <span class="k">if</span> <span class="n">this</span><span class="p">.</span><span class="n">dataBlocksWithIoInstFlag</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">this</span><span class="p">.</span><span class="n">dataBlocksWithIoInst</span>
  <span class="k">let</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">pos</span><span class="p">()</span>
  <span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">seek</span><span class="p">(</span><span class="kt">int</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">header</span><span class="p">.</span><span class="n">ofsDataBlocks</span><span class="p">))</span>
  <span class="k">let</span> <span class="n">rawDataBlocksWithIoInstExpr</span> <span class="o">=</span> <span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readBytes</span><span class="p">(</span><span class="kt">int</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">header</span><span class="p">.</span><span class="n">lenDataBlocks</span><span class="p">))</span>
  <span class="n">this</span><span class="p">.</span><span class="n">rawDataBlocksWithIoInst</span> <span class="o">=</span> <span class="n">rawDataBlocksWithIoInstExpr</span>
  <span class="k">let</span> <span class="n">rawDataBlocksWithIoInstIo</span> <span class="o">=</span> <span class="n">newKaitaiStream</span><span class="p">(</span><span class="n">rawDataBlocksWithIoInstExpr</span><span class="p">)</span>
  <span class="k">let</span> <span class="n">dataBlocksWithIoInstExpr</span> <span class="o">=</span> <span class="n">BytesWithIo</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">rawDataBlocksWithIoInstIo</span><span class="p">,</span> <span class="n">this</span><span class="p">.</span><span class="n">root</span><span class="p">,</span> <span class="n">this</span><span class="p">)</span>
  <span class="n">this</span><span class="p">.</span><span class="n">dataBlocksWithIoInst</span> <span class="o">=</span> <span class="n">dataBlocksWithIoInstExpr</span>
  <span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">seek</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
  <span class="n">this</span><span class="p">.</span><span class="n">dataBlocksWithIoInstFlag</span> <span class="o">=</span> <span class="kp">true</span>
  <span class="k">return</span> <span class="n">this</span><span class="p">.</span><span class="n">dataBlocksWithIoInst</span>

<span class="k">proc </span><span class="nf">dataBlocks</span><span class="p">(</span><span class="n">this</span><span class="p">:</span> <span class="n">ResourceFork</span><span class="p">):</span> <span class="kt">seq</span><span class="o">[</span><span class="n">byte</span><span class="o">]</span> <span class="o">=</span> 

  <span class="sd">##[</span>
  <span class="n">Storage</span> <span class="n">area</span> <span class="k">for</span> <span class="n">the</span> <span class="n">data</span> <span class="n">blocks</span> <span class="k">of</span> <span class="n">all</span> <span class="n">resources</span><span class="p">.</span>

<span class="n">These</span> <span class="n">data</span> <span class="n">blocks</span> <span class="n">are</span> <span class="ow">not</span> <span class="n">required</span> <span class="n">to</span> <span class="n">appear</span> <span class="ow">in</span> <span class="n">any</span> <span class="n">particular</span> <span class="n">order</span><span class="p">,</span>
<span class="ow">and</span> <span class="n">there</span> <span class="n">may</span> <span class="n">be</span> <span class="n">unused</span> <span class="n">space</span> <span class="n">between</span> <span class="ow">and</span> <span class="n">around</span> <span class="n">them</span><span class="p">.</span>

<span class="ow">In</span> <span class="n">practice</span><span class="p">,</span>
<span class="n">the</span> <span class="n">data</span> <span class="n">blocks</span> <span class="ow">in</span> <span class="n">newly</span> <span class="n">created</span> <span class="n">resource</span> <span class="n">files</span> <span class="n">are</span> <span class="n">usually</span> <span class="n">contiguous</span><span class="p">.</span>
<span class="k">When</span> <span class="n">existing</span> <span class="n">resources</span> <span class="n">are</span> <span class="n">shortened</span><span class="p">,</span>
<span class="n">the</span> <span class="n">Mac</span> <span class="n">OS</span> <span class="n">resource</span> <span class="n">manager</span> <span class="n">leaves</span> <span class="n">unused</span> <span class="n">space</span> <span class="n">where</span> <span class="n">the</span> <span class="n">now</span> <span class="n">removed</span> <span class="n">resource</span> <span class="n">data</span> <span class="n">was</span><span class="p">,</span>
<span class="k">as</span> <span class="n">this</span> <span class="ow">is</span> <span class="n">quicker</span> <span class="n">than</span> <span class="n">moving</span> <span class="n">the</span> <span class="n">following</span> <span class="n">resource</span> <span class="n">data</span> <span class="n">into</span> <span class="n">the</span> <span class="n">newly</span> <span class="n">freed</span> <span class="n">space</span><span class="p">.</span>
<span class="n">Such</span> <span class="n">unused</span> <span class="n">space</span> <span class="n">may</span> <span class="n">be</span> <span class="n">cleaned</span> <span class="n">up</span> <span class="n">later</span> <span class="k">when</span> <span class="n">the</span> <span class="n">resource</span> <span class="n">manager</span> <span class="s">&quot;compacts&quot;</span> <span class="n">the</span> <span class="n">resource</span> <span class="n">file</span><span class="p">,</span>
<span class="n">which</span> <span class="n">happens</span> <span class="k">when</span> <span class="n">resources</span> <span class="n">are</span> <span class="n">removed</span> <span class="n">entirely</span><span class="p">,</span>
<span class="ow">or</span> <span class="k">when</span> <span class="n">resources</span> <span class="n">are</span> <span class="n">added</span> <span class="ow">or</span> <span class="n">grown</span> <span class="n">so</span> <span class="n">that</span> <span class="n">more</span> <span class="n">space</span> <span class="ow">is</span> <span class="n">needed</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">data</span> <span class="n">area</span><span class="p">.</span>

  <span class="o">]</span><span class="sd">##</span>
  <span class="k">if</span> <span class="n">this</span><span class="p">.</span><span class="n">dataBlocksInstFlag</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">this</span><span class="p">.</span><span class="n">dataBlocksInst</span>
  <span class="k">let</span> <span class="n">dataBlocksInstExpr</span> <span class="o">=</span> <span class="kt">seq</span><span class="o">[</span><span class="n">byte</span><span class="o">]</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">dataBlocksWithIo</span><span class="p">.</span><span class="n">data</span><span class="p">)</span>
  <span class="n">this</span><span class="p">.</span><span class="n">dataBlocksInst</span> <span class="o">=</span> <span class="n">dataBlocksInstExpr</span>
  <span class="n">this</span><span class="p">.</span><span class="n">dataBlocksInstFlag</span> <span class="o">=</span> <span class="kp">true</span>
  <span class="k">return</span> <span class="n">this</span><span class="p">.</span><span class="n">dataBlocksInst</span>

<span class="k">proc </span><span class="nf">resourceMap</span><span class="p">(</span><span class="n">this</span><span class="p">:</span> <span class="n">ResourceFork</span><span class="p">):</span> <span class="n">ResourceFork_ResourceMap</span> <span class="o">=</span> 

  <span class="sd">##[</span>
  <span class="n">The</span> <span class="n">resource</span> <span class="n">file</span><span class="sc">&#39;s resource map.</span>
  <span class="o">]</span><span class="sd">##</span>
  <span class="k">if</span> <span class="n">this</span><span class="p">.</span><span class="n">resourceMapInstFlag</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">this</span><span class="p">.</span><span class="n">resourceMapInst</span>
  <span class="k">let</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">pos</span><span class="p">()</span>
  <span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">seek</span><span class="p">(</span><span class="kt">int</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">header</span><span class="p">.</span><span class="n">ofsResourceMap</span><span class="p">))</span>
  <span class="k">let</span> <span class="n">rawResourceMapInstExpr</span> <span class="o">=</span> <span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readBytes</span><span class="p">(</span><span class="kt">int</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">header</span><span class="p">.</span><span class="n">lenResourceMap</span><span class="p">))</span>
  <span class="n">this</span><span class="p">.</span><span class="n">rawResourceMapInst</span> <span class="o">=</span> <span class="n">rawResourceMapInstExpr</span>
  <span class="k">let</span> <span class="n">rawResourceMapInstIo</span> <span class="o">=</span> <span class="n">newKaitaiStream</span><span class="p">(</span><span class="n">rawResourceMapInstExpr</span><span class="p">)</span>
  <span class="k">let</span> <span class="n">resourceMapInstExpr</span> <span class="o">=</span> <span class="n">ResourceFork_ResourceMap</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">rawResourceMapInstIo</span><span class="p">,</span> <span class="n">this</span><span class="p">.</span><span class="n">root</span><span class="p">,</span> <span class="n">this</span><span class="p">)</span>
  <span class="n">this</span><span class="p">.</span><span class="n">resourceMapInst</span> <span class="o">=</span> <span class="n">resourceMapInstExpr</span>
  <span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">seek</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
  <span class="n">this</span><span class="p">.</span><span class="n">resourceMapInstFlag</span> <span class="o">=</span> <span class="kp">true</span>
  <span class="k">return</span> <span class="n">this</span><span class="p">.</span><span class="n">resourceMapInst</span>

<span class="k">proc </span><span class="nf">fromFile</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork], filename: string): ResourceFork =</span>
  <span class="n">ResourceFork</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">newKaitaiFileStream</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span> <span class="kp">nil</span><span class="p">,</span> <span class="kp">nil</span><span class="p">)</span>


<span class="sd">##[</span>
<span class="n">Resource</span> <span class="n">file</span> <span class="n">header</span><span class="p">,</span>
<span class="n">containing</span> <span class="n">the</span> <span class="n">offsets</span> <span class="ow">and</span> <span class="n">lengths</span> <span class="k">of</span> <span class="n">the</span> <span class="n">resource</span> <span class="n">data</span> <span class="n">area</span> <span class="ow">and</span> <span class="n">resource</span> <span class="n">map</span><span class="p">.</span>

<span class="o">]</span><span class="sd">##</span>
<span class="k">proc </span><span class="nf">read</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork_FileHeader], io: KaitaiStream, root: KaitaiStruct, parent: KaitaiStruct): ResourceFork_FileHeader =</span>
  <span class="k">template</span> <span class="n">this</span><span class="p">:</span> <span class="n">untyped</span> <span class="o">=</span> <span class="n">result</span>
  <span class="n">this</span> <span class="o">=</span> <span class="n">new</span><span class="p">(</span><span class="n">ResourceFork_FileHeader</span><span class="p">)</span>
  <span class="k">let</span> <span class="n">root</span> <span class="o">=</span> <span class="k">if</span> <span class="n">root</span> <span class="o">==</span> <span class="kp">nil</span><span class="p">:</span> <span class="k">cast</span><span class="o">[</span><span class="n">ResourceFork</span><span class="o">]</span><span class="p">(</span><span class="n">this</span><span class="p">)</span> <span class="k">else</span><span class="p">:</span> <span class="k">cast</span><span class="o">[</span><span class="n">ResourceFork</span><span class="o">]</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
  <span class="n">this</span><span class="p">.</span><span class="n">io</span> <span class="o">=</span> <span class="n">io</span>
  <span class="n">this</span><span class="p">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">root</span>
  <span class="n">this</span><span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>


  <span class="sd">##[</span>
  <span class="n">Offset</span> <span class="k">of</span> <span class="n">the</span> <span class="n">resource</span> <span class="n">data</span> <span class="n">area</span><span class="p">,</span>
<span class="kn">from</span> <span class="n">the</span> <span class="n">start</span> <span class="k">of</span> <span class="n">the</span> <span class="n">resource</span> <span class="n">file</span><span class="p">.</span>

<span class="ow">In</span> <span class="n">practice</span><span class="p">,</span>
<span class="n">this</span> <span class="n">should</span> <span class="n">always</span> <span class="n">be</span> <span class="p">`</span><span class="mi">256</span><span class="p">`,</span>
<span class="n">i</span><span class="p">.</span> <span class="n">e</span><span class="p">.</span> <span class="n">the</span> <span class="n">resource</span> <span class="n">data</span> <span class="n">area</span> <span class="n">should</span> <span class="n">directly</span> <span class="n">follow</span> <span class="n">the</span> <span class="n">application</span><span class="o">-</span><span class="n">specific</span> <span class="n">data</span> <span class="n">area</span><span class="p">.</span>

  <span class="o">]</span><span class="sd">##</span>
  <span class="k">let</span> <span class="n">ofsDataBlocksExpr</span> <span class="o">=</span> <span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readU4be</span><span class="p">()</span>
  <span class="n">this</span><span class="p">.</span><span class="n">ofsDataBlocks</span> <span class="o">=</span> <span class="n">ofsDataBlocksExpr</span>

  <span class="sd">##[</span>
  <span class="n">Offset</span> <span class="k">of</span> <span class="n">the</span> <span class="n">resource</span> <span class="n">map</span><span class="p">,</span>
<span class="kn">from</span> <span class="n">the</span> <span class="n">start</span> <span class="k">of</span> <span class="n">the</span> <span class="n">resource</span> <span class="n">file</span><span class="p">.</span>

<span class="ow">In</span> <span class="n">practice</span><span class="p">,</span>
<span class="n">this</span> <span class="n">should</span> <span class="n">always</span> <span class="n">be</span> <span class="p">`</span><span class="n">ofs_data_blocks</span> <span class="o">+</span> <span class="n">len_data_blocks</span><span class="p">`,</span>
<span class="n">i</span><span class="p">.</span> <span class="n">e</span><span class="p">.</span> <span class="n">the</span> <span class="n">resource</span> <span class="n">map</span> <span class="n">should</span> <span class="n">directly</span> <span class="n">follow</span> <span class="n">the</span> <span class="n">resource</span> <span class="n">data</span> <span class="n">area</span><span class="p">.</span>

  <span class="o">]</span><span class="sd">##</span>
  <span class="k">let</span> <span class="n">ofsResourceMapExpr</span> <span class="o">=</span> <span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readU4be</span><span class="p">()</span>
  <span class="n">this</span><span class="p">.</span><span class="n">ofsResourceMap</span> <span class="o">=</span> <span class="n">ofsResourceMapExpr</span>

  <span class="sd">##[</span>
  <span class="n">Length</span> <span class="k">of</span> <span class="n">the</span> <span class="n">resource</span> <span class="n">data</span> <span class="n">area</span><span class="p">.</span>

  <span class="o">]</span><span class="sd">##</span>
  <span class="k">let</span> <span class="n">lenDataBlocksExpr</span> <span class="o">=</span> <span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readU4be</span><span class="p">()</span>
  <span class="n">this</span><span class="p">.</span><span class="n">lenDataBlocks</span> <span class="o">=</span> <span class="n">lenDataBlocksExpr</span>

  <span class="sd">##[</span>
  <span class="n">Length</span> <span class="k">of</span> <span class="n">the</span> <span class="n">resource</span> <span class="n">map</span><span class="p">.</span>

<span class="ow">In</span> <span class="n">practice</span><span class="p">,</span>
<span class="n">this</span> <span class="n">should</span> <span class="n">always</span> <span class="n">be</span> <span class="p">`</span><span class="err">_root._io.size - ofs_resource_map`,</span>
<span class="n">i</span><span class="p">.</span> <span class="n">e</span><span class="p">.</span> <span class="n">the</span> <span class="n">resource</span> <span class="n">map</span> <span class="n">should</span> <span class="n">extend</span> <span class="n">to</span> <span class="n">the</span> <span class="k">end</span> <span class="k">of</span> <span class="n">the</span> <span class="n">resource</span> <span class="n">file</span><span class="p">.</span>

  <span class="o">]</span><span class="sd">##</span>
  <span class="k">let</span> <span class="n">lenResourceMapExpr</span> <span class="o">=</span> <span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readU4be</span><span class="p">()</span>
  <span class="n">this</span><span class="p">.</span><span class="n">lenResourceMap</span> <span class="o">=</span> <span class="n">lenResourceMapExpr</span>

<span class="k">proc </span><span class="nf">fromFile</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork_FileHeader], filename: string): ResourceFork_FileHeader =</span>
  <span class="n">ResourceFork_FileHeader</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">newKaitaiFileStream</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span> <span class="kp">nil</span><span class="p">,</span> <span class="kp">nil</span><span class="p">)</span>


<span class="sd">##[</span>
<span class="n">A</span> <span class="n">resource</span> <span class="n">data</span> <span class="k">block</span><span class="p">,</span>
<span class="k">as</span> <span class="n">stored</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">resource</span> <span class="n">data</span> <span class="n">area</span><span class="p">.</span>

<span class="n">Each</span> <span class="n">data</span> <span class="k">block</span> <span class="n">stores</span> <span class="n">the</span> <span class="n">data</span> <span class="n">contained</span> <span class="ow">in</span> <span class="n">a</span> <span class="n">resource</span><span class="p">,</span>
<span class="n">along</span> <span class="n">with</span> <span class="n">its</span> <span class="n">length</span><span class="p">.</span>

<span class="o">]</span><span class="sd">##</span>
<span class="k">proc </span><span class="nf">read</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork_DataBlock], io: KaitaiStream, root: KaitaiStruct, parent: ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference): ResourceFork_DataBlock =</span>
  <span class="k">template</span> <span class="n">this</span><span class="p">:</span> <span class="n">untyped</span> <span class="o">=</span> <span class="n">result</span>
  <span class="n">this</span> <span class="o">=</span> <span class="n">new</span><span class="p">(</span><span class="n">ResourceFork_DataBlock</span><span class="p">)</span>
  <span class="k">let</span> <span class="n">root</span> <span class="o">=</span> <span class="k">if</span> <span class="n">root</span> <span class="o">==</span> <span class="kp">nil</span><span class="p">:</span> <span class="k">cast</span><span class="o">[</span><span class="n">ResourceFork</span><span class="o">]</span><span class="p">(</span><span class="n">this</span><span class="p">)</span> <span class="k">else</span><span class="p">:</span> <span class="k">cast</span><span class="o">[</span><span class="n">ResourceFork</span><span class="o">]</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
  <span class="n">this</span><span class="p">.</span><span class="n">io</span> <span class="o">=</span> <span class="n">io</span>
  <span class="n">this</span><span class="p">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">root</span>
  <span class="n">this</span><span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>


  <span class="sd">##[</span>
  <span class="n">The</span> <span class="n">length</span> <span class="k">of</span> <span class="n">the</span> <span class="n">resource</span> <span class="n">data</span> <span class="n">stored</span> <span class="ow">in</span> <span class="n">this</span> <span class="k">block</span><span class="p">.</span>

  <span class="o">]</span><span class="sd">##</span>
  <span class="k">let</span> <span class="n">lenDataExpr</span> <span class="o">=</span> <span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readU4be</span><span class="p">()</span>
  <span class="n">this</span><span class="p">.</span><span class="n">lenData</span> <span class="o">=</span> <span class="n">lenDataExpr</span>

  <span class="sd">##[</span>
  <span class="n">The</span> <span class="n">data</span> <span class="n">stored</span> <span class="ow">in</span> <span class="n">this</span> <span class="k">block</span><span class="p">.</span>

  <span class="o">]</span><span class="sd">##</span>
  <span class="k">let</span> <span class="n">dataExpr</span> <span class="o">=</span> <span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readBytes</span><span class="p">(</span><span class="kt">int</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">lenData</span><span class="p">))</span>
  <span class="n">this</span><span class="p">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">dataExpr</span>

<span class="k">proc </span><span class="nf">fromFile</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork_DataBlock], filename: string): ResourceFork_DataBlock =</span>
  <span class="n">ResourceFork_DataBlock</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">newKaitaiFileStream</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span> <span class="kp">nil</span><span class="p">,</span> <span class="kp">nil</span><span class="p">)</span>


<span class="sd">##[</span>
<span class="n">Resource</span> <span class="n">map</span><span class="p">,</span>
<span class="n">containing</span> <span class="n">information</span> <span class="n">about</span> <span class="n">the</span> <span class="n">resources</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">file</span> <span class="ow">and</span> <span class="n">where</span> <span class="n">they</span> <span class="n">are</span> <span class="n">located</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">data</span> <span class="n">area</span><span class="p">.</span>

<span class="o">]</span><span class="sd">##</span>
<span class="k">proc </span><span class="nf">read</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork_ResourceMap], io: KaitaiStream, root: KaitaiStruct, parent: ResourceFork): ResourceFork_ResourceMap =</span>
  <span class="k">template</span> <span class="n">this</span><span class="p">:</span> <span class="n">untyped</span> <span class="o">=</span> <span class="n">result</span>
  <span class="n">this</span> <span class="o">=</span> <span class="n">new</span><span class="p">(</span><span class="n">ResourceFork_ResourceMap</span><span class="p">)</span>
  <span class="k">let</span> <span class="n">root</span> <span class="o">=</span> <span class="k">if</span> <span class="n">root</span> <span class="o">==</span> <span class="kp">nil</span><span class="p">:</span> <span class="k">cast</span><span class="o">[</span><span class="n">ResourceFork</span><span class="o">]</span><span class="p">(</span><span class="n">this</span><span class="p">)</span> <span class="k">else</span><span class="p">:</span> <span class="k">cast</span><span class="o">[</span><span class="n">ResourceFork</span><span class="o">]</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
  <span class="n">this</span><span class="p">.</span><span class="n">io</span> <span class="o">=</span> <span class="n">io</span>
  <span class="n">this</span><span class="p">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">root</span>
  <span class="n">this</span><span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>


  <span class="sd">##[</span>
  <span class="n">Reserved</span> <span class="n">space</span> <span class="k">for</span> <span class="n">a</span> <span class="n">copy</span> <span class="k">of</span> <span class="n">the</span> <span class="n">resource</span> <span class="n">file</span> <span class="n">header</span><span class="p">.</span>
  <span class="o">]</span><span class="sd">##</span>
  <span class="k">let</span> <span class="n">reservedFileHeaderCopyExpr</span> <span class="o">=</span> <span class="n">ResourceFork_FileHeader</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">,</span> <span class="n">this</span><span class="p">.</span><span class="n">root</span><span class="p">,</span> <span class="n">this</span><span class="p">)</span>
  <span class="n">this</span><span class="p">.</span><span class="n">reservedFileHeaderCopy</span> <span class="o">=</span> <span class="n">reservedFileHeaderCopyExpr</span>

  <span class="sd">##[</span>
  <span class="n">Reserved</span> <span class="n">space</span> <span class="k">for</span> <span class="n">a</span> <span class="n">handle</span> <span class="n">to</span> <span class="n">the</span> <span class="n">next</span> <span class="n">loaded</span> <span class="n">resource</span> <span class="n">map</span> <span class="ow">in</span> <span class="n">memory</span><span class="p">.</span>
  <span class="o">]</span><span class="sd">##</span>
  <span class="k">let</span> <span class="n">reservedNextResourceMapHandleExpr</span> <span class="o">=</span> <span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readU4be</span><span class="p">()</span>
  <span class="n">this</span><span class="p">.</span><span class="n">reservedNextResourceMapHandle</span> <span class="o">=</span> <span class="n">reservedNextResourceMapHandleExpr</span>

  <span class="sd">##[</span>
  <span class="n">Reserved</span> <span class="n">space</span> <span class="k">for</span> <span class="n">the</span> <span class="n">resource</span> <span class="n">file</span><span class="sc">&#39;s file reference number.</span>
  <span class="o">]</span><span class="sd">##</span>
  <span class="k">let</span> <span class="n">reservedFileReferenceNumberExpr</span> <span class="o">=</span> <span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readU2be</span><span class="p">()</span>
  <span class="n">this</span><span class="p">.</span><span class="n">reservedFileReferenceNumber</span> <span class="o">=</span> <span class="n">reservedFileReferenceNumberExpr</span>

  <span class="sd">##[</span>
  <span class="n">The</span> <span class="n">resource</span> <span class="n">file</span><span class="sc">&#39;s attributes.</span>
  <span class="o">]</span><span class="sd">##</span>
  <span class="k">let</span> <span class="n">rawFileAttributesExpr</span> <span class="o">=</span> <span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readBytes</span><span class="p">(</span><span class="kt">int</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
  <span class="n">this</span><span class="p">.</span><span class="n">rawFileAttributes</span> <span class="o">=</span> <span class="n">rawFileAttributesExpr</span>
  <span class="k">let</span> <span class="n">rawFileAttributesIo</span> <span class="o">=</span> <span class="n">newKaitaiStream</span><span class="p">(</span><span class="n">rawFileAttributesExpr</span><span class="p">)</span>
  <span class="k">let</span> <span class="n">fileAttributesExpr</span> <span class="o">=</span> <span class="n">ResourceFork_ResourceMap_FileAttributes</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">rawFileAttributesIo</span><span class="p">,</span> <span class="n">this</span><span class="p">.</span><span class="n">root</span><span class="p">,</span> <span class="n">this</span><span class="p">)</span>
  <span class="n">this</span><span class="p">.</span><span class="n">fileAttributes</span> <span class="o">=</span> <span class="n">fileAttributesExpr</span>

  <span class="sd">##[</span>
  <span class="n">Offset</span> <span class="k">of</span> <span class="n">the</span> <span class="n">resource</span> <span class="k">type</span> <span class="n">list</span><span class="p">,</span>
<span class="kn">from</span> <span class="n">the</span> <span class="n">start</span> <span class="k">of</span> <span class="n">the</span> <span class="n">resource</span> <span class="n">map</span><span class="p">.</span>

<span class="ow">In</span> <span class="n">practice</span><span class="p">,</span>
<span class="n">this</span> <span class="n">should</span> <span class="n">always</span> <span class="n">be</span> <span class="p">`</span><span class="n">sizeof</span><span class="o">&lt;</span><span class="n">resource_map</span><span class="o">&gt;</span><span class="p">`,</span>
<span class="n">i</span><span class="p">.</span> <span class="n">e</span><span class="p">.</span> <span class="n">the</span> <span class="n">resource</span> <span class="k">type</span> <span class="n">list</span> <span class="n">should</span> <span class="n">directly</span> <span class="n">follow</span> <span class="n">the</span> <span class="n">resource</span> <span class="n">map</span><span class="p">.</span>

  <span class="o">]</span><span class="sd">##</span>
  <span class="k">let</span> <span class="n">ofsTypeListExpr</span> <span class="o">=</span> <span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readU2be</span><span class="p">()</span>
  <span class="n">this</span><span class="p">.</span><span class="n">ofsTypeList</span> <span class="o">=</span> <span class="n">ofsTypeListExpr</span>

  <span class="sd">##[</span>
  <span class="n">Offset</span> <span class="k">of</span> <span class="n">the</span> <span class="n">resource</span> <span class="n">name</span> <span class="n">area</span><span class="p">,</span>
<span class="kn">from</span> <span class="n">the</span> <span class="n">start</span> <span class="k">of</span> <span class="n">the</span> <span class="n">resource</span> <span class="n">map</span><span class="p">.</span>

  <span class="o">]</span><span class="sd">##</span>
  <span class="k">let</span> <span class="n">ofsNamesExpr</span> <span class="o">=</span> <span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readU2be</span><span class="p">()</span>
  <span class="n">this</span><span class="p">.</span><span class="n">ofsNames</span> <span class="o">=</span> <span class="n">ofsNamesExpr</span>

<span class="k">proc </span><span class="nf">typeListAndReferenceLists</span><span class="p">(</span><span class="n">this</span><span class="p">:</span> <span class="n">ResourceFork_ResourceMap</span><span class="p">):</span> <span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists</span> <span class="o">=</span> 

  <span class="sd">##[</span>
  <span class="n">The</span> <span class="n">resource</span> <span class="n">map</span><span class="sc">&#39;s resource type list, followed by the resource reference list area.</span>
  <span class="o">]</span><span class="sd">##</span>
  <span class="k">if</span> <span class="n">this</span><span class="p">.</span><span class="n">typeListAndReferenceListsInstFlag</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">this</span><span class="p">.</span><span class="n">typeListAndReferenceListsInst</span>
  <span class="k">let</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">pos</span><span class="p">()</span>
  <span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">seek</span><span class="p">(</span><span class="kt">int</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">ofsTypeList</span><span class="p">))</span>
  <span class="k">let</span> <span class="n">rawTypeListAndReferenceListsInstExpr</span> <span class="o">=</span> <span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readBytes</span><span class="p">(</span><span class="kt">int</span><span class="p">((</span><span class="n">this</span><span class="p">.</span><span class="n">ofsNames</span> <span class="o">-</span> <span class="n">this</span><span class="p">.</span><span class="n">ofsTypeList</span><span class="p">)))</span>
  <span class="n">this</span><span class="p">.</span><span class="n">rawTypeListAndReferenceListsInst</span> <span class="o">=</span> <span class="n">rawTypeListAndReferenceListsInstExpr</span>
  <span class="k">let</span> <span class="n">rawTypeListAndReferenceListsInstIo</span> <span class="o">=</span> <span class="n">newKaitaiStream</span><span class="p">(</span><span class="n">rawTypeListAndReferenceListsInstExpr</span><span class="p">)</span>
  <span class="k">let</span> <span class="n">typeListAndReferenceListsInstExpr</span> <span class="o">=</span> <span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">rawTypeListAndReferenceListsInstIo</span><span class="p">,</span> <span class="n">this</span><span class="p">.</span><span class="n">root</span><span class="p">,</span> <span class="n">this</span><span class="p">)</span>
  <span class="n">this</span><span class="p">.</span><span class="n">typeListAndReferenceListsInst</span> <span class="o">=</span> <span class="n">typeListAndReferenceListsInstExpr</span>
  <span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">seek</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
  <span class="n">this</span><span class="p">.</span><span class="n">typeListAndReferenceListsInstFlag</span> <span class="o">=</span> <span class="kp">true</span>
  <span class="k">return</span> <span class="n">this</span><span class="p">.</span><span class="n">typeListAndReferenceListsInst</span>

<span class="k">proc </span><span class="nf">namesWithIo</span><span class="p">(</span><span class="n">this</span><span class="p">:</span> <span class="n">ResourceFork_ResourceMap</span><span class="p">):</span> <span class="n">BytesWithIo</span> <span class="o">=</span> 

  <span class="sd">##[</span>
  <span class="n">Use</span> <span class="p">`</span><span class="n">names</span><span class="p">`</span> <span class="n">instead</span><span class="p">,</span>
<span class="n">unless</span> <span class="n">you</span> <span class="n">need</span> <span class="n">access</span> <span class="n">to</span> <span class="n">this</span> <span class="n">instance</span><span class="sc">&#39;s `_io`.</span>

  <span class="o">]</span><span class="sd">##</span>
  <span class="k">if</span> <span class="n">this</span><span class="p">.</span><span class="n">namesWithIoInstFlag</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">this</span><span class="p">.</span><span class="n">namesWithIoInst</span>
  <span class="k">let</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">pos</span><span class="p">()</span>
  <span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">seek</span><span class="p">(</span><span class="kt">int</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">ofsNames</span><span class="p">))</span>
  <span class="k">let</span> <span class="n">rawNamesWithIoInstExpr</span> <span class="o">=</span> <span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readBytesFull</span><span class="p">()</span>
  <span class="n">this</span><span class="p">.</span><span class="n">rawNamesWithIoInst</span> <span class="o">=</span> <span class="n">rawNamesWithIoInstExpr</span>
  <span class="k">let</span> <span class="n">rawNamesWithIoInstIo</span> <span class="o">=</span> <span class="n">newKaitaiStream</span><span class="p">(</span><span class="n">rawNamesWithIoInstExpr</span><span class="p">)</span>
  <span class="k">let</span> <span class="n">namesWithIoInstExpr</span> <span class="o">=</span> <span class="n">BytesWithIo</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">rawNamesWithIoInstIo</span><span class="p">,</span> <span class="n">this</span><span class="p">.</span><span class="n">root</span><span class="p">,</span> <span class="n">this</span><span class="p">)</span>
  <span class="n">this</span><span class="p">.</span><span class="n">namesWithIoInst</span> <span class="o">=</span> <span class="n">namesWithIoInstExpr</span>
  <span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">seek</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
  <span class="n">this</span><span class="p">.</span><span class="n">namesWithIoInstFlag</span> <span class="o">=</span> <span class="kp">true</span>
  <span class="k">return</span> <span class="n">this</span><span class="p">.</span><span class="n">namesWithIoInst</span>

<span class="k">proc </span><span class="nf">names</span><span class="p">(</span><span class="n">this</span><span class="p">:</span> <span class="n">ResourceFork_ResourceMap</span><span class="p">):</span> <span class="kt">seq</span><span class="o">[</span><span class="n">byte</span><span class="o">]</span> <span class="o">=</span> 

  <span class="sd">##[</span>
  <span class="n">Storage</span> <span class="n">area</span> <span class="k">for</span> <span class="n">the</span> <span class="n">names</span> <span class="k">of</span> <span class="n">all</span> <span class="n">resources</span><span class="p">.</span>
  <span class="o">]</span><span class="sd">##</span>
  <span class="k">if</span> <span class="n">this</span><span class="p">.</span><span class="n">namesInstFlag</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">this</span><span class="p">.</span><span class="n">namesInst</span>
  <span class="k">let</span> <span class="n">namesInstExpr</span> <span class="o">=</span> <span class="kt">seq</span><span class="o">[</span><span class="n">byte</span><span class="o">]</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">namesWithIo</span><span class="p">.</span><span class="n">data</span><span class="p">)</span>
  <span class="n">this</span><span class="p">.</span><span class="n">namesInst</span> <span class="o">=</span> <span class="n">namesInstExpr</span>
  <span class="n">this</span><span class="p">.</span><span class="n">namesInstFlag</span> <span class="o">=</span> <span class="kp">true</span>
  <span class="k">return</span> <span class="n">this</span><span class="p">.</span><span class="n">namesInst</span>

<span class="k">proc </span><span class="nf">fromFile</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork_ResourceMap], filename: string): ResourceFork_ResourceMap =</span>
  <span class="n">ResourceFork_ResourceMap</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">newKaitaiFileStream</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span> <span class="kp">nil</span><span class="p">,</span> <span class="kp">nil</span><span class="p">)</span>


<span class="sd">##[</span>
<span class="n">A</span> <span class="n">resource</span> <span class="n">file</span><span class="sc">&#39;s attributes,</span>
<span class="k">as</span> <span class="n">stored</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">resource</span> <span class="n">map</span><span class="p">.</span>

<span class="n">These</span> <span class="n">attributes</span> <span class="n">are</span> <span class="n">sometimes</span> <span class="n">also</span> <span class="n">referred</span> <span class="n">to</span> <span class="k">as</span> <span class="n">resource</span> <span class="n">map</span> <span class="n">attributes</span><span class="p">,</span>
<span class="n">because</span> <span class="k">of</span> <span class="n">where</span> <span class="n">they</span> <span class="n">are</span> <span class="n">stored</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">file</span><span class="p">.</span>

<span class="o">]</span><span class="sd">##</span>
<span class="k">proc </span><span class="nf">read</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork_ResourceMap_FileAttributes], io: KaitaiStream, root: KaitaiStruct, parent: ResourceFork_ResourceMap): ResourceFork_ResourceMap_FileAttributes =</span>
  <span class="k">template</span> <span class="n">this</span><span class="p">:</span> <span class="n">untyped</span> <span class="o">=</span> <span class="n">result</span>
  <span class="n">this</span> <span class="o">=</span> <span class="n">new</span><span class="p">(</span><span class="n">ResourceFork_ResourceMap_FileAttributes</span><span class="p">)</span>
  <span class="k">let</span> <span class="n">root</span> <span class="o">=</span> <span class="k">if</span> <span class="n">root</span> <span class="o">==</span> <span class="kp">nil</span><span class="p">:</span> <span class="k">cast</span><span class="o">[</span><span class="n">ResourceFork</span><span class="o">]</span><span class="p">(</span><span class="n">this</span><span class="p">)</span> <span class="k">else</span><span class="p">:</span> <span class="k">cast</span><span class="o">[</span><span class="n">ResourceFork</span><span class="o">]</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
  <span class="n">this</span><span class="p">.</span><span class="n">io</span> <span class="o">=</span> <span class="n">io</span>
  <span class="n">this</span><span class="p">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">root</span>
  <span class="n">this</span><span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>


  <span class="sd">##[</span>
  <span class="n">TODO</span> <span class="n">What</span> <span class="n">does</span> <span class="n">this</span> <span class="n">attribute</span> <span class="n">actually</span> <span class="k">do</span><span class="p">,</span>
<span class="ow">and</span> <span class="n">how</span> <span class="ow">is</span> <span class="n">it</span> <span class="n">different</span> <span class="kn">from</span> <span class="p">`</span><span class="n">read_only</span><span class="p">`</span><span class="o">?</span>

<span class="n">This</span> <span class="n">attribute</span> <span class="ow">is</span> <span class="n">undocumented</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">defined</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">CarbonCore</span><span class="o">/</span><span class="n">Resources</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;</span><span class="p">,</span>
<span class="n">but</span> <span class="n">ResEdit</span> <span class="n">has</span> <span class="n">a</span> <span class="n">checkbox</span> <span class="n">called</span> <span class="s">&quot;Resources Locked&quot;</span> <span class="k">for</span> <span class="n">this</span> <span class="n">attribute</span><span class="p">.</span>

  <span class="o">]</span><span class="sd">##</span>
  <span class="k">let</span> <span class="n">resourcesLockedExpr</span> <span class="o">=</span> <span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readBitsIntBe</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span>
  <span class="n">this</span><span class="p">.</span><span class="n">resourcesLocked</span> <span class="o">=</span> <span class="n">resourcesLockedExpr</span>

  <span class="sd">##[</span>
  <span class="n">These</span> <span class="n">attributes</span> <span class="n">have</span> <span class="n">no</span> <span class="n">known</span> <span class="n">usage</span> <span class="ow">or</span> <span class="n">meaning</span> <span class="ow">and</span> <span class="n">should</span> <span class="n">always</span> <span class="n">be</span> <span class="n">zero</span><span class="p">.</span>

  <span class="o">]</span><span class="sd">##</span>
  <span class="k">let</span> <span class="n">reserved0Expr</span> <span class="o">=</span> <span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readBitsIntBe</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
  <span class="n">this</span><span class="p">.</span><span class="n">reserved0</span> <span class="o">=</span> <span class="n">reserved0Expr</span>

  <span class="sd">##[</span>
  <span class="n">Indicates</span> <span class="n">that</span> <span class="n">this</span> <span class="n">printer</span> <span class="n">driver</span> <span class="ow">is</span> <span class="n">compatible</span> <span class="n">with</span> <span class="n">MultiFinder</span><span class="p">,</span>
<span class="n">i</span><span class="p">.</span> <span class="n">e</span><span class="p">.</span> <span class="n">can</span> <span class="n">be</span> <span class="n">used</span> <span class="n">simultaneously</span> <span class="n">by</span> <span class="n">multiple</span> <span class="n">applications</span><span class="p">.</span>
<span class="n">This</span> <span class="n">attribute</span> <span class="ow">is</span> <span class="n">only</span> <span class="n">meant</span> <span class="n">to</span> <span class="n">be</span> <span class="kt">set</span> <span class="n">on</span> <span class="n">printer</span> <span class="n">driver</span> <span class="n">resource</span> <span class="n">forks</span><span class="p">.</span>

<span class="n">This</span> <span class="n">attribute</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">documented</span> <span class="ow">in</span> <span class="n">Inside</span> <span class="n">Macintosh</span> <span class="ow">and</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">defined</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">CarbonCore</span><span class="o">/</span><span class="n">Resources</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;</span><span class="p">.</span>
<span class="n">It</span> <span class="ow">is</span> <span class="n">documented</span> <span class="ow">in</span> <span class="n">technote</span> <span class="n">PR510</span><span class="p">,</span>
<span class="ow">and</span> <span class="n">ResEdit</span> <span class="n">has</span> <span class="n">a</span> <span class="n">checkbox</span> <span class="n">called</span> <span class="s">&quot;Printer Driver MultiFinder Compatible&quot;</span> <span class="k">for</span> <span class="n">this</span> <span class="n">attribute</span><span class="p">.</span>

  <span class="o">@</span><span class="n">see</span> <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s">&quot;https://developer.apple.com/library/archive/technotes/pr/pr_510.html&quot;</span><span class="o">&gt;</span><span class="n">Apple</span> <span class="n">Technical</span> <span class="n">Note</span> <span class="n">PR510</span> <span class="o">-</span> <span class="n">Printer</span> <span class="n">Driver</span> <span class="n">Q</span><span class="o">&amp;</span><span class="k">As</span><span class="p">,</span> <span class="n">section</span> <span class="sc">&#39;&quot;Printer driver is MultiFinder compatible&quot; bit&#39;</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
  <span class="o">]</span><span class="sd">##</span>
  <span class="k">let</span> <span class="n">printerDriverMultifinderCompatibleExpr</span> <span class="o">=</span> <span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readBitsIntBe</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span>
  <span class="n">this</span><span class="p">.</span><span class="n">printerDriverMultifinderCompatible</span> <span class="o">=</span> <span class="n">printerDriverMultifinderCompatibleExpr</span>

  <span class="sd">##[</span>
  <span class="n">Indicates</span> <span class="n">that</span> <span class="n">the</span> <span class="n">Resource</span> <span class="n">Manager</span> <span class="n">should</span> <span class="ow">not</span> <span class="n">write</span> <span class="n">any</span> <span class="n">changes</span> <span class="kn">from</span> <span class="n">memory</span> <span class="n">into</span> <span class="n">the</span> <span class="n">resource</span> <span class="n">file</span><span class="p">.</span>
<span class="n">Any</span> <span class="n">modification</span> <span class="n">operations</span> <span class="n">requested</span> <span class="n">by</span> <span class="n">the</span> <span class="n">application</span> <span class="n">will</span> <span class="k">return</span> <span class="n">successfully</span><span class="p">,</span>
<span class="n">but</span> <span class="n">will</span> <span class="ow">not</span> <span class="n">actually</span> <span class="n">update</span> <span class="n">the</span> <span class="n">resource</span> <span class="n">file</span><span class="p">.</span>

<span class="n">TODO</span> <span class="ow">Is</span> <span class="n">this</span> <span class="n">attribute</span> <span class="n">supposed</span> <span class="n">to</span> <span class="n">be</span> <span class="kt">set</span> <span class="n">on</span> <span class="n">disk</span> <span class="ow">or</span> <span class="n">only</span> <span class="ow">in</span> <span class="n">memory</span><span class="o">?</span>

  <span class="o">]</span><span class="sd">##</span>
  <span class="k">let</span> <span class="n">noWriteChangesExpr</span> <span class="o">=</span> <span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readBitsIntBe</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span>
  <span class="n">this</span><span class="p">.</span><span class="n">noWriteChanges</span> <span class="o">=</span> <span class="n">noWriteChangesExpr</span>

  <span class="sd">##[</span>
  <span class="n">Indicates</span> <span class="n">that</span> <span class="n">the</span> <span class="n">resource</span> <span class="n">file</span> <span class="n">should</span> <span class="n">be</span> <span class="n">compacted</span> <span class="n">the</span> <span class="n">next</span> <span class="n">time</span> <span class="n">it</span> <span class="ow">is</span> <span class="n">written</span> <span class="n">by</span> <span class="n">the</span> <span class="n">Resource</span> <span class="n">Manager</span><span class="p">.</span>
<span class="n">This</span> <span class="n">attribute</span> <span class="ow">is</span> <span class="n">only</span> <span class="n">meant</span> <span class="n">to</span> <span class="n">be</span> <span class="kt">set</span> <span class="ow">in</span> <span class="n">memory</span><span class="p">;</span>
<span class="n">it</span> <span class="ow">is</span> <span class="n">cleared</span> <span class="k">when</span> <span class="n">the</span> <span class="n">resource</span> <span class="n">file</span> <span class="ow">is</span> <span class="n">written</span> <span class="n">to</span> <span class="n">disk</span><span class="p">.</span>

<span class="n">This</span> <span class="n">attribute</span> <span class="ow">is</span> <span class="n">mainly</span> <span class="n">used</span> <span class="n">internally</span> <span class="n">by</span> <span class="n">the</span> <span class="n">Resource</span> <span class="n">Manager</span><span class="p">,</span>
<span class="n">but</span> <span class="n">may</span> <span class="n">also</span> <span class="n">be</span> <span class="kt">set</span> <span class="n">manually</span> <span class="n">by</span> <span class="n">the</span> <span class="n">application</span><span class="p">.</span>

  <span class="o">]</span><span class="sd">##</span>
  <span class="k">let</span> <span class="n">needsCompactExpr</span> <span class="o">=</span> <span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readBitsIntBe</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span>
  <span class="n">this</span><span class="p">.</span><span class="n">needsCompact</span> <span class="o">=</span> <span class="n">needsCompactExpr</span>

  <span class="sd">##[</span>
  <span class="n">Indicates</span> <span class="n">that</span> <span class="n">the</span> <span class="n">resource</span> <span class="n">map</span> <span class="n">has</span> <span class="n">been</span> <span class="n">changed</span> <span class="ow">in</span> <span class="n">memory</span> <span class="ow">and</span> <span class="n">should</span> <span class="n">be</span> <span class="n">written</span> <span class="n">to</span> <span class="n">the</span> <span class="n">resource</span> <span class="n">file</span> <span class="n">on</span> <span class="n">the</span> <span class="n">next</span> <span class="n">update</span><span class="p">.</span>
<span class="n">This</span> <span class="n">attribute</span> <span class="ow">is</span> <span class="n">only</span> <span class="n">meant</span> <span class="n">to</span> <span class="n">be</span> <span class="kt">set</span> <span class="ow">in</span> <span class="n">memory</span><span class="p">;</span>
<span class="n">it</span> <span class="ow">is</span> <span class="n">cleared</span> <span class="k">when</span> <span class="n">the</span> <span class="n">resource</span> <span class="n">file</span> <span class="ow">is</span> <span class="n">written</span> <span class="n">to</span> <span class="n">disk</span><span class="p">.</span>

<span class="n">This</span> <span class="n">attribute</span> <span class="ow">is</span> <span class="n">mainly</span> <span class="n">used</span> <span class="n">internally</span> <span class="n">by</span> <span class="n">the</span> <span class="n">Resource</span> <span class="n">Manager</span><span class="p">,</span>
<span class="n">but</span> <span class="n">may</span> <span class="n">also</span> <span class="n">be</span> <span class="kt">set</span> <span class="n">manually</span> <span class="n">by</span> <span class="n">the</span> <span class="n">application</span><span class="p">.</span>

  <span class="o">]</span><span class="sd">##</span>
  <span class="k">let</span> <span class="n">mapNeedsWriteExpr</span> <span class="o">=</span> <span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readBitsIntBe</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span>
  <span class="n">this</span><span class="p">.</span><span class="n">mapNeedsWrite</span> <span class="o">=</span> <span class="n">mapNeedsWriteExpr</span>

  <span class="sd">##[</span>
  <span class="n">These</span> <span class="n">attributes</span> <span class="n">have</span> <span class="n">no</span> <span class="n">known</span> <span class="n">usage</span> <span class="ow">or</span> <span class="n">meaning</span> <span class="ow">and</span> <span class="n">should</span> <span class="n">always</span> <span class="n">be</span> <span class="n">zero</span><span class="p">.</span>

  <span class="o">]</span><span class="sd">##</span>
  <span class="k">let</span> <span class="n">reserved1Expr</span> <span class="o">=</span> <span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readBitsIntBe</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
  <span class="n">this</span><span class="p">.</span><span class="n">reserved1</span> <span class="o">=</span> <span class="n">reserved1Expr</span>

<span class="k">proc </span><span class="nf">asInt</span><span class="p">(</span><span class="n">this</span><span class="p">:</span> <span class="n">ResourceFork_ResourceMap_FileAttributes</span><span class="p">):</span> <span class="n">uint16</span> <span class="o">=</span> 

  <span class="sd">##[</span>
  <span class="n">The</span> <span class="n">attributes</span> <span class="k">as</span> <span class="n">a</span> <span class="n">packed</span> <span class="n">integer</span><span class="p">,</span>
<span class="k">as</span> <span class="n">they</span> <span class="n">are</span> <span class="n">stored</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">file</span><span class="p">.</span>

  <span class="o">]</span><span class="sd">##</span>
  <span class="k">if</span> <span class="n">this</span><span class="p">.</span><span class="n">asIntInstFlag</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">this</span><span class="p">.</span><span class="n">asIntInst</span>
  <span class="k">let</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">pos</span><span class="p">()</span>
  <span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">seek</span><span class="p">(</span><span class="kt">int</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
  <span class="k">let</span> <span class="n">asIntInstExpr</span> <span class="o">=</span> <span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readU2be</span><span class="p">()</span>
  <span class="n">this</span><span class="p">.</span><span class="n">asIntInst</span> <span class="o">=</span> <span class="n">asIntInstExpr</span>
  <span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">seek</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
  <span class="n">this</span><span class="p">.</span><span class="n">asIntInstFlag</span> <span class="o">=</span> <span class="kp">true</span>
  <span class="k">return</span> <span class="n">this</span><span class="p">.</span><span class="n">asIntInst</span>

<span class="k">proc </span><span class="nf">fromFile</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork_ResourceMap_FileAttributes], filename: string): ResourceFork_ResourceMap_FileAttributes =</span>
  <span class="n">ResourceFork_ResourceMap_FileAttributes</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">newKaitaiFileStream</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span> <span class="kp">nil</span><span class="p">,</span> <span class="kp">nil</span><span class="p">)</span>


<span class="sd">##[</span>
<span class="n">Resource</span> <span class="k">type</span> <span class="n">list</span> <span class="ow">and</span> <span class="n">storage</span> <span class="n">area</span> <span class="k">for</span> <span class="n">resource</span> <span class="n">reference</span> <span class="n">lists</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">resource</span> <span class="n">map</span><span class="p">.</span>

<span class="n">The</span> <span class="n">two</span> <span class="n">parts</span> <span class="n">are</span> <span class="n">combined</span> <span class="n">into</span> <span class="n">a</span> <span class="n">single</span> <span class="k">type</span> <span class="n">here</span> <span class="k">for</span> <span class="n">technical</span> <span class="n">reasons</span><span class="p">:</span>
<span class="n">the</span> <span class="n">start</span> <span class="k">of</span> <span class="n">the</span> <span class="n">resource</span> <span class="n">reference</span> <span class="n">list</span> <span class="n">area</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">stored</span> <span class="n">explicitly</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">file</span><span class="p">,</span>
<span class="n">instead</span> <span class="n">it</span> <span class="n">always</span> <span class="n">starts</span> <span class="n">directly</span> <span class="n">after</span> <span class="n">the</span> <span class="n">resource</span> <span class="k">type</span> <span class="n">list</span><span class="p">.</span>
<span class="n">The</span> <span class="n">simplest</span> <span class="n">way</span> <span class="n">to</span> <span class="n">implement</span> <span class="n">this</span> <span class="ow">is</span> <span class="n">by</span> <span class="n">placing</span> <span class="n">both</span> <span class="n">types</span> <span class="n">into</span> <span class="n">a</span> <span class="n">single</span> <span class="p">`</span><span class="kt">seq</span><span class="p">`.</span>

<span class="o">]</span><span class="sd">##</span>
<span class="k">proc </span><span class="nf">read</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork_ResourceMap_TypeListAndReferenceLists], io: KaitaiStream, root: KaitaiStruct, parent: ResourceFork_ResourceMap): ResourceFork_ResourceMap_TypeListAndReferenceLists =</span>
  <span class="k">template</span> <span class="n">this</span><span class="p">:</span> <span class="n">untyped</span> <span class="o">=</span> <span class="n">result</span>
  <span class="n">this</span> <span class="o">=</span> <span class="n">new</span><span class="p">(</span><span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists</span><span class="p">)</span>
  <span class="k">let</span> <span class="n">root</span> <span class="o">=</span> <span class="k">if</span> <span class="n">root</span> <span class="o">==</span> <span class="kp">nil</span><span class="p">:</span> <span class="k">cast</span><span class="o">[</span><span class="n">ResourceFork</span><span class="o">]</span><span class="p">(</span><span class="n">this</span><span class="p">)</span> <span class="k">else</span><span class="p">:</span> <span class="k">cast</span><span class="o">[</span><span class="n">ResourceFork</span><span class="o">]</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
  <span class="n">this</span><span class="p">.</span><span class="n">io</span> <span class="o">=</span> <span class="n">io</span>
  <span class="n">this</span><span class="p">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">root</span>
  <span class="n">this</span><span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>


  <span class="sd">##[</span>
  <span class="n">The</span> <span class="n">resource</span> <span class="n">map</span><span class="sc">&#39;s resource type list.</span>
  <span class="o">]</span><span class="sd">##</span>
  <span class="k">let</span> <span class="n">typeListExpr</span> <span class="o">=</span> <span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_TypeList</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">,</span> <span class="n">this</span><span class="p">.</span><span class="n">root</span><span class="p">,</span> <span class="n">this</span><span class="p">)</span>
  <span class="n">this</span><span class="p">.</span><span class="n">typeList</span> <span class="o">=</span> <span class="n">typeListExpr</span>

  <span class="sd">##[</span>
  <span class="n">Storage</span> <span class="n">area</span> <span class="k">for</span> <span class="n">the</span> <span class="n">resource</span> <span class="n">map</span><span class="sc">&#39;s resource reference lists.</span>

<span class="n">According</span> <span class="n">to</span> <span class="n">Inside</span> <span class="n">Macintosh</span><span class="p">,</span>
<span class="n">the</span> <span class="n">reference</span> <span class="n">lists</span> <span class="n">are</span> <span class="n">stored</span> <span class="n">contiguously</span><span class="p">,</span>
<span class="ow">in</span> <span class="n">the</span> <span class="n">same</span> <span class="n">order</span> <span class="k">as</span> <span class="n">their</span> <span class="n">corresponding</span> <span class="n">resource</span> <span class="k">type</span> <span class="n">list</span> <span class="n">entries</span><span class="p">.</span>

  <span class="o">]</span><span class="sd">##</span>
  <span class="k">let</span> <span class="n">referenceListsExpr</span> <span class="o">=</span> <span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readBytesFull</span><span class="p">()</span>
  <span class="n">this</span><span class="p">.</span><span class="n">referenceLists</span> <span class="o">=</span> <span class="n">referenceListsExpr</span>

<span class="k">proc </span><span class="nf">fromFile</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork_ResourceMap_TypeListAndReferenceLists], filename: string): ResourceFork_ResourceMap_TypeListAndReferenceLists =</span>
  <span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">newKaitaiFileStream</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span> <span class="kp">nil</span><span class="p">,</span> <span class="kp">nil</span><span class="p">)</span>


<span class="sd">##[</span>
<span class="n">Resource</span> <span class="k">type</span> <span class="n">list</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">resource</span> <span class="n">map</span><span class="p">.</span>
<span class="o">]</span><span class="sd">##</span>
<span class="k">proc </span><span class="nf">read</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork_ResourceMap_TypeListAndReferenceLists_TypeList], io: KaitaiStream, root: KaitaiStruct, parent: ResourceFork_ResourceMap_TypeListAndReferenceLists): ResourceFork_ResourceMap_TypeListAndReferenceLists_TypeList =</span>
  <span class="k">template</span> <span class="n">this</span><span class="p">:</span> <span class="n">untyped</span> <span class="o">=</span> <span class="n">result</span>
  <span class="n">this</span> <span class="o">=</span> <span class="n">new</span><span class="p">(</span><span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_TypeList</span><span class="p">)</span>
  <span class="k">let</span> <span class="n">root</span> <span class="o">=</span> <span class="k">if</span> <span class="n">root</span> <span class="o">==</span> <span class="kp">nil</span><span class="p">:</span> <span class="k">cast</span><span class="o">[</span><span class="n">ResourceFork</span><span class="o">]</span><span class="p">(</span><span class="n">this</span><span class="p">)</span> <span class="k">else</span><span class="p">:</span> <span class="k">cast</span><span class="o">[</span><span class="n">ResourceFork</span><span class="o">]</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
  <span class="n">this</span><span class="p">.</span><span class="n">io</span> <span class="o">=</span> <span class="n">io</span>
  <span class="n">this</span><span class="p">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">root</span>
  <span class="n">this</span><span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>


  <span class="sd">##[</span>
  <span class="n">The</span> <span class="n">number</span> <span class="k">of</span> <span class="n">resource</span> <span class="n">types</span> <span class="ow">in</span> <span class="n">this</span> <span class="n">list</span><span class="p">,</span>
<span class="n">minus</span> <span class="n">one</span><span class="p">.</span>

<span class="k">If</span> <span class="n">the</span> <span class="n">resource</span> <span class="n">list</span> <span class="ow">is</span> <span class="n">empty</span><span class="p">,</span>
<span class="n">the</span> <span class="n">value</span> <span class="k">of</span> <span class="n">this</span> <span class="n">field</span> <span class="ow">is</span> <span class="p">`</span><span class="mh">0xffff</span><span class="p">`,</span>
<span class="n">i</span><span class="p">.</span> <span class="n">e</span><span class="p">.</span> <span class="p">`</span><span class="o">-</span><span class="mi">1</span><span class="p">`</span> <span class="n">truncated</span> <span class="n">to</span> <span class="n">a</span> <span class="mi">16</span><span class="o">-</span><span class="n">bit</span> <span class="n">unsigned</span> <span class="n">integer</span><span class="p">.</span>

  <span class="o">]</span><span class="sd">##</span>
  <span class="k">let</span> <span class="n">numTypesM1Expr</span> <span class="o">=</span> <span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readU2be</span><span class="p">()</span>
  <span class="n">this</span><span class="p">.</span><span class="n">numTypesM1</span> <span class="o">=</span> <span class="n">numTypesM1Expr</span>

  <span class="sd">##[</span>
  <span class="n">Entries</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">resource</span> <span class="k">type</span> <span class="n">list</span><span class="p">.</span>
  <span class="o">]</span><span class="sd">##</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="mi">0</span> <span class="p">..</span><span class="o">&lt;</span> <span class="kt">int</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">numTypes</span><span class="p">):</span>
    <span class="k">let</span> <span class="n">it</span> <span class="o">=</span> <span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_TypeList_TypeListEntry</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">,</span> <span class="n">this</span><span class="p">.</span><span class="n">root</span><span class="p">,</span> <span class="n">this</span><span class="p">)</span>
    <span class="n">this</span><span class="p">.</span><span class="n">entries</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">it</span><span class="p">)</span>

<span class="k">proc </span><span class="nf">numTypes</span><span class="p">(</span><span class="n">this</span><span class="p">:</span> <span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_TypeList</span><span class="p">):</span> <span class="kt">int</span> <span class="o">=</span> 

  <span class="sd">##[</span>
  <span class="n">The</span> <span class="n">number</span> <span class="k">of</span> <span class="n">resource</span> <span class="n">types</span> <span class="ow">in</span> <span class="n">this</span> <span class="n">list</span><span class="p">.</span>
  <span class="o">]</span><span class="sd">##</span>
  <span class="k">if</span> <span class="n">this</span><span class="p">.</span><span class="n">numTypesInstFlag</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">this</span><span class="p">.</span><span class="n">numTypesInst</span>
  <span class="k">let</span> <span class="n">numTypesInstExpr</span> <span class="o">=</span> <span class="kt">int</span><span class="p">(((</span><span class="n">this</span><span class="p">.</span><span class="n">numTypesM1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%%%</span> <span class="mi">65536</span><span class="p">))</span>
  <span class="n">this</span><span class="p">.</span><span class="n">numTypesInst</span> <span class="o">=</span> <span class="n">numTypesInstExpr</span>
  <span class="n">this</span><span class="p">.</span><span class="n">numTypesInstFlag</span> <span class="o">=</span> <span class="kp">true</span>
  <span class="k">return</span> <span class="n">this</span><span class="p">.</span><span class="n">numTypesInst</span>

<span class="k">proc </span><span class="nf">fromFile</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork_ResourceMap_TypeListAndReferenceLists_TypeList], filename: string): ResourceFork_ResourceMap_TypeListAndReferenceLists_TypeList =</span>
  <span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_TypeList</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">newKaitaiFileStream</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span> <span class="kp">nil</span><span class="p">,</span> <span class="kp">nil</span><span class="p">)</span>


<span class="sd">##[</span>
<span class="n">A</span> <span class="n">single</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">resource</span> <span class="k">type</span> <span class="n">list</span><span class="p">.</span>

<span class="n">Each</span> <span class="n">entry</span> <span class="n">corresponds</span> <span class="n">to</span> <span class="n">exactly</span> <span class="n">one</span> <span class="n">resource</span> <span class="n">reference</span> <span class="n">list</span><span class="p">.</span>

<span class="o">]</span><span class="sd">##</span>
<span class="k">proc </span><span class="nf">read</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork_ResourceMap_TypeListAndReferenceLists_TypeList_TypeListEntry], io: KaitaiStream, root: KaitaiStruct, parent: ResourceFork_ResourceMap_TypeListAndReferenceLists_TypeList): ResourceFork_ResourceMap_TypeListAndReferenceLists_TypeList_TypeListEntry =</span>
  <span class="k">template</span> <span class="n">this</span><span class="p">:</span> <span class="n">untyped</span> <span class="o">=</span> <span class="n">result</span>
  <span class="n">this</span> <span class="o">=</span> <span class="n">new</span><span class="p">(</span><span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_TypeList_TypeListEntry</span><span class="p">)</span>
  <span class="k">let</span> <span class="n">root</span> <span class="o">=</span> <span class="k">if</span> <span class="n">root</span> <span class="o">==</span> <span class="kp">nil</span><span class="p">:</span> <span class="k">cast</span><span class="o">[</span><span class="n">ResourceFork</span><span class="o">]</span><span class="p">(</span><span class="n">this</span><span class="p">)</span> <span class="k">else</span><span class="p">:</span> <span class="k">cast</span><span class="o">[</span><span class="n">ResourceFork</span><span class="o">]</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
  <span class="n">this</span><span class="p">.</span><span class="n">io</span> <span class="o">=</span> <span class="n">io</span>
  <span class="n">this</span><span class="p">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">root</span>
  <span class="n">this</span><span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>


  <span class="sd">##[</span>
  <span class="n">The</span> <span class="n">four</span><span class="o">-</span><span class="n">character</span> <span class="k">type</span> <span class="n">code</span> <span class="k">of</span> <span class="n">the</span> <span class="n">resources</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">reference</span> <span class="n">list</span><span class="p">.</span>
  <span class="o">]</span><span class="sd">##</span>
  <span class="k">let</span> <span class="n">typeExpr</span> <span class="o">=</span> <span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readBytes</span><span class="p">(</span><span class="kt">int</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
  <span class="n">this</span><span class="p">.</span><span class="k">type</span> <span class="o">=</span> <span class="n">typeExpr</span>

  <span class="sd">##[</span>
  <span class="n">The</span> <span class="n">number</span> <span class="k">of</span> <span class="n">resources</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">reference</span> <span class="n">list</span> <span class="k">for</span> <span class="n">this</span> <span class="k">type</span><span class="p">,</span>
<span class="n">minus</span> <span class="n">one</span><span class="p">.</span>

<span class="n">Empty</span> <span class="n">reference</span> <span class="n">lists</span> <span class="n">should</span> <span class="n">never</span> <span class="n">exist</span><span class="p">.</span>

  <span class="o">]</span><span class="sd">##</span>
  <span class="k">let</span> <span class="n">numReferencesM1Expr</span> <span class="o">=</span> <span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readU2be</span><span class="p">()</span>
  <span class="n">this</span><span class="p">.</span><span class="n">numReferencesM1</span> <span class="o">=</span> <span class="n">numReferencesM1Expr</span>

  <span class="sd">##[</span>
  <span class="n">Offset</span> <span class="k">of</span> <span class="n">the</span> <span class="n">resource</span> <span class="n">reference</span> <span class="n">list</span> <span class="k">for</span> <span class="n">this</span> <span class="n">resource</span> <span class="k">type</span><span class="p">,</span>
<span class="kn">from</span> <span class="n">the</span> <span class="n">start</span> <span class="k">of</span> <span class="n">the</span> <span class="n">resource</span> <span class="k">type</span> <span class="n">list</span><span class="p">.</span>

<span class="n">Although</span> <span class="n">the</span> <span class="n">offset</span> <span class="ow">is</span> <span class="n">relative</span> <span class="n">to</span> <span class="n">the</span> <span class="n">start</span> <span class="k">of</span> <span class="n">the</span> <span class="k">type</span> <span class="n">list</span><span class="p">,</span>
<span class="n">it</span> <span class="n">should</span> <span class="n">never</span> <span class="n">point</span> <span class="n">into</span> <span class="n">the</span> <span class="k">type</span> <span class="n">list</span> <span class="n">itself</span><span class="p">,</span>
<span class="n">but</span> <span class="n">into</span> <span class="n">the</span> <span class="n">reference</span> <span class="n">list</span> <span class="n">storage</span> <span class="n">area</span> <span class="n">that</span> <span class="n">directly</span> <span class="n">follows</span> <span class="n">it</span><span class="p">.</span>
<span class="n">That</span> <span class="ow">is</span><span class="p">,</span>
<span class="n">it</span> <span class="n">should</span> <span class="n">always</span> <span class="n">be</span> <span class="n">at</span> <span class="n">least</span> <span class="p">`</span><span class="err">_parent._sizeof`.</span>

  <span class="o">]</span><span class="sd">##</span>
  <span class="k">let</span> <span class="n">ofsReferenceListExpr</span> <span class="o">=</span> <span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readU2be</span><span class="p">()</span>
  <span class="n">this</span><span class="p">.</span><span class="n">ofsReferenceList</span> <span class="o">=</span> <span class="n">ofsReferenceListExpr</span>

<span class="k">proc </span><span class="nf">numReferences</span><span class="p">(</span><span class="n">this</span><span class="p">:</span> <span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_TypeList_TypeListEntry</span><span class="p">):</span> <span class="kt">int</span> <span class="o">=</span> 

  <span class="sd">##[</span>
  <span class="n">The</span> <span class="n">number</span> <span class="k">of</span> <span class="n">resources</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">reference</span> <span class="n">list</span> <span class="k">for</span> <span class="n">this</span> <span class="k">type</span><span class="p">.</span>
  <span class="o">]</span><span class="sd">##</span>
  <span class="k">if</span> <span class="n">this</span><span class="p">.</span><span class="n">numReferencesInstFlag</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">this</span><span class="p">.</span><span class="n">numReferencesInst</span>
  <span class="k">let</span> <span class="n">numReferencesInstExpr</span> <span class="o">=</span> <span class="kt">int</span><span class="p">(((</span><span class="n">this</span><span class="p">.</span><span class="n">numReferencesM1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%%%</span> <span class="mi">65536</span><span class="p">))</span>
  <span class="n">this</span><span class="p">.</span><span class="n">numReferencesInst</span> <span class="o">=</span> <span class="n">numReferencesInstExpr</span>
  <span class="n">this</span><span class="p">.</span><span class="n">numReferencesInstFlag</span> <span class="o">=</span> <span class="kp">true</span>
  <span class="k">return</span> <span class="n">this</span><span class="p">.</span><span class="n">numReferencesInst</span>

<span class="k">proc </span><span class="nf">referenceList</span><span class="p">(</span><span class="n">this</span><span class="p">:</span> <span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_TypeList_TypeListEntry</span><span class="p">):</span> <span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList</span> <span class="o">=</span> 

  <span class="sd">##[</span>
  <span class="n">The</span> <span class="n">resource</span> <span class="n">reference</span> <span class="n">list</span> <span class="k">for</span> <span class="n">this</span> <span class="n">resource</span> <span class="k">type</span><span class="p">.</span>

  <span class="o">]</span><span class="sd">##</span>
  <span class="k">if</span> <span class="n">this</span><span class="p">.</span><span class="n">referenceListInstFlag</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">this</span><span class="p">.</span><span class="n">referenceListInst</span>
  <span class="k">let</span> <span class="n">io</span> <span class="o">=</span> <span class="n">this</span><span class="p">.</span><span class="n">parent</span><span class="p">.</span><span class="n">parent</span><span class="p">.</span><span class="n">io</span>
  <span class="k">let</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">io</span><span class="p">.</span><span class="n">pos</span><span class="p">()</span>
  <span class="n">io</span><span class="p">.</span><span class="n">seek</span><span class="p">(</span><span class="kt">int</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">ofsReferenceList</span><span class="p">))</span>
  <span class="k">let</span> <span class="n">referenceListInstExpr</span> <span class="o">=</span> <span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">io</span><span class="p">,</span> <span class="n">this</span><span class="p">.</span><span class="n">root</span><span class="p">,</span> <span class="n">this</span><span class="p">,</span> <span class="n">this</span><span class="p">.</span><span class="n">numReferences</span><span class="p">)</span>
  <span class="n">this</span><span class="p">.</span><span class="n">referenceListInst</span> <span class="o">=</span> <span class="n">referenceListInstExpr</span>
  <span class="n">io</span><span class="p">.</span><span class="n">seek</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
  <span class="n">this</span><span class="p">.</span><span class="n">referenceListInstFlag</span> <span class="o">=</span> <span class="kp">true</span>
  <span class="k">return</span> <span class="n">this</span><span class="p">.</span><span class="n">referenceListInst</span>

<span class="k">proc </span><span class="nf">fromFile</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork_ResourceMap_TypeListAndReferenceLists_TypeList_TypeListEntry], filename: string): ResourceFork_ResourceMap_TypeListAndReferenceLists_TypeList_TypeListEntry =</span>
  <span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_TypeList_TypeListEntry</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">newKaitaiFileStream</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span> <span class="kp">nil</span><span class="p">,</span> <span class="kp">nil</span><span class="p">)</span>


<span class="sd">##[</span>
<span class="n">A</span> <span class="n">resource</span> <span class="n">reference</span> <span class="n">list</span><span class="p">,</span>
<span class="k">as</span> <span class="n">stored</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">reference</span> <span class="n">list</span> <span class="n">area</span><span class="p">.</span>

<span class="n">Each</span> <span class="n">reference</span> <span class="n">list</span> <span class="n">has</span> <span class="n">exactly</span> <span class="n">one</span> <span class="n">matching</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">resource</span> <span class="k">type</span> <span class="n">list</span><span class="p">,</span>
<span class="ow">and</span> <span class="n">describes</span> <span class="n">all</span> <span class="n">resources</span> <span class="k">of</span> <span class="n">a</span> <span class="n">single</span> <span class="k">type</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">file</span><span class="p">.</span>

<span class="o">]</span><span class="sd">##</span>
<span class="k">proc </span><span class="nf">read</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList], io: KaitaiStream, root: KaitaiStruct, parent: ResourceFork_ResourceMap_TypeListAndReferenceLists_TypeList_TypeListEntry, numReferences: any): ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList =</span>
  <span class="k">template</span> <span class="n">this</span><span class="p">:</span> <span class="n">untyped</span> <span class="o">=</span> <span class="n">result</span>
  <span class="n">this</span> <span class="o">=</span> <span class="n">new</span><span class="p">(</span><span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList</span><span class="p">)</span>
  <span class="k">let</span> <span class="n">root</span> <span class="o">=</span> <span class="k">if</span> <span class="n">root</span> <span class="o">==</span> <span class="kp">nil</span><span class="p">:</span> <span class="k">cast</span><span class="o">[</span><span class="n">ResourceFork</span><span class="o">]</span><span class="p">(</span><span class="n">this</span><span class="p">)</span> <span class="k">else</span><span class="p">:</span> <span class="k">cast</span><span class="o">[</span><span class="n">ResourceFork</span><span class="o">]</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
  <span class="n">this</span><span class="p">.</span><span class="n">io</span> <span class="o">=</span> <span class="n">io</span>
  <span class="n">this</span><span class="p">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">root</span>
  <span class="n">this</span><span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
  <span class="k">let</span> <span class="n">numReferencesExpr</span> <span class="o">=</span> <span class="n">uint16</span><span class="p">(</span><span class="n">numReferences</span><span class="p">)</span>
  <span class="n">this</span><span class="p">.</span><span class="n">numReferences</span> <span class="o">=</span> <span class="n">numReferencesExpr</span>


  <span class="sd">##[</span>
  <span class="n">The</span> <span class="n">resource</span> <span class="n">references</span> <span class="ow">in</span> <span class="n">this</span> <span class="n">reference</span> <span class="n">list</span><span class="p">.</span>
  <span class="o">]</span><span class="sd">##</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="mi">0</span> <span class="p">..</span><span class="o">&lt;</span> <span class="kt">int</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">numReferences</span><span class="p">):</span>
    <span class="k">let</span> <span class="n">it</span> <span class="o">=</span> <span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">,</span> <span class="n">this</span><span class="p">.</span><span class="n">root</span><span class="p">,</span> <span class="n">this</span><span class="p">)</span>
    <span class="n">this</span><span class="p">.</span><span class="n">references</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">it</span><span class="p">)</span>

<span class="k">proc </span><span class="nf">fromFile</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList], filename: string): ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList =</span>
  <span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">newKaitaiFileStream</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span> <span class="kp">nil</span><span class="p">,</span> <span class="kp">nil</span><span class="p">)</span>


<span class="sd">##[</span>
<span class="n">A</span> <span class="n">single</span> <span class="n">resource</span> <span class="n">reference</span> <span class="ow">in</span> <span class="n">a</span> <span class="n">resource</span> <span class="n">reference</span> <span class="n">list</span><span class="p">.</span>
<span class="o">]</span><span class="sd">##</span>
<span class="k">proc </span><span class="nf">read</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference], io: KaitaiStream, root: KaitaiStruct, parent: ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList): ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference =</span>
  <span class="k">template</span> <span class="n">this</span><span class="p">:</span> <span class="n">untyped</span> <span class="o">=</span> <span class="n">result</span>
  <span class="n">this</span> <span class="o">=</span> <span class="n">new</span><span class="p">(</span><span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference</span><span class="p">)</span>
  <span class="k">let</span> <span class="n">root</span> <span class="o">=</span> <span class="k">if</span> <span class="n">root</span> <span class="o">==</span> <span class="kp">nil</span><span class="p">:</span> <span class="k">cast</span><span class="o">[</span><span class="n">ResourceFork</span><span class="o">]</span><span class="p">(</span><span class="n">this</span><span class="p">)</span> <span class="k">else</span><span class="p">:</span> <span class="k">cast</span><span class="o">[</span><span class="n">ResourceFork</span><span class="o">]</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
  <span class="n">this</span><span class="p">.</span><span class="n">io</span> <span class="o">=</span> <span class="n">io</span>
  <span class="n">this</span><span class="p">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">root</span>
  <span class="n">this</span><span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>


  <span class="sd">##[</span>
  <span class="n">ID</span> <span class="k">of</span> <span class="n">the</span> <span class="n">resource</span> <span class="n">described</span> <span class="n">by</span> <span class="n">this</span> <span class="n">reference</span><span class="p">.</span>
  <span class="o">]</span><span class="sd">##</span>
  <span class="k">let</span> <span class="n">idExpr</span> <span class="o">=</span> <span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readS2be</span><span class="p">()</span>
  <span class="n">this</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">idExpr</span>

  <span class="sd">##[</span>
  <span class="n">Offset</span> <span class="k">of</span> <span class="n">the</span> <span class="n">name</span> <span class="k">for</span> <span class="n">the</span> <span class="n">resource</span> <span class="n">described</span> <span class="n">by</span> <span class="n">this</span> <span class="n">reference</span><span class="p">,</span>
<span class="kn">from</span> <span class="n">the</span> <span class="n">start</span> <span class="k">of</span> <span class="n">the</span> <span class="n">resource</span> <span class="n">name</span> <span class="n">area</span><span class="p">.</span>

<span class="k">If</span> <span class="n">the</span> <span class="n">resource</span> <span class="n">has</span> <span class="n">no</span> <span class="n">name</span><span class="p">,</span>
<span class="n">the</span> <span class="n">value</span> <span class="k">of</span> <span class="n">this</span> <span class="n">field</span> <span class="ow">is</span> <span class="p">`</span><span class="mh">0xffff</span><span class="p">`</span>
<span class="n">i</span><span class="p">.</span> <span class="n">e</span><span class="p">.</span> <span class="p">`</span><span class="o">-</span><span class="mi">1</span><span class="p">`</span> <span class="n">truncated</span> <span class="n">to</span> <span class="n">a</span> <span class="mi">16</span><span class="o">-</span><span class="n">bit</span> <span class="n">unsigned</span> <span class="n">integer</span><span class="p">.</span>

  <span class="o">]</span><span class="sd">##</span>
  <span class="k">let</span> <span class="n">ofsNameExpr</span> <span class="o">=</span> <span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readU2be</span><span class="p">()</span>
  <span class="n">this</span><span class="p">.</span><span class="n">ofsName</span> <span class="o">=</span> <span class="n">ofsNameExpr</span>

  <span class="sd">##[</span>
  <span class="n">Attributes</span> <span class="k">of</span> <span class="n">the</span> <span class="n">resource</span> <span class="n">described</span> <span class="n">by</span> <span class="n">this</span> <span class="n">reference</span><span class="p">.</span>
  <span class="o">]</span><span class="sd">##</span>
  <span class="k">let</span> <span class="n">rawAttributesExpr</span> <span class="o">=</span> <span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readBytes</span><span class="p">(</span><span class="kt">int</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
  <span class="n">this</span><span class="p">.</span><span class="n">rawAttributes</span> <span class="o">=</span> <span class="n">rawAttributesExpr</span>
  <span class="k">let</span> <span class="n">rawAttributesIo</span> <span class="o">=</span> <span class="n">newKaitaiStream</span><span class="p">(</span><span class="n">rawAttributesExpr</span><span class="p">)</span>
  <span class="k">let</span> <span class="n">attributesExpr</span> <span class="o">=</span> <span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference_Attributes</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">rawAttributesIo</span><span class="p">,</span> <span class="n">this</span><span class="p">.</span><span class="n">root</span><span class="p">,</span> <span class="n">this</span><span class="p">)</span>
  <span class="n">this</span><span class="p">.</span><span class="n">attributes</span> <span class="o">=</span> <span class="n">attributesExpr</span>

  <span class="sd">##[</span>
  <span class="n">Offset</span> <span class="k">of</span> <span class="n">the</span> <span class="n">data</span> <span class="k">block</span> <span class="k">for</span> <span class="n">the</span> <span class="n">resource</span> <span class="n">described</span> <span class="n">by</span> <span class="n">this</span> <span class="n">reference</span><span class="p">,</span>
<span class="kn">from</span> <span class="n">the</span> <span class="n">start</span> <span class="k">of</span> <span class="n">the</span> <span class="n">resource</span> <span class="n">data</span> <span class="n">area</span><span class="p">.</span>

  <span class="o">]</span><span class="sd">##</span>
  <span class="k">let</span> <span class="n">ofsDataBlockExpr</span> <span class="o">=</span> <span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readBitsIntBe</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span>
  <span class="n">this</span><span class="p">.</span><span class="n">ofsDataBlock</span> <span class="o">=</span> <span class="n">ofsDataBlockExpr</span>
  <span class="n">alignToByte</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">)</span>

  <span class="sd">##[</span>
  <span class="n">Reserved</span> <span class="n">space</span> <span class="k">for</span> <span class="n">the</span> <span class="n">resource</span><span class="sc">&#39;s handle in memory.</span>
  <span class="o">]</span><span class="sd">##</span>
  <span class="k">let</span> <span class="n">reservedHandleExpr</span> <span class="o">=</span> <span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readU4be</span><span class="p">()</span>
  <span class="n">this</span><span class="p">.</span><span class="n">reservedHandle</span> <span class="o">=</span> <span class="n">reservedHandleExpr</span>

<span class="k">proc </span><span class="nf">name</span><span class="p">(</span><span class="n">this</span><span class="p">:</span> <span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference</span><span class="p">):</span> <span class="n">ResourceFork_ResourceMap_Name</span> <span class="o">=</span> 

  <span class="sd">##[</span>
  <span class="n">The</span> <span class="n">name</span> <span class="p">(</span><span class="k">if</span> <span class="n">any</span><span class="p">)</span> <span class="k">of</span> <span class="n">the</span> <span class="n">resource</span> <span class="n">described</span> <span class="n">by</span> <span class="n">this</span> <span class="n">reference</span><span class="p">.</span>

  <span class="o">]</span><span class="sd">##</span>
  <span class="k">if</span> <span class="n">this</span><span class="p">.</span><span class="n">nameInstFlag</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">this</span><span class="p">.</span><span class="n">nameInst</span>
  <span class="k">if</span> <span class="n">this</span><span class="p">.</span><span class="n">ofsName</span> <span class="o">!=</span> <span class="mi">65535</span><span class="p">:</span>
    <span class="k">let</span> <span class="n">io</span> <span class="o">=</span> <span class="n">ResourceFork</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">root</span><span class="p">).</span><span class="n">resourceMap</span><span class="p">.</span><span class="n">namesWithIo</span><span class="p">.</span><span class="n">io</span>
    <span class="k">let</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">io</span><span class="p">.</span><span class="n">pos</span><span class="p">()</span>
    <span class="n">io</span><span class="p">.</span><span class="n">seek</span><span class="p">(</span><span class="kt">int</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">ofsName</span><span class="p">))</span>
    <span class="k">let</span> <span class="n">nameInstExpr</span> <span class="o">=</span> <span class="n">ResourceFork_ResourceMap_Name</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">io</span><span class="p">,</span> <span class="n">this</span><span class="p">.</span><span class="n">root</span><span class="p">,</span> <span class="n">this</span><span class="p">)</span>
    <span class="n">this</span><span class="p">.</span><span class="n">nameInst</span> <span class="o">=</span> <span class="n">nameInstExpr</span>
    <span class="n">io</span><span class="p">.</span><span class="n">seek</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
  <span class="n">this</span><span class="p">.</span><span class="n">nameInstFlag</span> <span class="o">=</span> <span class="kp">true</span>
  <span class="k">return</span> <span class="n">this</span><span class="p">.</span><span class="n">nameInst</span>

<span class="k">proc </span><span class="nf">dataBlock</span><span class="p">(</span><span class="n">this</span><span class="p">:</span> <span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference</span><span class="p">):</span> <span class="n">ResourceFork_DataBlock</span> <span class="o">=</span> 

  <span class="sd">##[</span>
  <span class="n">The</span> <span class="n">data</span> <span class="k">block</span> <span class="n">containing</span> <span class="n">the</span> <span class="n">data</span> <span class="k">for</span> <span class="n">the</span> <span class="n">resource</span> <span class="n">described</span> <span class="n">by</span> <span class="n">this</span> <span class="n">reference</span><span class="p">.</span>

  <span class="o">]</span><span class="sd">##</span>
  <span class="k">if</span> <span class="n">this</span><span class="p">.</span><span class="n">dataBlockInstFlag</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">this</span><span class="p">.</span><span class="n">dataBlockInst</span>
  <span class="k">let</span> <span class="n">io</span> <span class="o">=</span> <span class="n">ResourceFork</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">root</span><span class="p">).</span><span class="n">dataBlocksWithIo</span><span class="p">.</span><span class="n">io</span>
  <span class="k">let</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">io</span><span class="p">.</span><span class="n">pos</span><span class="p">()</span>
  <span class="n">io</span><span class="p">.</span><span class="n">seek</span><span class="p">(</span><span class="kt">int</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">ofsDataBlock</span><span class="p">))</span>
  <span class="k">let</span> <span class="n">dataBlockInstExpr</span> <span class="o">=</span> <span class="n">ResourceFork_DataBlock</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">io</span><span class="p">,</span> <span class="n">this</span><span class="p">.</span><span class="n">root</span><span class="p">,</span> <span class="n">this</span><span class="p">)</span>
  <span class="n">this</span><span class="p">.</span><span class="n">dataBlockInst</span> <span class="o">=</span> <span class="n">dataBlockInstExpr</span>
  <span class="n">io</span><span class="p">.</span><span class="n">seek</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
  <span class="n">this</span><span class="p">.</span><span class="n">dataBlockInstFlag</span> <span class="o">=</span> <span class="kp">true</span>
  <span class="k">return</span> <span class="n">this</span><span class="p">.</span><span class="n">dataBlockInst</span>

<span class="k">proc </span><span class="nf">fromFile</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference], filename: string): ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference =</span>
  <span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">newKaitaiFileStream</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span> <span class="kp">nil</span><span class="p">,</span> <span class="kp">nil</span><span class="p">)</span>


<span class="sd">##[</span>
<span class="n">A</span> <span class="n">resource</span><span class="sc">&#39;s attributes,</span>
<span class="k">as</span> <span class="n">stored</span> <span class="ow">in</span> <span class="n">a</span> <span class="n">resource</span> <span class="n">reference</span><span class="p">.</span>

<span class="o">]</span><span class="sd">##</span>
<span class="k">proc </span><span class="nf">read</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference_Attributes], io: KaitaiStream, root: KaitaiStruct, parent: ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference): ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference_Attributes =</span>
  <span class="k">template</span> <span class="n">this</span><span class="p">:</span> <span class="n">untyped</span> <span class="o">=</span> <span class="n">result</span>
  <span class="n">this</span> <span class="o">=</span> <span class="n">new</span><span class="p">(</span><span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference_Attributes</span><span class="p">)</span>
  <span class="k">let</span> <span class="n">root</span> <span class="o">=</span> <span class="k">if</span> <span class="n">root</span> <span class="o">==</span> <span class="kp">nil</span><span class="p">:</span> <span class="k">cast</span><span class="o">[</span><span class="n">ResourceFork</span><span class="o">]</span><span class="p">(</span><span class="n">this</span><span class="p">)</span> <span class="k">else</span><span class="p">:</span> <span class="k">cast</span><span class="o">[</span><span class="n">ResourceFork</span><span class="o">]</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
  <span class="n">this</span><span class="p">.</span><span class="n">io</span> <span class="o">=</span> <span class="n">io</span>
  <span class="n">this</span><span class="p">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">root</span>
  <span class="n">this</span><span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>


  <span class="sd">##[</span>
  <span class="n">Indicates</span> <span class="n">that</span> <span class="n">this</span> <span class="n">resource</span> <span class="n">reference</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">system</span> <span class="n">reference</span> <span class="n">rather</span> <span class="n">than</span> <span class="n">a</span> <span class="n">regular</span> <span class="n">local</span> <span class="n">reference</span><span class="p">.</span>
<span class="n">This</span> <span class="n">attribute</span> <span class="ow">is</span> <span class="n">nearly</span> <span class="n">undocumented</span><span class="p">.</span>
<span class="k">For</span> <span class="n">all</span> <span class="n">practical</span> <span class="n">purposes</span><span class="p">,</span>
<span class="n">it</span> <span class="n">should</span> <span class="n">be</span> <span class="n">considered</span> <span class="n">reserved</span> <span class="ow">and</span> <span class="n">should</span> <span class="n">always</span> <span class="n">be</span> <span class="n">zero</span><span class="p">.</span>

<span class="n">This</span> <span class="n">attribute</span> <span class="n">was</span> <span class="n">last</span> <span class="n">documented</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">Promotional</span> <span class="n">Edition</span> <span class="k">of</span> <span class="n">Inside</span> <span class="n">Macintosh</span><span class="p">,</span>
<span class="ow">in</span> <span class="n">the</span> <span class="n">Resource</span> <span class="n">Manager</span> <span class="n">chapter</span><span class="p">,</span>
<span class="n">on</span> <span class="n">pages</span> <span class="mi">37</span><span class="o">-</span><span class="mi">41</span><span class="p">,</span>
<span class="ow">in</span> <span class="n">a</span> <span class="s">&quot;System References&quot;</span> <span class="n">section</span> <span class="n">that</span> <span class="n">calls</span> <span class="n">itself</span> <span class="s">&quot;of historical interest only&quot;</span><span class="p">.</span>
<span class="n">The</span> <span class="n">final</span> <span class="n">versions</span> <span class="k">of</span> <span class="n">Inside</span> <span class="n">Macintosh</span> <span class="n">only</span> <span class="n">mention</span> <span class="n">this</span> <span class="n">attribute</span> <span class="k">as</span> <span class="s">&quot;reserved for use by the Resource Manager&quot;</span><span class="p">.</span>
<span class="o">&lt;</span><span class="n">CarbonCore</span><span class="o">/</span><span class="n">Resources</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;</span> <span class="n">contains</span> <span class="n">a</span> <span class="p">`</span><span class="n">resSysRefBit</span><span class="p">`</span> <span class="n">constant</span><span class="p">,</span>
<span class="n">but</span> <span class="n">no</span> <span class="n">corresponding</span> <span class="p">`</span><span class="n">resSysRef</span><span class="p">`</span> <span class="n">constant</span> <span class="n">like</span> <span class="k">for</span> <span class="n">all</span> <span class="n">other</span> <span class="n">resource</span> <span class="n">attributes</span><span class="p">.</span>

<span class="n">According</span> <span class="n">to</span> <span class="n">the</span> <span class="n">Inside</span> <span class="n">Macintosh</span> <span class="n">Promotional</span> <span class="n">Edition</span><span class="p">,</span>
<span class="n">a</span> <span class="n">system</span> <span class="n">reference</span> <span class="n">was</span> <span class="n">effectively</span> <span class="n">an</span> <span class="n">alias</span> <span class="n">pointing</span> <span class="n">to</span> <span class="n">a</span> <span class="n">resource</span> <span class="n">stored</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">system</span> <span class="n">file</span><span class="p">,</span>
<span class="n">possibly</span> <span class="n">with</span> <span class="n">a</span> <span class="n">different</span> <span class="n">ID</span> <span class="ow">and</span> <span class="n">name</span> <span class="p">(</span><span class="n">but</span> <span class="ow">not</span> <span class="k">type</span><span class="p">)</span> <span class="n">than</span> <span class="n">the</span> <span class="n">system</span> <span class="n">reference</span><span class="p">.</span>
<span class="k">If</span> <span class="n">this</span> <span class="n">attribute</span> <span class="ow">is</span> <span class="kt">set</span><span class="p">,</span>
<span class="p">`</span><span class="n">ofs_data_block</span><span class="p">`</span> <span class="ow">is</span> <span class="n">ignored</span> <span class="ow">and</span> <span class="n">should</span> <span class="n">be</span> <span class="n">zero</span><span class="p">,</span>
<span class="ow">and</span> <span class="p">`</span><span class="n">reserved_handle</span><span class="p">`</span> <span class="n">contains</span>
<span class="p">(</span><span class="ow">in</span> <span class="n">its</span> <span class="n">high</span> <span class="ow">and</span> <span class="n">low</span> <span class="n">two</span> <span class="n">bytes</span><span class="p">,</span> <span class="n">respectively</span><span class="p">)</span>
<span class="n">the</span> <span class="n">ID</span> <span class="ow">and</span> <span class="n">name</span> <span class="n">offset</span> <span class="k">of</span> <span class="n">the</span> <span class="n">real</span> <span class="n">system</span> <span class="n">resource</span> <span class="n">that</span> <span class="n">this</span> <span class="n">system</span> <span class="n">reference</span> <span class="n">points</span> <span class="n">to</span><span class="p">.</span>

<span class="n">TODO</span> <span class="k">Do</span> <span class="n">any</span> <span class="n">publicly</span> <span class="n">available</span> <span class="n">Mac</span> <span class="n">OS</span> <span class="n">versions</span> <span class="n">support</span> <span class="n">system</span> <span class="n">references</span><span class="p">,</span>
<span class="ow">and</span> <span class="k">do</span> <span class="n">any</span> <span class="n">real</span> <span class="n">files</span><span class="o">/</span><span class="n">applications</span> <span class="n">use</span> <span class="n">them</span><span class="o">?</span>
<span class="n">So</span> <span class="n">far</span> <span class="n">the</span> <span class="n">answer</span> <span class="n">seems</span> <span class="n">to</span> <span class="n">be</span> <span class="n">no</span><span class="p">,</span>
<span class="n">but</span> <span class="n">I</span> <span class="n">would</span> <span class="n">like</span> <span class="n">to</span> <span class="n">be</span> <span class="n">proven</span> <span class="n">wrong</span><span class="o">!</span>

  <span class="o">]</span><span class="sd">##</span>
  <span class="k">let</span> <span class="n">systemReferenceExpr</span> <span class="o">=</span> <span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readBitsIntBe</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span>
  <span class="n">this</span><span class="p">.</span><span class="n">systemReference</span> <span class="o">=</span> <span class="n">systemReferenceExpr</span>

  <span class="sd">##[</span>
  <span class="n">Indicates</span> <span class="n">that</span> <span class="n">this</span> <span class="n">resource</span> <span class="n">should</span> <span class="n">be</span> <span class="n">loaded</span> <span class="n">into</span> <span class="n">the</span> <span class="n">system</span> <span class="n">heap</span> <span class="k">if</span> <span class="n">possible</span><span class="p">,</span>
<span class="n">rather</span> <span class="n">than</span> <span class="n">the</span> <span class="n">application</span> <span class="n">heap</span><span class="p">.</span>

<span class="n">This</span> <span class="n">attribute</span> <span class="ow">is</span> <span class="n">only</span> <span class="n">meant</span> <span class="n">to</span> <span class="n">be</span> <span class="n">used</span> <span class="n">by</span> <span class="n">Mac</span> <span class="n">OS</span> <span class="n">itself</span><span class="p">,</span>
<span class="k">for</span> <span class="n">System</span> <span class="ow">and</span> <span class="n">Finder</span> <span class="n">resources</span><span class="p">,</span>
<span class="ow">and</span> <span class="ow">not</span> <span class="n">by</span> <span class="n">normal</span> <span class="n">applications</span><span class="p">.</span>

<span class="n">This</span> <span class="n">attribute</span> <span class="n">may</span> <span class="n">be</span> <span class="kt">set</span> <span class="n">both</span> <span class="ow">in</span> <span class="n">memory</span> <span class="ow">and</span> <span class="n">on</span> <span class="n">disk</span><span class="p">,</span>
<span class="n">but</span> <span class="n">it</span> <span class="n">only</span> <span class="n">has</span> <span class="n">any</span> <span class="n">meaning</span> <span class="k">while</span> <span class="n">the</span> <span class="n">resource</span> <span class="n">file</span> <span class="ow">is</span> <span class="n">loaded</span> <span class="n">into</span> <span class="n">memory</span><span class="p">.</span>

  <span class="o">]</span><span class="sd">##</span>
  <span class="k">let</span> <span class="n">loadIntoSystemHeapExpr</span> <span class="o">=</span> <span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readBitsIntBe</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span>
  <span class="n">this</span><span class="p">.</span><span class="n">loadIntoSystemHeap</span> <span class="o">=</span> <span class="n">loadIntoSystemHeapExpr</span>

  <span class="sd">##[</span>
  <span class="n">Indicates</span> <span class="n">that</span> <span class="n">this</span> <span class="n">resource</span><span class="sc">&#39;s data should be purgeable by the Mac OS Memory Manager.</span>
<span class="n">This</span> <span class="n">allows</span> <span class="n">the</span> <span class="n">resource</span> <span class="n">data</span> <span class="n">to</span> <span class="n">be</span> <span class="n">purged</span> <span class="kn">from</span> <span class="n">memory</span> <span class="k">if</span> <span class="n">space</span> <span class="ow">is</span> <span class="n">needed</span> <span class="n">on</span> <span class="n">the</span> <span class="n">heap</span><span class="p">.</span>
<span class="n">Purged</span> <span class="n">resources</span> <span class="n">can</span> <span class="n">later</span> <span class="n">be</span> <span class="n">reloaded</span> <span class="kn">from</span> <span class="n">disk</span> <span class="k">if</span> <span class="n">their</span> <span class="n">data</span> <span class="ow">is</span> <span class="n">needed</span> <span class="n">again</span><span class="p">.</span>

<span class="k">If</span> <span class="n">the</span> <span class="p">`</span><span class="n">locked</span><span class="p">`</span> <span class="n">attribute</span> <span class="ow">is</span> <span class="kt">set</span><span class="p">,</span>
<span class="n">this</span> <span class="n">attribute</span> <span class="n">has</span> <span class="n">no</span> <span class="n">effect</span>
<span class="p">(</span><span class="n">i</span><span class="p">.</span> <span class="n">e</span><span class="p">.</span> <span class="n">locked</span> <span class="n">resources</span> <span class="n">are</span> <span class="n">never</span> <span class="n">purgeable</span><span class="p">).</span>

<span class="n">This</span> <span class="n">attribute</span> <span class="n">may</span> <span class="n">be</span> <span class="kt">set</span> <span class="n">both</span> <span class="ow">in</span> <span class="n">memory</span> <span class="ow">and</span> <span class="n">on</span> <span class="n">disk</span><span class="p">,</span>
<span class="n">but</span> <span class="n">it</span> <span class="n">only</span> <span class="n">has</span> <span class="n">any</span> <span class="n">meaning</span> <span class="k">while</span> <span class="n">the</span> <span class="n">resource</span> <span class="n">file</span> <span class="ow">is</span> <span class="n">loaded</span> <span class="n">into</span> <span class="n">memory</span><span class="p">.</span>

  <span class="o">]</span><span class="sd">##</span>
  <span class="k">let</span> <span class="n">purgeableExpr</span> <span class="o">=</span> <span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readBitsIntBe</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span>
  <span class="n">this</span><span class="p">.</span><span class="n">purgeable</span> <span class="o">=</span> <span class="n">purgeableExpr</span>

  <span class="sd">##[</span>
  <span class="n">Indicates</span> <span class="n">that</span> <span class="n">this</span> <span class="n">resource</span><span class="sc">&#39;s data should be locked to the Mac OS Memory Manager.</span>
<span class="n">This</span> <span class="n">prevents</span> <span class="n">the</span> <span class="n">resource</span> <span class="n">data</span> <span class="kn">from</span> <span class="n">being</span> <span class="n">moved</span> <span class="k">when</span> <span class="n">the</span> <span class="n">heap</span> <span class="ow">is</span> <span class="n">compacted</span><span class="p">.</span>

<span class="n">This</span> <span class="n">attribute</span> <span class="n">may</span> <span class="n">be</span> <span class="kt">set</span> <span class="n">both</span> <span class="ow">in</span> <span class="n">memory</span> <span class="ow">and</span> <span class="n">on</span> <span class="n">disk</span><span class="p">,</span>
<span class="n">but</span> <span class="n">it</span> <span class="n">only</span> <span class="n">has</span> <span class="n">any</span> <span class="n">meaning</span> <span class="k">while</span> <span class="n">the</span> <span class="n">resource</span> <span class="n">file</span> <span class="ow">is</span> <span class="n">loaded</span> <span class="n">into</span> <span class="n">memory</span><span class="p">.</span>

  <span class="o">]</span><span class="sd">##</span>
  <span class="k">let</span> <span class="n">lockedExpr</span> <span class="o">=</span> <span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readBitsIntBe</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span>
  <span class="n">this</span><span class="p">.</span><span class="n">locked</span> <span class="o">=</span> <span class="n">lockedExpr</span>

  <span class="sd">##[</span>
  <span class="n">Indicates</span> <span class="n">that</span> <span class="n">this</span> <span class="n">resource</span> <span class="n">should</span> <span class="n">be</span> <span class="n">protected</span> <span class="p">(</span><span class="n">i</span><span class="p">.</span> <span class="n">e</span><span class="p">.</span> <span class="n">unmodifiable</span><span class="p">)</span> <span class="ow">in</span> <span class="n">memory</span><span class="p">.</span>
<span class="n">This</span> <span class="n">prevents</span> <span class="n">the</span> <span class="n">application</span> <span class="kn">from</span> <span class="k">using</span> <span class="n">the</span> <span class="n">Resource</span> <span class="n">Manager</span> <span class="n">to</span> <span class="n">change</span> <span class="n">the</span> <span class="n">resource</span><span class="sc">&#39;s data or metadata,</span>
<span class="ow">or</span> <span class="n">delete</span> <span class="n">it</span><span class="p">.</span>
<span class="n">The</span> <span class="n">only</span> <span class="n">exception</span> <span class="n">are</span> <span class="n">the</span> <span class="n">resource</span><span class="sc">&#39;s attributes,</span>
<span class="n">which</span> <span class="n">can</span> <span class="n">always</span> <span class="n">be</span> <span class="n">changed</span><span class="p">,</span>
<span class="n">even</span> <span class="k">for</span> <span class="n">protected</span> <span class="n">resources</span><span class="p">.</span>
<span class="n">This</span> <span class="n">allows</span> <span class="n">protected</span> <span class="n">resources</span> <span class="n">to</span> <span class="n">be</span> <span class="n">unprotected</span> <span class="n">again</span> <span class="n">by</span> <span class="n">the</span> <span class="n">application</span><span class="p">.</span>

<span class="n">This</span> <span class="n">attribute</span> <span class="n">may</span> <span class="n">be</span> <span class="kt">set</span> <span class="n">both</span> <span class="ow">in</span> <span class="n">memory</span> <span class="ow">and</span> <span class="n">on</span> <span class="n">disk</span><span class="p">,</span>
<span class="n">but</span> <span class="n">it</span> <span class="n">only</span> <span class="n">has</span> <span class="n">any</span> <span class="n">meaning</span> <span class="k">while</span> <span class="n">the</span> <span class="n">resource</span> <span class="n">file</span> <span class="ow">is</span> <span class="n">loaded</span> <span class="n">into</span> <span class="n">memory</span><span class="p">.</span>

  <span class="o">]</span><span class="sd">##</span>
  <span class="k">let</span> <span class="n">protectedExpr</span> <span class="o">=</span> <span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readBitsIntBe</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span>
  <span class="n">this</span><span class="p">.</span><span class="n">protected</span> <span class="o">=</span> <span class="n">protectedExpr</span>

  <span class="sd">##[</span>
  <span class="n">Indicates</span> <span class="n">that</span> <span class="n">this</span> <span class="n">resource</span><span class="sc">&#39;s data should be immediately loaded into memory when the resource file is opened.</span>

<span class="n">This</span> <span class="n">attribute</span> <span class="n">may</span> <span class="n">be</span> <span class="kt">set</span> <span class="n">both</span> <span class="ow">in</span> <span class="n">memory</span> <span class="ow">and</span> <span class="n">on</span> <span class="n">disk</span><span class="p">,</span>
<span class="n">but</span> <span class="n">it</span> <span class="n">only</span> <span class="n">has</span> <span class="n">any</span> <span class="n">meaning</span> <span class="k">when</span> <span class="n">the</span> <span class="n">resource</span> <span class="n">file</span> <span class="ow">is</span> <span class="n">first</span> <span class="n">opened</span><span class="p">.</span>

  <span class="o">]</span><span class="sd">##</span>
  <span class="k">let</span> <span class="n">preloadExpr</span> <span class="o">=</span> <span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readBitsIntBe</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span>
  <span class="n">this</span><span class="p">.</span><span class="n">preload</span> <span class="o">=</span> <span class="n">preloadExpr</span>

  <span class="sd">##[</span>
  <span class="n">Indicates</span> <span class="n">that</span> <span class="n">this</span> <span class="n">resource</span><span class="sc">&#39;s data has been changed in memory and should be written to the resource file on the next update.</span>
<span class="n">This</span> <span class="n">attribute</span> <span class="ow">is</span> <span class="n">only</span> <span class="n">meant</span> <span class="n">to</span> <span class="n">be</span> <span class="kt">set</span> <span class="ow">in</span> <span class="n">memory</span><span class="p">;</span>
<span class="n">it</span> <span class="ow">is</span> <span class="n">cleared</span> <span class="k">when</span> <span class="n">the</span> <span class="n">resource</span> <span class="n">file</span> <span class="ow">is</span> <span class="n">written</span> <span class="n">to</span> <span class="n">disk</span><span class="p">.</span>

<span class="n">This</span> <span class="n">attribute</span> <span class="ow">is</span> <span class="n">used</span> <span class="n">internally</span> <span class="n">by</span> <span class="n">the</span> <span class="n">Resource</span> <span class="n">Manager</span> <span class="ow">and</span> <span class="n">should</span> <span class="ow">not</span> <span class="n">be</span> <span class="kt">set</span> <span class="n">manually</span> <span class="n">by</span> <span class="n">the</span> <span class="n">application</span><span class="p">.</span>

  <span class="o">]</span><span class="sd">##</span>
  <span class="k">let</span> <span class="n">needsWriteExpr</span> <span class="o">=</span> <span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readBitsIntBe</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span>
  <span class="n">this</span><span class="p">.</span><span class="n">needsWrite</span> <span class="o">=</span> <span class="n">needsWriteExpr</span>

  <span class="sd">##[</span>
  <span class="n">Indicates</span> <span class="n">that</span> <span class="n">this</span> <span class="n">resource</span><span class="sc">&#39;s data is compressed.</span>
<span class="n">Compressed</span> <span class="n">resource</span> <span class="n">data</span> <span class="ow">is</span> <span class="n">decompressed</span> <span class="n">transparently</span> <span class="n">by</span> <span class="n">the</span> <span class="n">Resource</span> <span class="n">Manager</span> <span class="k">when</span> <span class="n">reading</span><span class="p">.</span>

<span class="k">For</span> <span class="n">a</span> <span class="n">detailed</span> <span class="n">description</span> <span class="k">of</span> <span class="n">the</span> <span class="n">structure</span> <span class="k">of</span> <span class="n">compressed</span> <span class="n">resources</span> <span class="k">as</span> <span class="n">they</span> <span class="n">are</span> <span class="n">stored</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">file</span><span class="p">,</span>
<span class="n">see</span> <span class="n">the</span> <span class="n">compressed_resource</span><span class="p">.</span><span class="n">ksy</span> <span class="n">spec</span><span class="p">.</span>

  <span class="o">]</span><span class="sd">##</span>
  <span class="k">let</span> <span class="n">compressedExpr</span> <span class="o">=</span> <span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readBitsIntBe</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span>
  <span class="n">this</span><span class="p">.</span><span class="n">compressed</span> <span class="o">=</span> <span class="n">compressedExpr</span>

<span class="k">proc </span><span class="nf">asInt</span><span class="p">(</span><span class="n">this</span><span class="p">:</span> <span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference_Attributes</span><span class="p">):</span> <span class="n">uint8</span> <span class="o">=</span> 

  <span class="sd">##[</span>
  <span class="n">The</span> <span class="n">attributes</span> <span class="k">as</span> <span class="n">a</span> <span class="n">packed</span> <span class="n">integer</span><span class="p">,</span>
<span class="k">as</span> <span class="n">they</span> <span class="n">are</span> <span class="n">stored</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">file</span><span class="p">.</span>

  <span class="o">]</span><span class="sd">##</span>
  <span class="k">if</span> <span class="n">this</span><span class="p">.</span><span class="n">asIntInstFlag</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">this</span><span class="p">.</span><span class="n">asIntInst</span>
  <span class="k">let</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">pos</span><span class="p">()</span>
  <span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">seek</span><span class="p">(</span><span class="kt">int</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
  <span class="k">let</span> <span class="n">asIntInstExpr</span> <span class="o">=</span> <span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readU1</span><span class="p">()</span>
  <span class="n">this</span><span class="p">.</span><span class="n">asIntInst</span> <span class="o">=</span> <span class="n">asIntInstExpr</span>
  <span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">seek</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
  <span class="n">this</span><span class="p">.</span><span class="n">asIntInstFlag</span> <span class="o">=</span> <span class="kp">true</span>
  <span class="k">return</span> <span class="n">this</span><span class="p">.</span><span class="n">asIntInst</span>

<span class="k">proc </span><span class="nf">fromFile</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference_Attributes], filename: string): ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference_Attributes =</span>
  <span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference_Attributes</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">newKaitaiFileStream</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span> <span class="kp">nil</span><span class="p">,</span> <span class="kp">nil</span><span class="p">)</span>


<span class="sd">##[</span>
<span class="n">A</span> <span class="n">resource</span> <span class="n">name</span><span class="p">,</span>
<span class="k">as</span> <span class="n">stored</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">resource</span> <span class="n">name</span> <span class="n">storage</span> <span class="n">area</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">resource</span> <span class="n">map</span><span class="p">.</span>

<span class="n">The</span> <span class="n">resource</span> <span class="n">names</span> <span class="n">are</span> <span class="ow">not</span> <span class="n">required</span> <span class="n">to</span> <span class="n">appear</span> <span class="ow">in</span> <span class="n">any</span> <span class="n">particular</span> <span class="n">order</span><span class="p">.</span>
<span class="n">There</span> <span class="n">may</span> <span class="n">be</span> <span class="n">unused</span> <span class="n">space</span> <span class="n">between</span> <span class="ow">and</span> <span class="n">around</span> <span class="n">resource</span> <span class="n">names</span><span class="p">,</span>
<span class="n">but</span> <span class="ow">in</span> <span class="n">practice</span> <span class="n">they</span> <span class="n">are</span> <span class="n">often</span> <span class="n">contiguous</span><span class="p">.</span>

<span class="o">]</span><span class="sd">##</span>
<span class="k">proc </span><span class="nf">read</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork_ResourceMap_Name], io: KaitaiStream, root: KaitaiStruct, parent: ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference): ResourceFork_ResourceMap_Name =</span>
  <span class="k">template</span> <span class="n">this</span><span class="p">:</span> <span class="n">untyped</span> <span class="o">=</span> <span class="n">result</span>
  <span class="n">this</span> <span class="o">=</span> <span class="n">new</span><span class="p">(</span><span class="n">ResourceFork_ResourceMap_Name</span><span class="p">)</span>
  <span class="k">let</span> <span class="n">root</span> <span class="o">=</span> <span class="k">if</span> <span class="n">root</span> <span class="o">==</span> <span class="kp">nil</span><span class="p">:</span> <span class="k">cast</span><span class="o">[</span><span class="n">ResourceFork</span><span class="o">]</span><span class="p">(</span><span class="n">this</span><span class="p">)</span> <span class="k">else</span><span class="p">:</span> <span class="k">cast</span><span class="o">[</span><span class="n">ResourceFork</span><span class="o">]</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
  <span class="n">this</span><span class="p">.</span><span class="n">io</span> <span class="o">=</span> <span class="n">io</span>
  <span class="n">this</span><span class="p">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">root</span>
  <span class="n">this</span><span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>


  <span class="sd">##[</span>
  <span class="n">The</span> <span class="n">length</span> <span class="k">of</span> <span class="n">the</span> <span class="n">resource</span> <span class="n">name</span><span class="p">,</span> <span class="ow">in</span> <span class="n">bytes</span><span class="p">.</span>

  <span class="o">]</span><span class="sd">##</span>
  <span class="k">let</span> <span class="n">lenValueExpr</span> <span class="o">=</span> <span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readU1</span><span class="p">()</span>
  <span class="n">this</span><span class="p">.</span><span class="n">lenValue</span> <span class="o">=</span> <span class="n">lenValueExpr</span>

  <span class="sd">##[</span>
  <span class="n">The</span> <span class="n">resource</span> <span class="n">name</span><span class="p">.</span>

<span class="n">This</span> <span class="n">field</span> <span class="ow">is</span> <span class="n">exposed</span> <span class="k">as</span> <span class="n">a</span> <span class="n">byte</span> <span class="kt">array</span><span class="p">,</span>
<span class="n">because</span> <span class="n">there</span> <span class="ow">is</span> <span class="n">no</span> <span class="n">universal</span> <span class="n">encoding</span> <span class="k">for</span> <span class="n">resource</span> <span class="n">names</span><span class="p">.</span>
<span class="n">Most</span> <span class="n">Classic</span> <span class="n">Mac</span> <span class="n">software</span> <span class="n">does</span> <span class="ow">not</span> <span class="n">deal</span> <span class="n">with</span> <span class="n">encodings</span> <span class="n">explicitly</span> <span class="ow">and</span> <span class="n">instead</span> <span class="n">assumes</span> <span class="n">that</span> <span class="n">all</span> <span class="n">strings</span><span class="p">,</span>
<span class="n">including</span> <span class="n">resource</span> <span class="n">names</span><span class="p">,</span>
<span class="n">use</span> <span class="n">the</span> <span class="n">system</span> <span class="n">encoding</span><span class="p">,</span>
<span class="n">which</span> <span class="n">varies</span> <span class="n">depending</span> <span class="n">on</span> <span class="n">the</span> <span class="n">system</span> <span class="n">language</span><span class="p">.</span>
<span class="n">This</span> <span class="n">means</span> <span class="n">that</span> <span class="n">resource</span> <span class="n">names</span> <span class="n">can</span> <span class="n">use</span> <span class="n">different</span> <span class="n">encodings</span> <span class="n">depending</span> <span class="n">on</span> <span class="n">what</span> <span class="n">system</span> <span class="n">language</span> <span class="n">they</span> <span class="n">were</span> <span class="n">created</span> <span class="n">with</span><span class="p">.</span>

<span class="n">Many</span> <span class="n">resource</span> <span class="n">names</span> <span class="n">are</span> <span class="n">plain</span> <span class="n">ASCII</span><span class="p">,</span>
<span class="n">meaning</span> <span class="n">that</span> <span class="n">the</span> <span class="n">encoding</span> <span class="n">often</span> <span class="n">does</span> <span class="ow">not</span> <span class="n">matter</span>
<span class="p">(</span><span class="n">because</span> <span class="n">all</span> <span class="n">Mac</span> <span class="n">OS</span> <span class="n">encodings</span> <span class="n">are</span> <span class="n">ASCII</span><span class="o">-</span><span class="n">compatible</span><span class="p">).</span>
<span class="k">For</span> <span class="n">non</span><span class="o">-</span><span class="n">ASCII</span> <span class="n">resource</span> <span class="n">names</span><span class="p">,</span>
<span class="n">the</span> <span class="n">most</span> <span class="n">common</span> <span class="n">encoding</span> <span class="ow">is</span> <span class="n">perhaps</span> <span class="n">MacRoman</span>
<span class="p">(</span><span class="n">used</span> <span class="k">for</span> <span class="n">English</span> <span class="ow">and</span> <span class="n">other</span> <span class="n">Western</span> <span class="n">languages</span><span class="p">),</span>
<span class="n">but</span> <span class="n">other</span> <span class="n">encodings</span> <span class="n">are</span> <span class="n">also</span> <span class="n">sometimes</span> <span class="n">used</span><span class="p">,</span>
<span class="n">especially</span> <span class="k">for</span> <span class="n">software</span> <span class="ow">in</span> <span class="n">non</span><span class="o">-</span><span class="n">Western</span> <span class="n">languages</span><span class="p">.</span>

<span class="n">There</span> <span class="ow">is</span> <span class="n">no</span> <span class="n">requirement</span> <span class="n">that</span> <span class="n">all</span> <span class="n">names</span> <span class="ow">in</span> <span class="n">a</span> <span class="n">single</span> <span class="n">resource</span> <span class="n">file</span> <span class="n">use</span> <span class="n">the</span> <span class="n">same</span> <span class="n">encoding</span><span class="p">.</span>
<span class="k">For</span> <span class="n">example</span><span class="p">,</span>
<span class="n">localized</span> <span class="n">software</span> <span class="n">may</span> <span class="n">have</span> <span class="n">some</span> <span class="p">(</span><span class="n">but</span> <span class="ow">not</span> <span class="n">all</span><span class="p">)</span> <span class="k">of</span> <span class="n">its</span> <span class="n">resource</span> <span class="n">names</span> <span class="n">translated</span><span class="p">.</span>
<span class="k">For</span> <span class="n">non</span><span class="o">-</span><span class="n">Western</span> <span class="n">languages</span><span class="p">,</span>
<span class="n">this</span> <span class="n">can</span> <span class="n">lead</span> <span class="n">to</span> <span class="n">some</span> <span class="n">resource</span> <span class="n">names</span> <span class="k">using</span> <span class="n">MacRoman</span><span class="p">,</span>
<span class="ow">and</span> <span class="n">others</span> <span class="k">using</span> <span class="n">a</span> <span class="n">different</span> <span class="n">encoding</span><span class="p">.</span>

  <span class="o">]</span><span class="sd">##</span>
  <span class="k">let</span> <span class="n">valueExpr</span> <span class="o">=</span> <span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readBytes</span><span class="p">(</span><span class="kt">int</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">lenValue</span><span class="p">))</span>
  <span class="n">this</span><span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">valueExpr</span>

<span class="k">proc </span><span class="nf">fromFile</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork_ResourceMap_Name], filename: string): ResourceFork_ResourceMap_Name =</span>
  <span class="n">ResourceFork_ResourceMap_Name</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">newKaitaiFileStream</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span> <span class="kp">nil</span><span class="p">,</span> <span class="kp">nil</span><span class="p">)</span>
</pre></div>

        </div>
        
    </div>
</section>

    <footer id="main-footer">
        <div class="container">
            &copy; 2015&ndash;2023 Kaitai Project and <a href="https://github.com/kaitai-io/kaitai_struct_formats/graphs/contributors">format repo contributors</a>

            <h3>Contacts</h3>

            <div class="row">
                <div class="col-sm-4">
                    <i class="fa fa-fw fa-2x fa-github"></i> <a href="https://github.com/kaitai-io/kaitai_struct">GitHub</a>
                </div>
                <div class="col-sm-4">
                    <i class="fa fa-fw fa-2x fa-twitter"></i> <a href="https://twitter.com/kaitai_io">@kaitai_io</a>
                </div>
                <div class="col-sm-4">
                    Gitter: <a href="https://gitter.im/kaitai_struct/Lobby">kaitai_struct</a>
                </div>
            </div>
        </div>
    </footer>

  <script src="//kaitai.io/js/jquery-1.12.3.min.js"></script>
  <script src="//kaitai.io/js/bootstrap.min.js"></script>

  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-76299550-1', 'auto');
      ga('send', 'pageview');
  </script>
</body>
</html>
