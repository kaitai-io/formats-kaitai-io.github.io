<!DOCTYPE html>
<html dir="ltr" lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Macintosh resource fork data: Nim parsing library</title>
  <meta name="keywords" content="kaitai,struct,binary,format,parsing,decoding,java,javascript,python,ruby,library,metadata">
  <meta name="description" content="Kaitai Struct is a formal language for binary format specification that can be compiled into parser code">

  <link rel="stylesheet" href="//kaitai.io/styles/bootstrap.min.css">
  <link rel="stylesheet" href="//kaitai.io/styles/bootstrap-theme.min.css">
  <link href='https://fonts.googleapis.com/css?family=Exo:400,700' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Share+Tech+Mono' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

  <link rel="stylesheet" href="//kaitai.io/styles/main.css" type="text/css">
  <link rel="stylesheet" href="/pygments-default.css" type="text/css">
  <style>
.diagram-img {
    display: block;
    max-width: 100%;
    height: auto;
    margin: 0 auto;
}

section.format {
    padding: 30px 0;
}

section#format-meta, section#format-index-header {
    background: #e3eef7;
}

section#format-diagram, section#format-index-footer {
    background: #e9f8dd;
}

section#format-ksy, section#format-lang {
    background: #d1eadd;
}

section#format-index .row {
    padding-bottom: 10px;
}

  </style>

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-MFSBBRGREL"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-MFSBBRGREL');
  </script>
</head>
<body data-spy="scroll" data-target="#main-navbar" data-offset="100">

    <nav class="navbar navbar-inverse navbar-fixed-top" id="main-navbar">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#main-navbar-collapse" aria-expanded="false">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <span class="navbar-brand">Kaitai Struct</span>
            </div>
            <div class="collapse navbar-collapse" id="main-navbar-collapse">
                <ul class="nav navbar-nav">
                    <li><a href="//kaitai.io/#what-is-it">What is it?</a></li>
                    <li><a href="//kaitai.io/#quick-start">Quick Start</a></li>
                    <li><a href="//kaitai.io/#download">Download</a></li>
                    <li><a href="//kaitai.io/news/">News</a></li>
                    <li class="active"><a href="//formats.kaitai.io/">Format Gallery</a></li>
                </ul>
                <ul class="nav navbar-nav navbar-right">
                    <li><a href="https://ide.kaitai.io/">Try it &mdash; Web IDE</a></li>
                    <li><a href="//doc.kaitai.io/">Documentation</a></li>
                </ul>
            </div>
        </div>
    </nav>
<nav>
    <div class="container">
    <ol class="breadcrumb">
        <li><a href="../">Format Gallery</a></li>
        <li>macOS-specific</li>
        <li class="active">Macintosh resource fork data</li>
    </ol>
    </div>
</nav>

<section id="format-meta" class="format">
    <div class="container">
        <h1>Macintosh resource fork data:
            
            Nim parsing library
            
        </h1>

        <div class="row">
            <div class="col-md-8">
                <p><p>The data format of Macintosh resource forks,<br />
used on Classic Mac OS and Mac OS X/macOS to store additional structured data along with a file's main data (the data fork).<br />
The kinds of data stored in resource forks include:</p>
<ul>
<li>Document resources:<br />
images, sounds, etc. used by a document</li>
<li>Application resources:<br />
graphics, GUI layouts, localizable strings,<br />
and even code used by an application, a library, or system files</li>
<li>Common metadata:<br />
custom icons and version metadata that could be displayed by the Finder</li>
<li>Application-specific metadata:<br />
because resource forks follow a common format,<br />
other applications can store new metadata in them,<br />
even if the original application does not recognize or understand it</li>
</ul>
<p>Macintosh file systems (MFS, HFS, HFS+, APFS) support resource forks natively,<br />
which allows storing resources along with any file.<br />
Non-Macintosh file systems and protocols have little or no support for resource forks,<br />
so the resource fork data must be stored in some other way when using such file systems or protocols.<br />
Various file formats and tools exist for this purpose,<br />
such as BinHex, MacBinary, AppleSingle, AppleDouble, or QuickTime RezWack.<br />
In some cases,<br />
resource forks are stored as plain data in separate files with a .rsrc extension,<br />
even on Mac systems that natively support resource forks.</p>
<p>On modern Mac OS X/macOS systems,<br />
resource forks are used far less commonly than on classic Mac OS systems,<br />
because of compatibility issues with other systems and historical limitations in the format.<br />
Modern macOS APIs and libraries do not use resource forks,<br />
and the legacy Carbon API that still used them has been deprecated since OS X 10.8.<br />
Despite this,<br />
even current macOS systems still use resource forks for certain purposes,<br />
such as custom file icons.</p>
</p>
            </div>
            <div class="col-md-4">
                <div class="panel panel-info">
                    
                    <div class="panel-heading">
                        <h3 class="panel-title">Application</h3>
                    </div>
                    <div class="panel-body">
                        Mac OS
                    </div>
                    
                    
                    <div class="panel-heading">
                        <h3 class="panel-title">File extension</h3>
                    </div>
                    <div class="panel-body">
                        ["rsrc", "dfont"]
                    </div>
                    
                    
                    <div class="panel-heading">
                        <h3 class="panel-title">KS implementation details</h3>
                    </div>
                    
                    <div class="panel-body">
                        License: <a href="https://spdx.org/licenses/MIT.html">MIT</a>
                    </div>
                    
                    
                    <div class="panel-body">
                        Minimal Kaitai Struct required: 0.9
                    </div>
                    
                    
                    
                    
                    <div class="panel-heading">
                        <h3 class="panel-title">References</h3>
                    </div>
                    <div class="panel-body">
                        <ul>
                            
                            
                            
                            
                            
                            
                            
                            
                            
                            <li><a href="https://www.wikidata.org/wiki/Q3933446">Wikidata Q3933446</a></li>
                            
                            
                            
                            <li><a href="http://fileformats.archiveteam.org/wiki/Resource_Fork">Resource Fork in Just Solve the File Format Problem</a></li>
                            
                        </ul>
                    </div>
                    
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
            <p>
            This page hosts a formal specification of Macintosh resource fork data
            using <a href="//kaitai.io">Kaitai Struct</a>. This
            specification can be automatically translated into a
            variety of programming languages to get a parsing library.
            </p>

            <ul class="nav nav-pills">
                
                
                <li>
                
                <a href="index.html" title="Macintosh resource fork data parsing Overview library">Overview</a></li>
                
                
                <li>
                
                <a href="cpp_stl_11.html" title="Macintosh resource fork data parsing C++11/STL library">C++11/STL</a></li>
                
                
                <li>
                
                <a href="cpp_stl_98.html" title="Macintosh resource fork data parsing C++98/STL library">C++98/STL</a></li>
                
                
                <li>
                
                <a href="csharp.html" title="Macintosh resource fork data parsing C# library">C#</a></li>
                
                
                <li>
                
                <a href="go.html" title="Macintosh resource fork data parsing Go library">Go</a></li>
                
                
                <li>
                
                <a href="graphviz.html" title="Macintosh resource fork data parsing GraphViz library">GraphViz</a></li>
                
                
                <li>
                
                <a href="java.html" title="Macintosh resource fork data parsing Java library">Java</a></li>
                
                
                <li>
                
                <a href="javascript.html" title="Macintosh resource fork data parsing JavaScript library">JavaScript</a></li>
                
                
                <li>
                
                <a href="lua.html" title="Macintosh resource fork data parsing Lua library">Lua</a></li>
                
                
                <li class="active">
                
                <a href="nim.html" title="Macintosh resource fork data parsing Nim library">Nim</a></li>
                
                
                <li>
                
                <a href="perl.html" title="Macintosh resource fork data parsing Perl library">Perl</a></li>
                
                
                <li>
                
                <a href="php.html" title="Macintosh resource fork data parsing PHP library">PHP</a></li>
                
                
                <li>
                
                <a href="python.html" title="Macintosh resource fork data parsing Python library">Python</a></li>
                
                
                <li>
                
                <a href="ruby.html" title="Macintosh resource fork data parsing Ruby library">Ruby</a></li>
                
            </ul>
            </div>
        </div>
    </div>
</section>


<section id="format-lang" class="format">
    <div class="container">
        <h2>
            
            Nim source code to parse Macintosh resource fork data
            
        </h2>

        

        <h3>resource_fork.nim</h3>

        <div class="row">
            <div class="pull-right">
                <p>
                    <a href="src/nim/resource_fork.nim" download="resource_fork.nim" class="btn btn-success">Download <i class="fa fa-download"></i></a>
                </p>
            </div>
        </div>

        <div class="row">
            <div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="n">kaitai_struct_nim_runtime</span>
<span class="kn">import</span><span class="w"> </span><span class="n">options</span>
<span class="kn">import</span><span class="w"> </span><span class="o">/</span><span class="n">common</span><span class="o">/</span><span class="n">bytes_with_io</span>

<span class="kn">import</span><span class="w"> </span><span class="s">&quot;bytes_with_io&quot;</span>
<span class="k">type</span>
<span class="w">  </span><span class="n">ResourceFork</span><span class="o">*</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">ref</span><span class="w"> </span><span class="k">object</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">KaitaiStruct</span>
<span class="w">    </span><span class="p">`</span><span class="n">header</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">ResourceFork_FileHeader</span>
<span class="w">    </span><span class="p">`</span><span class="n">systemData</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="nb">seq</span><span class="o">[</span><span class="n">byte</span><span class="o">]</span>
<span class="w">    </span><span class="p">`</span><span class="n">applicationData</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="nb">seq</span><span class="o">[</span><span class="n">byte</span><span class="o">]</span>
<span class="w">    </span><span class="p">`</span><span class="n">parent</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">KaitaiStruct</span>
<span class="w">    </span><span class="p">`</span><span class="n">rawDataBlocksWithIoInst</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="nb">seq</span><span class="o">[</span><span class="n">byte</span><span class="o">]</span>
<span class="w">    </span><span class="p">`</span><span class="n">rawResourceMapInst</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="nb">seq</span><span class="o">[</span><span class="n">byte</span><span class="o">]</span>
<span class="w">    </span><span class="p">`</span><span class="n">dataBlocksWithIoInst</span><span class="p">`:</span><span class="w"> </span><span class="n">BytesWithIo</span>
<span class="w">    </span><span class="p">`</span><span class="n">dataBlocksWithIoInstFlag</span><span class="p">`:</span><span class="w"> </span><span class="nb">bool</span>
<span class="w">    </span><span class="p">`</span><span class="n">dataBlocksInst</span><span class="p">`:</span><span class="w"> </span><span class="nb">seq</span><span class="o">[</span><span class="n">byte</span><span class="o">]</span>
<span class="w">    </span><span class="p">`</span><span class="n">dataBlocksInstFlag</span><span class="p">`:</span><span class="w"> </span><span class="nb">bool</span>
<span class="w">    </span><span class="p">`</span><span class="n">resourceMapInst</span><span class="p">`:</span><span class="w"> </span><span class="n">ResourceFork_ResourceMap</span>
<span class="w">    </span><span class="p">`</span><span class="n">resourceMapInstFlag</span><span class="p">`:</span><span class="w"> </span><span class="nb">bool</span>
<span class="w">  </span><span class="n">ResourceFork_FileHeader</span><span class="o">*</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">ref</span><span class="w"> </span><span class="k">object</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">KaitaiStruct</span>
<span class="w">    </span><span class="p">`</span><span class="n">ofsDataBlocks</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">uint32</span>
<span class="w">    </span><span class="p">`</span><span class="n">ofsResourceMap</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">uint32</span>
<span class="w">    </span><span class="p">`</span><span class="n">lenDataBlocks</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">uint32</span>
<span class="w">    </span><span class="p">`</span><span class="n">lenResourceMap</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">uint32</span>
<span class="w">    </span><span class="p">`</span><span class="n">parent</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">KaitaiStruct</span>
<span class="w">  </span><span class="n">ResourceFork_DataBlock</span><span class="o">*</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">ref</span><span class="w"> </span><span class="k">object</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">KaitaiStruct</span>
<span class="w">    </span><span class="p">`</span><span class="n">lenData</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">uint32</span>
<span class="w">    </span><span class="p">`</span><span class="n">data</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="nb">seq</span><span class="o">[</span><span class="n">byte</span><span class="o">]</span>
<span class="w">    </span><span class="p">`</span><span class="n">parent</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference</span>
<span class="w">  </span><span class="n">ResourceFork_ResourceMap</span><span class="o">*</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">ref</span><span class="w"> </span><span class="k">object</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">KaitaiStruct</span>
<span class="w">    </span><span class="p">`</span><span class="n">reservedFileHeaderCopy</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">ResourceFork_FileHeader</span>
<span class="w">    </span><span class="p">`</span><span class="n">reservedNextResourceMapHandle</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">uint32</span>
<span class="w">    </span><span class="p">`</span><span class="n">reservedFileReferenceNumber</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">uint16</span>
<span class="w">    </span><span class="p">`</span><span class="n">fileAttributes</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">ResourceFork_ResourceMap_FileAttributes</span>
<span class="w">    </span><span class="p">`</span><span class="n">ofsTypeList</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">uint16</span>
<span class="w">    </span><span class="p">`</span><span class="n">ofsNames</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">uint16</span>
<span class="w">    </span><span class="p">`</span><span class="n">parent</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">ResourceFork</span>
<span class="w">    </span><span class="p">`</span><span class="n">rawFileAttributes</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="nb">seq</span><span class="o">[</span><span class="n">byte</span><span class="o">]</span>
<span class="w">    </span><span class="p">`</span><span class="n">rawTypeListAndReferenceListsInst</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="nb">seq</span><span class="o">[</span><span class="n">byte</span><span class="o">]</span>
<span class="w">    </span><span class="p">`</span><span class="n">rawNamesWithIoInst</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="nb">seq</span><span class="o">[</span><span class="n">byte</span><span class="o">]</span>
<span class="w">    </span><span class="p">`</span><span class="n">typeListAndReferenceListsInst</span><span class="p">`:</span><span class="w"> </span><span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists</span>
<span class="w">    </span><span class="p">`</span><span class="n">typeListAndReferenceListsInstFlag</span><span class="p">`:</span><span class="w"> </span><span class="nb">bool</span>
<span class="w">    </span><span class="p">`</span><span class="n">namesWithIoInst</span><span class="p">`:</span><span class="w"> </span><span class="n">BytesWithIo</span>
<span class="w">    </span><span class="p">`</span><span class="n">namesWithIoInstFlag</span><span class="p">`:</span><span class="w"> </span><span class="nb">bool</span>
<span class="w">    </span><span class="p">`</span><span class="n">namesInst</span><span class="p">`:</span><span class="w"> </span><span class="nb">seq</span><span class="o">[</span><span class="n">byte</span><span class="o">]</span>
<span class="w">    </span><span class="p">`</span><span class="n">namesInstFlag</span><span class="p">`:</span><span class="w"> </span><span class="nb">bool</span>
<span class="w">  </span><span class="n">ResourceFork_ResourceMap_FileAttributes</span><span class="o">*</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">ref</span><span class="w"> </span><span class="k">object</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">KaitaiStruct</span>
<span class="w">    </span><span class="p">`</span><span class="n">resourcesLocked</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="nb">bool</span>
<span class="w">    </span><span class="p">`</span><span class="n">reserved0</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">uint64</span>
<span class="w">    </span><span class="p">`</span><span class="n">printerDriverMultifinderCompatible</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="nb">bool</span>
<span class="w">    </span><span class="p">`</span><span class="n">noWriteChanges</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="nb">bool</span>
<span class="w">    </span><span class="p">`</span><span class="n">needsCompact</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="nb">bool</span>
<span class="w">    </span><span class="p">`</span><span class="n">mapNeedsWrite</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="nb">bool</span>
<span class="w">    </span><span class="p">`</span><span class="n">reserved1</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">uint64</span>
<span class="w">    </span><span class="p">`</span><span class="n">parent</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">ResourceFork_ResourceMap</span>
<span class="w">    </span><span class="p">`</span><span class="n">asIntInst</span><span class="p">`:</span><span class="w"> </span><span class="n">uint16</span>
<span class="w">    </span><span class="p">`</span><span class="n">asIntInstFlag</span><span class="p">`:</span><span class="w"> </span><span class="nb">bool</span>
<span class="w">  </span><span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists</span><span class="o">*</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">ref</span><span class="w"> </span><span class="k">object</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">KaitaiStruct</span>
<span class="w">    </span><span class="p">`</span><span class="n">typeList</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_TypeList</span>
<span class="w">    </span><span class="p">`</span><span class="n">referenceLists</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="nb">seq</span><span class="o">[</span><span class="n">byte</span><span class="o">]</span>
<span class="w">    </span><span class="p">`</span><span class="n">parent</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">ResourceFork_ResourceMap</span>
<span class="w">  </span><span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_TypeList</span><span class="o">*</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">ref</span><span class="w"> </span><span class="k">object</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">KaitaiStruct</span>
<span class="w">    </span><span class="p">`</span><span class="n">numTypesM1</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">uint16</span>
<span class="w">    </span><span class="p">`</span><span class="n">entries</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="nb">seq</span><span class="o">[</span><span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_TypeList_TypeListEntry</span><span class="o">]</span>
<span class="w">    </span><span class="p">`</span><span class="n">parent</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists</span>
<span class="w">    </span><span class="p">`</span><span class="n">numTypesInst</span><span class="p">`:</span><span class="w"> </span><span class="nb">int</span>
<span class="w">    </span><span class="p">`</span><span class="n">numTypesInstFlag</span><span class="p">`:</span><span class="w"> </span><span class="nb">bool</span>
<span class="w">  </span><span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_TypeList_TypeListEntry</span><span class="o">*</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">ref</span><span class="w"> </span><span class="k">object</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">KaitaiStruct</span>
<span class="w">    </span><span class="p">`</span><span class="k">type</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="nb">seq</span><span class="o">[</span><span class="n">byte</span><span class="o">]</span>
<span class="w">    </span><span class="p">`</span><span class="n">numReferencesM1</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">uint16</span>
<span class="w">    </span><span class="p">`</span><span class="n">ofsReferenceList</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">uint16</span>
<span class="w">    </span><span class="p">`</span><span class="n">parent</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_TypeList</span>
<span class="w">    </span><span class="p">`</span><span class="n">numReferencesInst</span><span class="p">`:</span><span class="w"> </span><span class="nb">int</span>
<span class="w">    </span><span class="p">`</span><span class="n">numReferencesInstFlag</span><span class="p">`:</span><span class="w"> </span><span class="nb">bool</span>
<span class="w">    </span><span class="p">`</span><span class="n">referenceListInst</span><span class="p">`:</span><span class="w"> </span><span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList</span>
<span class="w">    </span><span class="p">`</span><span class="n">referenceListInstFlag</span><span class="p">`:</span><span class="w"> </span><span class="nb">bool</span>
<span class="w">  </span><span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList</span><span class="o">*</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">ref</span><span class="w"> </span><span class="k">object</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">KaitaiStruct</span>
<span class="w">    </span><span class="p">`</span><span class="n">references</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="nb">seq</span><span class="o">[</span><span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference</span><span class="o">]</span>
<span class="w">    </span><span class="p">`</span><span class="n">numReferences</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">uint16</span>
<span class="w">    </span><span class="p">`</span><span class="n">parent</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_TypeList_TypeListEntry</span>
<span class="w">  </span><span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference</span><span class="o">*</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">ref</span><span class="w"> </span><span class="k">object</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">KaitaiStruct</span>
<span class="w">    </span><span class="p">`</span><span class="n">id</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="nb">int16</span>
<span class="w">    </span><span class="p">`</span><span class="n">ofsName</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">uint16</span>
<span class="w">    </span><span class="p">`</span><span class="n">attributes</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference_Attributes</span>
<span class="w">    </span><span class="p">`</span><span class="n">ofsDataBlock</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">uint64</span>
<span class="w">    </span><span class="p">`</span><span class="n">reservedHandle</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">uint32</span>
<span class="w">    </span><span class="p">`</span><span class="n">parent</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList</span>
<span class="w">    </span><span class="p">`</span><span class="n">rawAttributes</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="nb">seq</span><span class="o">[</span><span class="n">byte</span><span class="o">]</span>
<span class="w">    </span><span class="p">`</span><span class="n">nameInst</span><span class="p">`:</span><span class="w"> </span><span class="n">ResourceFork_ResourceMap_Name</span>
<span class="w">    </span><span class="p">`</span><span class="n">nameInstFlag</span><span class="p">`:</span><span class="w"> </span><span class="nb">bool</span>
<span class="w">    </span><span class="p">`</span><span class="n">dataBlockInst</span><span class="p">`:</span><span class="w"> </span><span class="n">ResourceFork_DataBlock</span>
<span class="w">    </span><span class="p">`</span><span class="n">dataBlockInstFlag</span><span class="p">`:</span><span class="w"> </span><span class="nb">bool</span>
<span class="w">  </span><span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference_Attributes</span><span class="o">*</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">ref</span><span class="w"> </span><span class="k">object</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">KaitaiStruct</span>
<span class="w">    </span><span class="p">`</span><span class="n">systemReference</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="nb">bool</span>
<span class="w">    </span><span class="p">`</span><span class="n">loadIntoSystemHeap</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="nb">bool</span>
<span class="w">    </span><span class="p">`</span><span class="n">purgeable</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="nb">bool</span>
<span class="w">    </span><span class="p">`</span><span class="n">locked</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="nb">bool</span>
<span class="w">    </span><span class="p">`</span><span class="n">protected</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="nb">bool</span>
<span class="w">    </span><span class="p">`</span><span class="n">preload</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="nb">bool</span>
<span class="w">    </span><span class="p">`</span><span class="n">needsWrite</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="nb">bool</span>
<span class="w">    </span><span class="p">`</span><span class="n">compressed</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="nb">bool</span>
<span class="w">    </span><span class="p">`</span><span class="n">parent</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference</span>
<span class="w">    </span><span class="p">`</span><span class="n">asIntInst</span><span class="p">`:</span><span class="w"> </span><span class="n">uint8</span>
<span class="w">    </span><span class="p">`</span><span class="n">asIntInstFlag</span><span class="p">`:</span><span class="w"> </span><span class="nb">bool</span>
<span class="w">  </span><span class="n">ResourceFork_ResourceMap_Name</span><span class="o">*</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">ref</span><span class="w"> </span><span class="k">object</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">KaitaiStruct</span>
<span class="w">    </span><span class="p">`</span><span class="n">lenValue</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">uint8</span>
<span class="w">    </span><span class="p">`</span><span class="n">value</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="nb">seq</span><span class="o">[</span><span class="n">byte</span><span class="o">]</span>
<span class="w">    </span><span class="p">`</span><span class="n">parent</span><span class="p">`</span><span class="o">*</span><span class="p">:</span><span class="w"> </span><span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference</span>

<span class="k">proc</span><span class="w"> </span><span class="nf">read</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork], io: KaitaiStream, root: KaitaiStruct, parent: KaitaiStruct): ResourceFork</span>
<span class="k">proc</span><span class="w"> </span><span class="nf">read</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork_FileHeader], io: KaitaiStream, root: KaitaiStruct, parent: KaitaiStruct): ResourceFork_FileHeader</span>
<span class="k">proc</span><span class="w"> </span><span class="nf">read</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork_DataBlock], io: KaitaiStream, root: KaitaiStruct, parent: ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference): ResourceFork_DataBlock</span>
<span class="k">proc</span><span class="w"> </span><span class="nf">read</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork_ResourceMap], io: KaitaiStream, root: KaitaiStruct, parent: ResourceFork): ResourceFork_ResourceMap</span>
<span class="k">proc</span><span class="w"> </span><span class="nf">read</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork_ResourceMap_FileAttributes], io: KaitaiStream, root: KaitaiStruct, parent: ResourceFork_ResourceMap): ResourceFork_ResourceMap_FileAttributes</span>
<span class="k">proc</span><span class="w"> </span><span class="nf">read</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork_ResourceMap_TypeListAndReferenceLists], io: KaitaiStream, root: KaitaiStruct, parent: ResourceFork_ResourceMap): ResourceFork_ResourceMap_TypeListAndReferenceLists</span>
<span class="k">proc</span><span class="w"> </span><span class="nf">read</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork_ResourceMap_TypeListAndReferenceLists_TypeList], io: KaitaiStream, root: KaitaiStruct, parent: ResourceFork_ResourceMap_TypeListAndReferenceLists): ResourceFork_ResourceMap_TypeListAndReferenceLists_TypeList</span>
<span class="k">proc</span><span class="w"> </span><span class="nf">read</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork_ResourceMap_TypeListAndReferenceLists_TypeList_TypeListEntry], io: KaitaiStream, root: KaitaiStruct, parent: ResourceFork_ResourceMap_TypeListAndReferenceLists_TypeList): ResourceFork_ResourceMap_TypeListAndReferenceLists_TypeList_TypeListEntry</span>
<span class="k">proc</span><span class="w"> </span><span class="nf">read</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList], io: KaitaiStream, root: KaitaiStruct, parent: ResourceFork_ResourceMap_TypeListAndReferenceLists_TypeList_TypeListEntry, numReferences: any): ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList</span>
<span class="k">proc</span><span class="w"> </span><span class="nf">read</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference], io: KaitaiStream, root: KaitaiStruct, parent: ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList): ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference</span>
<span class="k">proc</span><span class="w"> </span><span class="nf">read</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference_Attributes], io: KaitaiStream, root: KaitaiStruct, parent: ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference): ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference_Attributes</span>
<span class="k">proc</span><span class="w"> </span><span class="nf">read</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork_ResourceMap_Name], io: KaitaiStream, root: KaitaiStruct, parent: ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference): ResourceFork_ResourceMap_Name</span>

<span class="k">proc</span><span class="w"> </span><span class="nf">dataBlocksWithIo</span><span class="o">*</span><span class="p">(</span><span class="n">this</span><span class="p">:</span><span class="w"> </span><span class="n">ResourceFork</span><span class="p">):</span><span class="w"> </span><span class="n">BytesWithIo</span>
<span class="k">proc</span><span class="w"> </span><span class="nf">dataBlocks</span><span class="o">*</span><span class="p">(</span><span class="n">this</span><span class="p">:</span><span class="w"> </span><span class="n">ResourceFork</span><span class="p">):</span><span class="w"> </span><span class="nb">seq</span><span class="o">[</span><span class="n">byte</span><span class="o">]</span>
<span class="k">proc</span><span class="w"> </span><span class="nf">resourceMap</span><span class="o">*</span><span class="p">(</span><span class="n">this</span><span class="p">:</span><span class="w"> </span><span class="n">ResourceFork</span><span class="p">):</span><span class="w"> </span><span class="n">ResourceFork_ResourceMap</span>
<span class="k">proc</span><span class="w"> </span><span class="nf">typeListAndReferenceLists</span><span class="o">*</span><span class="p">(</span><span class="n">this</span><span class="p">:</span><span class="w"> </span><span class="n">ResourceFork_ResourceMap</span><span class="p">):</span><span class="w"> </span><span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists</span>
<span class="k">proc</span><span class="w"> </span><span class="nf">namesWithIo</span><span class="o">*</span><span class="p">(</span><span class="n">this</span><span class="p">:</span><span class="w"> </span><span class="n">ResourceFork_ResourceMap</span><span class="p">):</span><span class="w"> </span><span class="n">BytesWithIo</span>
<span class="k">proc</span><span class="w"> </span><span class="nf">names</span><span class="o">*</span><span class="p">(</span><span class="n">this</span><span class="p">:</span><span class="w"> </span><span class="n">ResourceFork_ResourceMap</span><span class="p">):</span><span class="w"> </span><span class="nb">seq</span><span class="o">[</span><span class="n">byte</span><span class="o">]</span>
<span class="k">proc</span><span class="w"> </span><span class="nf">asInt</span><span class="o">*</span><span class="p">(</span><span class="n">this</span><span class="p">:</span><span class="w"> </span><span class="n">ResourceFork_ResourceMap_FileAttributes</span><span class="p">):</span><span class="w"> </span><span class="n">uint16</span>
<span class="k">proc</span><span class="w"> </span><span class="nf">numTypes</span><span class="o">*</span><span class="p">(</span><span class="n">this</span><span class="p">:</span><span class="w"> </span><span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_TypeList</span><span class="p">):</span><span class="w"> </span><span class="nb">int</span>
<span class="k">proc</span><span class="w"> </span><span class="nf">numReferences</span><span class="o">*</span><span class="p">(</span><span class="n">this</span><span class="p">:</span><span class="w"> </span><span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_TypeList_TypeListEntry</span><span class="p">):</span><span class="w"> </span><span class="nb">int</span>
<span class="k">proc</span><span class="w"> </span><span class="nf">referenceList</span><span class="o">*</span><span class="p">(</span><span class="n">this</span><span class="p">:</span><span class="w"> </span><span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_TypeList_TypeListEntry</span><span class="p">):</span><span class="w"> </span><span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList</span>
<span class="k">proc</span><span class="w"> </span><span class="nf">name</span><span class="o">*</span><span class="p">(</span><span class="n">this</span><span class="p">:</span><span class="w"> </span><span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference</span><span class="p">):</span><span class="w"> </span><span class="n">ResourceFork_ResourceMap_Name</span>
<span class="k">proc</span><span class="w"> </span><span class="nf">dataBlock</span><span class="o">*</span><span class="p">(</span><span class="n">this</span><span class="p">:</span><span class="w"> </span><span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference</span><span class="p">):</span><span class="w"> </span><span class="n">ResourceFork_DataBlock</span>
<span class="k">proc</span><span class="w"> </span><span class="nf">asInt</span><span class="o">*</span><span class="p">(</span><span class="n">this</span><span class="p">:</span><span class="w"> </span><span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference_Attributes</span><span class="p">):</span><span class="w"> </span><span class="n">uint8</span>


<span class="sd">##[</span>
<span class="sd">The data format of Macintosh resource forks,</span>
<span class="sd">used on Classic Mac OS and Mac OS X/macOS to store additional structured data along with a file&#39;s main data (the data fork).</span>
<span class="sd">The kinds of data stored in resource forks include:</span>

<span class="sd">* Document resources:</span>
<span class="sd">  images, sounds, etc. used by a document</span>
<span class="sd">* Application resources:</span>
<span class="sd">  graphics, GUI layouts, localizable strings,</span>
<span class="sd">  and even code used by an application, a library, or system files</span>
<span class="sd">* Common metadata:</span>
<span class="sd">  custom icons and version metadata that could be displayed by the Finder</span>
<span class="sd">* Application-specific metadata:</span>
<span class="sd">  because resource forks follow a common format,</span>
<span class="sd">  other applications can store new metadata in them,</span>
<span class="sd">  even if the original application does not recognize or understand it</span>

<span class="sd">Macintosh file systems (MFS, HFS, HFS+, APFS) support resource forks natively,</span>
<span class="sd">which allows storing resources along with any file.</span>
<span class="sd">Non-Macintosh file systems and protocols have little or no support for resource forks,</span>
<span class="sd">so the resource fork data must be stored in some other way when using such file systems or protocols.</span>
<span class="sd">Various file formats and tools exist for this purpose,</span>
<span class="sd">such as BinHex, MacBinary, AppleSingle, AppleDouble, or QuickTime RezWack.</span>
<span class="sd">In some cases,</span>
<span class="sd">resource forks are stored as plain data in separate files with a .rsrc extension,</span>
<span class="sd">even on Mac systems that natively support resource forks.</span>

<span class="sd">On modern Mac OS X/macOS systems,</span>
<span class="sd">resource forks are used far less commonly than on classic Mac OS systems,</span>
<span class="sd">because of compatibility issues with other systems and historical limitations in the format.</span>
<span class="sd">Modern macOS APIs and libraries do not use resource forks,</span>
<span class="sd">and the legacy Carbon API that still used them has been deprecated since OS X 10.8.</span>
<span class="sd">Despite this,</span>
<span class="sd">even current macOS systems still use resource forks for certain purposes,</span>
<span class="sd">such as custom file icons.</span>

<span class="sd">@see &lt;a href=&quot;https://developer.apple.com/library/archive/documentation/mac/pdf/MoreMacintoshToolbox.pdf#page=151&quot;&gt;Inside Macintosh, More Macintosh Toolbox, Resource Manager, Resource Manager Reference, Resource File Format&lt;/a&gt;</span>
<span class="sd">@see &lt;a href=&quot;https://www.pagetable.com/?p=50&quot;&gt;Inside Macintosh, Volume I, The Resource Manager, Format of a Resource File&lt;/a&gt;</span>
<span class="sd">@see &lt;a href=&quot;https://github.com/kreativekorp/ksfl/wiki/Macintosh-Resource-File-Format&quot;&gt;Source&lt;/a&gt;</span>
<span class="sd">@see &lt;a href=&quot;https://github.com/dgelessus/mac_file_format_docs/blob/master/README.md#resource-forks&quot;&gt;Source&lt;/a&gt;</span>
<span class="sd">]##</span>
<span class="k">proc</span><span class="w"> </span><span class="nf">read</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork], io: KaitaiStream, root: KaitaiStruct, parent: KaitaiStruct): ResourceFork =</span>
<span class="w">  </span><span class="k">template</span><span class="w"> </span><span class="nf">this</span><span class="p">:</span><span class="w"> </span><span class="n">untyped</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span>
<span class="w">  </span><span class="n">this</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="p">(</span><span class="n">ResourceFork</span><span class="p">)</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kp">nil</span><span class="p">:</span><span class="w"> </span><span class="k">cast</span><span class="o">[</span><span class="n">ResourceFork</span><span class="o">]</span><span class="p">(</span><span class="n">this</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="p">:</span><span class="w"> </span><span class="k">cast</span><span class="o">[</span><span class="n">ResourceFork</span><span class="o">]</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">io</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">root</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parent</span>


<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  The resource file&#39;s header information.</span>
<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">headerExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ResourceFork_FileHeader</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">root</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="p">)</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">header</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">headerExpr</span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  System-reserved data area.</span>
<span class="sd">This field can generally be ignored when reading and writing.</span>

<span class="sd">This field is used by the Classic Mac OS Finder as temporary storage space.</span>
<span class="sd">It usually contains parts of the file metadata (name, type/creator code, etc.).</span>
<span class="sd">Any existing data in this field is ignored and overwritten.</span>

<span class="sd">In resource files written by Mac OS X,</span>
<span class="sd">this field is set to all zero bytes.</span>

<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">systemDataExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readBytes</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">112</span><span class="p">))</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">systemData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">systemDataExpr</span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  Application-specific data area.</span>
<span class="sd">This field can generally be ignored when reading and writing.</span>

<span class="sd">According to early revisions of Inside Macintosh,</span>
<span class="sd">this field is &quot;available for application data&quot;.</span>
<span class="sd">In practice, it is almost never used for this purpose,</span>
<span class="sd">and usually contains only junk data.</span>

<span class="sd">In resource files written by Mac OS X,</span>
<span class="sd">this field is set to all zero bytes.</span>

<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">applicationDataExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readBytes</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">128</span><span class="p">))</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">applicationData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">applicationDataExpr</span>

<span class="k">proc</span><span class="w"> </span><span class="nf">dataBlocksWithIo</span><span class="p">(</span><span class="n">this</span><span class="p">:</span><span class="w"> </span><span class="n">ResourceFork</span><span class="p">):</span><span class="w"> </span><span class="n">BytesWithIo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  Use `data_blocks` instead,</span>
<span class="sd">unless you need access to this instance&#39;s `_io`.</span>

<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">dataBlocksWithIoInstFlag</span><span class="p">:</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">dataBlocksWithIoInst</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">pos</span><span class="p">()</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">seek</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">header</span><span class="p">.</span><span class="n">ofsDataBlocks</span><span class="p">))</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">rawDataBlocksWithIoInstExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readBytes</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">header</span><span class="p">.</span><span class="n">lenDataBlocks</span><span class="p">))</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">rawDataBlocksWithIoInst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rawDataBlocksWithIoInstExpr</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">rawDataBlocksWithIoInstIo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newKaitaiStream</span><span class="p">(</span><span class="n">rawDataBlocksWithIoInstExpr</span><span class="p">)</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">dataBlocksWithIoInstExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BytesWithIo</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">rawDataBlocksWithIoInstIo</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">root</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="p">)</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">dataBlocksWithIoInst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dataBlocksWithIoInstExpr</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">seek</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">dataBlocksWithIoInstFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kp">true</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">dataBlocksWithIoInst</span>

<span class="k">proc</span><span class="w"> </span><span class="nf">dataBlocks</span><span class="p">(</span><span class="n">this</span><span class="p">:</span><span class="w"> </span><span class="n">ResourceFork</span><span class="p">):</span><span class="w"> </span><span class="nb">seq</span><span class="o">[</span><span class="n">byte</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  Storage area for the data blocks of all resources.</span>

<span class="sd">These data blocks are not required to appear in any particular order,</span>
<span class="sd">and there may be unused space between and around them.</span>

<span class="sd">In practice,</span>
<span class="sd">the data blocks in newly created resource files are usually contiguous.</span>
<span class="sd">When existing resources are shortened,</span>
<span class="sd">the Mac OS resource manager leaves unused space where the now removed resource data was,</span>
<span class="sd">as this is quicker than moving the following resource data into the newly freed space.</span>
<span class="sd">Such unused space may be cleaned up later when the resource manager &quot;compacts&quot; the resource file,</span>
<span class="sd">which happens when resources are removed entirely,</span>
<span class="sd">or when resources are added or grown so that more space is needed in the data area.</span>

<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">dataBlocksInstFlag</span><span class="p">:</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">dataBlocksInst</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">dataBlocksInstExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">seq</span><span class="o">[</span><span class="n">byte</span><span class="o">]</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">dataBlocksWithIo</span><span class="p">.</span><span class="n">data</span><span class="p">)</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">dataBlocksInst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dataBlocksInstExpr</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">dataBlocksInstFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kp">true</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">dataBlocksInst</span>

<span class="k">proc</span><span class="w"> </span><span class="nf">resourceMap</span><span class="p">(</span><span class="n">this</span><span class="p">:</span><span class="w"> </span><span class="n">ResourceFork</span><span class="p">):</span><span class="w"> </span><span class="n">ResourceFork_ResourceMap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  The resource file&#39;s resource map.</span>
<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">resourceMapInstFlag</span><span class="p">:</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">resourceMapInst</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">pos</span><span class="p">()</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">seek</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">header</span><span class="p">.</span><span class="n">ofsResourceMap</span><span class="p">))</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">rawResourceMapInstExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readBytes</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">header</span><span class="p">.</span><span class="n">lenResourceMap</span><span class="p">))</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">rawResourceMapInst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rawResourceMapInstExpr</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">rawResourceMapInstIo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newKaitaiStream</span><span class="p">(</span><span class="n">rawResourceMapInstExpr</span><span class="p">)</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">resourceMapInstExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ResourceFork_ResourceMap</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">rawResourceMapInstIo</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">root</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="p">)</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">resourceMapInst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">resourceMapInstExpr</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">seek</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">resourceMapInstFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kp">true</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">resourceMapInst</span>

<span class="k">proc</span><span class="w"> </span><span class="nf">fromFile</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork], filename: string): ResourceFork =</span>
<span class="w">  </span><span class="n">ResourceFork</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">newKaitaiFileStream</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span><span class="w"> </span><span class="kp">nil</span><span class="p">,</span><span class="w"> </span><span class="kp">nil</span><span class="p">)</span>


<span class="sd">##[</span>
<span class="sd">Resource file header,</span>
<span class="sd">containing the offsets and lengths of the resource data area and resource map.</span>

<span class="sd">]##</span>
<span class="k">proc</span><span class="w"> </span><span class="nf">read</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork_FileHeader], io: KaitaiStream, root: KaitaiStruct, parent: KaitaiStruct): ResourceFork_FileHeader =</span>
<span class="w">  </span><span class="k">template</span><span class="w"> </span><span class="nf">this</span><span class="p">:</span><span class="w"> </span><span class="n">untyped</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span>
<span class="w">  </span><span class="n">this</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="p">(</span><span class="n">ResourceFork_FileHeader</span><span class="p">)</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kp">nil</span><span class="p">:</span><span class="w"> </span><span class="k">cast</span><span class="o">[</span><span class="n">ResourceFork</span><span class="o">]</span><span class="p">(</span><span class="n">this</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="p">:</span><span class="w"> </span><span class="k">cast</span><span class="o">[</span><span class="n">ResourceFork</span><span class="o">]</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">io</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">root</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parent</span>


<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  Offset of the resource data area,</span>
<span class="sd">from the start of the resource file.</span>

<span class="sd">In practice,</span>
<span class="sd">this should always be `256`,</span>
<span class="sd">i. e. the resource data area should directly follow the application-specific data area.</span>

<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">ofsDataBlocksExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readU4be</span><span class="p">()</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">ofsDataBlocks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ofsDataBlocksExpr</span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  Offset of the resource map,</span>
<span class="sd">from the start of the resource file.</span>

<span class="sd">In practice,</span>
<span class="sd">this should always be `ofs_data_blocks + len_data_blocks`,</span>
<span class="sd">i. e. the resource map should directly follow the resource data area.</span>

<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">ofsResourceMapExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readU4be</span><span class="p">()</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">ofsResourceMap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ofsResourceMapExpr</span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  Length of the resource data area.</span>

<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">lenDataBlocksExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readU4be</span><span class="p">()</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">lenDataBlocks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lenDataBlocksExpr</span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  Length of the resource map.</span>

<span class="sd">In practice,</span>
<span class="sd">this should always be `_root._io.size - ofs_resource_map`,</span>
<span class="sd">i. e. the resource map should extend to the end of the resource file.</span>

<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">lenResourceMapExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readU4be</span><span class="p">()</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">lenResourceMap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lenResourceMapExpr</span>

<span class="k">proc</span><span class="w"> </span><span class="nf">fromFile</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork_FileHeader], filename: string): ResourceFork_FileHeader =</span>
<span class="w">  </span><span class="n">ResourceFork_FileHeader</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">newKaitaiFileStream</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span><span class="w"> </span><span class="kp">nil</span><span class="p">,</span><span class="w"> </span><span class="kp">nil</span><span class="p">)</span>


<span class="sd">##[</span>
<span class="sd">A resource data block,</span>
<span class="sd">as stored in the resource data area.</span>

<span class="sd">Each data block stores the data contained in a resource,</span>
<span class="sd">along with its length.</span>

<span class="sd">]##</span>
<span class="k">proc</span><span class="w"> </span><span class="nf">read</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork_DataBlock], io: KaitaiStream, root: KaitaiStruct, parent: ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference): ResourceFork_DataBlock =</span>
<span class="w">  </span><span class="k">template</span><span class="w"> </span><span class="nf">this</span><span class="p">:</span><span class="w"> </span><span class="n">untyped</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span>
<span class="w">  </span><span class="n">this</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="p">(</span><span class="n">ResourceFork_DataBlock</span><span class="p">)</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kp">nil</span><span class="p">:</span><span class="w"> </span><span class="k">cast</span><span class="o">[</span><span class="n">ResourceFork</span><span class="o">]</span><span class="p">(</span><span class="n">this</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="p">:</span><span class="w"> </span><span class="k">cast</span><span class="o">[</span><span class="n">ResourceFork</span><span class="o">]</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">io</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">root</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parent</span>


<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  The length of the resource data stored in this block.</span>

<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">lenDataExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readU4be</span><span class="p">()</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">lenData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lenDataExpr</span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  The data stored in this block.</span>

<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">dataExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readBytes</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">lenData</span><span class="p">))</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dataExpr</span>

<span class="k">proc</span><span class="w"> </span><span class="nf">fromFile</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork_DataBlock], filename: string): ResourceFork_DataBlock =</span>
<span class="w">  </span><span class="n">ResourceFork_DataBlock</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">newKaitaiFileStream</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span><span class="w"> </span><span class="kp">nil</span><span class="p">,</span><span class="w"> </span><span class="kp">nil</span><span class="p">)</span>


<span class="sd">##[</span>
<span class="sd">Resource map,</span>
<span class="sd">containing information about the resources in the file and where they are located in the data area.</span>

<span class="sd">]##</span>
<span class="k">proc</span><span class="w"> </span><span class="nf">read</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork_ResourceMap], io: KaitaiStream, root: KaitaiStruct, parent: ResourceFork): ResourceFork_ResourceMap =</span>
<span class="w">  </span><span class="k">template</span><span class="w"> </span><span class="nf">this</span><span class="p">:</span><span class="w"> </span><span class="n">untyped</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span>
<span class="w">  </span><span class="n">this</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="p">(</span><span class="n">ResourceFork_ResourceMap</span><span class="p">)</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kp">nil</span><span class="p">:</span><span class="w"> </span><span class="k">cast</span><span class="o">[</span><span class="n">ResourceFork</span><span class="o">]</span><span class="p">(</span><span class="n">this</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="p">:</span><span class="w"> </span><span class="k">cast</span><span class="o">[</span><span class="n">ResourceFork</span><span class="o">]</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">io</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">root</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parent</span>


<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  Reserved space for a copy of the resource file header.</span>
<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">reservedFileHeaderCopyExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ResourceFork_FileHeader</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">root</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="p">)</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">reservedFileHeaderCopy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reservedFileHeaderCopyExpr</span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  Reserved space for a handle to the next loaded resource map in memory.</span>
<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">reservedNextResourceMapHandleExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readU4be</span><span class="p">()</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">reservedNextResourceMapHandle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reservedNextResourceMapHandleExpr</span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  Reserved space for the resource file&#39;s file reference number.</span>
<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">reservedFileReferenceNumberExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readU2be</span><span class="p">()</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">reservedFileReferenceNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reservedFileReferenceNumberExpr</span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  The resource file&#39;s attributes.</span>
<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">rawFileAttributesExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readBytes</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">rawFileAttributes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rawFileAttributesExpr</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">rawFileAttributesIo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newKaitaiStream</span><span class="p">(</span><span class="n">rawFileAttributesExpr</span><span class="p">)</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">fileAttributesExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ResourceFork_ResourceMap_FileAttributes</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">rawFileAttributesIo</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">root</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="p">)</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">fileAttributes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fileAttributesExpr</span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  Offset of the resource type list,</span>
<span class="sd">from the start of the resource map.</span>

<span class="sd">In practice,</span>
<span class="sd">this should always be `sizeof&lt;resource_map&gt;`,</span>
<span class="sd">i. e. the resource type list should directly follow the resource map.</span>

<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">ofsTypeListExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readU2be</span><span class="p">()</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">ofsTypeList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ofsTypeListExpr</span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  Offset of the resource name area,</span>
<span class="sd">from the start of the resource map.</span>

<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">ofsNamesExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readU2be</span><span class="p">()</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">ofsNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ofsNamesExpr</span>

<span class="k">proc</span><span class="w"> </span><span class="nf">typeListAndReferenceLists</span><span class="p">(</span><span class="n">this</span><span class="p">:</span><span class="w"> </span><span class="n">ResourceFork_ResourceMap</span><span class="p">):</span><span class="w"> </span><span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  The resource map&#39;s resource type list, followed by the resource reference list area.</span>
<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">typeListAndReferenceListsInstFlag</span><span class="p">:</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">typeListAndReferenceListsInst</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">pos</span><span class="p">()</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">seek</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">ofsTypeList</span><span class="p">))</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">rawTypeListAndReferenceListsInstExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readBytes</span><span class="p">(</span><span class="nb">int</span><span class="p">((</span><span class="n">this</span><span class="p">.</span><span class="n">ofsNames</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">ofsTypeList</span><span class="p">)))</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">rawTypeListAndReferenceListsInst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rawTypeListAndReferenceListsInstExpr</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">rawTypeListAndReferenceListsInstIo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newKaitaiStream</span><span class="p">(</span><span class="n">rawTypeListAndReferenceListsInstExpr</span><span class="p">)</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">typeListAndReferenceListsInstExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">rawTypeListAndReferenceListsInstIo</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">root</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="p">)</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">typeListAndReferenceListsInst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">typeListAndReferenceListsInstExpr</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">seek</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">typeListAndReferenceListsInstFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kp">true</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">typeListAndReferenceListsInst</span>

<span class="k">proc</span><span class="w"> </span><span class="nf">namesWithIo</span><span class="p">(</span><span class="n">this</span><span class="p">:</span><span class="w"> </span><span class="n">ResourceFork_ResourceMap</span><span class="p">):</span><span class="w"> </span><span class="n">BytesWithIo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  Use `names` instead,</span>
<span class="sd">unless you need access to this instance&#39;s `_io`.</span>

<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">namesWithIoInstFlag</span><span class="p">:</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">namesWithIoInst</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">pos</span><span class="p">()</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">seek</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">ofsNames</span><span class="p">))</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">rawNamesWithIoInstExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readBytesFull</span><span class="p">()</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">rawNamesWithIoInst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rawNamesWithIoInstExpr</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">rawNamesWithIoInstIo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newKaitaiStream</span><span class="p">(</span><span class="n">rawNamesWithIoInstExpr</span><span class="p">)</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">namesWithIoInstExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BytesWithIo</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">rawNamesWithIoInstIo</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">root</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="p">)</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">namesWithIoInst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">namesWithIoInstExpr</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">seek</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">namesWithIoInstFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kp">true</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">namesWithIoInst</span>

<span class="k">proc</span><span class="w"> </span><span class="nf">names</span><span class="p">(</span><span class="n">this</span><span class="p">:</span><span class="w"> </span><span class="n">ResourceFork_ResourceMap</span><span class="p">):</span><span class="w"> </span><span class="nb">seq</span><span class="o">[</span><span class="n">byte</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  Storage area for the names of all resources.</span>
<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">namesInstFlag</span><span class="p">:</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">namesInst</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">namesInstExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">seq</span><span class="o">[</span><span class="n">byte</span><span class="o">]</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">namesWithIo</span><span class="p">.</span><span class="n">data</span><span class="p">)</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">namesInst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">namesInstExpr</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">namesInstFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kp">true</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">namesInst</span>

<span class="k">proc</span><span class="w"> </span><span class="nf">fromFile</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork_ResourceMap], filename: string): ResourceFork_ResourceMap =</span>
<span class="w">  </span><span class="n">ResourceFork_ResourceMap</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">newKaitaiFileStream</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span><span class="w"> </span><span class="kp">nil</span><span class="p">,</span><span class="w"> </span><span class="kp">nil</span><span class="p">)</span>


<span class="sd">##[</span>
<span class="sd">A resource file&#39;s attributes,</span>
<span class="sd">as stored in the resource map.</span>

<span class="sd">These attributes are sometimes also referred to as resource map attributes,</span>
<span class="sd">because of where they are stored in the file.</span>

<span class="sd">]##</span>
<span class="k">proc</span><span class="w"> </span><span class="nf">read</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork_ResourceMap_FileAttributes], io: KaitaiStream, root: KaitaiStruct, parent: ResourceFork_ResourceMap): ResourceFork_ResourceMap_FileAttributes =</span>
<span class="w">  </span><span class="k">template</span><span class="w"> </span><span class="nf">this</span><span class="p">:</span><span class="w"> </span><span class="n">untyped</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span>
<span class="w">  </span><span class="n">this</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="p">(</span><span class="n">ResourceFork_ResourceMap_FileAttributes</span><span class="p">)</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kp">nil</span><span class="p">:</span><span class="w"> </span><span class="k">cast</span><span class="o">[</span><span class="n">ResourceFork</span><span class="o">]</span><span class="p">(</span><span class="n">this</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="p">:</span><span class="w"> </span><span class="k">cast</span><span class="o">[</span><span class="n">ResourceFork</span><span class="o">]</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">io</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">root</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parent</span>


<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  TODO What does this attribute actually do,</span>
<span class="sd">and how is it different from `read_only`?</span>

<span class="sd">This attribute is undocumented and not defined in &lt;CarbonCore/Resources.h&gt;,</span>
<span class="sd">but ResEdit has a checkbox called &quot;Resources Locked&quot; for this attribute.</span>

<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">resourcesLockedExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readBitsIntBe</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">resourcesLocked</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">resourcesLockedExpr</span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  These attributes have no known usage or meaning and should always be zero.</span>

<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">reserved0Expr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readBitsIntBe</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">reserved0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reserved0Expr</span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  Indicates that this printer driver is compatible with MultiFinder,</span>
<span class="sd">i. e. can be used simultaneously by multiple applications.</span>
<span class="sd">This attribute is only meant to be set on printer driver resource forks.</span>

<span class="sd">This attribute is not documented in Inside Macintosh and is not defined in &lt;CarbonCore/Resources.h&gt;.</span>
<span class="sd">It is documented in technote PR510,</span>
<span class="sd">and ResEdit has a checkbox called &quot;Printer Driver MultiFinder Compatible&quot; for this attribute.</span>

<span class="sd">  @see &lt;a href=&quot;https://developer.apple.com/library/archive/technotes/pr/pr_510.html&quot;&gt;Apple Technical Note PR510 - Printer Driver Q&amp;As, section &#39;&quot;Printer driver is MultiFinder compatible&quot; bit&#39;&lt;/a&gt;</span>
<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">printerDriverMultifinderCompatibleExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readBitsIntBe</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">printerDriverMultifinderCompatible</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">printerDriverMultifinderCompatibleExpr</span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  Indicates that the Resource Manager should not write any changes from memory into the resource file.</span>
<span class="sd">Any modification operations requested by the application will return successfully,</span>
<span class="sd">but will not actually update the resource file.</span>

<span class="sd">TODO Is this attribute supposed to be set on disk or only in memory?</span>

<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">noWriteChangesExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readBitsIntBe</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">noWriteChanges</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">noWriteChangesExpr</span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  Indicates that the resource file should be compacted the next time it is written by the Resource Manager.</span>
<span class="sd">This attribute is only meant to be set in memory;</span>
<span class="sd">it is cleared when the resource file is written to disk.</span>

<span class="sd">This attribute is mainly used internally by the Resource Manager,</span>
<span class="sd">but may also be set manually by the application.</span>

<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">needsCompactExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readBitsIntBe</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">needsCompact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">needsCompactExpr</span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  Indicates that the resource map has been changed in memory and should be written to the resource file on the next update.</span>
<span class="sd">This attribute is only meant to be set in memory;</span>
<span class="sd">it is cleared when the resource file is written to disk.</span>

<span class="sd">This attribute is mainly used internally by the Resource Manager,</span>
<span class="sd">but may also be set manually by the application.</span>

<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">mapNeedsWriteExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readBitsIntBe</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">mapNeedsWrite</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mapNeedsWriteExpr</span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  These attributes have no known usage or meaning and should always be zero.</span>

<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">reserved1Expr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readBitsIntBe</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">reserved1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reserved1Expr</span>

<span class="k">proc</span><span class="w"> </span><span class="nf">asInt</span><span class="p">(</span><span class="n">this</span><span class="p">:</span><span class="w"> </span><span class="n">ResourceFork_ResourceMap_FileAttributes</span><span class="p">):</span><span class="w"> </span><span class="n">uint16</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  The attributes as a packed integer,</span>
<span class="sd">as they are stored in the file.</span>

<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">asIntInstFlag</span><span class="p">:</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">asIntInst</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">pos</span><span class="p">()</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">seek</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">asIntInstExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readU2be</span><span class="p">()</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">asIntInst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">asIntInstExpr</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">seek</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">asIntInstFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kp">true</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">asIntInst</span>

<span class="k">proc</span><span class="w"> </span><span class="nf">fromFile</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork_ResourceMap_FileAttributes], filename: string): ResourceFork_ResourceMap_FileAttributes =</span>
<span class="w">  </span><span class="n">ResourceFork_ResourceMap_FileAttributes</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">newKaitaiFileStream</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span><span class="w"> </span><span class="kp">nil</span><span class="p">,</span><span class="w"> </span><span class="kp">nil</span><span class="p">)</span>


<span class="sd">##[</span>
<span class="sd">Resource type list and storage area for resource reference lists in the resource map.</span>

<span class="sd">The two parts are combined into a single type here for technical reasons:</span>
<span class="sd">the start of the resource reference list area is not stored explicitly in the file,</span>
<span class="sd">instead it always starts directly after the resource type list.</span>
<span class="sd">The simplest way to implement this is by placing both types into a single `seq`.</span>

<span class="sd">]##</span>
<span class="k">proc</span><span class="w"> </span><span class="nf">read</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork_ResourceMap_TypeListAndReferenceLists], io: KaitaiStream, root: KaitaiStruct, parent: ResourceFork_ResourceMap): ResourceFork_ResourceMap_TypeListAndReferenceLists =</span>
<span class="w">  </span><span class="k">template</span><span class="w"> </span><span class="nf">this</span><span class="p">:</span><span class="w"> </span><span class="n">untyped</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span>
<span class="w">  </span><span class="n">this</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="p">(</span><span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists</span><span class="p">)</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kp">nil</span><span class="p">:</span><span class="w"> </span><span class="k">cast</span><span class="o">[</span><span class="n">ResourceFork</span><span class="o">]</span><span class="p">(</span><span class="n">this</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="p">:</span><span class="w"> </span><span class="k">cast</span><span class="o">[</span><span class="n">ResourceFork</span><span class="o">]</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">io</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">root</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parent</span>


<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  The resource map&#39;s resource type list.</span>
<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">typeListExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_TypeList</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">root</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="p">)</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">typeList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">typeListExpr</span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  Storage area for the resource map&#39;s resource reference lists.</span>

<span class="sd">According to Inside Macintosh,</span>
<span class="sd">the reference lists are stored contiguously,</span>
<span class="sd">in the same order as their corresponding resource type list entries.</span>

<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">referenceListsExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readBytesFull</span><span class="p">()</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">referenceLists</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">referenceListsExpr</span>

<span class="k">proc</span><span class="w"> </span><span class="nf">fromFile</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork_ResourceMap_TypeListAndReferenceLists], filename: string): ResourceFork_ResourceMap_TypeListAndReferenceLists =</span>
<span class="w">  </span><span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">newKaitaiFileStream</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span><span class="w"> </span><span class="kp">nil</span><span class="p">,</span><span class="w"> </span><span class="kp">nil</span><span class="p">)</span>


<span class="sd">##[</span>
<span class="sd">Resource type list in the resource map.</span>
<span class="sd">]##</span>
<span class="k">proc</span><span class="w"> </span><span class="nf">read</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork_ResourceMap_TypeListAndReferenceLists_TypeList], io: KaitaiStream, root: KaitaiStruct, parent: ResourceFork_ResourceMap_TypeListAndReferenceLists): ResourceFork_ResourceMap_TypeListAndReferenceLists_TypeList =</span>
<span class="w">  </span><span class="k">template</span><span class="w"> </span><span class="nf">this</span><span class="p">:</span><span class="w"> </span><span class="n">untyped</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span>
<span class="w">  </span><span class="n">this</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="p">(</span><span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_TypeList</span><span class="p">)</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kp">nil</span><span class="p">:</span><span class="w"> </span><span class="k">cast</span><span class="o">[</span><span class="n">ResourceFork</span><span class="o">]</span><span class="p">(</span><span class="n">this</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="p">:</span><span class="w"> </span><span class="k">cast</span><span class="o">[</span><span class="n">ResourceFork</span><span class="o">]</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">io</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">root</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parent</span>


<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  The number of resource types in this list,</span>
<span class="sd">minus one.</span>

<span class="sd">If the resource list is empty,</span>
<span class="sd">the value of this field is `0xffff`,</span>
<span class="sd">i. e. `-1` truncated to a 16-bit unsigned integer.</span>

<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">numTypesM1Expr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readU2be</span><span class="p">()</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">numTypesM1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">numTypesM1Expr</span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  Entries in the resource type list.</span>
<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">..</span><span class="o">&lt;</span><span class="w"> </span><span class="nb">int</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">numTypes</span><span class="p">):</span>
<span class="w">    </span><span class="k">let</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_TypeList_TypeListEntry</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">root</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="p">)</span>
<span class="w">    </span><span class="n">this</span><span class="p">.</span><span class="n">entries</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">it</span><span class="p">)</span>

<span class="k">proc</span><span class="w"> </span><span class="nf">numTypes</span><span class="p">(</span><span class="n">this</span><span class="p">:</span><span class="w"> </span><span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_TypeList</span><span class="p">):</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  The number of resource types in this list.</span>
<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">numTypesInstFlag</span><span class="p">:</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">numTypesInst</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">numTypesInstExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">int</span><span class="p">(((</span><span class="n">this</span><span class="p">.</span><span class="n">numTypesM1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">%%%</span><span class="w"> </span><span class="mi">65536</span><span class="p">))</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">numTypesInst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">numTypesInstExpr</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">numTypesInstFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kp">true</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">numTypesInst</span>

<span class="k">proc</span><span class="w"> </span><span class="nf">fromFile</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork_ResourceMap_TypeListAndReferenceLists_TypeList], filename: string): ResourceFork_ResourceMap_TypeListAndReferenceLists_TypeList =</span>
<span class="w">  </span><span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_TypeList</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">newKaitaiFileStream</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span><span class="w"> </span><span class="kp">nil</span><span class="p">,</span><span class="w"> </span><span class="kp">nil</span><span class="p">)</span>


<span class="sd">##[</span>
<span class="sd">A single entry in the resource type list.</span>

<span class="sd">Each entry corresponds to exactly one resource reference list.</span>

<span class="sd">]##</span>
<span class="k">proc</span><span class="w"> </span><span class="nf">read</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork_ResourceMap_TypeListAndReferenceLists_TypeList_TypeListEntry], io: KaitaiStream, root: KaitaiStruct, parent: ResourceFork_ResourceMap_TypeListAndReferenceLists_TypeList): ResourceFork_ResourceMap_TypeListAndReferenceLists_TypeList_TypeListEntry =</span>
<span class="w">  </span><span class="k">template</span><span class="w"> </span><span class="nf">this</span><span class="p">:</span><span class="w"> </span><span class="n">untyped</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span>
<span class="w">  </span><span class="n">this</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="p">(</span><span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_TypeList_TypeListEntry</span><span class="p">)</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kp">nil</span><span class="p">:</span><span class="w"> </span><span class="k">cast</span><span class="o">[</span><span class="n">ResourceFork</span><span class="o">]</span><span class="p">(</span><span class="n">this</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="p">:</span><span class="w"> </span><span class="k">cast</span><span class="o">[</span><span class="n">ResourceFork</span><span class="o">]</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">io</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">root</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parent</span>


<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  The four-character type code of the resources in the reference list.</span>
<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">typeExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readBytes</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="k">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">typeExpr</span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  The number of resources in the reference list for this type,</span>
<span class="sd">minus one.</span>

<span class="sd">Empty reference lists should never exist.</span>

<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">numReferencesM1Expr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readU2be</span><span class="p">()</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">numReferencesM1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">numReferencesM1Expr</span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  Offset of the resource reference list for this resource type,</span>
<span class="sd">from the start of the resource type list.</span>

<span class="sd">Although the offset is relative to the start of the type list,</span>
<span class="sd">it should never point into the type list itself,</span>
<span class="sd">but into the reference list storage area that directly follows it.</span>
<span class="sd">That is,</span>
<span class="sd">it should always be at least `_parent._sizeof`.</span>

<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">ofsReferenceListExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readU2be</span><span class="p">()</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">ofsReferenceList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ofsReferenceListExpr</span>

<span class="k">proc</span><span class="w"> </span><span class="nf">numReferences</span><span class="p">(</span><span class="n">this</span><span class="p">:</span><span class="w"> </span><span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_TypeList_TypeListEntry</span><span class="p">):</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  The number of resources in the reference list for this type.</span>
<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">numReferencesInstFlag</span><span class="p">:</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">numReferencesInst</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">numReferencesInstExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">int</span><span class="p">(((</span><span class="n">this</span><span class="p">.</span><span class="n">numReferencesM1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">%%%</span><span class="w"> </span><span class="mi">65536</span><span class="p">))</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">numReferencesInst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">numReferencesInstExpr</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">numReferencesInstFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kp">true</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">numReferencesInst</span>

<span class="k">proc</span><span class="w"> </span><span class="nf">referenceList</span><span class="p">(</span><span class="n">this</span><span class="p">:</span><span class="w"> </span><span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_TypeList_TypeListEntry</span><span class="p">):</span><span class="w"> </span><span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  The resource reference list for this resource type.</span>

<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">referenceListInstFlag</span><span class="p">:</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">referenceListInst</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">io</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">parent</span><span class="p">.</span><span class="n">parent</span><span class="p">.</span><span class="n">io</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">io</span><span class="p">.</span><span class="n">pos</span><span class="p">()</span>
<span class="w">  </span><span class="n">io</span><span class="p">.</span><span class="n">seek</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">ofsReferenceList</span><span class="p">))</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">referenceListInstExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">io</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">root</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">numReferences</span><span class="p">)</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">referenceListInst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">referenceListInstExpr</span>
<span class="w">  </span><span class="n">io</span><span class="p">.</span><span class="n">seek</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">referenceListInstFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kp">true</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">referenceListInst</span>

<span class="k">proc</span><span class="w"> </span><span class="nf">fromFile</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork_ResourceMap_TypeListAndReferenceLists_TypeList_TypeListEntry], filename: string): ResourceFork_ResourceMap_TypeListAndReferenceLists_TypeList_TypeListEntry =</span>
<span class="w">  </span><span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_TypeList_TypeListEntry</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">newKaitaiFileStream</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span><span class="w"> </span><span class="kp">nil</span><span class="p">,</span><span class="w"> </span><span class="kp">nil</span><span class="p">)</span>


<span class="sd">##[</span>
<span class="sd">A resource reference list,</span>
<span class="sd">as stored in the reference list area.</span>

<span class="sd">Each reference list has exactly one matching entry in the resource type list,</span>
<span class="sd">and describes all resources of a single type in the file.</span>

<span class="sd">]##</span>
<span class="k">proc</span><span class="w"> </span><span class="nf">read</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList], io: KaitaiStream, root: KaitaiStruct, parent: ResourceFork_ResourceMap_TypeListAndReferenceLists_TypeList_TypeListEntry, numReferences: any): ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList =</span>
<span class="w">  </span><span class="k">template</span><span class="w"> </span><span class="nf">this</span><span class="p">:</span><span class="w"> </span><span class="n">untyped</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span>
<span class="w">  </span><span class="n">this</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="p">(</span><span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList</span><span class="p">)</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kp">nil</span><span class="p">:</span><span class="w"> </span><span class="k">cast</span><span class="o">[</span><span class="n">ResourceFork</span><span class="o">]</span><span class="p">(</span><span class="n">this</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="p">:</span><span class="w"> </span><span class="k">cast</span><span class="o">[</span><span class="n">ResourceFork</span><span class="o">]</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">io</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">root</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parent</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">numReferencesExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uint16</span><span class="p">(</span><span class="n">numReferences</span><span class="p">)</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">numReferences</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">numReferencesExpr</span>


<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  The resource references in this reference list.</span>
<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">..</span><span class="o">&lt;</span><span class="w"> </span><span class="nb">int</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">numReferences</span><span class="p">):</span>
<span class="w">    </span><span class="k">let</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">root</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="p">)</span>
<span class="w">    </span><span class="n">this</span><span class="p">.</span><span class="n">references</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">it</span><span class="p">)</span>

<span class="k">proc</span><span class="w"> </span><span class="nf">fromFile</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList], filename: string): ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList =</span>
<span class="w">  </span><span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">newKaitaiFileStream</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span><span class="w"> </span><span class="kp">nil</span><span class="p">,</span><span class="w"> </span><span class="kp">nil</span><span class="p">)</span>


<span class="sd">##[</span>
<span class="sd">A single resource reference in a resource reference list.</span>
<span class="sd">]##</span>
<span class="k">proc</span><span class="w"> </span><span class="nf">read</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference], io: KaitaiStream, root: KaitaiStruct, parent: ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList): ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference =</span>
<span class="w">  </span><span class="k">template</span><span class="w"> </span><span class="nf">this</span><span class="p">:</span><span class="w"> </span><span class="n">untyped</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span>
<span class="w">  </span><span class="n">this</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="p">(</span><span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference</span><span class="p">)</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kp">nil</span><span class="p">:</span><span class="w"> </span><span class="k">cast</span><span class="o">[</span><span class="n">ResourceFork</span><span class="o">]</span><span class="p">(</span><span class="n">this</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="p">:</span><span class="w"> </span><span class="k">cast</span><span class="o">[</span><span class="n">ResourceFork</span><span class="o">]</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">io</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">root</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parent</span>


<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  ID of the resource described by this reference.</span>
<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">idExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readS2be</span><span class="p">()</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">idExpr</span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  Offset of the name for the resource described by this reference,</span>
<span class="sd">from the start of the resource name area.</span>

<span class="sd">If the resource has no name,</span>
<span class="sd">the value of this field is `0xffff`</span>
<span class="sd">i. e. `-1` truncated to a 16-bit unsigned integer.</span>

<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">ofsNameExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readU2be</span><span class="p">()</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">ofsName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ofsNameExpr</span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  Attributes of the resource described by this reference.</span>
<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">rawAttributesExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readBytes</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">rawAttributes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rawAttributesExpr</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">rawAttributesIo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newKaitaiStream</span><span class="p">(</span><span class="n">rawAttributesExpr</span><span class="p">)</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">attributesExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference_Attributes</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">rawAttributesIo</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">root</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="p">)</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">attributes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">attributesExpr</span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  Offset of the data block for the resource described by this reference,</span>
<span class="sd">from the start of the resource data area.</span>

<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">ofsDataBlockExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readBitsIntBe</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">ofsDataBlock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ofsDataBlockExpr</span>
<span class="w">  </span><span class="n">alignToByte</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">)</span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  Reserved space for the resource&#39;s handle in memory.</span>
<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">reservedHandleExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readU4be</span><span class="p">()</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">reservedHandle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reservedHandleExpr</span>

<span class="k">proc</span><span class="w"> </span><span class="nf">name</span><span class="p">(</span><span class="n">this</span><span class="p">:</span><span class="w"> </span><span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference</span><span class="p">):</span><span class="w"> </span><span class="n">ResourceFork_ResourceMap_Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  The name (if any) of the resource described by this reference.</span>

<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">nameInstFlag</span><span class="p">:</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">nameInst</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">ofsName</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">65535</span><span class="p">:</span>
<span class="w">    </span><span class="k">let</span><span class="w"> </span><span class="n">io</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ResourceFork</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">root</span><span class="p">).</span><span class="n">resourceMap</span><span class="p">.</span><span class="n">namesWithIo</span><span class="p">.</span><span class="n">io</span>
<span class="w">    </span><span class="k">let</span><span class="w"> </span><span class="n">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">io</span><span class="p">.</span><span class="n">pos</span><span class="p">()</span>
<span class="w">    </span><span class="n">io</span><span class="p">.</span><span class="n">seek</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">ofsName</span><span class="p">))</span>
<span class="w">    </span><span class="k">let</span><span class="w"> </span><span class="n">nameInstExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ResourceFork_ResourceMap_Name</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">io</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">root</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="p">)</span>
<span class="w">    </span><span class="n">this</span><span class="p">.</span><span class="n">nameInst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nameInstExpr</span>
<span class="w">    </span><span class="n">io</span><span class="p">.</span><span class="n">seek</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">nameInstFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kp">true</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">nameInst</span>

<span class="k">proc</span><span class="w"> </span><span class="nf">dataBlock</span><span class="p">(</span><span class="n">this</span><span class="p">:</span><span class="w"> </span><span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference</span><span class="p">):</span><span class="w"> </span><span class="n">ResourceFork_DataBlock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  The data block containing the data for the resource described by this reference.</span>

<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">dataBlockInstFlag</span><span class="p">:</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">dataBlockInst</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">io</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ResourceFork</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">root</span><span class="p">).</span><span class="n">dataBlocksWithIo</span><span class="p">.</span><span class="n">io</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">io</span><span class="p">.</span><span class="n">pos</span><span class="p">()</span>
<span class="w">  </span><span class="n">io</span><span class="p">.</span><span class="n">seek</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">ofsDataBlock</span><span class="p">))</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">dataBlockInstExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ResourceFork_DataBlock</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">io</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">root</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="p">)</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">dataBlockInst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dataBlockInstExpr</span>
<span class="w">  </span><span class="n">io</span><span class="p">.</span><span class="n">seek</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">dataBlockInstFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kp">true</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">dataBlockInst</span>

<span class="k">proc</span><span class="w"> </span><span class="nf">fromFile</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference], filename: string): ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference =</span>
<span class="w">  </span><span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">newKaitaiFileStream</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span><span class="w"> </span><span class="kp">nil</span><span class="p">,</span><span class="w"> </span><span class="kp">nil</span><span class="p">)</span>


<span class="sd">##[</span>
<span class="sd">A resource&#39;s attributes,</span>
<span class="sd">as stored in a resource reference.</span>

<span class="sd">]##</span>
<span class="k">proc</span><span class="w"> </span><span class="nf">read</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference_Attributes], io: KaitaiStream, root: KaitaiStruct, parent: ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference): ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference_Attributes =</span>
<span class="w">  </span><span class="k">template</span><span class="w"> </span><span class="nf">this</span><span class="p">:</span><span class="w"> </span><span class="n">untyped</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span>
<span class="w">  </span><span class="n">this</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="p">(</span><span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference_Attributes</span><span class="p">)</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kp">nil</span><span class="p">:</span><span class="w"> </span><span class="k">cast</span><span class="o">[</span><span class="n">ResourceFork</span><span class="o">]</span><span class="p">(</span><span class="n">this</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="p">:</span><span class="w"> </span><span class="k">cast</span><span class="o">[</span><span class="n">ResourceFork</span><span class="o">]</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">io</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">root</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parent</span>


<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  Indicates that this resource reference is a system reference rather than a regular local reference.</span>
<span class="sd">This attribute is nearly undocumented.</span>
<span class="sd">For all practical purposes,</span>
<span class="sd">it should be considered reserved and should always be zero.</span>

<span class="sd">This attribute was last documented in the Promotional Edition of Inside Macintosh,</span>
<span class="sd">in the Resource Manager chapter,</span>
<span class="sd">on pages 37-41,</span>
<span class="sd">in a &quot;System References&quot; section that calls itself &quot;of historical interest only&quot;.</span>
<span class="sd">The final versions of Inside Macintosh only mention this attribute as &quot;reserved for use by the Resource Manager&quot;.</span>
<span class="sd">&lt;CarbonCore/Resources.h&gt; contains a `resSysRefBit` constant,</span>
<span class="sd">but no corresponding `resSysRef` constant like for all other resource attributes.</span>

<span class="sd">According to the Inside Macintosh Promotional Edition,</span>
<span class="sd">a system reference was effectively an alias pointing to a resource stored in the system file,</span>
<span class="sd">possibly with a different ID and name (but not type) than the system reference.</span>
<span class="sd">If this attribute is set,</span>
<span class="sd">`ofs_data_block` is ignored and should be zero,</span>
<span class="sd">and `reserved_handle` contains</span>
<span class="sd">(in its high and low two bytes, respectively)</span>
<span class="sd">the ID and name offset of the real system resource that this system reference points to.</span>

<span class="sd">TODO Do any publicly available Mac OS versions support system references,</span>
<span class="sd">and do any real files/applications use them?</span>
<span class="sd">So far the answer seems to be no,</span>
<span class="sd">but I would like to be proven wrong!</span>

<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">systemReferenceExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readBitsIntBe</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">systemReference</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">systemReferenceExpr</span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  Indicates that this resource should be loaded into the system heap if possible,</span>
<span class="sd">rather than the application heap.</span>

<span class="sd">This attribute is only meant to be used by Mac OS itself,</span>
<span class="sd">for System and Finder resources,</span>
<span class="sd">and not by normal applications.</span>

<span class="sd">This attribute may be set both in memory and on disk,</span>
<span class="sd">but it only has any meaning while the resource file is loaded into memory.</span>

<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">loadIntoSystemHeapExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readBitsIntBe</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">loadIntoSystemHeap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">loadIntoSystemHeapExpr</span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  Indicates that this resource&#39;s data should be purgeable by the Mac OS Memory Manager.</span>
<span class="sd">This allows the resource data to be purged from memory if space is needed on the heap.</span>
<span class="sd">Purged resources can later be reloaded from disk if their data is needed again.</span>

<span class="sd">If the `locked` attribute is set,</span>
<span class="sd">this attribute has no effect</span>
<span class="sd">(i. e. locked resources are never purgeable).</span>

<span class="sd">This attribute may be set both in memory and on disk,</span>
<span class="sd">but it only has any meaning while the resource file is loaded into memory.</span>

<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">purgeableExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readBitsIntBe</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">purgeable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">purgeableExpr</span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  Indicates that this resource&#39;s data should be locked to the Mac OS Memory Manager.</span>
<span class="sd">This prevents the resource data from being moved when the heap is compacted.</span>

<span class="sd">This attribute may be set both in memory and on disk,</span>
<span class="sd">but it only has any meaning while the resource file is loaded into memory.</span>

<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">lockedExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readBitsIntBe</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">locked</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lockedExpr</span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  Indicates that this resource should be protected (i. e. unmodifiable) in memory.</span>
<span class="sd">This prevents the application from using the Resource Manager to change the resource&#39;s data or metadata,</span>
<span class="sd">or delete it.</span>
<span class="sd">The only exception are the resource&#39;s attributes,</span>
<span class="sd">which can always be changed,</span>
<span class="sd">even for protected resources.</span>
<span class="sd">This allows protected resources to be unprotected again by the application.</span>

<span class="sd">This attribute may be set both in memory and on disk,</span>
<span class="sd">but it only has any meaning while the resource file is loaded into memory.</span>

<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">protectedExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readBitsIntBe</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">protected</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">protectedExpr</span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  Indicates that this resource&#39;s data should be immediately loaded into memory when the resource file is opened.</span>

<span class="sd">This attribute may be set both in memory and on disk,</span>
<span class="sd">but it only has any meaning when the resource file is first opened.</span>

<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">preloadExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readBitsIntBe</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">preload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">preloadExpr</span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  Indicates that this resource&#39;s data has been changed in memory and should be written to the resource file on the next update.</span>
<span class="sd">This attribute is only meant to be set in memory;</span>
<span class="sd">it is cleared when the resource file is written to disk.</span>

<span class="sd">This attribute is used internally by the Resource Manager and should not be set manually by the application.</span>

<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">needsWriteExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readBitsIntBe</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">needsWrite</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">needsWriteExpr</span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  Indicates that this resource&#39;s data is compressed.</span>
<span class="sd">Compressed resource data is decompressed transparently by the Resource Manager when reading.</span>

<span class="sd">For a detailed description of the structure of compressed resources as they are stored in the file,</span>
<span class="sd">see the compressed_resource.ksy spec.</span>

<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">compressedExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readBitsIntBe</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">compressed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">compressedExpr</span>

<span class="k">proc</span><span class="w"> </span><span class="nf">asInt</span><span class="p">(</span><span class="n">this</span><span class="p">:</span><span class="w"> </span><span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference_Attributes</span><span class="p">):</span><span class="w"> </span><span class="n">uint8</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  The attributes as a packed integer,</span>
<span class="sd">as they are stored in the file.</span>

<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">asIntInstFlag</span><span class="p">:</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">asIntInst</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">pos</span><span class="p">()</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">seek</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">asIntInstExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readU1</span><span class="p">()</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">asIntInst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">asIntInstExpr</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">seek</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">asIntInstFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kp">true</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">asIntInst</span>

<span class="k">proc</span><span class="w"> </span><span class="nf">fromFile</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference_Attributes], filename: string): ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference_Attributes =</span>
<span class="w">  </span><span class="n">ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference_Attributes</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">newKaitaiFileStream</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span><span class="w"> </span><span class="kp">nil</span><span class="p">,</span><span class="w"> </span><span class="kp">nil</span><span class="p">)</span>


<span class="sd">##[</span>
<span class="sd">A resource name,</span>
<span class="sd">as stored in the resource name storage area in the resource map.</span>

<span class="sd">The resource names are not required to appear in any particular order.</span>
<span class="sd">There may be unused space between and around resource names,</span>
<span class="sd">but in practice they are often contiguous.</span>

<span class="sd">]##</span>
<span class="k">proc</span><span class="w"> </span><span class="nf">read</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork_ResourceMap_Name], io: KaitaiStream, root: KaitaiStruct, parent: ResourceFork_ResourceMap_TypeListAndReferenceLists_ReferenceList_Reference): ResourceFork_ResourceMap_Name =</span>
<span class="w">  </span><span class="k">template</span><span class="w"> </span><span class="nf">this</span><span class="p">:</span><span class="w"> </span><span class="n">untyped</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span>
<span class="w">  </span><span class="n">this</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="p">(</span><span class="n">ResourceFork_ResourceMap_Name</span><span class="p">)</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kp">nil</span><span class="p">:</span><span class="w"> </span><span class="k">cast</span><span class="o">[</span><span class="n">ResourceFork</span><span class="o">]</span><span class="p">(</span><span class="n">this</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="p">:</span><span class="w"> </span><span class="k">cast</span><span class="o">[</span><span class="n">ResourceFork</span><span class="o">]</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">io</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">root</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parent</span>


<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  The length of the resource name, in bytes.</span>

<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">lenValueExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readU1</span><span class="p">()</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">lenValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lenValueExpr</span>

<span class="w">  </span><span class="sd">##[</span>
<span class="sd">  The resource name.</span>

<span class="sd">This field is exposed as a byte array,</span>
<span class="sd">because there is no universal encoding for resource names.</span>
<span class="sd">Most Classic Mac software does not deal with encodings explicitly and instead assumes that all strings,</span>
<span class="sd">including resource names,</span>
<span class="sd">use the system encoding,</span>
<span class="sd">which varies depending on the system language.</span>
<span class="sd">This means that resource names can use different encodings depending on what system language they were created with.</span>

<span class="sd">Many resource names are plain ASCII,</span>
<span class="sd">meaning that the encoding often does not matter</span>
<span class="sd">(because all Mac OS encodings are ASCII-compatible).</span>
<span class="sd">For non-ASCII resource names,</span>
<span class="sd">the most common encoding is perhaps MacRoman</span>
<span class="sd">(used for English and other Western languages),</span>
<span class="sd">but other encodings are also sometimes used,</span>
<span class="sd">especially for software in non-Western languages.</span>

<span class="sd">There is no requirement that all names in a single resource file use the same encoding.</span>
<span class="sd">For example,</span>
<span class="sd">localized software may have some (but not all) of its resource names translated.</span>
<span class="sd">For non-Western languages,</span>
<span class="sd">this can lead to some resource names using MacRoman,</span>
<span class="sd">and others using a different encoding.</span>

<span class="sd">  ]##</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">valueExpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">readBytes</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">lenValue</span><span class="p">))</span>
<span class="w">  </span><span class="n">this</span><span class="p">.</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">valueExpr</span>

<span class="k">proc</span><span class="w"> </span><span class="nf">fromFile</span><span class="o">*</span><span class="p">(</span><span class="err">_: typedesc[ResourceFork_ResourceMap_Name], filename: string): ResourceFork_ResourceMap_Name =</span>
<span class="w">  </span><span class="n">ResourceFork_ResourceMap_Name</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">newKaitaiFileStream</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span><span class="w"> </span><span class="kp">nil</span><span class="p">,</span><span class="w"> </span><span class="kp">nil</span><span class="p">)</span>
</pre></div>

        </div>
        
    </div>
</section>

    <footer id="main-footer">
        <div class="container">
            &copy; 2015&ndash;2024 Kaitai Project and <a href="https://github.com/kaitai-io/kaitai_struct_formats/graphs/contributors">format repo contributors</a>

            <h3>Contacts</h3>

            <div class="row">
                <div class="col-sm-4">
                    <i class="fa fa-fw fa-2x fa-github"></i> <a href="https://github.com/kaitai-io/kaitai_struct">GitHub</a>
                </div>
                <div class="col-sm-4">
                    <i class="fa fa-fw fa-2x fa-twitter"></i> <a href="https://twitter.com/kaitai_io">@kaitai_io</a>
                </div>
                <div class="col-sm-4">
                    Gitter: <a href="https://gitter.im/kaitai_struct/Lobby">kaitai_struct</a>
                </div>
            </div>
        </div>
    </footer>

  <script src="//kaitai.io/js/jquery-1.12.3.min.js"></script>
  <script src="//kaitai.io/js/bootstrap.min.js"></script>

  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-76299550-1', 'auto');
      ga('send', 'pageview');
  </script>
</body>
</html>
