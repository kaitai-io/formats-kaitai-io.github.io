<!DOCTYPE html>
<html dir="ltr" lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>UTF-8-encoded string: C# parsing library</title>
  <meta name="keywords" content="kaitai,struct,binary,format,parsing,decoding,java,javascript,python,ruby,library,metadata">
  <meta name="description" content="Kaitai Struct is a formal language for binary format specification that can be compiled into parser code">

  <link rel="stylesheet" href="//kaitai.io/styles/bootstrap.min.css">
  <link rel="stylesheet" href="//kaitai.io/styles/bootstrap-theme.min.css">
  <link href='https://fonts.googleapis.com/css?family=Exo:400,700' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Share+Tech+Mono' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

  <link rel="stylesheet" href="//kaitai.io/styles/main.css" type="text/css">

  <link rel="stylesheet" href="//kaitai.io/styles/highlight/default.css">
  <style>
.diagram-img {
    display: block;
    max-width: 100%;
    height: auto;
    margin: 0 auto;
}

section.format {
    padding: 30px 0;
}

section#format-meta, section#format-index-header {
    background: #e3eef7;
}

section#format-diagram, section#format-index-footer {
    background: #e9f8dd;
}

section#format-ksy, section#format-lang {
    background: #d1eadd;
}

section#format-index .row {
    padding-bottom: 10px;
}

  </style>
  <script src="//kaitai.io/js/highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
</head>
<body data-spy="scroll" data-target="#main-navbar" data-offset="100">

    <nav class="navbar navbar-inverse navbar-fixed-top" id="main-navbar">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#main-navbar-collapse" aria-expanded="false">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <span class="navbar-brand">Kaitai Struct</span>
            </div>
            <div class="collapse navbar-collapse" id="main-navbar-collapse">
                <ul class="nav navbar-nav">
                    <li><a href="http://kaitai.io/#what-is-it">What is it?</a></li>
                    <li><a href="http://kaitai.io/#quick-start">Quick Start</a></li>
                    <li><a href="http://kaitai.io/#download">Download</a></li>
                    <li class="active"><a href="http://formats.kaitai.io/">Format Gallery</a></li>
                </ul>
                <ul class="nav navbar-nav navbar-right">
                    <li><a href="http://kaitai.io/repl/index.html">Try it</a></li>
                    <li><a href="https://ide.kaitai.io/">Web IDE</a></li>
                    <li><a href="http://doc.kaitai.io/">Documentation</a></li>
                </ul>
            </div>
        </div>
    </nav>
<nav>
    <div class="container">
    <ol class="breadcrumb">
        <li><a href="../index.html">Format Gallery</a></li>
        <li>Commonly Used Data Types</li>
        <li class="active">UTF-8-encoded string</li>
    </ol>
    </div>
</nav>

<section id="format-meta" class="format">
    <div class="container">
        <h1>UTF-8-encoded string:
            
            C# parsing library
            
        </h1>

        <div class="row">
            <div class="col-md-8">
                <p><p>UTF-8 is a popular character encoding scheme that allows to
represent strings as sequence of code points defined in Unicode
standard. Its features are:</p>
<ul>
<li>variable width (i.e. one code point might be represented by 1 to 4
bytes)</li>
<li>backward compatiblity with ASCII</li>
<li>basic validity checking (and thus distinguishing from other legacy
8-bit encodings)</li>
<li>maintaining sort order of codepoints if sorted as a byte array</li>
</ul>
<p>WARNING: For the vast majority of practical purposes of format
definitions in Kaitai Struct, you'd likely NOT want to use this and
rather just use <code>type: str</code> with <code>encoding: utf8</code>. That will use
native string implementations, which are most likely more efficient
and will give you native language strings, rather than an array of
individual codepoints.  This format definition is provided mostly
for educational / research purposes.</p>
</p>
            </div>
            <div class="col-md-4">
                <div class="panel panel-info">
                    
                    
                    
                    <div class="panel-heading">
                        <h3 class="panel-title">KS implementation details</h3>
                    </div>
                    
                    <div class="panel-body">
                        License: <a href="https://spdx.org/licenses/CC0-1.0.html">CC0-1.0</a>
                    </div>
                    
                    
                    
                    
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
            <p>
            This page hosts a formal specification of UTF-8-encoded string
            using <a href="http://kaitai.io">Kaitai Struct</a>. This
            specification can be automatically translated into a
            variety of programming languages to get a parsing library.
            </p>

            <ul class="nav nav-pills">
                
                
                <li>
                
                <a href="index.html" title="UTF-8-encoded string parsing Overview library">Overview</a></li>
                
                
                <li>
                
                <a href="cpp_stl.html" title="UTF-8-encoded string parsing C++/STL library">C++/STL</a></li>
                
                
                <li class="active">
                
                <a href="csharp.html" title="UTF-8-encoded string parsing C# library">C#</a></li>
                
                
                <li>
                
                <a href="graphviz.html" title="UTF-8-encoded string parsing GraphViz library">GraphViz</a></li>
                
                
                <li>
                
                <a href="java.html" title="UTF-8-encoded string parsing Java library">Java</a></li>
                
                
                <li>
                
                <a href="javascript.html" title="UTF-8-encoded string parsing JavaScript library">JavaScript</a></li>
                
                
                <li>
                
                <a href="lua.html" title="UTF-8-encoded string parsing Lua library">Lua</a></li>
                
                
                <li>
                
                <a href="perl.html" title="UTF-8-encoded string parsing Perl library">Perl</a></li>
                
                
                <li>
                
                <a href="php.html" title="UTF-8-encoded string parsing PHP library">PHP</a></li>
                
                
                <li>
                
                <a href="python.html" title="UTF-8-encoded string parsing Python library">Python</a></li>
                
                
                <li>
                
                <a href="ruby.html" title="UTF-8-encoded string parsing Ruby library">Ruby</a></li>
                
            </ul>
            </div>
        </div>
    </div>
</section>

<section id="format-usage" class="format">
    <div class="container">
        <h2>Usage</h2>

        <p>Parse a local file and get structure in memory:</p>



<pre><code class="csharp">var data = Utf8String.FromFile("path/to/local/file.utf8_string");</code></pre>

<p>Or parse structure from a byte array:</p>

<pre><code class="csharp">byte[] someArray = new byte[] { ... };
var data = new Utf8String(new KaitaiStream(someArray));</code></pre>

<p>After that, one can get various attributes from the structure by accessing properties like:</p>

<pre><code class="csharp">data.Codepoints // => get codepoints</code></pre>

    </div>
</section>


<section id="format-lang" class="format">
    <div class="container">
        <h2>
            
            C# source code to parse UTF-8-encoded string
            
        </h2>

        

        <h3>Utf8String.cs</h3>

        <div class="row">
            <div class="pull-right">
                <p>
                    <a href="src/csharp/Utf8String.cs" class="btn btn-success">Download <i class="fa fa-download"></i></a>
                </p>
            </div>
        </div>

        <div class="row">
            <pre><code class="csharp">// This is a generated file! Please edit source .ksy file and use kaitai-struct-compiler to rebuild

using System.Collections.Generic;

namespace Kaitai
{

    /// &lt;summary&gt;
    /// UTF-8 is a popular character encoding scheme that allows to
    /// represent strings as sequence of code points defined in Unicode
    /// standard. Its features are:
    /// 
    /// * variable width (i.e. one code point might be represented by 1 to 4
    ///   bytes)
    /// * backward compatiblity with ASCII
    /// * basic validity checking (and thus distinguishing from other legacy
    ///   8-bit encodings)
    /// * maintaining sort order of codepoints if sorted as a byte array
    /// 
    /// WARNING: For the vast majority of practical purposes of format
    /// definitions in Kaitai Struct, you&#39;d likely NOT want to use this and
    /// rather just use `type: str` with `encoding: utf8`. That will use
    /// native string implementations, which are most likely more efficient
    /// and will give you native language strings, rather than an array of
    /// individual codepoints.  This format definition is provided mostly
    /// for educational / research purposes.
    /// &lt;/summary&gt;
    public partial class Utf8String : KaitaiStruct
    {
        public static Utf8String FromFile(string fileName)
        {
            return new Utf8String(new KaitaiStream(fileName));
        }

        public Utf8String(KaitaiStream p__io, KaitaiStruct p__parent = null, Utf8String p__root = null) : base(p__io)
        {
            m_parent = p__parent;
            m_root = p__root ?? this;
            _read();
        }
        private void _read()
        {
            _codepoints = new List&lt;Utf8Codepoint&gt;();
            {
                var i = 0;
                while (!m_io.IsEof) {
                    _codepoints.Add(new Utf8Codepoint(m_io, this, m_root));
                    i++;
                }
            }
        }
        public partial class Utf8Codepoint : KaitaiStruct
        {
            public static Utf8Codepoint FromFile(string fileName)
            {
                return new Utf8Codepoint(new KaitaiStream(fileName));
            }

            public Utf8Codepoint(KaitaiStream p__io, Utf8String p__parent = null, Utf8String p__root = null) : base(p__io)
            {
                m_parent = p__parent;
                m_root = p__root;
                f_raw1 = false;
                f_raw4 = false;
                f_raw3 = false;
                f_valueAsInt = false;
                f_raw2 = false;
                f_len = false;
                _read();
            }
            private void _read()
            {
                _byte1 = m_io.ReadU1();
                if (Len &gt;= 2) {
                    _byte2 = m_io.ReadU1();
                }
                if (Len &gt;= 3) {
                    _byte3 = m_io.ReadU1();
                }
                if (Len &gt;= 4) {
                    _byte4 = m_io.ReadU1();
                }
            }
            private bool f_raw1;
            private int _raw1;
            public int Raw1
            {
                get
                {
                    if (f_raw1)
                        return _raw1;
                    _raw1 = (int) ((Byte1 &amp; (Len == 1 ? 127 : (Len == 2 ? 31 : (Len == 3 ? 15 : (Len == 4 ? 7 : 0))))));
                    f_raw1 = true;
                    return _raw1;
                }
            }
            private bool f_raw4;
            private int? _raw4;
            public int? Raw4
            {
                get
                {
                    if (f_raw4)
                        return _raw4;
                    if (Len &gt;= 4) {
                        _raw4 = (int) ((Byte4 &amp; 63));
                    }
                    f_raw4 = true;
                    return _raw4;
                }
            }
            private bool f_raw3;
            private int? _raw3;
            public int? Raw3
            {
                get
                {
                    if (f_raw3)
                        return _raw3;
                    if (Len &gt;= 3) {
                        _raw3 = (int) ((Byte3 &amp; 63));
                    }
                    f_raw3 = true;
                    return _raw3;
                }
            }
            private bool f_valueAsInt;
            private int _valueAsInt;
            public int ValueAsInt
            {
                get
                {
                    if (f_valueAsInt)
                        return _valueAsInt;
                    _valueAsInt = (int) ((Len == 1 ? Raw1 : (Len == 2 ? ((Raw1 &lt;&lt; 6) | Raw2) : (Len == 3 ? (((Raw1 &lt;&lt; 12) | (Raw2 &lt;&lt; 6)) | Raw3) : (Len == 4 ? ((((Raw1 &lt;&lt; 18) | (Raw2 &lt;&lt; 12)) | (Raw3 &lt;&lt; 6)) | Raw4) : -1)))));
                    f_valueAsInt = true;
                    return _valueAsInt;
                }
            }
            private bool f_raw2;
            private int? _raw2;
            public int? Raw2
            {
                get
                {
                    if (f_raw2)
                        return _raw2;
                    if (Len &gt;= 2) {
                        _raw2 = (int) ((Byte2 &amp; 63));
                    }
                    f_raw2 = true;
                    return _raw2;
                }
            }
            private bool f_len;
            private int _len;
            public int Len
            {
                get
                {
                    if (f_len)
                        return _len;
                    _len = (int) (((Byte1 &amp; 128) == 0 ? 1 : ((Byte1 &amp; 224) == 192 ? 2 : ((Byte1 &amp; 240) == 224 ? 3 : ((Byte1 &amp; 248) == 240 ? 4 : -1)))));
                    f_len = true;
                    return _len;
                }
            }
            private byte _byte1;
            private byte? _byte2;
            private byte? _byte3;
            private byte? _byte4;
            private Utf8String m_root;
            private Utf8String m_parent;
            public byte Byte1 { get { return _byte1; } }
            public byte? Byte2 { get { return _byte2; } }
            public byte? Byte3 { get { return _byte3; } }
            public byte? Byte4 { get { return _byte4; } }
            public Utf8String M_Root { get { return m_root; } }
            public Utf8String M_Parent { get { return m_parent; } }
        }
        private List&lt;Utf8Codepoint&gt; _codepoints;
        private Utf8String m_root;
        private KaitaiStruct m_parent;
        public List&lt;Utf8Codepoint&gt; Codepoints { get { return _codepoints; } }
        public Utf8String M_Root { get { return m_root; } }
        public KaitaiStruct M_Parent { get { return m_parent; } }
    }
}
</code></pre>

        </div>
        
    </div>
</section>

    <footer id="main-footer">
        <div class="container">
            &copy; 2015-2019 Kaitai Project and <a href="https://github.com/kaitai-io/kaitai_struct_formats/graphs/contributors">formats repo contributors</a>

            <h3>Contacts</h3>

            <div class="row">
                <div class="col-sm-4">
                    <i class="fa fa-fw fa-2x fa-github"></i> <a href="https://github.com/kaitai-io/kaitai_struct">GitHub</a>
                </div>
                <div class="col-sm-4">
                    <i class="fa fa-fw fa-2x fa-twitter"></i> <a href="https://twitter.com/kaitai_io">@kaitai_io</a>
                </div>
                <div class="col-sm-4">
                    Gitter: <a href="https://gitter.im/kaitai_struct/Lobby">kaitai_struct</a>
                </div>
            </div>
        </div>
    </footer>

  <script src="//kaitai.io/js/jquery-1.12.3.min.js"></script>
  <script src="//kaitai.io/js/bootstrap.min.js"></script>

  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-76299550-1', 'auto');
      ga('send', 'pageview');
  </script>
</body>
</html>
