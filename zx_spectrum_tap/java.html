<!DOCTYPE html>
<html dir="ltr" lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>ZX Spectrum tape file: Java parsing library</title>
  <meta name="keywords" content="kaitai,struct,binary,format,parsing,decoding,java,javascript,python,ruby,library,metadata">
  <meta name="description" content="Kaitai Struct is a formal language for binary format specification that can be compiled into parser code">

  <link rel="stylesheet" href="//kaitai.io/styles/bootstrap.min.css">
  <link rel="stylesheet" href="//kaitai.io/styles/bootstrap-theme.min.css">
  <link href='https://fonts.googleapis.com/css?family=Exo:400,700' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Share+Tech+Mono' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

  <link rel="stylesheet" href="//kaitai.io/styles/main.css" type="text/css">

  <link rel="stylesheet" href="//kaitai.io/styles/highlight/default.css">
  <style>
.diagram-img {
    display: block;
    max-width: 100%;
    height: auto;
    margin: 0 auto;
}

section.format {
    padding: 30px 0;
}

section#format-meta, section#format-index-header {
    background: #e3eef7;
}

section#format-diagram, section#format-index-footer {
    background: #e9f8dd;
}

section#format-ksy, section#format-lang {
    background: #d1eadd;
}

section#format-index .row {
    padding-bottom: 10px;
}

  </style>
  <script src="//kaitai.io/js/highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
</head>
<body data-spy="scroll" data-target="#main-navbar" data-offset="100">

    <nav class="navbar navbar-inverse navbar-fixed-top" id="main-navbar">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#main-navbar-collapse" aria-expanded="false">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <span class="navbar-brand">Kaitai Struct</span>
            </div>
            <div class="collapse navbar-collapse" id="main-navbar-collapse">
                <ul class="nav navbar-nav">
                    <li><a href="http://kaitai.io/#what-is-it">What is it?</a></li>
                    <li><a href="http://kaitai.io/#quick-start">Quick Start</a></li>
                    <li><a href="http://kaitai.io/#download">Download</a></li>
                    <li class="active"><a href="http://formats.kaitai.io/">Format Gallery</a></li>
                </ul>
                <ul class="nav navbar-nav navbar-right">
                    <li><a href="http://kaitai.io/repl/index.html">Try it</a></li>
                    <li><a href="https://ide.kaitai.io/">Web IDE</a></li>
                    <li><a href="http://doc.kaitai.io/">Documentation</a></li>
                </ul>
            </div>
        </div>
    </nav>
<nav>
    <div class="container">
    <ol class="breadcrumb">
        <li><a href="../index.html">Format Gallery</a></li>
        <li>Filesystems</li>
        <li class="active">ZX Spectrum tape file</li>
    </ol>
    </div>
</nav>

<section id="format-meta" class="format">
    <div class="container">
        <h1>ZX Spectrum tape file:
            
            Java parsing library
            
        </h1>

        <div class="row">
            <div class="col-md-8">
                <p><p>TAP files are used by emulators of ZX Spectrum computer (released in
1982 by Sinclair Research). TAP file stores blocks of data as if
they are written to magnetic tape, which was used as primary media
for ZX Spectrum. Contents of this file can be viewed as a very
simple linear filesystem, storing named files with some basic
metainformation prepended as a header.</p>
</p>
            </div>
            <div class="col-md-4">
                <div class="panel panel-info">
                    
                    
                    <div class="panel-heading">
                        <h3 class="panel-title">File extension</h3>
                    </div>
                    <div class="panel-body">
                        tap
                    </div>
                    
                    
                    <div class="panel-heading">
                        <h3 class="panel-title">KS implementation details</h3>
                    </div>
                    
                    <div class="panel-body">
                        License: <a href="https://spdx.org/licenses/CC0-1.0.html">CC0-1.0</a>
                    </div>
                    
                    
                    
                    
                    
                    <div class="panel-heading">
                        <h3 class="panel-title">References</h3>
                    </div>
                    <div class="panel-body">
                        <ul>
                            
                            
                            
                            
                            
                            
                            
                            <li><a href="https://www.nationalarchives.gov.uk/pronom/fmt/801">PRONOM fmt/801</a></li>
                            
                            
                            
                            
                            
                            <li><a href="http://fileformats.archiveteam.org/wiki/TAP_(ZX_Spectrum)">TAP (ZX Spectrum) in Just Solve the File Format Problem</a></li>
                            
                        </ul>
                    </div>
                    
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
            <p>
            This page hosts a formal specification of ZX Spectrum tape file
            using <a href="http://kaitai.io">Kaitai Struct</a>. This
            specification can be automatically translated into a
            variety of programming languages to get a parsing library.
            </p>

            <ul class="nav nav-pills">
                
                
                <li>
                
                <a href="index.html" title="ZX Spectrum tape file parsing Overview library">Overview</a></li>
                
                
                <li>
                
                <a href="cpp_stl.html" title="ZX Spectrum tape file parsing C++/STL library">C++/STL</a></li>
                
                
                <li>
                
                <a href="csharp.html" title="ZX Spectrum tape file parsing C# library">C#</a></li>
                
                
                <li>
                
                <a href="graphviz.html" title="ZX Spectrum tape file parsing GraphViz library">GraphViz</a></li>
                
                
                <li class="active">
                
                <a href="java.html" title="ZX Spectrum tape file parsing Java library">Java</a></li>
                
                
                <li>
                
                <a href="javascript.html" title="ZX Spectrum tape file parsing JavaScript library">JavaScript</a></li>
                
                
                <li>
                
                <a href="lua.html" title="ZX Spectrum tape file parsing Lua library">Lua</a></li>
                
                
                <li>
                
                <a href="perl.html" title="ZX Spectrum tape file parsing Perl library">Perl</a></li>
                
                
                <li>
                
                <a href="php.html" title="ZX Spectrum tape file parsing PHP library">PHP</a></li>
                
                
                <li>
                
                <a href="python.html" title="ZX Spectrum tape file parsing Python library">Python</a></li>
                
                
                <li>
                
                <a href="ruby.html" title="ZX Spectrum tape file parsing Ruby library">Ruby</a></li>
                
            </ul>
            </div>
        </div>
    </div>
</section>

<section id="format-usage" class="format">
    <div class="container">
        <h2>Usage</h2>

        <p>Parse a local file and get structure in memory:</p>



<pre><code class="java">ZxSpectrumTap data = ZxSpectrumTap.fromFile("path/to/local/file.tap");</code></pre>

<p>Or parse structure from a byte array:</p>

<pre><code class="java">byte[] someArray = new byte[] { ... };
ZxSpectrumTap data = new ZxSpectrumTap(new ByteBufferKaitaiStream(someArray));</code></pre>

<p>After that, one can get various attributes from the structure by invoking getter methods like:</p>

<pre><code class="java">data.block() // => get block</code></pre>

    </div>
</section>


<section id="format-lang" class="format">
    <div class="container">
        <h2>
            
            Java source code to parse ZX Spectrum tape file
            
        </h2>

        

        <h3>ZxSpectrumTap.java</h3>

        <div class="row">
            <div class="pull-right">
                <p>
                    <a href="src/java/ZxSpectrumTap.java" class="btn btn-success">Download <i class="fa fa-download"></i></a>
                </p>
            </div>
        </div>

        <div class="row">
            <pre><code class="java">// This is a generated file! Please edit source .ksy file and use kaitai-struct-compiler to rebuild

import io.kaitai.struct.ByteBufferKaitaiStream;
import io.kaitai.struct.KaitaiStruct;
import io.kaitai.struct.KaitaiStream;
import java.io.IOException;
import java.util.Map;
import java.util.HashMap;
import java.util.ArrayList;


/**
 * TAP files are used by emulators of ZX Spectrum computer (released in
 * 1982 by Sinclair Research). TAP file stores blocks of data as if
 * they are written to magnetic tape, which was used as primary media
 * for ZX Spectrum. Contents of this file can be viewed as a very
 * simple linear filesystem, storing named files with some basic
 * metainformation prepended as a header.
 * @see &lt;a href=&quot;https://faqwiki.zxnet.co.uk/wiki/TAP_format&quot;&gt;Source&lt;/a&gt;
 */
public class ZxSpectrumTap extends KaitaiStruct {
    public static ZxSpectrumTap fromFile(String fileName) throws IOException {
        return new ZxSpectrumTap(new ByteBufferKaitaiStream(fileName));
    }

    public enum FlagEnum {
        HEADER(0),
        DATA(255);

        private final long id;
        FlagEnum(long id) { this.id = id; }
        public long id() { return id; }
        private static final Map&lt;Long, FlagEnum&gt; byId = new HashMap&lt;Long, FlagEnum&gt;(2);
        static {
            for (FlagEnum e : FlagEnum.values())
                byId.put(e.id(), e);
        }
        public static FlagEnum byId(long id) { return byId.get(id); }
    }

    public enum HeaderTypeEnum {
        PROGRAM(0),
        NUM_ARRAY(1),
        CHAR_ARRAY(2),
        BYTES(3);

        private final long id;
        HeaderTypeEnum(long id) { this.id = id; }
        public long id() { return id; }
        private static final Map&lt;Long, HeaderTypeEnum&gt; byId = new HashMap&lt;Long, HeaderTypeEnum&gt;(4);
        static {
            for (HeaderTypeEnum e : HeaderTypeEnum.values())
                byId.put(e.id(), e);
        }
        public static HeaderTypeEnum byId(long id) { return byId.get(id); }
    }

    public ZxSpectrumTap(KaitaiStream _io) {
        this(_io, null, null);
    }

    public ZxSpectrumTap(KaitaiStream _io, KaitaiStruct _parent) {
        this(_io, _parent, null);
    }

    public ZxSpectrumTap(KaitaiStream _io, KaitaiStruct _parent, ZxSpectrumTap _root) {
        super(_io);
        this._parent = _parent;
        this._root = _root == null ? this : _root;
        _read();
    }
    private void _read() {
        this.block = new ArrayList&lt;Block&gt;();
        {
            int i = 0;
            while (!this._io.isEof()) {
                this.block.add(new Block(this._io, this, _root));
                i++;
            }
        }
    }
    public static class Block extends KaitaiStruct {
        public static Block fromFile(String fileName) throws IOException {
            return new Block(new ByteBufferKaitaiStream(fileName));
        }

        public Block(KaitaiStream _io) {
            this(_io, null, null);
        }

        public Block(KaitaiStream _io, ZxSpectrumTap _parent) {
            this(_io, _parent, null);
        }

        public Block(KaitaiStream _io, ZxSpectrumTap _parent, ZxSpectrumTap _root) {
            super(_io);
            this._parent = _parent;
            this._root = _root;
            _read();
        }
        private void _read() {
            this.lenBlock = this._io.readU2le();
            this.flag = ZxSpectrumTap.FlagEnum.byId(this._io.readU1());
            if ( ((lenBlock() == 19) &amp;&amp; (flag() == ZxSpectrumTap.FlagEnum.HEADER)) ) {
                this.header = new Header(this._io, this, _root);
            }
            if (lenBlock() == 19) {
                this.data = this._io.readBytes((header().lenData() + 4));
            }
            if (flag() == ZxSpectrumTap.FlagEnum.DATA) {
                this.headerlessData = this._io.readBytes((lenBlock() - 1));
            }
        }
        private int lenBlock;
        private FlagEnum flag;
        private Header header;
        private byte[] data;
        private byte[] headerlessData;
        private ZxSpectrumTap _root;
        private ZxSpectrumTap _parent;
        public int lenBlock() { return lenBlock; }
        public FlagEnum flag() { return flag; }
        public Header header() { return header; }
        public byte[] data() { return data; }
        public byte[] headerlessData() { return headerlessData; }
        public ZxSpectrumTap _root() { return _root; }
        public ZxSpectrumTap _parent() { return _parent; }
    }
    public static class ProgramParams extends KaitaiStruct {
        public static ProgramParams fromFile(String fileName) throws IOException {
            return new ProgramParams(new ByteBufferKaitaiStream(fileName));
        }

        public ProgramParams(KaitaiStream _io) {
            this(_io, null, null);
        }

        public ProgramParams(KaitaiStream _io, ZxSpectrumTap.Header _parent) {
            this(_io, _parent, null);
        }

        public ProgramParams(KaitaiStream _io, ZxSpectrumTap.Header _parent, ZxSpectrumTap _root) {
            super(_io);
            this._parent = _parent;
            this._root = _root;
            _read();
        }
        private void _read() {
            this.autostartLine = this._io.readU2le();
            this.lenProgram = this._io.readU2le();
        }
        private int autostartLine;
        private int lenProgram;
        private ZxSpectrumTap _root;
        private ZxSpectrumTap.Header _parent;
        public int autostartLine() { return autostartLine; }
        public int lenProgram() { return lenProgram; }
        public ZxSpectrumTap _root() { return _root; }
        public ZxSpectrumTap.Header _parent() { return _parent; }
    }
    public static class BytesParams extends KaitaiStruct {
        public static BytesParams fromFile(String fileName) throws IOException {
            return new BytesParams(new ByteBufferKaitaiStream(fileName));
        }

        public BytesParams(KaitaiStream _io) {
            this(_io, null, null);
        }

        public BytesParams(KaitaiStream _io, ZxSpectrumTap.Header _parent) {
            this(_io, _parent, null);
        }

        public BytesParams(KaitaiStream _io, ZxSpectrumTap.Header _parent, ZxSpectrumTap _root) {
            super(_io);
            this._parent = _parent;
            this._root = _root;
            _read();
        }
        private void _read() {
            this.startAddress = this._io.readU2le();
            this.reserved = this._io.readBytes(2);
        }
        private int startAddress;
        private byte[] reserved;
        private ZxSpectrumTap _root;
        private ZxSpectrumTap.Header _parent;
        public int startAddress() { return startAddress; }
        public byte[] reserved() { return reserved; }
        public ZxSpectrumTap _root() { return _root; }
        public ZxSpectrumTap.Header _parent() { return _parent; }
    }
    public static class Header extends KaitaiStruct {
        public static Header fromFile(String fileName) throws IOException {
            return new Header(new ByteBufferKaitaiStream(fileName));
        }

        public Header(KaitaiStream _io) {
            this(_io, null, null);
        }

        public Header(KaitaiStream _io, ZxSpectrumTap.Block _parent) {
            this(_io, _parent, null);
        }

        public Header(KaitaiStream _io, ZxSpectrumTap.Block _parent, ZxSpectrumTap _root) {
            super(_io);
            this._parent = _parent;
            this._root = _root;
            _read();
        }
        private void _read() {
            this.headerType = ZxSpectrumTap.HeaderTypeEnum.byId(this._io.readU1());
            this.filename = KaitaiStream.bytesStripRight(this._io.readBytes(10), (byte) 32);
            this.lenData = this._io.readU2le();
            switch (headerType()) {
            case PROGRAM: {
                this.params = new ProgramParams(this._io, this, _root);
                break;
            }
            case NUM_ARRY: {
                this.params = new ArrayParams(this._io, this, _root);
                break;
            }
            case CHAR_ARRY: {
                this.params = new ArrayParams(this._io, this, _root);
                break;
            }
            case BYTES: {
                this.params = new BytesParams(this._io, this, _root);
                break;
            }
            }
            this.checksum = this._io.readU1();
        }
        private HeaderTypeEnum headerType;
        private byte[] filename;
        private int lenData;
        private KaitaiStruct params;
        private int checksum;
        private ZxSpectrumTap _root;
        private ZxSpectrumTap.Block _parent;
        public HeaderTypeEnum headerType() { return headerType; }
        public byte[] filename() { return filename; }
        public int lenData() { return lenData; }
        public KaitaiStruct params() { return params; }

        /**
         * Bitwise XOR of all bytes including the flag byte
         */
        public int checksum() { return checksum; }
        public ZxSpectrumTap _root() { return _root; }
        public ZxSpectrumTap.Block _parent() { return _parent; }
    }
    public static class ArrayParams extends KaitaiStruct {
        public static ArrayParams fromFile(String fileName) throws IOException {
            return new ArrayParams(new ByteBufferKaitaiStream(fileName));
        }

        public ArrayParams(KaitaiStream _io) {
            this(_io, null, null);
        }

        public ArrayParams(KaitaiStream _io, ZxSpectrumTap.Header _parent) {
            this(_io, _parent, null);
        }

        public ArrayParams(KaitaiStream _io, ZxSpectrumTap.Header _parent, ZxSpectrumTap _root) {
            super(_io);
            this._parent = _parent;
            this._root = _root;
            _read();
        }
        private void _read() {
            this.reserved = this._io.readU1();
            this.varName = this._io.readU1();
            this.reserved1 = this._io.ensureFixedContents(new byte[] { 0, -128 });
        }
        private int reserved;
        private int varName;
        private byte[] reserved1;
        private ZxSpectrumTap _root;
        private ZxSpectrumTap.Header _parent;
        public int reserved() { return reserved; }

        /**
         * Variable name (1..26 meaning A$..Z$ +192)
         */
        public int varName() { return varName; }
        public byte[] reserved1() { return reserved1; }
        public ZxSpectrumTap _root() { return _root; }
        public ZxSpectrumTap.Header _parent() { return _parent; }
    }
    private ArrayList&lt;Block&gt; block;
    private ZxSpectrumTap _root;
    private KaitaiStruct _parent;
    public ArrayList&lt;Block&gt; block() { return block; }
    public ZxSpectrumTap _root() { return _root; }
    public KaitaiStruct _parent() { return _parent; }
}
</code></pre>

        </div>
        
    </div>
</section>

    <footer id="main-footer">
        <div class="container">
            &copy; 2015-2019 Kaitai Project and <a href="https://github.com/kaitai-io/kaitai_struct_formats/graphs/contributors">formats repo contributors</a>

            <h3>Contacts</h3>

            <div class="row">
                <div class="col-sm-4">
                    <i class="fa fa-fw fa-2x fa-github"></i> <a href="https://github.com/kaitai-io/kaitai_struct">GitHub</a>
                </div>
                <div class="col-sm-4">
                    <i class="fa fa-fw fa-2x fa-twitter"></i> <a href="https://twitter.com/kaitai_io">@kaitai_io</a>
                </div>
                <div class="col-sm-4">
                    Gitter: <a href="https://gitter.im/kaitai_struct/Lobby">kaitai_struct</a>
                </div>
            </div>
        </div>
    </footer>

  <script src="//kaitai.io/js/jquery-1.12.3.min.js"></script>
  <script src="//kaitai.io/js/bootstrap.min.js"></script>

  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-76299550-1', 'auto');
      ga('send', 'pageview');
  </script>
</body>
</html>
