<!DOCTYPE html>
<html dir="ltr" lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Digital Imaging and Communications in Medicine (DICOM) file format format spec for Kaitai Struct</title>
  <meta name="keywords" content="kaitai,struct,binary,format,parsing,decoding,java,javascript,python,ruby,library,metadata">
  <meta name="description" content="Kaitai Struct is a formal language for binary format specification that can be compiled into parser code">

  <link rel="stylesheet" href="//kaitai.io/styles/bootstrap.min.css">
  <link rel="stylesheet" href="//kaitai.io/styles/bootstrap-theme.min.css">
  <link href='https://fonts.googleapis.com/css?family=Exo:400,700' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Share+Tech+Mono' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

  <link rel="stylesheet" href="//kaitai.io/styles/main.css" type="text/css">

  <link rel="stylesheet" href="//kaitai.io/styles/highlight/default.css">
  <style>
.diagram-img {
    display: block;
    max-width: 100%;
    height: auto;
    margin: 0 auto;
}

section.format {
    padding: 30px 0;
}

section#format-meta, section#format-index-header {
    background: #e3eef7;
}

section#format-diagram, section#format-index-footer {
    background: #e9f8dd;
}

section#format-ksy, section#format-lang {
    background: #d1eadd;
}

section#format-index .row {
    padding-bottom: 10px;
}

  </style>
  <script src="//kaitai.io/js/highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
</head>
<body data-spy="scroll" data-target="#main-navbar" data-offset="100">

    <nav class="navbar navbar-inverse navbar-fixed-top" id="main-navbar">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#main-navbar-collapse" aria-expanded="false">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <span class="navbar-brand">Kaitai Struct</span>
            </div>
            <div class="collapse navbar-collapse" id="main-navbar-collapse">
                <ul class="nav navbar-nav">
                    <li><a href="http://kaitai.io/#what-is-it">What is it?</a></li>
                    <li><a href="http://kaitai.io/#quick-start">Quick Start</a></li>
                    <li><a href="http://kaitai.io/#download">Download</a></li>
                    <li class="active"><a href="http://formats.kaitai.io/">Format Gallery</a></li>
                </ul>
                <ul class="nav navbar-nav navbar-right">
                    <li><a href="http://kaitai.io/repl/index.html">Try it</a></li>
                    <li><a href="https://ide.kaitai.io/">Web IDE</a></li>
                    <li><a href="http://doc.kaitai.io/">Documentation</a></li>
                </ul>
            </div>
        </div>
    </nav>
<nav>
    <div class="container">
    <ol class="breadcrumb">
        <li><a href="../index.html">Format Gallery</a></li>
        <li>Image Files</li>
        <li class="active">Digital Imaging and Communications in Medicine (DICOM) file format</li>
    </ol>
    </div>
</nav>

<section id="format-meta" class="format">
    <div class="container">
        <h1>Digital Imaging and Communications in Medicine (DICOM) file format:
            
            format specification
            
        </h1>

        <div class="row">
            <div class="col-md-8">
                <p><p>DICOM (Digital Imaging and Communications in Medicine), AKA NEMA
PS3, AKA ISO 12052:2006, is a file format and network protocol
standard for medical imaging purposes. This parser covers file
format, typically written by various medical equipment, such as
radiography, computer tomography scans, MRT, ultrasonography, etc.</p>
<p>DICOM defines two transfer syntaxes: implicit and explicit. This
top-level parser attempts to autodetect and handle both of them. If
any problems arise, one can use <code>file_explicit</code> and <code>file_implicit</code>
subtypes to force parsing in particular transfer syntax.</p>
</p>
            </div>
            <div class="col-md-4">
                <div class="panel panel-info">
                    
                    
                    <div class="panel-heading">
                        <h3 class="panel-title">File extension</h3>
                    </div>
                    <div class="panel-body">
                        dcm
                    </div>
                    
                    
                    <div class="panel-heading">
                        <h3 class="panel-title">KS implementation details</h3>
                    </div>
                    
                    <div class="panel-body">
                        License: <a href="https://spdx.org/licenses/MIT.html">MIT</a>
                    </div>
                    
                    
                    
                    
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
            <p>
            This page hosts a formal specification of Digital Imaging and Communications in Medicine (DICOM) file format
            using <a href="http://kaitai.io">Kaitai Struct</a>. This
            specification can be automatically translated into a
            variety of programming languages to get a parsing library.
            </p>

            <ul class="nav nav-pills">
                
                
                <li class="active">
                
                <a href="index.html" title="Digital Imaging and Communications in Medicine (DICOM) file format parsing Overview library">Overview</a></li>
                
                
                <li>
                
                <a href="lua.html" title="Digital Imaging and Communications in Medicine (DICOM) file format parsing Lua library">Lua</a></li>
                
            </ul>
            </div>
        </div>
    </div>
</section>
<section id="format-diagram" class="format">
    <div class="container">
        <h2>Block diagram</h2>
        <a href="dicom_le.svg">
            <img class="diagram-img" src="dicom_le.svg" />
        </a>
    </div>
</section>

<section id="format-ksy" class="format">
    <div class="container">
        <h2>Format specification in Kaitai Struct YAML</h2>
        
        <pre><code class="yaml">meta:
  id: dicom_le
  title: Digital Imaging and Communications in Medicine (DICOM) file format
  file-extension: dcm
  license: MIT
  endian: le
doc-ref: http://dicom.nema.org/medical/dicom/current/output/html/part10.html
doc: |
  DICOM (Digital Imaging and Communications in Medicine), AKA NEMA
  PS3, AKA ISO 12052:2006, is a file format and network protocol
  standard for medical imaging purposes. This parser covers file
  format, typically written by various medical equipment, such as
  radiography, computer tomography scans, MRT, ultrasonography, etc.

  DICOM defines two transfer syntaxes: implicit and explicit. This
  top-level parser attempts to autodetect and handle both of them. If
  any problems arise, one can use `file_explicit` and `file_implicit`
  subtypes to force parsing in particular transfer syntax.
seq:
  - id: file_header
    type: t_file_header
  - id: dataset
    type: t_dataset
types:
  file_explicit:
    doc: |
      This type parses DICOM files with explicit transfer syntax.
    seq:
      - id: file_header
        type: t_file_header
      - id: dataset
        type: t_dataset_explicit
    types:
      t_dataset_explicit:
        seq:
          - id: elements
            type: t_dataentry_explicit
            repeat: eos
  file_implicit:
    doc: |
      This type parses DICOM files with implicit transfer syntax.
    seq:
      - id: file_header
        type: t_file_header
      - id: dataset
        type: t_dataset_implicit
    types:
      t_dataset_implicit:
        seq:
          - id: elements
            type: t_dataentry_implicit
            repeat: eos
  t_dataset:
    doc-ref: http://dicom.nema.org/dicom/2013/output/chtml/part05/chapter_7.html
    seq:
      - id: elements1
        type: t_dataentry_implicit
        if: not _io.eof
        repeat: until
        repeat-until: _io.eof or _.is_transfer_syntax_change_explicit
      - id: elements2
        type: t_dataentry_explicit
        repeat: eos
  t_file_header:
    seq:
      - id: preamble
        size: 128
      - id: magic
        contents: 'DICM'
  t_dataentry_implicit:
    seq:
      - id: tag_group
        type: u2
      - id: tag_elem
        type: u2
      - id: header
        type:
          switch-on: entry_implicit
          cases:
            true: t_entry_header_implicit
            false: t_entry_header_explicit
      - id: content
        size: header_content_length
        if: has_content
      - id: elements_1
        type: t_dataentry_implicit
        if: has_elements and not is_definite
        repeat: until
        repeat-until: _.is_closing_tag
      - id: elements_2
        type: t_elements
        if: has_elements and is_definite
        size: header_content_length
    types:
      t_elements:
        seq:
          - id: elements
            type: t_dataentry_implicit
            repeat: eos
    instances:
      entry_implicit:
        value: tag_group != 2 or tag_group == 0xfffe
      is_closing_tag:
        value: (tag_group == 0xfffe) and (tag_elem & 0xff00 == 0xe000) and (tag_elem != 0xe000)
      has_elements:
        value: (tag_group == 0xfffe and tag_elem == 0xe000) or header_is_seq
      has_content:
        value: not has_elements
      is_definite:
        value: header_content_length != 0xffffffff
      p_is_transfer_syntax_change_non_implicit:
        # '1.2.840.10008.1.2.1\0' (Explicit VR Little Endian)
        # See http://www.dicomlibrary.com/dicom/transfer-syntax/
        value: content != [49, 46, 50, 46, 56, 52, 48, 46, 49, 48, 48, 48, 56, 46, 49, 46, 50, 46, 49, 0]
      is_transfer_syntax_change_explicit:
        value: tag_group == 2 and tag_elem == 16 and p_is_transfer_syntax_change_non_implicit
      header_is_seq:
        value: >-
          entry_implicit ?
            header.as<t_entry_header_implicit>.is_seq :
            header.as<t_entry_header_explicit>.is_seq
      header_content_length:
        value: >-
          entry_implicit ?
            header.as<t_entry_header_implicit>.content_length :
            header.as<t_entry_header_explicit>.content_length
  t_dataentry_explicit:
    seq:
      - id: tag_group
        type: u2
      - id: tag_elem
        type: u2
      - id: header
        if: header_is_implicit
        type: t_entry_header_implicit
      - id: header
        if: not header_is_implicit
        type: t_entry_header_explicit
      - id: content
        size: header.content_length
        if: has_content
      - id: elements
        type: t_dataentry_explicit
        if: has_elements and not is_definite
        repeat: until
        repeat-until: _.is_closing_tag
      - id: elements
        type: t_elements
        if: has_elements and is_definite
        size: header.content_length
    types:
      t_elements:
        seq:
          - id: elements
            type: t_dataentry_explicit
            repeat: eos
    instances:
      header_is_implicit:
        value: tag_group == 0xfffe
      is_closing_tag:
        value: tag_group == 0xfffe and tag_elem & 0xff00 == 0xe000 and tag_elem != 0xe000
      has_elements:
        value: (tag_group == 0xfffe and tag_elem == 0xe000) or header.is_seq
      has_content:
        value: not has_elements
      is_definite:
        value: header.content_length != 0xffffffff
  t_entry_header_explicit:
    seq:
      - id: vr
        type: str
        encoding: ASCII
        size: 2
      - id: p_reserved
        type: u2
        if: length_is_long
      - id: p_content_length_u4
        type: u4
        if: length_is_long
      - id: p_content_length_u2
        type: u2
        if: not length_is_long
    instances:
      content_length:
        value: 'length_is_long ? p_content_length_u4 : p_content_length_u2'
      length_is_long:
        value: >
          not (
            vr == 'AE' or
            vr == 'AS' or
            vr == 'AT' or
            vr == 'CS' or
            vr == 'DA' or
            vr == 'DS' or
            vr == 'DT' or
            vr == 'FL' or
            vr == 'FD' or
            vr == 'IS' or
            vr == 'LO' or
            vr == 'PN' or
            vr == 'SH' or
            vr == 'SL' or
            vr == 'SS' or
            vr == 'ST' or
            vr == 'TM' or
            vr == 'UI' or
            vr == 'UL' or
            vr == 'US' or
            vr == 'LT'
          )
      is_seq:
        value: vr == 'SQ'
  t_entry_header_implicit:
    seq:
      - id: content_length
        type: u4
    instances:
      is_seq:
        value: content_length == 0xffffffff
</code></pre>
    </div>
</section>

    <footer id="main-footer">
        <div class="container">
            &copy; 2015-2019 Kaitai Project and <a href="https://github.com/kaitai-io/kaitai_struct_formats/graphs/contributors">formats repo contributors</a>

            <h3>Contacts</h3>

            <div class="row">
                <div class="col-sm-4">
                    <i class="fa fa-fw fa-2x fa-github"></i> <a href="https://github.com/kaitai-io/kaitai_struct">GitHub</a>
                </div>
                <div class="col-sm-4">
                    <i class="fa fa-fw fa-2x fa-twitter"></i> <a href="https://twitter.com/kaitai_io">@kaitai_io</a>
                </div>
                <div class="col-sm-4">
                    Gitter: <a href="https://gitter.im/kaitai_struct/Lobby">kaitai_struct</a>
                </div>
            </div>
        </div>
    </footer>

  <script src="//kaitai.io/js/jquery-1.12.3.min.js"></script>
  <script src="//kaitai.io/js/bootstrap.min.js"></script>

  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-76299550-1', 'auto');
      ga('send', 'pageview');
  </script>
</body>
</html>
