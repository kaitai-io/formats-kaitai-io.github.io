<!DOCTYPE html>
<html dir="ltr" lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Windows Shell Items: Perl parsing library</title>
  <meta name="keywords" content="kaitai,struct,binary,format,parsing,decoding,java,javascript,python,ruby,library,metadata">
  <meta name="description" content="Kaitai Struct is a formal language for binary format specification that can be compiled into parser code">

  <link rel="stylesheet" href="http://kaitai.io/styles/bootstrap.min.css">
  <link rel="stylesheet" href="http://kaitai.io/styles/bootstrap-theme.min.css">
  <link href='https://fonts.googleapis.com/css?family=Exo:400,700' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Share+Tech+Mono' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

  <link rel="stylesheet" href="http://kaitai.io/styles/main.css" type="text/css">

  <link rel="stylesheet" href="http://kaitai.io/styles/highlight/default.css">
  <style>
.diagram-img {
    display: block;
    max-width: 100%;
    height: auto;
    margin: 0 auto;
}

section.format {
    padding: 30px 0;
}

section#format-meta, section#format-index-header {
    background: #e3eef7;
}

section#format-diagram, section#format-index-footer {
    background: #e9f8dd;
}

section#format-ksy, section#format-lang {
    background: #d1eadd;
}

section#format-index .row {
    padding-bottom: 10px;
}

  </style>
  <script src="http://kaitai.io/js/highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
</head>
<body data-spy="scroll" data-target="#main-navbar" data-offset="100">

    <nav class="navbar navbar-inverse navbar-fixed-top" id="main-navbar">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#main-navbar-collapse" aria-expanded="false">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <span class="navbar-brand">Kaitai Struct</span>
            </div>
            <div class="collapse navbar-collapse" id="main-navbar-collapse">
                <ul class="nav navbar-nav">
                    <li><a href="http://kaitai.io/#what-is-it">What is it?</a></li>
                    <li><a href="http://kaitai.io/#quick-start">Quick Start</a></li>
                    <li><a href="http://kaitai.io/#download">Download</a></li>
                    <li class="active"><a href="http://formats.kaitai.io/">Format Gallery</a></li>
                </ul>
                <ul class="nav navbar-nav navbar-right">
                    <li><a href="http://kaitai.io/repl/index.html">Try it</a></li>
                    <li><a href="https://ide.kaitai.io/">Web IDE</a></li>
                    <li><a href="http://doc.kaitai.io/">Documentation</a></li>
                </ul>
            </div>
        </div>
    </nav>
<nav>
    <div class="container">
    <ol class="breadcrumb">
        <li><a href="../index.html">Format Gallery</a></li>
        <li>Windows-specific</li>
        <li class="active">Windows Shell Items</li>
    </ol>
    </div>
</nav>

<section id="format-meta" class="format">
    <div class="container">
        <h1>Windows Shell Items:
            
            Perl parsing library
            
        </h1>

        <div class="row">
            <div class="col-md-8">
                <p><p>Windows Shell Items (AKA &quot;shellbags&quot;) is an undocumented set of
structures used internally within Windows to identify paths in
Windows Folder Hierarchy. It is widely used in Windows Shell (and
most visible in File Explorer), both as in-memory and in-file
structures. Some formats embed them, namely:</p>
<ul>
<li>Windows Shell link files (.lnk) Windows registry</li>
<li>Windows registry &quot;ShellBags&quot; keys</li>
</ul>
<p>The format is mostly undocumented, and is known to vary between
various Windows versions.</p>
</p>
            </div>
            <div class="col-md-4">
                <div class="panel panel-info">
                    
                    
                    
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
            <p>
            This page hosts a formal specification of Windows Shell Items
            using <a href="http://kaitai.io">Kaitai Struct</a>. This
            specification can be automatically translated into a
            variety of programming languages to get a parsing library.
            </p>

            <ul class="nav nav-pills">
                
                
                <li>
                
                <a href="index.html" title="Windows Shell Items parsing Overview library">Overview</a></li>
                
                
                <li>
                
                <a href="cpp_stl.html" title="Windows Shell Items parsing C++/STL library">C++/STL</a></li>
                
                
                <li>
                
                <a href="csharp.html" title="Windows Shell Items parsing C# library">C#</a></li>
                
                
                <li>
                
                <a href="graphviz.html" title="Windows Shell Items parsing GraphViz library">GraphViz</a></li>
                
                
                <li>
                
                <a href="java.html" title="Windows Shell Items parsing Java library">Java</a></li>
                
                
                <li>
                
                <a href="javascript.html" title="Windows Shell Items parsing JavaScript library">JavaScript</a></li>
                
                
                <li>
                
                <a href="lua.html" title="Windows Shell Items parsing Lua library">Lua</a></li>
                
                
                <li class="active">
                
                <a href="perl.html" title="Windows Shell Items parsing Perl library">Perl</a></li>
                
                
                <li>
                
                <a href="php.html" title="Windows Shell Items parsing PHP library">PHP</a></li>
                
                
                <li>
                
                <a href="python.html" title="Windows Shell Items parsing Python library">Python</a></li>
                
                
                <li>
                
                <a href="ruby.html" title="Windows Shell Items parsing Ruby library">Ruby</a></li>
                
            </ul>
            </div>
        </div>
    </div>
</section>


<section id="format-lang" class="format">
    <div class="container">
        <h2>
            
            Perl source code to parse Windows Shell Items
            
        </h2>

        

        <h3>WindowsShellItems.pm</h3>

        <div class="row">
            <div class="pull-right">
                <p>
                    <a href="src/perl/WindowsShellItems.pm" class="btn btn-success">Download <i class="fa fa-download"></i></a>
                </p>
            </div>
        </div>

        <div class="row">
            <pre><code class="perl"># This is a generated file! Please edit source .ksy file and use kaitai-struct-compiler to rebuild

use strict;
use warnings;
use IO::KaitaiStruct 0.007_000;

########################################################################
package WindowsShellItems;

our @ISA = &#39;IO::KaitaiStruct::Struct&#39;;

sub from_file {
    my ($class, $filename) = @_;
    my $fd;

    open($fd, &#39;&lt;&#39;, $filename) or return undef;
    binmode($fd);
    return new($class, IO::KaitaiStruct::Stream-&gt;new($fd));
}

sub new {
    my ($class, $_io, $_parent, $_root) = @_;
    my $self = IO::KaitaiStruct::Struct-&gt;new($_io);

    bless $self, $class;
    $self-&gt;{_parent} = $_parent;
    $self-&gt;{_root} = $_root || $self;;

    $self-&gt;_read();

    return $self;
}

sub _read {
    my ($self) = @_;

    $self-&gt;{items} = ();
    do {
        $_ = WindowsShellItems::ShellItem-&gt;new($self-&gt;{_io}, $self, $self-&gt;{_root});
        push @{$self-&gt;{items}}, $_;
    } until ($_-&gt;len_data() == 0);
}

sub items {
    my ($self) = @_;
    return $self-&gt;{items};
}

########################################################################
package WindowsShellItems::ShellItemData;

our @ISA = &#39;IO::KaitaiStruct::Struct&#39;;

sub from_file {
    my ($class, $filename) = @_;
    my $fd;

    open($fd, &#39;&lt;&#39;, $filename) or return undef;
    binmode($fd);
    return new($class, IO::KaitaiStruct::Stream-&gt;new($fd));
}

sub new {
    my ($class, $_io, $_parent, $_root) = @_;
    my $self = IO::KaitaiStruct::Struct-&gt;new($_io);

    bless $self, $class;
    $self-&gt;{_parent} = $_parent;
    $self-&gt;{_root} = $_root || $self;;

    $self-&gt;_read();

    return $self;
}

sub _read {
    my ($self) = @_;

    $self-&gt;{code} = $self-&gt;{_io}-&gt;read_u1();
    my $_on = $self-&gt;code();
    if ($_on == 31) {
        $self-&gt;{body1} = WindowsShellItems::RootFolderBody-&gt;new($self-&gt;{_io}, $self, $self-&gt;{_root});
    }
    my $_on = ($self-&gt;code() &amp; 112);
    if ($_on == 32) {
        $self-&gt;{body2} = WindowsShellItems::VolumeBody-&gt;new($self-&gt;{_io}, $self, $self-&gt;{_root});
    }
    elsif ($_on == 48) {
        $self-&gt;{body2} = WindowsShellItems::FileEntryBody-&gt;new($self-&gt;{_io}, $self, $self-&gt;{_root});
    }
}

sub code {
    my ($self) = @_;
    return $self-&gt;{code};
}

sub body1 {
    my ($self) = @_;
    return $self-&gt;{body1};
}

sub body2 {
    my ($self) = @_;
    return $self-&gt;{body2};
}

########################################################################
package WindowsShellItems::ShellItem;

our @ISA = &#39;IO::KaitaiStruct::Struct&#39;;

sub from_file {
    my ($class, $filename) = @_;
    my $fd;

    open($fd, &#39;&lt;&#39;, $filename) or return undef;
    binmode($fd);
    return new($class, IO::KaitaiStruct::Stream-&gt;new($fd));
}

sub new {
    my ($class, $_io, $_parent, $_root) = @_;
    my $self = IO::KaitaiStruct::Struct-&gt;new($_io);

    bless $self, $class;
    $self-&gt;{_parent} = $_parent;
    $self-&gt;{_root} = $_root || $self;;

    $self-&gt;_read();

    return $self;
}

sub _read {
    my ($self) = @_;

    $self-&gt;{len_data} = $self-&gt;{_io}-&gt;read_u2le();
    if ($self-&gt;len_data() &gt;= 2) {
        $self-&gt;{_raw_data} = $self-&gt;{_io}-&gt;read_bytes(($self-&gt;len_data() - 2));
        my $io__raw_data = IO::KaitaiStruct::Stream-&gt;new($self-&gt;{_raw_data});
        $self-&gt;{data} = WindowsShellItems::ShellItemData-&gt;new($io__raw_data, $self, $self-&gt;{_root});
    }
}

sub len_data {
    my ($self) = @_;
    return $self-&gt;{len_data};
}

sub data {
    my ($self) = @_;
    return $self-&gt;{data};
}

sub _raw_data {
    my ($self) = @_;
    return $self-&gt;{_raw_data};
}

########################################################################
package WindowsShellItems::RootFolderBody;

our @ISA = &#39;IO::KaitaiStruct::Struct&#39;;

sub from_file {
    my ($class, $filename) = @_;
    my $fd;

    open($fd, &#39;&lt;&#39;, $filename) or return undef;
    binmode($fd);
    return new($class, IO::KaitaiStruct::Stream-&gt;new($fd));
}

sub new {
    my ($class, $_io, $_parent, $_root) = @_;
    my $self = IO::KaitaiStruct::Struct-&gt;new($_io);

    bless $self, $class;
    $self-&gt;{_parent} = $_parent;
    $self-&gt;{_root} = $_root || $self;;

    $self-&gt;_read();

    return $self;
}

sub _read {
    my ($self) = @_;

    $self-&gt;{sort_index} = $self-&gt;{_io}-&gt;read_u1();
    $self-&gt;{shell_folder_id} = $self-&gt;{_io}-&gt;read_bytes(16);
}

sub sort_index {
    my ($self) = @_;
    return $self-&gt;{sort_index};
}

sub shell_folder_id {
    my ($self) = @_;
    return $self-&gt;{shell_folder_id};
}

########################################################################
package WindowsShellItems::VolumeBody;

our @ISA = &#39;IO::KaitaiStruct::Struct&#39;;

sub from_file {
    my ($class, $filename) = @_;
    my $fd;

    open($fd, &#39;&lt;&#39;, $filename) or return undef;
    binmode($fd);
    return new($class, IO::KaitaiStruct::Stream-&gt;new($fd));
}

sub new {
    my ($class, $_io, $_parent, $_root) = @_;
    my $self = IO::KaitaiStruct::Struct-&gt;new($_io);

    bless $self, $class;
    $self-&gt;{_parent} = $_parent;
    $self-&gt;{_root} = $_root || $self;;

    $self-&gt;_read();

    return $self;
}

sub _read {
    my ($self) = @_;

    $self-&gt;{flags} = $self-&gt;{_io}-&gt;read_u1();
}

sub flags {
    my ($self) = @_;
    return $self-&gt;{flags};
}

########################################################################
package WindowsShellItems::FileEntryBody;

our @ISA = &#39;IO::KaitaiStruct::Struct&#39;;

sub from_file {
    my ($class, $filename) = @_;
    my $fd;

    open($fd, &#39;&lt;&#39;, $filename) or return undef;
    binmode($fd);
    return new($class, IO::KaitaiStruct::Stream-&gt;new($fd));
}

sub new {
    my ($class, $_io, $_parent, $_root) = @_;
    my $self = IO::KaitaiStruct::Struct-&gt;new($_io);

    bless $self, $class;
    $self-&gt;{_parent} = $_parent;
    $self-&gt;{_root} = $_root || $self;;

    $self-&gt;_read();

    return $self;
}

sub _read {
    my ($self) = @_;

    $self-&gt;{_unnamed0} = $self-&gt;{_io}-&gt;read_u1();
    $self-&gt;{file_size} = $self-&gt;{_io}-&gt;read_u4le();
    $self-&gt;{last_mod_time} = $self-&gt;{_io}-&gt;read_u4le();
    $self-&gt;{file_attrs} = $self-&gt;{_io}-&gt;read_u2le();
}

sub is_dir {
    my ($self) = @_;
    return $self-&gt;{is_dir} if ($self-&gt;{is_dir});
    $self-&gt;{is_dir} = ($self-&gt;_parent()-&gt;code() &amp; 1) != 0;
    return $self-&gt;{is_dir};
}

sub is_file {
    my ($self) = @_;
    return $self-&gt;{is_file} if ($self-&gt;{is_file});
    $self-&gt;{is_file} = ($self-&gt;_parent()-&gt;code() &amp; 2) != 0;
    return $self-&gt;{is_file};
}

sub _unnamed0 {
    my ($self) = @_;
    return $self-&gt;{_unnamed0};
}

sub file_size {
    my ($self) = @_;
    return $self-&gt;{file_size};
}

sub last_mod_time {
    my ($self) = @_;
    return $self-&gt;{last_mod_time};
}

sub file_attrs {
    my ($self) = @_;
    return $self-&gt;{file_attrs};
}

1;
</code></pre>
            
        </div>
        
    </div>
</section>

    <footer id="main-footer">
        <div class="container">
            &copy; 2015-2018 Kaitai Project and <a href="https://github.com/kaitai-io/kaitai_struct_formats/graphs/contributors">formats repo contributors</a>

            <h3>Contacts</h3>

            <div class="row">
                <div class="col-sm-4">
                    <i class="fa fa-fw fa-2x fa-github"></i> <a href="https://github.com/kaitai-io/kaitai_struct">GitHub</a>
                </div>
                <div class="col-sm-4">
                    <i class="fa fa-fw fa-2x fa-twitter"></i> <a href="https://twitter.com/kaitai_io">@kaitai_io</a>
                </div>
                <div class="col-sm-4">
                    Gitter: <a href="https://gitter.im/kaitai_struct/Lobby">kaitai_struct</a>
                </div>
            </div>
        </div>
    </footer>

  <script src="http://kaitai.io/js/jquery-1.12.3.min.js"></script>
  <script src="http://kaitai.io/js/bootstrap.min.js"></script>

  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-76299550-1', 'auto');
      ga('send', 'pageview');
  </script>
</body>
</html>
