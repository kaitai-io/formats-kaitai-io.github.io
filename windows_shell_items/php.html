<!DOCTYPE html>
<html dir="ltr" lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Windows Shell Items: PHP parsing library</title>
  <meta name="keywords" content="kaitai,struct,binary,format,parsing,decoding,java,javascript,python,ruby,library,metadata">
  <meta name="description" content="Kaitai Struct is a formal language for binary format specification that can be compiled into parser code">

  <link rel="stylesheet" href="//kaitai.io/styles/bootstrap.min.css">
  <link rel="stylesheet" href="//kaitai.io/styles/bootstrap-theme.min.css">
  <link href='https://fonts.googleapis.com/css?family=Exo:400,700' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Share+Tech+Mono' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

  <link rel="stylesheet" href="//kaitai.io/styles/main.css" type="text/css">

  <link rel="stylesheet" href="//kaitai.io/styles/highlight/default.css">
  <style>
.diagram-img {
    display: block;
    max-width: 100%;
    height: auto;
    margin: 0 auto;
}

section.format {
    padding: 30px 0;
}

section#format-meta, section#format-index-header {
    background: #e3eef7;
}

section#format-diagram, section#format-index-footer {
    background: #e9f8dd;
}

section#format-ksy, section#format-lang {
    background: #d1eadd;
}

section#format-index .row {
    padding-bottom: 10px;
}

  </style>
  <script src="//kaitai.io/js/highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
</head>
<body data-spy="scroll" data-target="#main-navbar" data-offset="100">

    <nav class="navbar navbar-inverse navbar-fixed-top" id="main-navbar">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#main-navbar-collapse" aria-expanded="false">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <span class="navbar-brand">Kaitai Struct</span>
            </div>
            <div class="collapse navbar-collapse" id="main-navbar-collapse">
                <ul class="nav navbar-nav">
                    <li><a href="http://kaitai.io/#what-is-it">What is it?</a></li>
                    <li><a href="http://kaitai.io/#quick-start">Quick Start</a></li>
                    <li><a href="http://kaitai.io/#download">Download</a></li>
                    <li class="active"><a href="http://formats.kaitai.io/">Format Gallery</a></li>
                </ul>
                <ul class="nav navbar-nav navbar-right">
                    <li><a href="http://kaitai.io/repl/index.html">Try it</a></li>
                    <li><a href="https://ide.kaitai.io/">Web IDE</a></li>
                    <li><a href="http://doc.kaitai.io/">Documentation</a></li>
                </ul>
            </div>
        </div>
    </nav>
<nav>
    <div class="container">
    <ol class="breadcrumb">
        <li><a href="../index.html">Format Gallery</a></li>
        <li>Windows-specific</li>
        <li class="active">Windows Shell Items</li>
    </ol>
    </div>
</nav>

<section id="format-meta" class="format">
    <div class="container">
        <h1>Windows Shell Items:
            
            PHP parsing library
            
        </h1>

        <div class="row">
            <div class="col-md-8">
                <p><p>Windows Shell Items (AKA &quot;shellbags&quot;) is an undocumented set of
structures used internally within Windows to identify paths in
Windows Folder Hierarchy. It is widely used in Windows Shell (and
most visible in File Explorer), both as in-memory and in-file
structures. Some formats embed them, namely:</p>
<ul>
<li>Windows Shell link files (.lnk) Windows registry</li>
<li>Windows registry &quot;ShellBags&quot; keys</li>
</ul>
<p>The format is mostly undocumented, and is known to vary between
various Windows versions.</p>
</p>
            </div>
            <div class="col-md-4">
                <div class="panel panel-info">
                    
                    
                    
                    <div class="panel-heading">
                        <h3 class="panel-title">KS implementation details</h3>
                    </div>
                    
                    <div class="panel-body">
                        License: <a href="https://spdx.org/licenses/CC0-1.0.html">CC0-1.0</a>
                    </div>
                    
                    
                    
                    
                    
                    <div class="panel-heading">
                        <h3 class="panel-title">References</h3>
                    </div>
                    <div class="panel-body">
                        <ul>
                            
                            
                            
                            
                            
                            
                            
                            
                            
                            
                            
                            <li><a href="https://forensicswiki.xyz/page/Shell Item">Shell Item in ForensicsWiki</a></li>
                            
                            
                            
                        </ul>
                    </div>
                    
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
            <p>
            This page hosts a formal specification of Windows Shell Items
            using <a href="http://kaitai.io">Kaitai Struct</a>. This
            specification can be automatically translated into a
            variety of programming languages to get a parsing library.
            </p>

            <ul class="nav nav-pills">
                
                
                <li>
                
                <a href="index.html" title="Windows Shell Items parsing Overview library">Overview</a></li>
                
                
                <li>
                
                <a href="cpp_stl.html" title="Windows Shell Items parsing C++/STL library">C++/STL</a></li>
                
                
                <li>
                
                <a href="csharp.html" title="Windows Shell Items parsing C# library">C#</a></li>
                
                
                <li>
                
                <a href="graphviz.html" title="Windows Shell Items parsing GraphViz library">GraphViz</a></li>
                
                
                <li>
                
                <a href="java.html" title="Windows Shell Items parsing Java library">Java</a></li>
                
                
                <li>
                
                <a href="javascript.html" title="Windows Shell Items parsing JavaScript library">JavaScript</a></li>
                
                
                <li>
                
                <a href="lua.html" title="Windows Shell Items parsing Lua library">Lua</a></li>
                
                
                <li>
                
                <a href="perl.html" title="Windows Shell Items parsing Perl library">Perl</a></li>
                
                
                <li class="active">
                
                <a href="php.html" title="Windows Shell Items parsing PHP library">PHP</a></li>
                
                
                <li>
                
                <a href="python.html" title="Windows Shell Items parsing Python library">Python</a></li>
                
                
                <li>
                
                <a href="ruby.html" title="Windows Shell Items parsing Ruby library">Ruby</a></li>
                
            </ul>
            </div>
        </div>
    </div>
</section>


<section id="format-lang" class="format">
    <div class="container">
        <h2>
            
            PHP source code to parse Windows Shell Items
            
        </h2>

        

        <h3>WindowsShellItems.php</h3>

        <div class="row">
            <div class="pull-right">
                <p>
                    <a href="src/php/WindowsShellItems.php" class="btn btn-success">Download <i class="fa fa-download"></i></a>
                </p>
            </div>
        </div>

        <div class="row">
            <pre><code class="php">&lt;?php
// This is a generated file! Please edit source .ksy file and use kaitai-struct-compiler to rebuild

/**
 * Windows Shell Items (AKA &quot;shellbags&quot;) is an undocumented set of
 * structures used internally within Windows to identify paths in
 * Windows Folder Hierarchy. It is widely used in Windows Shell (and
 * most visible in File Explorer), both as in-memory and in-file
 * structures. Some formats embed them, namely:
 * 
 * * Windows Shell link files (.lnk) Windows registry
 * * Windows registry &quot;ShellBags&quot; keys
 * 
 * The format is mostly undocumented, and is known to vary between
 * various Windows versions.
 */

class WindowsShellItems extends \Kaitai\Struct\Struct {
    public function __construct(\Kaitai\Struct\Stream $_io, \Kaitai\Struct\Struct $_parent = null, \WindowsShellItems $_root = null) {
        parent::__construct($_io, $_parent, $_root);
        $this-&gt;_read();
    }

    private function _read() {
        $this-&gt;_m_items = [];
        $i = 0;
        do {
            $_ = new \WindowsShellItems\ShellItem($this-&gt;_io, $this, $this-&gt;_root);
            $this-&gt;_m_items[] = $_;
            $i++;
        } while (!($_-&gt;lenData() == 0));
    }
    protected $_m_items;
    public function items() { return $this-&gt;_m_items; }
}

namespace \WindowsShellItems;

class ShellItemData extends \Kaitai\Struct\Struct {
    public function __construct(\Kaitai\Struct\Stream $_io, \WindowsShellItems\ShellItem $_parent = null, \WindowsShellItems $_root = null) {
        parent::__construct($_io, $_parent, $_root);
        $this-&gt;_read();
    }

    private function _read() {
        $this-&gt;_m_code = $this-&gt;_io-&gt;readU1();
        switch ($this-&gt;code()) {
            case 31:
                $this-&gt;_m_body1 = new \WindowsShellItems\RootFolderBody($this-&gt;_io, $this, $this-&gt;_root);
                break;
        }
        switch (($this-&gt;code() &amp; 112)) {
            case 32:
                $this-&gt;_m_body2 = new \WindowsShellItems\VolumeBody($this-&gt;_io, $this, $this-&gt;_root);
                break;
            case 48:
                $this-&gt;_m_body2 = new \WindowsShellItems\FileEntryBody($this-&gt;_io, $this, $this-&gt;_root);
                break;
        }
    }
    protected $_m_code;
    protected $_m_body1;
    protected $_m_body2;
    public function code() { return $this-&gt;_m_code; }
    public function body1() { return $this-&gt;_m_body1; }
    public function body2() { return $this-&gt;_m_body2; }
}

namespace \WindowsShellItems;

class ShellItem extends \Kaitai\Struct\Struct {
    public function __construct(\Kaitai\Struct\Stream $_io, \WindowsShellItems $_parent = null, \WindowsShellItems $_root = null) {
        parent::__construct($_io, $_parent, $_root);
        $this-&gt;_read();
    }

    private function _read() {
        $this-&gt;_m_lenData = $this-&gt;_io-&gt;readU2le();
        if ($this-&gt;lenData() &gt;= 2) {
            $this-&gt;_m__raw_data = $this-&gt;_io-&gt;readBytes(($this-&gt;lenData() - 2));
            $io = new \Kaitai\Struct\Stream($this-&gt;_m__raw_data);
            $this-&gt;_m_data = new \WindowsShellItems\ShellItemData($io, $this, $this-&gt;_root);
        }
    }
    protected $_m_lenData;
    protected $_m_data;
    protected $_m__raw_data;
    public function lenData() { return $this-&gt;_m_lenData; }
    public function data() { return $this-&gt;_m_data; }
    public function _raw_data() { return $this-&gt;_m__raw_data; }
}

namespace \WindowsShellItems;

class RootFolderBody extends \Kaitai\Struct\Struct {
    public function __construct(\Kaitai\Struct\Stream $_io, \WindowsShellItems\ShellItemData $_parent = null, \WindowsShellItems $_root = null) {
        parent::__construct($_io, $_parent, $_root);
        $this-&gt;_read();
    }

    private function _read() {
        $this-&gt;_m_sortIndex = $this-&gt;_io-&gt;readU1();
        $this-&gt;_m_shellFolderId = $this-&gt;_io-&gt;readBytes(16);
    }
    protected $_m_sortIndex;
    protected $_m_shellFolderId;
    public function sortIndex() { return $this-&gt;_m_sortIndex; }
    public function shellFolderId() { return $this-&gt;_m_shellFolderId; }
}

namespace \WindowsShellItems;

class VolumeBody extends \Kaitai\Struct\Struct {
    public function __construct(\Kaitai\Struct\Stream $_io, \WindowsShellItems\ShellItemData $_parent = null, \WindowsShellItems $_root = null) {
        parent::__construct($_io, $_parent, $_root);
        $this-&gt;_read();
    }

    private function _read() {
        $this-&gt;_m_flags = $this-&gt;_io-&gt;readU1();
    }
    protected $_m_flags;
    public function flags() { return $this-&gt;_m_flags; }
}

namespace \WindowsShellItems;

class FileEntryBody extends \Kaitai\Struct\Struct {
    public function __construct(\Kaitai\Struct\Stream $_io, \WindowsShellItems\ShellItemData $_parent = null, \WindowsShellItems $_root = null) {
        parent::__construct($_io, $_parent, $_root);
        $this-&gt;_read();
    }

    private function _read() {
        $this-&gt;_m__unnamed0 = $this-&gt;_io-&gt;readU1();
        $this-&gt;_m_fileSize = $this-&gt;_io-&gt;readU4le();
        $this-&gt;_m_lastModTime = $this-&gt;_io-&gt;readU4le();
        $this-&gt;_m_fileAttrs = $this-&gt;_io-&gt;readU2le();
    }
    protected $_m_isDir;
    public function isDir() {
        if ($this-&gt;_m_isDir !== null)
            return $this-&gt;_m_isDir;
        $this-&gt;_m_isDir = ($this-&gt;_parent()-&gt;code() &amp; 1) != 0;
        return $this-&gt;_m_isDir;
    }
    protected $_m_isFile;
    public function isFile() {
        if ($this-&gt;_m_isFile !== null)
            return $this-&gt;_m_isFile;
        $this-&gt;_m_isFile = ($this-&gt;_parent()-&gt;code() &amp; 2) != 0;
        return $this-&gt;_m_isFile;
    }
    protected $_m__unnamed0;
    protected $_m_fileSize;
    protected $_m_lastModTime;
    protected $_m_fileAttrs;
    public function _unnamed0() { return $this-&gt;_m__unnamed0; }
    public function fileSize() { return $this-&gt;_m_fileSize; }
    public function lastModTime() { return $this-&gt;_m_lastModTime; }
    public function fileAttrs() { return $this-&gt;_m_fileAttrs; }
}
</code></pre>
            
        </div>
        
    </div>
</section>

    <footer id="main-footer">
        <div class="container">
            &copy; 2015-2019 Kaitai Project and <a href="https://github.com/kaitai-io/kaitai_struct_formats/graphs/contributors">formats repo contributors</a>

            <h3>Contacts</h3>

            <div class="row">
                <div class="col-sm-4">
                    <i class="fa fa-fw fa-2x fa-github"></i> <a href="https://github.com/kaitai-io/kaitai_struct">GitHub</a>
                </div>
                <div class="col-sm-4">
                    <i class="fa fa-fw fa-2x fa-twitter"></i> <a href="https://twitter.com/kaitai_io">@kaitai_io</a>
                </div>
                <div class="col-sm-4">
                    Gitter: <a href="https://gitter.im/kaitai_struct/Lobby">kaitai_struct</a>
                </div>
            </div>
        </div>
    </footer>

  <script src="//kaitai.io/js/jquery-1.12.3.min.js"></script>
  <script src="//kaitai.io/js/bootstrap.min.js"></script>

  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-76299550-1', 'auto');
      ga('send', 'pageview');
  </script>
</body>
</html>
